typeof Web=="undefined"&&(Web={DataView:{}});Web.SmartTag=function(){this.initialize()};Web.SmartTag.prototype={isVisible:function(){return this._visible==!0},initialize:function(){this._visible=!1},_hideMenu:function(){var n=this._tag;n&&n.menu&&($(n.menu).menu("destroy").remove(),$(n.markerSelector).removeClass(n.markerClassName),this.unmark(),n.menu=null,n.items=null)},_createTag:function(){var u=this,n=function(){},t=function(n){Web.SmartTag._instance.hide(n)},f=(new Date).getTime()*1e4+621355968000000000,i=function(){return u.open(),!1},r={left:$('<div class="web-smart-tag left"><\/div>').appendTo(document.body).css({position:"absolute",width:"1px"}).hide().hover(n,t).click(i),top:$('<div class="web-smart-tag top"><\/div>').appendTo(document.body).css({position:"absolute",height:"1px"}).hide().hover(n,t).click(i),right:$('<div class="web-smart-tag right"><\/div>').appendTo(document.body).css({position:"absolute",width:"1px"}).hide().hover(n,t).click(i),bottom:$('<div class="web-smart-tag bottom"><\/div>').appendTo(document.body).css({position:"absolute",height:"1px"}).hide().hover(n,t).click(i),arrow:$('<div class="web-smart-tag arrow"><span class="button"><\/span><\/div>').appendTo(document.body).css({position:"absolute"}).hide().hover(n,t).click(i),className:null,uniqueClassName:"st-"+f,markerClassName:"m-"+f};return r.selector="."+r.uniqueClassName,r.markerSelector="."+r.markerClassName,$(document).click(function(){u._hideMenu()}),r},exec:function(){var n=this._tag,i,t;n._callback&&(i=$(n.selector),t=n._callback(i),t&&(this._hideMenu(),t[0].select()))},open:function(n){var u,i,e,o,a,r,t,s;if((!n||$(n.currentTarget).is(".smart-tag"))&&(u=this,i=u._tag,i._callback)&&(e=$(i.selector),o=i._callback(e),o&&(a=e.is(i.markerSelector),i.menu&&u._hideMenu(),!a))){e.addClass(i.markerClassName);i.items=o;r=$(i.selector);t=i.menu=u._buildMenu(o,$([]),0);t.menu({select:function(n,t){for(var e=$(t.item).data("path"),o=i.items,r=null,f=0;f<e.length;f++)r=o[e[f]],r.children&&(o=r.children);if(!r.select)return!1;u._hideMenu();r.select()}}).position({my:"left top",at:"left bottom",of:r});s=r.outerWidth();s>t.outerWidth()&&t.outerWidth(s);var f=r.offset(),v=$(window).scrollLeft(),y=$(window).width(),p=t.outerWidth();f.left+p>v+y&&(t.position({my:"left top",at:String.format("left-{0} bottom",p-(v+y-f.left)),of:r,collision:"none"}),f=t.offset());var h=t.outerHeight(),w=$(window).scrollTop(),c=w+$(window).height();if(f.top+h>c){var b=r.offset(),l=b.top-w,k=c-b.top+r.outerHeight();l>k?(t.outerHeight(h>l?l:h),t.position({my:"left bottom",at:"left top",of:i.selector})):t.outerHeight(c-f.top);t.css("overflow","auto")}t.find("a:first").focus()}},_buildMenu:function(n,t,i){var u=this,r=$(String.format('<ul class="web-smart-tag menu level{0}">',i));return t.length==0&&r.appendTo(document.body),$(n).each(function(n){var i=this,e,f;(i.text||!i.select)&&(e=t.add(n),f=$("<li><\/li>").appendTo(r).data("path",e),i.text?$('<a href="javascript:"><span class="outer"><span class="inner"><\/span><\/span><\/a>').appendTo(f).find("span.inner").text(i.text):$('<div class="divider"><\/div>').appendTo(f),i.checked&&f.addClass("selected"),i.icon&&f.addClass(i.icon),i.children&&u._buildMenu(i.children,e).appendTo(f))}),r},show:function(n,t,i,r){var u,e,s,c;if(this._paused!=!0){u=this._tag;u||(u=this._tag=this._createTag());u._callback=null;t&&(e=u.className==t,s=u.className&&!e,s&&u.left.removeClass(u.className),e||u.left.addClass(t),s&&u.top.removeClass(u.className),e||u.top.addClass(t),s&&u.right.removeClass(u.className),e||u.right.addClass(t),s&&u.bottom.removeClass(u.className),e||u.bottom.addClass(t),s&&u.arrow.removeClass(u.className),e||u.arrow.addClass(t),u.className=t);this._visible=!0;var f=$(n).addClass(u.uniqueClassName).addClass("smart-tag"),o=f.outerWidth(),l=f.outerHeight()-1,h=-1,a=0;if(f.is(".ui-resizable")&&(a=3),o-=a,h-=a,i){u.containerSelector="#"+i.attr("id");var p=i.offset(),w=i.outerWidth(),v=p.left+w-17,y=f.offset();if(y.left+o-1>v){if(c=v-y.left,c<20){this.hide();return}h=c-o;o=c}u.width=o}u.left.height(l).show().position({my:"left top",at:"left top",of:f,collision:"none"});u.top.width(o).show().position({my:"left top",at:"left top",of:f,collision:"none"});u.right.height(l).show().position({my:"left top",at:String.format("right{0} top",h),of:f,collision:"none"});u.bottom.width(o).show().position({my:"left top",at:"left bottom-1",of:f,collision:"none"});u.arrow.height(l).show().position({my:"right top",at:String.format("right{0} top",h),of:f,collision:"none"});u._callback=r}},is:function(n){if(!this._visible)return!1;var t=this._tag;return t.left[0]==n||t.top[0]==n||t.right[0]==n||t.bottom[0]==n||t.arrow[0]==n},hide:function(n){var i,t,r;this._paused!=!0&&((i=null,n&&(i=n.relatedTarget,i||(i=n.toElement)),t=this._tag,i&&t&&(r=$(i),this.is(i)||r.is(t.selector)))||(this._visible=!1,t&&(this.mark(),t.left.hide(),t.top.hide(),t.right.hide(),t.bottom.hide(),t.arrow.hide(),$(t.selector).removeClass(t.uniqueClassName).removeClass("smart-tag"))))},pause:function(){this.hide();this._hideMenu();this._paused=!0},resume:function(){this._paused=!1},mark:function(){var n=this._tag,i,t;if(n&&(i=$(n.markerSelector),i.length!=0)&&(t=this._marker,t||(t=this._marker=this._createMarker()),!t.visible)){t.visible=!0;t.className=n.className;t.containerSelector=n.containerSelector;t._callback=n._callback;var r=i.outerWidth(),f=i.outerHeight()-1,u=-1,e=0;i.is(".ui-resizable")&&(e=3);r-=e;u-=e;n.width<r&&(u=n.width-r,r=n.width);t.left.addClass(n.className).height(f).show().position({my:"left top",at:"left top",of:i,collision:"none"});t.top.addClass(n.className).width(r).show().position({my:"left top",at:"left top",of:i,collision:"none"});t.right.addClass(n.className).height(f).show().position({my:"left top",at:String.format("right{0} top",u),of:i,collision:"none"});t.bottom.addClass(n.className).width(r).show().position({my:"left top",at:"left bottom-1",of:i,collision:"none"});t.arrow.addClass(n.className).height(f).show().position({my:"right top",at:String.format("right{0} top",u),of:i,collision:"none"})}},_createMarker:function(){var r=this,n=this._marker,u=this._tag,t=function(){r.unmark();r.show($(u.markerSelector),n.className,$(n.containerSelector),n._callback)},i=function(){};return n||(n={left:$('<div class="web-smart-tag left marker"><\/div>').appendTo(document.body).css({position:"absolute",width:"1px"}).hide().hover(t,i),top:$('<div class="web-smart-tag top marker"><\/div>').appendTo(document.body).css({position:"absolute",height:"1px"}).hide().hover(t,i),right:$('<div class="web-smart-tag right marker"><\/div>').appendTo(document.body).css({position:"absolute",width:"1px"}).hide().hover(t,i),bottom:$('<div class="web-smart-tag bottom marker"><\/div>').appendTo(document.body).css({position:"absolute",height:"1px"}).hide().hover(t,i),arrow:$('<div class="web-smart-tag arrow marker"><span class="button"><\/span><\/div>').appendTo(document.body).css({position:"absolute"}).hide().hover(t,i)}),n},unmark:function(){var n=this._marker;n&&n.visible&&(n.visible=!1,n.left.hide().removeClass(n.className),n.top.hide().removeClass(n.className),n.right.hide().removeClass(n.className),n.bottom.hide().removeClass(n.className),n.arrow.hide().removeClass(n.className))}};Web.SmartTag._instance=new Web.SmartTag;jQuery.fn.smartTag=function(n,t){var r=arguments,i=Web.SmartTag._instance;if(r.length==2)this.hover(function(){var r=!0;t.test&&(r=t.test());r&&i.show(this,n,t.container,t.items)},function(n){i.hide(n)}).click(function(n){var r=$(n.target);return r.is(".node-button,:input")?!0:(t.select&&t.select(),r.is(".button,.status")?i.exec(n):i.open(n),!1)});else switch(n){case"pause":i.pause();break;case"resume":i.resume();i.hide();break;case"hide":i.hide();i._hideMenu();break;case"destroy":this.off("mouseenter mouseleave click");break;default:throw Error(String.format('Method "{0}" is not supported',n));}return this};Web.DataView.Extensions={};$(document).mousedown(function(n){var f=!1,r=$(n.target),i,t,u;r.parent().length!=0&&((i=r.closest(".resizable-data-view"),i.length==0&&(i=r.closest(".DataViewContainer").parent().children(".resizable-data-view")),i.length==0&&r.closest(".HoverMenu,.web-smart-tag").length>0)||(i.length>0&&(t=i.attr("id"),t=t?t.match(/^(.+?)_[a-z]+$/i):null,t=t?t[1]:null,u=t?$find(t):null,u&&(Web.DataView.Extensions.active(u.extension(),!0),f=!0)),f||Web.DataView.Extensions.active(null,!1)))}).keydown(function(n){var t=Web.DataView.Extensions.activeTarget(n);t&&t.keydown(n)}).keyup(function(n){var t=Web.DataView.Extensions.activeTarget(n);t&&t.keyup(n)}).keypress(function(n){var t=Web.DataView.Extensions.activeTarget(n);t&&t.keydown(n)});Web.DataView.Extensions.activeTarget=function(n){var t=Web.DataView.Extensions.active();return t&&$(n.target).closest("input,select,textarea,.HoverMenu,.web-smart-tag,.Group,.horizontal-scroll-bar-wrap,.vertical-scroll-bar-wrap").length==0?t:null};Web.DataView.Extensions.active=function(n,t){var r,u,i;if(arguments.length==0)return(r=Web.DataView._activeExtensionId,!r)?null:(u=$find(r),u?u.extension():null);if(n!=0){if(t==null)return Web.DataView._activeExtensionId==n.dataView().get_id();t&&this.active(n)||(i=this.active(),t?(i&&i.deactivate(),Web.DataView._activeExtensionId=n.dataView().get_id(),n.activate()):(Web.DataView._activeExtensionId=null,i&&i.deactivate(),n&&n.deactivate()))}};(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>7)&&(Web.DataView.Extensions.DataSheet=function(n){return new Web.DataView.DataSheet(n)});Web.DataView.DataSheet=function(n){this.dataView(n)};Web.DataView.DataSheet.prototype={initialize:function(){var t=this._dataView,n;for(this._rowHeight=15,n=0;n<t._fields.length;n++)t._fields[n].OnDemand&&(this._rowHeight=75);this._headerHeight=15;this._createContainer();this._frozenFieldName=t.readContext("dataSheetFrozenField")},options:function(){return{actionBar:!0,description:!0}},_createContainer:function(){var n=this._dataView,t=this._id=n.get_id()+"_DataSheet",i,r;this._selector="#"+t;i=n._element;this.$that().remove();r=$("<div>").attr("id",t).addClass("container data-sheet resizable-data-view").appendTo(i);this.showRowNumber()&&r.addClass("show-row-numbers")},_reset:function(){var n;this._refreshSpeed=null;$().smartTag("hide");var t=this._cellMap,i=this._gapMap,r=this._headerMap,u=this._rowMap;for(n=0;n<t.length;n++)delete t[n],i&&delete i[n],r&&delete r[n],u&&delete u[n];this._$horizontalScrollbar.slider("destroy");this._$verticalScrollbar.slider("destroy");this.$that().find(".header-cell,.data-cell,span.showing").smartTag("destroy");this._$dataRows.unbind();this._viewId=null;this._dataView._lastExtension=null;this._cursor=null;this.rowRange(null)},rowRange:function(n,t){if(n=="current"){if(!t)return this._currentRowRange;this._lastRowRange=this._currentRowRange;this._currentRowRange=t}else if(n=="last"){if(!t)return this._lastRowRange;this._lastRowRange=t}else this._lastRowRange=null,this._currentRowRange=null},rowHeight:function(){return this._rowHeight},headerHeight:function(){return this._headerHeight},charWidth:function(n){var i,t;if(n==0&&(n=15),i=Web.DataView.DataSheet,t=i._charWidth,t==null){var r="abcdefghijklmnopqrstuvwzyz0123456789",u=$('<div class="data-row"><div class="data-cell"><div class="data-item"><\/div><\/div><\/div>').appendTo(this.$that()),f=u.find(".data-item").text(r).width();i._charWidth=t=Math.ceil(f/r.length);u.remove()}return n?t*n:t},$that:function(n){var t=this._selector;return n&&(n.charAt(0)!="_"&&(n=" "+n),t+=n),$(t)},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},show:function(){var o=this._dataView,u=o.get_viewId(),t,n,r;if(this._viewId!=u||this.pageSize()!=this._lastPageSize?(this._viewId=u,this._allocateCells()):this.$that().show(),this._$sliderPageInfo.hide(),this.lookup()){t=this.$that();n=t.parents(".ModalPlaceholder").find(".HeaderText table:first");n.width("100%");var f=this.$that(".header-row .header-cell:last"),s=f.position(),h=f.outerWidth(),e=s.left+h,c=t.outerWidth(),i=$(window).width()/5*4;e>i&&(e=i);r=i-c;r>0&&(n.parent().outerWidth(n.outerWidth()+r),this.autoSize(!1));this.cursor(!0)}this.autoSize(!1)},hide:function(){this.$that().hide()},activate:function(){this.cursor(!0)},deactivate:function(){this.cursor(!1)},keydown:function(n,t){var h,d,k,p,l;if(this._skipKeyDown){this._skipKeyDown=!1;return}if(h=!1,this.busy())h=!0;else{var v=this._$horizontalScrollbar,a=this.cursor(),c=this.totalRowCount(),r=this.topRowIndex(),s=this.pageSize(),g=this.dataView()._fields,y=g.length-1,f=a.col,i=a.row,u=null;switch(n.keyCode){case 40:u="Down";break;case 38:u="Up";break;case 39:u="Right";break;case 37:u="Left";break;case 34:u="PageDown";break;case 33:u="PageUp";break;case 13:u=n.shiftKey?"ShiftEnter":"Enter";break;case 9:u=n.shiftKey?"ShiftTab":"Tab";break;case 36:u=n.ctrlKey?"CtrlHome":"Home";break;case 35:u=n.ctrlKey?"CtrlEnd":"End"}u&&!t&&navigator.userAgent.match(/webkit/)&&(d=this._lastKey==u,this._lastKey=u,k=(new Date).getTime(),p=this._refreshSpeed,p=p?p*1.5:100,d&&k-this._lastKeyTime<p?(u=null,h=!0):this._lastKeyTime=k);switch(u){case"Down":case"Enter":u=="Enter"&&n.ctrlKey?this.rowCommand(a.row-r,"Select"):a.row<c-1&&(i++,this.cursor(!0,i,f),r+s-1<i?this.scrollTopRow(i-s+1):i<r&&this.scrollTopRow(i));h=!0;break;case"Up":case"ShiftEnter":i>0&&(i--,this.cursor(!0,i,f),i<r?this.scrollTopRow(i):i>r+s-1&&this.scrollTopRow(i-s+1));h=!0;break;case"Right":case"Tab":if(a.col<y||t){f++;f>y&&(f=y);this.cursor(!0,i,f);for(var o=this.cell(0,f),w=this._$verticalScrollbar.offset(),b=v.slider("option"),e=o.is(":visible")?b.value:-1;;)if(l=o.offset(),!o.is(":visible")||l.left+o.outerWidth()>=w.left){if(e==b.max)break;e++;v.slider("option","value",e);this.hScroll(e)}else break}else u=="Tab"&&i<c-1&&(this.cursor(!0,i,0),n.keyCode=37,this.keydown(n,!0),n.keyCode=40,this.keydown(n));!n.ctrlKey&&(i<r||i>r+s-1)&&this.makeCursorVisible();h=!0;break;case"Left":case"ShiftTab":if(a.col>0||t){for(f--,f<0&&(f=0),this.cursor(!0,i,f),o=this.cell(0,f),w=this._$verticalScrollbar.offset(),b=v.slider("option"),e=b.value;;){if(l=o.offset(),o.is(":visible")&&l.left+o.outerWidth()<w.left)break;if(e--,e<0)break;v.slider("option","value",e);this.hScroll(e)}if(!o.is(":visible")||l.left+o.outerWidth()>=w.left)for(e=b.max;;){if(l=o.offset(),o.is(":visible")&&l.left+o.outerWidth()<w.left)break;if(e--,e<0)break;v.slider("option","value",e);this.hScroll(e)}}else u=="ShiftTab"&&i>0&&(this.cursor(!0,i,y),n.keyCode=39,this.keydown(n,!0),n.keyCode=38,this.keydown(n));!n.ctrlKey&&(i<r||i>r+s-1)&&this.makeCursorVisible();h=!0;break;case"PageDown":i+=s;i>c-1&&(i=c-1);this.cursor(!0,i,f);r+=s;r+s>c&&(r=c-s);r<0&&(r=0);this.scrollTopRow(r);h=!0;break;case"PageUp":i-=s;i<0&&(i=0);this.cursor(!0,i,f);r-=s;r<0&&(r=0);this.scrollTopRow(r);h=!0;break;case"Home":case"CtrlHome":n.ctrlKey&&(i=0);this.cursor(!0,i,0);n.keyCode=37;this.keydown(n,!0);n.ctrlKey&&this.makeCursorVisible();break;case"End":case"CtrlEnd":n.ctrlKey&&(i=c-1);this.cursor(!0,i,y);n.keyCode=39;this.keydown(n,!0);n.ctrlKey&&this.makeCursorVisible()}}h&&n.preventDefault&&(n.preventDefault(),n.stopPropagation(),this._skipKeyDown=navigator.userAgent.match(/Firefox/)&&!t)},makeCursorVisible:function(){var u=this.cursor(),n=this.topRowIndex(),i=this.pageSize(),f=u.row,o=this.totalRowCount(),r,s,h,e,t;(f<n||f>n+i-1)&&(n=f-Math.floor(i/2),n+i>=o&&(n=o-i),n<0&&(n=0),this.scrollTopRow(n));r=this.cell(u.row-n,u.col);r.length>0&&(s=r.offset(),h=this._$verticalScrollbar.offset(),s.left+r.outerWidth()>=h.left&&(e=this._$horizontalScrollbar,t=e.slider("option"),t.value++<t.max-1&&(e.slider("option","value",t.value),this.hScroll(t.value))))},keypress:function(){},keyup:function(n){var t=n.which,e=t==189||t==109||t==187||t==107||t==173||t==61;if(e&&n.altKey&&n.shiftKey){var u=this.topRowIndex(),i=this.cursor(),o=this.cell(i.row-u,i.col),r=o.find(".node-button"),f=r.is(".collapsed");r.length>0&&!r.is(".terminal")&&(!f&&(t==189||t==109||t==173)||f&&(t==187||t==107||t==61))&&($().smartTag("hide"),this.execute("node-button",i.row-u,i.col,"click",r[0]),n.preventDefault(),n.stopPropagation())}},field:function(n){return this._dataView.findField(n)},fieldUnderAlias:function(n){return this._dataView.findFieldUnderAlias(this.field(n))},hierarchyField:function(){return this._hierarchyField},visibleDataRows:function(n){var w=this._dataView,u=null,f=null,l=null,i=n,a,s,t,r,c,o;i==null&&(i=this.pageIndex());a=w._cachedPages;s=this.pageCount();s==1&&this.pageOffset(0);var e=this.pageOffset(),v=e>0&&i<s-1,k=this.hierarchyField()!=null,y=i==s-1&&i>0;for(t=0;t<a.length;t++)if(r=a[t],r.index==i?u=r:v&&r.index==i+1?f=r:(y||k)&&r.index==i-1&&(l=r),u&&(v&&f||y&&l))break;if(!u||v&&!f||y&&!l)return null;n!=null&&w.set_pageIndex(n);var h=[],b=u.index*this.pageSize()+e,p=b-1;for(t=e;t<u.rows.length;t++)Array.add(h,u.rows[t]),p++;if(this._bottomInvisibleRow=null,f){for(c=f.rows,o=c.length,o>e&&(o=e),t=0;t<o;t++)Array.add(h,c[t]),p++;this._bottomInvisibleRow=c[o]}return this.rowRange("current",{first:b,last:p,rows:h}),h},wait:function(n){var t=this._$pagerRefresh;t&&(n||n==null?t.addClass("wait"):t.removeClass("wait"))},busy:function(){return this._dataView._isBusy},row:function(n){var t=this._rowMap,i,r;return t||(t=this._rowMap=[]),i=t[n],i||(r=this.$that(String.format("_R{0}",n)),i=t[n]=r),i},cell:function(n,t){var r=this._cellMap,i,u;return r||(r=this._cellMap=[]),i=r[n],u=i?i[t]:null,u||(i||(i=r[n]=[]),u=i[t]=this.$that(String.format("_R{0}_C{1}",n,t))),u},gap:function(n){var t=this._gapMap,i,r;return t||(t=this._gapMap=[]),i=t[n],i||(r=this.$that(String.format("_RG{0}",n)),i=t[n]={gap:r,status:r.find(".status"),number:r.find(".number")}),i},header:function(n){var t=this._headerMap,i,r;return t||(t=this._headerMap=[]),i=t[n],i||(r=this.$that(String.format("_H{0}",n)),i=t[n]=r),i},refresh:function(n){var u=this._dataView,c=u._fields,t,e,a,nt,v,i,tt,lt,it,s,y,p,w,at,h,rt,b,vt,ut,k,ft;if(!n&&(n=this.visibleDataRows(),n==null)){u.goToPage(u.get_pageIndex(),!0);return}var o=this.rowRange("last"),r=this.rowRange("current"),l=[],d=this.pageSize(),et=this.showRowNumber(),yt=this.multiSelect(),pt=this.topRowIndex(),g=this.hierarchyField(),wt=this.keyField(),f=new Sys.StringBuilder;u._disableObjectRef=!0;var ot=this.systemFilter(),st=Web.DataViewResources.Form,ht=u._hasKey(),ct=!this._refreshSpeed;if(ct&&(this._refreshSpeed=(new Date).getTime()),o&&r)if(o.first==r.first&&o.last==r.last)for(t=0;t<d;t++)l.push(t);else for(e=r.first<o.first?r.last:r.first,a=e==r.last?-1:1;a>0&&e<=r.last||a<0&&e>=r.first;){if(o.first<=e&&e<=o.last&&(nt=e-r.first,v=e-o.first,0<=v&&v<d)){for(i=0;i<c.length;i++)tt=this.cell(nt,i),lt=this.cell(v,i),tt.empty(),it=lt[0].childNodes,it.length>0&&tt[0].appendChild(it[0]);l.push(nt)}e+=a}for(t=0;t<n.length;t++){if(s=n[t],l.length==0||!Array.contains(l,t))for(i=0;i<c.length;i++)y=c[i],y=u._allFields[y.Index],f.append('<div class="data-item">'),p=!1,i==0&&(yt&&f.appendFormat('<input type="checkbox" class="checkbox"/>'),ht&&(p=!0),g&&(w=s[g.Index],w&&(at=w.split("/"),h=n[t+1],h||(h=this._bottomInvisibleRow),rt=h?h[g.Index]:null,b=ot&&Array.contains(ot,s[wt.Index]),f.appendFormat('<span style="margin-left:{0}px;" class="button node-button{1}{2}" title="{3}"><\/span>',(at.length-1)*16,(!rt||w.length>=rt.length)&&!b?" terminal":"",b?" collapsed":"",b?st.Maximize:st.Minimize)))),p&&f.append('<span class="button">'),u._renderItem(f,y,s,!1,null,!1),p&&f.append("<\/span>"),f.append("<\/div>"),vt=this.cell(t,i),vt[0].innerHTML=f.toString(),f.clear();ut=this.row(t).removeClass("empty");ht&&(u.rowIsSelected(s)?ut.addClass("selected"):ut.removeClass("selected"));et&&this.gap(t).number.text(pt+t+1)}for(u._disableObjectRef=!1,t=n.length;t<d;t++){for(i=0;i<c.length;i++)this.cell(t,i).empty();this.row(t).removeClass("selected").addClass("empty");et&&this.gap(t).number.text("")}this._syncVScrollBar();this.wait(!1);ct&&(this._refreshSpeed=(new Date).getTime()-this._refreshSpeed);k=this.cursor();ft=this.totalRowCount();k&&k.row>=ft?this.cursor(!0,ft-1,k.col):this.cursor(!0)},reset:function(n){n&&this.pageOffset(0);this.rowRange(null)},fixedColumns:function(){for(var t,i=this._frozenFieldName,r=this._dataView._fields,n=0;n<r.length;n++)if(t=r[n],t.Name==i||!i&&t.tagged("data-sheet-freeze"))return n+1;return 0},freeze:function(n){var i=this._dataView,t;if(n==null)return(t=this.fixedColumns(),t==0)?null:i._fields[t-1].Name;n==""&&(n=null);i.writeContext("dataSheetFrozenField",n);this._frozenFieldName=n;this._reset();this.show();this.refresh()},_freeze:function(){var n=this.fixedColumns();this.$that().find("div.data-row").each(function(){$(String.format("div.data-cell:lt({0})",n),this).addClass("fixed")})},_allocateCells:function(){var n=this,t,u,f,nt,a,o,v,s,tt,w,it,b,k,rt,d,st,y;this._createContainer();var i=this._dataView,p=i._fields,ft=i._allFields,vt=i._rows,yt=i.get_pageCount(),h=i.get_pageSize();this._lastPageSize=h;var c=this.totalRowCount(),et=this.headerHeight(),ot=this.rowHeight();for(t=0;t<ft.length;t++)u=ft[t],u.tagged("hierarchy-organization")&&(this._hierarchyField=u);f=i.readContext("dataSheetColumnWidth");nt=f==null;nt&&(f=[]);var ct=0,e=this._id,r=new Sys.StringBuilder,l=3;for(this.showRowNumber()&&(l+=c.toString().length),l=this.charWidth(l),r.appendFormat('<div id="{0}_H" class="header-row"><div id="{0}_HG" class="header-gap" style="position:relative;height:{1}px;width:{2}px"><span><\/span><\/div>',e,et,l),t=0;t<p.length;t++)u=p[t],u=i._allFields[u.AliasIndex],nt?(a=this.charWidth(u.Columns),f[t]=a):a=f[t],ct+=a,r.appendFormat('<div id="{0}_H{1}" class="header-cell c{1}" style="position:relative;width:{2}px;height:{3}px"><\/div>',e,t,a,et);for(r.append("<\/div>"),o=0;o<h;o++){for(v="",o==0&&(v+=" first"),o==h-1&&(v+=" last"),o%2!=0&&(v+=" alternating"),r.appendFormat('<div id="{0}_R{1}" class="data-row{3}"><div id="{0}_RG{1}" class="data-gap" style="position:relative;height:{2}px;width:{4}px"><div class="gap-item"><span class="status">&nbsp;<\/span><span class="number"><\/span><\/div><\/div>',e,o,ot,v,l),t=0;t<p.length;t++)u=p[t],u=i._allFields[u.AliasIndex],r.appendFormat('<div id="{0}_R{1}_C{2}" class="data-cell c{2}" style="position:relative;width:{3}px;height:{4}px"><!--r{1}, c{2}--><\/div>',e,o,t,f[t],ot);r.append("<\/div>")}r.append("<\/div>");r.appendFormat('<div id="{0}_HSB" class="horizontal-scroll-bar-wrap"><div class="scroll-bar"><\/div><\/div>',e);r.appendFormat('<div id="{0}_Pager" class="pager"><span class="showing"><\/span><span title="Refresh" class="refresh"><\/span><\/div>',e);r.appendFormat('<div id="{0}_VSB" class="vertical-scroll-bar-wrap"><div class="scroll-bar"><\/div><\/div>',e);s=this.$that();tt=s.outerWidth();s.show().html(r.toString());w=n.sort();$(".header-cell",s).each(function(t){var i=n._dataView._fields[t],r,u;i=n._dataView._allFields[i.AliasIndex];t==0&&n.multiSelect()&&$('<input type="checkbox" class="checkbox"/>').appendTo(this);i.AllowSorting?(r=$('<span class="button"><\/span>').appendTo(this).text(i.HeaderText).attr("title",String.format(Web.DataViewResources.HeaderFilter.SortBy,i.HeaderText)),u=$('<span class="status"><\/span>').appendTo(r),w&&w.fieldName==i.Name&&u.addClass(w.order!="desc"?"sort-asc":"sort-desc")):$(this).text(i.HeaderText)});r.clear();it=this.$that("div.header-row");b=0;this._$headerCells=$(it).find("div.header-cell,div.header-gap").each(function(t){var r=$(this);b+=r.outerWidth();t==0&&(k=r.outerHeight());t>0&&r.resizable({handles:"e",maxWidth:tt-50,alsoResize:String.format("#{0} div.data-cell.c{1}",e,t-1),resize:function(r,u){f[t-1]=u.size.width;i.writeContext("dataSheetColumnWidth",f);n.cursor(!0)},start:function(){},stop:function(){n.autoSize(!0);$().smartTag("resume")}}).find(".ui-resizable-handle").mousedown(function(){$().smartTag("pause")}).mouseup(function(){$().smartTag("resume")}).dblclick(function(r){var o=$(r.target),s=o.css("cursor"),u;o.css("cursor","default");u=0;n.$that(String.format("div.data-cell.c{0} div.data-item",t-1)).each(function(){var n=$(this),i=n.css("position"),t;n.css("position","absolute");t=n.outerWidth();n.css("position",i);t>u&&(u=t)});u<tt-20&&(f[t-1]=u,$(String.format("#{0} div.header-cell.c{1}, #{0} div.data-cell.c{1}",e,t-1)).width(u),n.autoSize(!0),$().smartTag("resume"),i.writeContext("dataSheetColumnWidth",f),n.cursor(!0));o.css("cursor",s)})});it.height(k);rt=this._$dataRows=this.$that("div.data-row").each(function(){var n=this,t;b=0;t=$("div.data-cell,div.data-gap",n).each(function(n){var t=$(this);b+=t.outerWidth();n==0&&(k=t.outerHeight())});$(n).height(k);t.css("top",0)}).click(function(t){var i=$(t.target),u=parseInt($(this).attr("id").match(/_R(\d+)$/)[1]),f=n.cellIndex(i),r="row";action="click";i.is(".node-button")&&(r="node-button");n.execute(r,u,f,action,t.target)});this._$dataGaps=this.$that("div.data-gap");d=navigator.userAgent.match(/Firefox/)==!0;st=d?"wheel":"mousewheel";rt.bind(st,function(t){var u=t.originalEvent?t.originalEvent.wheelDelta/120:null,f,r,i,e,o;u==null&&(u=t.originalEvent.deltaY!=null?t.originalEvent.deltaY:null);u!=null&&n.pageCount()>1&&($().smartTag("pause"),n.busy()||(f=Math.ceil(Math.abs(u)),r=t.originalEvent.wheelDeltaX,r==null&&(r=t.originalEvent.deltaX!=null?t.originalEvent.deltaX:null),r!=null&&r!=0?(d||(r*=-1),t.keyCode=r>0?37:39,t.ctrlKey=!0,n.keydown(t)):(d&&(u*=-1),i=n.topRowIndex(),e=n.pageSize(),u<0?(i=i+f,o=n.totalRowCount(),i+e>o&&(i=o-e),i<0&&(i=0),n.scrollTopRow(i)):(i=i-f,i<0&&(i=0),n.scrollTopRow(i)))),t.preventDefault(),t.stopPropagation(),$().smartTag("resume"))});this.$that(".header-cell").each(function(t){$(this).smartTag("header-cell",{container:s,items:function(){return n._contextMenuOfColumn(t)}})});rt.each(function(t){$(this).find(".data-cell.c0").smartTag("data-cell",{container:s,items:function(){return n._contextMenuOfDataRow(t)},test:function(){var i=n.absoluteRowIndex(t);return i<n.totalRowCount()},select:function(){var i=n.absoluteRowIndex(t);c=n.totalRowCount();i>=c&&(i=c-1);n.cursor(!0,i,0)}})});this._$pageShowing=this.$that("div.pager span.showing").smartTag("pager-menu",{container:s,items:function(){var t=[];return $(Web.DataViewResources.Pager.PageSizes).each(function(){var r=this;t.push({text:String.format("{0} {1}",Web.DataViewResources.Pager.ItemsPerPage,this),checked:this==i.get_pageSize(),select:function(){n.pageSize(r)}})}),t}});this._freeze();y=this._$horizontalScrollbar=this.$that("_HSB .scroll-bar");y.slider({orientation:"horizontal",min:0,max:0,value:0,animate:100,slide:function(t,i){n.hScroll(i.value)},start:function(){$().smartTag("pause")},stop:function(){$().smartTag("resume");y.width("100%")}});var lt=y.find(".ui-slider-handle").mousedown(function(){y.width(at.width())}),at=lt.append('<div class="ui-handle-helper"><\/div>').wrap('<div class="ui-slider-handle-parent"><\/div>').parent(),pt=this.$that("div.data-row.last"),ut=this._$sliderPageInfo=$("<div>").addClass("data-sheet pager-info-popup").css({position:"absolute"}).hide().appendTo(document.body);n._pageInfoTimeout=-1;n.pageInfoSlideTimeout=null;var ht=this._$verticalScrollbar=this.$that("_VSB .scroll-bar").slider({orientation:"vertical",min:0,max:c<=h?0:c-h,animate:100,value:i.get_pageIndex()*h+n.pageOffset(),slide:function(t,i){n._skipSyncVScrollBar=!0;var r=n.scrollTopRow(i.value,!0);n._pageInfoSlideTimeout||(n._pageInfoSlideTimeout=setTimeout(function(){ut.show().position({my:"right-8 middle",at:"left middle",of:g});n._pageInfoSlideTimeout=null},50));n._pageInfoTimeout!=-1&&clearTimeout(n._pageInfoTimeout);n._updatePageInfo(r)},change:function(){ut.show().position({my:"right-8 middle",at:"left middle",of:$(this).find("a.ui-slider-handle")})},start:function(){if(n.busy())return!1;$().smartTag("pause")},stop:function(){$().smartTag("resume");n._pageInfoTimeout=setTimeout(function(){ut.hide()},1e3);n.resetVScrollBar&&(n.$that("_VSB .scroll-bar").height("100%").css({"margin-top":0}),n._$vSliderHandleParent.css("margin-top",+g.height()/2),n.resetVScrollBar=!1)}}),g=this._$vSliderHandle=ht.find(".ui-slider-handle").mousedown(function(){ht.slider("option","max")>0&&(n.resetVScrollBar=!0,n.$that("_VSB .scroll-bar").height(n._$vSliderHandleParent.height()).css({"margin-top":+g.height()/2}),n._$vSliderHandleParent.css("margin-top",0))}),wt=this._$vSliderHandleParent=g.append('<div class="ui-handle-helper"><\/div>').wrap('<div class="ui-slider-handle-parent"><\/div>').parent();this._$pagerRefresh=this.$that("_Pager .refresh").click(function(){return n.busy()||(i._hasSearchAction?i.search():i.sync()),!1});this.autoSize();(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)&&$(window).resize(function(){n.autoSize(!0)})},cellIndex:function(n){var t=$(n).parent(".data-cell",".data-cell").andSelf().attr("id"),i=t?t.match(/_C(\d+)$/):null;return i==null?-1:parseInt(i[1])},hScroll:function(n){var t=this,i=t.fixedColumns(),r=i==0?"":String.format(":gt({0})",i-1);t.$that("div.data-cell").show();t.$that("div.header-cell").show();t.$that(String.format("div.header-row div.header-cell:lt({0}){1}",n+i,r)).hide();this._$dataRows.each(function(){$(this).find(String.format("div.data-cell:lt({0}){1}",n+i,r)).hide()});$().smartTag("hide");t.cursor(!0)},keyField:function(){var t=this._dataView,n=t._keyFields;return n.length>0?n[0]:null},topRowIndex:function(){return this.pageIndex()*this.pageSize()+this.pageOffset()},absoluteRowIndex:function(n){return n+this.topRowIndex()},execute:function(n,t,i,r){var f,e,u,h,o,s;if(!this.busy())if(f=this._dataView,n=="node-button"){var c=this.keyField(),l=this.rowRange("current").rows,a=l[t][c.Index];r=="click"&&(this.systemFilter(a),f._clearCache(!1),f._requiresRowCount=!0,f.goToPage(this.pageIndex()))}else e=this.totalRowCount(),u=this.absoluteRowIndex(t),u>=e&&(u=e-1),i>=0?(this.cursor(!0,u,i),this.makeCursorVisible()):(h=this.cursor(),i=h.col,o=this.cell(t,i),(!o.is(":visible")||o.offset().left>this._$verticalScrollbar.offset().left)&&(s=$(this._$dataRows[t]).find(".data-cell:visible"),s.length>0&&(i=this.cellIndex(s[0]))),this.cursor(!0,u,i),this.rowCommand(t,"Select"))},rowCommand:function(n,t,i){var f=this._dataView,r=this.rowRange("current").rows,u;n>=r.length&&(n=r.length-1);u=r[n];f.rowCommand(u,"Select",i);$().smartTag("hide")},systemFilter:function(n){var t=this._nodeFilter,i;if(n==null||n==!0)return t;n==!1?this._nodeFilter=null:(t||(t=this._nodeFilter=["collapse-nodes"]),i=Array.indexOf(t,n),i==-1?Array.add(t,n):Array.remove(t,n))},pageIndex:function(){var n=this._dataView;return n.get_pageIndex()},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageOffset:function(n){var t=this._dataView;if(n==null)return this._pageOffset!=null?this._pageOffset:0;this._pageOffset=n},scrollTopRow:function(n,t){t==null&&(t=!1);var i=this,s=this._dataView,l=this.totalRowCount(),u=s.get_pageSize(),f=t?l-u-n:n,e=Math.floor(f/u),a=f-e*u;i._goToPageTimeout!=-1&&clearTimeout(i._goToPageTimeout);i.pageOffset(a);var r=i.visibleDataRows(e),o=function(){r?i.refresh(r):s.goToPage(e,!1)},h=100,c=this._refreshSpeed;return c==null||c<75||t==!1?t&&!r?i._goToPageTimeout=window.setTimeout(o,500):o():(t&&!r&&(h=500),i._goToPageTimeout=window.setTimeout(o,h)),f},autoSize:function(n){var a=this,v,t,i,c,u,g,l;if(a._refreshSpeed=null,n==!0){this._autoSizeTimeout&&clearTimeout(this._autoSizeTimeout);this._autoSizeTimeout=setTimeout(function(){a.autoSize();this._autoSizeTimeout=null},50);return}if(v=$(window).scrollTop(),t=this.$that(),t.is(":visible")){var y=this._dataView,f=y._fields,p=$(".container.resizable-data-view:visible");p.hide();t.outerWidth($(y._element).width());p.show();var r=this._$horizontalScrollbar,nt=r.find(".ui-slider-handle"),tt=r.find(".ui-slider-handle-parent"),w=1+this.$that("_VSB").outerWidth();this.$that("_HSB").outerWidth(t.outerWidth()-w);var o=-1,e=-1,s=t.width()-w-t.find("div.header-cell.c0").position().left;t.find("div.data-row.first div.data-cell.fixed").each(function(){var n=$(this).width();s-=n;h+=n});var b=this.fixedColumns(),h=0,k=function(n){var t=$(n),i=t.is(":visible"),r;return i||t.show(),r=t.outerWidth(),i||t.hide(),r},it=t.find("div.data-row.first div.data-cell").each(function(n){if(n>=b){var t=k(this),i=h+t;if(i>=s)return o=n,!1;h+=t}}),d=0;$(it.get().reverse()).each(function(n){var t=k(this),i=d+t;if(i>=s)return e=f.length-n-b,!1;d+=t});i=o!=-1?f.length-o:0;i<e&&(i=e);this._rightMostFirstInvisibleColumn=e;r.slider("option","max",i);r.slider("option","value")>i&&r.slider("option","value",i);c=r.width();u=c;i>0?u=(f.length-i)/f.length*u:(this.$that("div.data-cell").show(),this.$that("div.header-cell").show());nt.css({width:u,"margin-left":-u/2});tt.width(c-u);g=this.$that(".header-row");l=this.$that("div.data-row.last");this.$that("_VSB").css({position:"absolute"}).height(l.position().top+l.outerHeight()).position({my:"right top",at:"right top",of:g,collision:"none"});this._updatePageInfo();$(window).scrollTop(v)}},_syncVScrollBar:function(){var e,n;if(this._skipSyncVScrollBar){this._skipSyncVScrollBar=!1;return}var h=this._dataView,i=this._$verticalScrollbar,r=this.totalRowCount(),u=h.get_pageSize(),f=r<=u?0:r-u,o=i.slider("option"),s=this.topRowIndex(),t=r>u?r-u-s:0;t<0&&(t=0);o.max!=f?(i.slider("option","max",f),t>f&&(t=f-1),i.slider("option","value",t),this._$sliderPageInfo.hide()):o.value!=t&&(i.slider("option","value",t),this._$sliderPageInfo.hide());this._updatePageInfo(s);e=i.height();n=0;r>u&&(n=e*(u/r));n<10&&(n=10);this.$that("_VSB .scroll-bar").height("100%");i.slider("option","max")==0?(this._$vSliderHandleParent.height("100%").css("margin-top",0),this._$vSliderHandle.css({height:e,"margin-bottom":0})):(this._$vSliderHandleParent.height(e-n).css("margin-top",n/2),this._$vSliderHandle.css({height:n,"margin-bottom":-n/2}))},_updatePageInfo:function(n){var f=this._dataView,t=this.totalRowCount(),i=f.get_pageSize(),r,u;i>t&&(i=t);n==null&&(n=f.get_pageIndex()*i+this.pageOffset());r=n+i;r>=t&&(r=t,n=t-i);n++;this._$sliderPageInfo[0].innerHTML=String.format("{0} - {1}",n,r);u=Web.DataViewResources;this._$pageShowing[0].innerHTML=t>0?String.format(u.Pager.ShowingItems,n,r,t):u.Data.NoRecords;this._$pagerRefresh.css({position:"absolute"}).position({my:"right middle",at:"right middle",of:this.$that("_Pager"),collision:"none"})},lookup:function(){return this.dataView().get_lookupField()},_contextMenuOfDataRow:function(n){var t=this;return[{text:"Select",select:function(){t.lookup()?t.rowCommand(n,"Select"):t.rowCommand(n,"Select","editForm1")}}]},sort:function(n){var r=this._dataView,t,i;if(n==null)return n=r.get_sortExpression(),t=n?n.match(/^(\w+?)(\s+(asc|desc))?$/):null,{fieldName:t?t[1]:null,order:t?t[3]:null};this.busy()||(this.pageOffset(0),r.sort(n),this._$headerCells.find(".status").removeClass("sort-asc sort-desc"),t=this.sort(),t.fieldName&&(i=this.fieldUnderAlias(t.fieldName),i&&this.header(i.Index).find(".status").addClass(t.order!="desc"?"sort-asc":"sort-desc")))},showRowNumber:function(){return this._dataView.get_showRowNumber()==!0},multiSelect:function(){return this._dataView.get_showMultipleSelection()},totalRowCount:function(){var n=this._dataView;return n._totalRowCount},pageSize:function(n){if(!this.busy()){var t=this._dataView;if(n==null)return t.get_pageSize();this._reset();t._clearCache();t.set_pageSize(n)}},_contextMenuOfColumn:function(n){var t=[],u=this,l=u._dataView,y=l._fields,s=y[n],h=l._allFields[s.AliasIndex],a=Web.DataViewResources,i=a.HeaderFilter,v=a.Grid,e,o,f,r,c;if(h.AllowSorting){e=i.GenericSortAscending;o=i.GenericSortDescending;switch(h.FilterType){case"Text":e=i.StringSortAscending;o=i.StringSortDescending;break;case"Date":e=i.DateSortAscending;o=i.DateSortDescending}f=this.sort();r=h.Name;t.push({select:function(){u.sort(r)}});t.push({text:e,icon:"sort-asc",checked:f.fieldName==r&&f.order!="desc",select:function(){u.sort(r+" asc")}});t.push({text:o,icon:"sort-desc",checked:f.fieldName==r&&f.order=="desc",select:function(){u.sort(r+" desc")}})}return c=this.freeze()==s.Name,t.push({text:c?v.Unfreeze:v.Freeze,select:function(){u.freeze(c?"":s.Name)}}),t.length>0?t:[{text:"Header Item 1",select:function(){alert("header 1")}},{text:"Header item number 2",select2:function(){alert("header 2")},children:[{text:"Header Sub Item 1",select:function(){alert("header sub item 1")}},{text:"Header Sub Item 2",select:function(){alert("header sub item 2")}},{text:"Header Sub Item 3",select:function(){alert("header sub item 3")}},{text:"Header Sub Item 4",select:function(){alert("header sub item 4")}},{text:"Header Sub Item 5",select:function(){alert("header sub item 5")}}]},{text:"item #3",select:function(){alert("header 3")}}]},cursor:function(n,t,i){var l=this._dataView,f,r;if(Web.DataView.Extensions.active(this)||(n=!1),f=this.$that(),r=this._cursor,r||(r=this._cursor={left:$('<div class="cursor left"><\/div>').appendTo(f).css({position:"absolute",width:"3px"}).hide(),top:$('<div class="cursor top"><\/div>').appendTo(f).css({position:"absolute",height:"3px"}).hide(),right:$('<div class="cursor right"><\/div>').appendTo(f).css({position:"absolute",width:"3px"}).hide(),bottom:$('<div class="cursor bottom"><\/div>').appendTo(f).css({position:"absolute",height:"3px"}).hide(),row:0,col:0}),n==null)return r;if(this._$dataGaps.removeClass("cursor"),this._$headerCells.removeClass("cursor"),n){t!=null&&(r.row=t);i!=null&&(r.col=i);var h=this.pageSize(),c=this.topRowIndex(),e=r.row-c;if(e<0||e>=h)this.cursor(!1);else{var u=this.cell(e,r.col),o=u.outerHeight()-3,s=u.outerWidth()+3;r.left.height(o).show().position({my:"left top",at:"left-2 top+1",of:u,collision:"none"});r.top.width(s).show().position({my:"left top",at:"left-2 top-2",of:u,collision:"none"});r.right.height(o).show().position({my:"left top",at:"right-2 top+1",of:u,collision:"none"});r.bottom.width(s).show().position({my:"left top",at:"left-2 bottom-2",of:u,collision:"none"});this.gap(e).gap.addClass("cursor");this.header(r.col).addClass("cursor")}}else r.left.hide(),r.top.hide(),r.right.hide(),r.bottom.hide()}}