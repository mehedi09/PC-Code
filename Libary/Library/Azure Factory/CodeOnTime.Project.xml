<?xml version="1.0" encoding="utf-8" ?>
<project xmlns="http://www.codeontime.com/2008/code-generator"
         xmlns:ontime="http://www.codeontime.com/2008/code-generator"
         xmlns:a="urn:schemas-codeontime-com:data-aquarium-project"
         xmlns:c="urn:schemas-codeontime-com:data-aquarium"
				 xmlns:config="http://www.codeontime.com/2008/codedom-configuration"
				 xmlns:vsproj="http://schemas.microsoft.com/developer/msbuild/2003"
         xmlns:app="urn:schemas-codeontime-com:data-aquarium-application"
         debug="false"
>
  <information>
    <product>COT201105-AF</product>
    <title>Azure Factory</title>
    <description>Create an Azure Cloud solution from your SQL Azure database. Includes a Web Role and class library implementing a web site with navigation system, role-based security, membership manager, built-in data export, reporting, optional mobile user interface, and much more. Have it online in 15 minutes.</description>
    <vendor>Code OnTime LLC</vendor>
    <website>http://www.codeontime.com</website>
    <about>http://codeontime.com/learn/project-types/azure-factory</about>
    <demo>http://www.codeontime.com/demo</demo>
  </information>
  <build>
    <!-- load entire project output file/folder tree -->
    <load path="$ProjectPath">
      <if test="not(file/@name='DataAquarium.Project.xml')">
        <copy input="$LibraryRoot\Data Aquarium\DataAquarium.Project.xml" output="DataAquarium.Project.xml"/>
      </if>
    </load>
    <navigate url="..\Data Aquarium\DataAquarium.Start.htm?webServer2=false&amp;splash=AzureFactory"/>
    <load path="DataAquarium.Project.xml">
      <variable name="ConnectionString" select="a:project/a:connectionString"/>
      <variable name="ProviderName" select="a:project/a:providerName"/>
      <variable name="MembershipProviderName" select="a:project/a:membership/@providerName"/>
      <load path="$ProjectPath">
        <if test="not(file/@name='DataAquarium.Metadata.xml')">
          <execute fileName="CodeOnTime.exe" arguments="/connectionString:&quot;$ConnectionString&quot; /providerName:&quot;$ProviderName&quot; /output:&quot;$ProjectPath\DataAquarium.Metadata.xml&quot;" mode="wait"/>
        </if>
      </load>
    </load>
    <retract path="Error.DataAquarium.Metadata.xml" test="ontime:error!=''" steps="2"/>
    <!-- convert project data model in the Data Aquarium controller collection -->
    <load path="DataAquarium.Project.xml">
      <variable name="Compatibility" select="a:project/@compatibility"/>
      <variable name="Namespace" select="a:project/a:namespace"/>
      <variable name="TargetFramework" select="a:project/@targetFramework"/>
      <variable name="ScriptOnly" select="a:project/@targetFramework='4.5' and a:project/a:features/a:framework/@scriptOnly='true'"/>
      <variable name="ReportsEnabled" select="a:project/a:reports/@enabled"/>
      <variable name="MembershipEnabled" select="a:project/a:membership/@enabled"/>
      <variable name="WindowsAuthentication" select="a:project/a:membership/@windowsAuthentication"/>
      <variable name="CustomSecurity" select="a:project/a:membership/@customSecurity"/>
      <variable name="ActiveDirectory" select="a:project/a:membership/@activeDirectory"/>
      <variable name="DedicatedLogin" select="a:project/a:membership/@dedicatedLogin"/>
      <variable name="HelpEnabled" select="/a:project/a:membership/@displayHelp"/>
      <variable name="AnnotationsEnabled" select="a:project/a:features/@annotations"/>
      <variable name="AnnotationsPath" select="a:project/a:features/@annotationsPath"/>
      <variable name="NewColumnEnabled" select="a:project/a:features/@newColumn"/>
      <variable name="FloatingEnabled" select="a:project/a:features/@floating"/>
      <variable name="MaxGridFields" select="a:project/a:features/@maxGridFields"/>
      <variable name="MultiSelectEnabled" select="a:project/a:features/@multiSelect"/>
      <variable name="ShowModalForms" select="a:project/a:features/@showModalForms"/>
      <variable name="SearchOnStart" select="a:project/a:features/@advancedSearch"/>
      <variable name="SearchOnStartInLookups" select="a:project/a:features/@advancedLookup"/>
      <variable name="BatchEditEnabled" select="a:project/a:features/@batchEdit"/>
      <variable name="RelationshipExplorer" select="a:project/a:features/@relationshipExplorer"/>
      <variable name="EnableTransactions" select="a:project/a:features/@enableTransactions"/>
      <variable name="PageHeader" select="a:project/a:features/@pageHeader"/>
      <variable name="Copyright" select="a:project/a:features/@copyright"/>
      <variable name="DataViewLayout" select="a:project/a:layout/@name"/>
      <variable name="BLL_DiscoveryDepth" select="a:project/a:bll/@discoveryDepth"/>
      <variable name="BLL_FieldMap" select="a:project/a:bll/a:fieldMap"/>
      <variable name="BLL_Keys" select="a:project/a:bll/a:keys"/>
      <variable name="BLL_FieldsToIgnore" select="a:project/a:bll/a:fieldsToIgnore"/>
      <variable name="BLL_FieldsToHide" select="a:project/a:bll/a:fieldsToHide"/>
      <variable name="BLL_CustomLabels" select="a:project/a:bll/a:customLabels"/>
      <variable name="DatabaseObjectFilter" select="a:project/a:databaseObjectFilter"/>
      <variable name="BLL_LabelFormatExpression" select="a:project/a:bll/@labelFormatExpression"/>
      <variable name="BLL_SharedBusinessRules" select="a:project/a:bll/@generateSharedBusinessRules"/>
      <variable name="BLL_IncludeViews" select="a:project/a:bll/@includeViews"/>
      <variable name="WebConfigUserData" select="a:project/a:webServer/a:webConfig"/>
      <variable name="Globalization_SupportedCultures" select="a:project/a:globalization/@supportedCultures"/>
      <variable name="Globalization_GoogleTranslateApiKey" select="a:project/a:globalization/@googleTranslateApiKey"/>
      <variable name="EASE_UrlHashing" select="a:project/a:features/a:ease/@urlHashing"/>
      <variable name="DetectUnderscoreSeparatedSchema" select="a:project/a:features/a:navigation/@detectUnderscoreSeparatedSchema"/>
      <variable name="AllowBlobUploadOnInsert" select="a:project/a:features/a:blob/@allowUploadOnInsert"/>
      <variable name="ActionColumn" select="/a:project/a:features/a:grid/@actionColumn"/>
      <variable name="DatabaseObjectGenerate" select="a:project/a:databaseObjectFilter/@generate"/>
      <variable name="UseExtenders" select="a:project/a:features/a:framework/@useExtenders"/>
      <choose>
        <when test="$TargetFramework='4.5'">
          <variable name="ReportTemplate" select="'Template40'"/>
        </when>
        <when test="$TargetFramework='4.0'">
          <variable name="ReportTemplate" select="'Template40'"/>
        </when>
        <otherwise>
          <variable name="ReportTemplate" select="'Template'"/>
        </otherwise>
      </choose>
      <variable name="CKEDITOR" select="'false'"/>
      <load path="$ProjectPath\WebRole1\ckeditor" depth="0">
        <if test="file">
          <variable name="CKEDITOR" select="'true'"/>
        </if>
      </load>
    </load>
    <!-- load meta data produced by the import process in the previous step and convert it into the standardized project data model -->
    <load path="DataAquarium.Metadata.xml" skipIfCached="Controllers.xml">
      <transform template="$LibraryRoot\_System\DataModel.xslt" output="DataModel.xml">
        <param name="Keys" select="$BLL_Keys"/>
        <param name="IncludeViews" select="$BLL_IncludeViews"/>
        <param name="DatabaseObjectFilter" select="$DatabaseObjectFilter"/>
      </transform>
      <load path="$ProjectPath\DataModel.xml">
        <transform template="$LibraryRoot\_System\DataModelReducer.xslt" output="DataModel.xml"/>
      </load>
    </load>
    <load path="DataModel.xml" skipIfCached="Controllers.xml">
      <transform template="$LibraryRoot\_System\BusinessObjects.xslt" output="Controllers.xml">
        <param name="AllowBlobSupport" select="'true'"/>
        <param name="DiscoveryDepth" select="$BLL_DiscoveryDepth"/>
        <param name="FieldMap" select="$BLL_FieldMap"/>
        <param name="LabelFormatExpression" select="$BLL_LabelFormatExpression"/>
        <param name="FieldsToIgnore" select="$BLL_FieldsToIgnore"/>
        <param name="FieldsToHide" select="$BLL_FieldsToHide"/>
        <param name="CustomLabels" select="$BLL_CustomLabels"/>
        <param name="MaxNumberOfDataFieldsInGridView" select="$MaxGridFields"/>
        <param name="DetectUnderscoreSeparatedSchema" select="$DetectUnderscoreSeparatedSchema"/>
        <param name="AllowBlobUploadOnInsert" select="$AllowBlobUploadOnInsert"/>
      </transform>
    </load>
    <load path="Controllers.xml" skipIfCached="Controllers.xml">
      <transform template="$LibraryRoot\Web Site Factory\MapBuilder.1.xslt" output="Map1.xml">
        <param name="DatabaseObjectGenerate" select="$DatabaseObjectGenerate"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\DataAquarium.xslt" output="Controllers.xml" cache="true">
        <param name="ReportsEnabled" select="$ReportsEnabled"/>
        <param name="FactoryEnabled" select="'true'"/>
        <param name="BatchEditEnabled" select="$BatchEditEnabled"/>
        <param name="RelationshipExplorer" select="$RelationshipExplorer"/>
        <param name="EnableTransactions" select="$EnableTransactions"/>
        <param name="SearchOnStartInLookups" select="$SearchOnStartInLookups"/>
        <param name="TargetFramework" select="$TargetFramework"/>
        <param name="AzureFactory" select="'true'"/>
        <param name="ActionColumn" select="$ActionColumn"/>
      </transform>
    </load>
    <load path="$ProjectPath\Map1.xml" skipIfCached="Application.xml">
      <transform template="$LibraryRoot\Web Site Factory\MapBuilder.2.xslt" output="Map2.xml"/>
    </load>
    <load path="$ProjectPath\Map2.xml" skipIfCached="Application.xml">
      <transform template="$LibraryRoot\Web Site Factory\MapBuilder.3.xslt" output="Map3.xml"/>
    </load>
    <load path="$ProjectPath\Map3.xml" skipIfCached="Application.xml">
      <transform template="$LibraryRoot\Web Site Factory\MapBuilder.4.xslt" output="Map4.xml"/>
    </load>
    <load path="$ProjectPath\Controllers.Cache.xml" useLog="false" skipIfCached="Application.xml">
      <transform template="$LibraryRoot\Web Site Factory\Application.xslt" output="Application.xml" cache="true">
        <param name="ProjectPath" select="$ProjectPath"/>
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
        <param name="CustomSecurity" select="$CustomSecurity"/>
        <param name="DedicatedLogin" select="$DedicatedLogin"/>
        <param name="Style" select="$DataViewLayout"/>
        <param name="MultiSelectEnabled" select="$MultiSelectEnabled"/>
        <param name="ShowModalForms" select="$ShowModalForms"/>
        <param name="SearchOnStart" select="$SearchOnStart"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <if test="contains($Compatibility, '20111118')">
        <load path="$ProjectPath\Application.Cache.xml">
          <transform template="$LibraryRoot\Web Site Factory\ApplicationReducer.xslt" output="Application.Cache.xml"/>
        </load>
      </if>
    </load>
    <load path="$ProjectPath\Controllers.xml" useLog="true">
      <message text="Finished processing Controllers.xml log."/>
    </load>
    <load path="$ProjectPath\Application.xml" useLog="true">
      <message text="Finished processing Application.xml log."/>
    </load>
    <navigate url="..\Data Aquarium\DataAquarium.Controllers.htm"/>
    <retract path="DataAquarium.Project.xml" test="$NextStep!='Generate'" steps="14"/>
    <!-- create a backup of the project source code -->
    <message text="backup the previous version of the project"/>
    <load path="$ProjectPath">
      <forEach select="//file[not(contains(@path, '\bin\') or contains(@path, '\obj\') or contains(@path, 'AjaxControlToolkit\'))]">
        <copy input="$ProjectPath\{@path}" output="$BackupPath\{@path}" silent="true"/>
      </forEach>
    </load>
    <message text="end backup"/>
    <load path="$ProjectPath\Application.xml" useLog="true">
      <transform template="$LibraryRoot\Web Site Factory\Web.Sitemap.xslt" output="WebRole1\Web.Sitemap"/>
    </load>
    <load path="$LibraryRoot\_Config\CodeOnTime.CodeDom.xml">
      <variable name="CodedomProviderName" select="/config:configuration/config:providers/@default"/>
      <variable name="ProjectExtension" select="concat(substring-after(/config:configuration/config:providers/config:provider[@name=/config:configuration/config:providers/@default]/@extension, '.'), 'proj')"/>
    </load>
    <load path="DataAquarium.Project.xml">
      <variable name="BLL_Generate" select="a:project/a:bll/@generate"/>
      <variable name="BLL_SelectMethod" select="a:project/a:bll/@selectMethod"/>
      <variable name="BLL_SelectSingleMethod" select="a:project/a:bll/@selectSingleMethod"/>
      <variable name="BLL_InsertMethod" select="a:project/a:bll/@insertMethod"/>
      <variable name="BLL_UpdateMethod" select="a:project/a:bll/@updateMethod"/>
      <variable name="BLL_DeleteMethod" select="a:project/a:bll/@deleteMethod"/>
      <variable name="Theme" select="a:project/a:theme/@name"/>
      <variable name="ThemeInput" select="'$LibraryRoot\Data Aquarium\_App_Themes\$Theme'"/>
      <variable name="ThemeOutput" select="'$ProjectPath\$Namespace\Theme'"/>
      <!-- copy "Scripts" files-->
      <load path="$LibraryRoot\Data Aquarium\Scripts">
        <forEach select="//file[@name !='Web.Membership.js' and @name != 'Web.MembershipManager.js' and @name != 'Web.MembershipResources.js']">
          <copy input="$LibraryRoot\Data Aquarium\Scripts\{@path}" output="$Namespace\Scripts\{@path}"/>
        </forEach>
      </load>
      <load path="$LibraryRoot\Premium\Scripts">
        <forEach select="//file">
          <copy input="$LibraryRoot\Premium\Scripts\{@path}" output="$Namespace\Scripts\{@path}"/>
        </forEach>
      </load>
      <if test="$ReportsEnabled='true' and $ProjectName!='WebRole1'">
        <copy input="$LibraryRoot\Data Aquarium\Reports\$ReportTemplate.xslt" output="$Namespace\Reports\Template.xslt"/>
      </if>
      <!-- delete any previous themes -->
      <load path="$LibraryRoot\Data Aquarium\_App_Themes">
        <forEach select="folder">
          <delete path="$Namespace\Theme\{@name}.css" silent="true"/>
        </forEach>
        <forEach select="folder">
          <variable name="ThemeFolder" select="@path"/>
          <load path="$ProjectPath\WebRole1\App_Themes\$ThemeFolder">
            <forEach select="//file">
              <delete path="$ProjectPath\WebRole1\App_Themes\$ThemeFolder\{@path}" silent="true"/>
            </forEach>
          </load>
          <delete path="$ProjectPath\WebRole1\App_Themes\{@path}" silent="true"/>
          <delete path="$ProjectPath\WebRole1\App_Themes\$Namespace\_Theme_{@name}.css" silent="true"/>
        </forEach>
      </load>
      <!-- copy shared theme and target theme in the App_Themes folder -->
      <load path="$LibraryRoot\Data Aquarium\_App_Themes\_Shared">
        <forEach select="//file[@name!='Membership.css']">
          <copy input="$LibraryRoot\Data Aquarium\_App_Themes\_Shared\{@path}" output="$Namespace\Theme\{@path}" silent="true"/>
          <copy input="$LibraryRoot\Data Aquarium\_App_Themes\_Shared\{@path}" output="WebRole1\App_Themes\_Shared\{@path}" silent="true"/>
        </forEach>
      </load>
      <load path="$ThemeInput">
        <forEach select="//file[not(contains(@name, '.css'))]">
          <copy input="$ThemeInput\{@path}" output="$Namespace\Theme\{@path}" silent="true"/>
          <copy input="$ThemeInput\{@path}" output="WebRole1\App_Themes\$Theme\{@path}" silent="true"/>
        </forEach>
      </load>
      <!-- alter default theme -->
      <copy input="$ProjectPath\$Namespace\Theme\Core.css" output="$Namespace\Theme\$Theme.css"/>
      <copy input="$ProjectPath\$Namespace\Theme\Core.css" output="WebRole1\App_Themes\_Shared\Core.css"/>
      <if test="$MembershipEnabled='true' or $CustomSecurity='true' or $WindowsAuthentication='true' or $ActiveDirectory='true'">
        <copy input="$LibraryRoot\Data Aquarium\_App_Themes\_Shared\Membership.css" output="$Namespace\Theme\$Theme.css" mode="append"/>
        <copy input="$LibraryRoot\Data Aquarium\_App_Themes\_Shared\Membership.css" output="WebRole1\App_Themes\_Shared\Membership.css"/>
      </if>
      <copy input="$ThemeInput\$Theme.css" output="$Namespace\Theme\$Theme.css" mode="append">
        <regex pattern="@import .+?;\s+" replacement=""/>
        <regex pattern="url\s*\((.+?)\)" replacement="url(&lt;%= WebResource(&quot;DAF.Theme.$1&quot;) %&gt;)"/>
      </copy>
      <applyTheme theme="$Theme" output="$Namespace\Theme\$Theme.css" usage="ClassLibrary"/>
      <delete path="$ProjectPath\$Namespace\Theme\Core.css"/>
      <!-- generate AssemblyInfo with web resources -->
      <load path="$ProjectPath\$Namespace\Theme">
        <transform template="AssemblyInfo.codedom.xslt" output="$Namespace\AssemblyInfo.codedom.xml" async="true" dependencies="DataAquarium.Project.xml">
          <param name="Namespace" select="$Namespace"/>
          <param name="ProjectPath" select="$ProjectPath"/>
          <param name="MembershipEnabled" select="$MembershipEnabled"/>
          <param name="CustomSecurity" select="$CustomSecurity"/>
          <param name="WindowsAuthentication" select="$WindowsAuthentication"/>
          <param name="ActiveDirectory" select="$ActiveDirectory"/>
          <param name="Theme" select="$Theme"/>
          <param name="TargetFramework" select="$TargetFramework"/>
          <param name="Globalization_SupportedCultures" select="$Globalization_SupportedCultures"/>
          <param name="ScriptOnly" select="$ScriptOnly"/>
          <param name="Mobile" select="$Mobile"/>
        </transform>
      </load>
      <!-- Generate "Data" folder -->
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ActionHandlerBase.codedom.xslt" output="$Namespace\Data\ActionHandlerBase.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\BusinessRules.codedom.xslt" output="$Namespace\Data\BusinessRules.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Premium\_App_Code\Data\ControllerNodeSet.codedom.xslt" output="$Namespace\Data\ControllerNodeSet.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\AquariumExtenderBase.codedom.xslt" output="$Namespace\Web\AquariumExtenderBase.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true">
        <param name="IsClassLibrary" select="'true'"/>
        <param name="Theme" select="$Theme"/>
        <param name="AppVersion" select="$AppVersion"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
        <param name="Mobile" select="$Mobile"/>
        <param name="jQueryMobileVersion" select="$jQueryMobileVersion"/>
        <param name="CodedomProviderName" select="$CodedomProviderName"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\PageBase.codedom.xslt" output="$Namespace\Web\PageBase.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true">
        <param name="UrlHashing" select="$EASE_UrlHashing"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Controller.codedom.xslt" output="$Namespace\Data\Controller.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Controller.Core.codedom.xslt" output="$Namespace\Data\Controller.Core.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Controller.Export.codedom.xslt" output="$Namespace\Data\Controller.Export.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Controller.Filter.codedom.xslt" output="$Namespace\Data\Controller.Filter.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      <transform template="$LibraryRoot\Unlimited\Security\EventTracker.codedom.xslt" output="$Namespace\Security\EventTracker.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      <if test="$ActiveDirectory='true'">
        <transform template="$LibraryRoot\Unlimited\Security\ADRoleProvider.codedom.xslt" output="$Namespace\Security\RoleProvider.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      </if>
      <if test="$CustomSecurity='true'">
        <transform template="$LibraryRoot\Unlimited\Security\RoleProvider.codedom.xslt" output="$Namespace\Security\RoleProvider.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
        <transform template="$LibraryRoot\Unlimited\Security\MembershipProvider.codedom.xslt" output="$Namespace\Security\MembershipProvider.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      </if>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\DataField.codedom.xslt" output="$Namespace\Data\DataField.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Action.codedom.xslt" output="$Namespace\Data\Action.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ActionGroup.codedom.xslt" output="$Namespace\Data\ActionGroup.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\FieldValue.codedom.xslt" output="$Namespace\Data\FieldValue.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\View.codedom.xslt" output="$Namespace\Data\View.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Category.codedom.xslt" output="$Namespace\Data\Category.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ViewPage.codedom.xslt" output="$Namespace\Data\ViewPage.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\AnnotationPlugIn.codedom.xslt" output="$Namespace\Data\AnnotationPlugIn.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ActionArgs.codedom.xslt" output="$Namespace\Data\ActionArgs.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ActionResult.codedom.xslt" output="$Namespace\Data\ActionResult.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\PageRequest.codedom.xslt" output="$Namespace\Data\PageRequest.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\DistinctValueRequest.codedom.xslt" output="$Namespace\Data\DistinctValueRequest.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Common.codedom.xslt" output="$Namespace\Data\Common.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ControllerConfiguration.codedom.xslt" output="$Namespace\Data\ControllerConfiguration.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\DynamicExpression.codedom.xslt" output="$Namespace\Data\DynamicExpression.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Transactions.codedom.xslt" output="$Namespace\Data\Transactions.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml"  async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\FilterFunctions.codedom.xslt" output="$Namespace\Data\FilterFunctions.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ImportProcessor.codedom.xslt" output="$Namespace\Data\ImportProcessor.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true">
        <param  name="DisableOLEDB" select="'true'"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\ControlHost.codedom.xslt" output="$Namespace\Web\ControlHost.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Localizer.codedom.xslt" output="$Namespace\Data\Localizer.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\CultureManager.codedom.xslt" output="$Namespace\Data\CultureManager.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
        <param name="SupportedCultures" select="$Globalization_SupportedCultures"/>
      </transform>
      <choose>
        <when test="$TargetFramework!='3.5'">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\ChartHost.codedom.xslt" output="$Namespace\Web\ChartHost.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true"/>
        </when>
        <otherwise>
          <delete path="$Namespace\Web\ChartHost.$CodeExtension"/>
        </otherwise>
      </choose>
      <transform template="$LibraryRoot\_Shared\DataAccess.codedom.xslt" output="$Namespace\Data\DataAccess.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <!-- Generate "Web" folder -->
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\DataViewExtender.codedom.xslt" output="$Namespace\Web\DataViewExtender.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true">
        <param name="IsClassLibrary" select="'true'"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\DataViewLookup.codedom.xslt" output="$Namespace\Web\DataViewLookup.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\DataViewTextBox.codedom.xslt" output="$Namespace\Web\DataViewTextBox.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true">
        <param name="IsClassLibrary" select="'true'"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\_App_Code\Web\MenuExtender.codedom.xslt" output="$Namespace\Web\MenuExtender.codedom.xml" when="TemplateChanged"  usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
        <param name="IsClassLibrary" select="'true'"/>
        <param name="Theme" select="$Theme"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
        <param name="Mobile" select="$Mobile"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\ControllerDataSource.codedom.xslt" output="$Namespace\Web\ControllerDataSource.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\ControllerDataSourceDesign.codedom.xslt" output="$Namespace\Web\ControllerDataSourceDesign.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <!-- generate "Services" folder -->
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Services\DataControllerService.codedom.xslt" output="$Namespace\Services\DataControllerService.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Services\ApplicationServices.codedom.xslt" output="$Namespace\Services\ApplicationServices.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true">
        <param name="Mobile" select="$Mobile"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Services\ApplicationServices.Version.codedom.xslt" output="$Namespace\Services\ApplicationServices.Version.codedom.xml" usage="ClassLibrary" async="true">
        <param name="AppVersion" select="$AppVersion"/>
        <param name="jQueryMobileVersion" select="$jQueryMobileVersion"/>
      </transform>
      <transform template="$LibraryRoot\Unlimited\Services\EnterpriseApplicationServices.codedom.xslt" output="$Namespace\Services\EnterpriseApplicationServices.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Unlimited\Services\RepresentationalStateTransfer.codedom.xslt" output="$Namespace\Services\RepresentationalStateTransfer.codedom.xml" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml" async="true">
        <param name="IsClassLibrary" select="true"/>
        <param name="AppVersion" select="$AppVersion"/>
      </transform>
      <!-- Generate web.config for Sandbox application -->
      <!--<transform template="$LibraryRoot\Data Aquarium\web.config.xslt" output="Sandbox\web.config" when="TemplateChanged" usage="ClassLibrary"  dependencies="DataAquarium.Project.xml">
        <param name="Namespace" select="$Namespace"/>
        <param name="IsClassLibrary" select="'true'"/>
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
        <param name="ReportsEnabled" select="$ReportsEnabled"/>
        <param name="AnnotationsPath" select="$AnnotationsPath"/>
        <param name="LoginUrl" select="'~/Default.aspx'"/>
        <param name="MySqlClient" select="$MySqlClient"/>
        <param name="MySqlMembershipProvider" select="$MySqlMembershipProvider"/>
      </transform>-->
      <load path="$LibraryRoot\Data Aquarium\Help">
        <forEach select="//file">
          <copy input="$LibraryRoot\Data Aquarium\Help\{@path}" output="WebRole1\Help\{@path}"/>
        </forEach>
      </load>
      <transform template="$LibraryRoot\Azure Factory\WebRole.codedom.xslt" output="WebRole1\WebRole.codedom.xml" when="TemplateChanged"  usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
        <param name="IsClassLibrary" select="'true'"/>
        <param name="WindowsAzureSdkVersion" select="$WindowsAzureSdkVersion"/>
      </transform>
      <wait mesage="Waiting for transformations to complete..."/>
      <!-- generate files for WebRole1 application-->
      <load path="$ProjectPath\Application.xml" useLog="true">
        <copy output="Application.Web.Config.xml" />
      </load>
      <transform template="$LibraryRoot\Data Aquarium\web.config.xslt" output="web.config.xml" >
        <param name="Namespace" select="$Namespace"/>
        <param name="IsClassLibrary" select="'true'"/>
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
        <param name="ReportsEnabled" select="$ReportsEnabled"/>
        <param name="ApplicationPath" select="concat($ProjectPath, '\Application.Web.Config.xml')"/>
        <param name="AnnotationsPath" select="$AnnotationsPath"/>
        <param name="FrameworkIsAssembly" select="'true'"/>
        <!--<param name="MySqlClient" select="$MySqlClient"/>
        <param name="MySqlMembershipProvider" select="$MySqlMembershipProvider"/>-->
        <param name="ProviderFactories" select="$ProviderFactories"/>
        <param name="ProjectName" select="'WebRole1'"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\web.config.Customize.xslt" output="WebRole1\web.config">
        <param name="Path" select="concat($ProjectPath, '\web.config.xml')"/>
        <param name="UserData" select="$WebConfigUserData"/>
      </transform>
      <if test="$TargetFramework != '3.5'">
        <copy input="$LibraryRoot\Data Aquarium\Web.Debug.config" output="WebRole1\Web.Debug.config" mode="create"/>
        <copy input="$LibraryRoot\Data Aquarium\Web.Release.config" output="WebRole1\Web.Release.config" mode="create"/>
      </if>
      <delete path="$ProjectPath\web.config.xml"/>
      <transform template="$LibraryRoot\Web Site Factory\Main.master.1.xslt" output="WebRole1\Main.master.1">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Main.master.2.xslt" output="WebRole1\Main.master.2" >
        <param name="Namespace" select="$Namespace"/>
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
        <param name="PageHeader" select="$PageHeader"/>
        <param name="Copyright" select="$Copyright"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Main.master.codedom.xslt" output="WebRole1\Main.master.codedom.xml" >
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
        <param name="AppVersion" select="$AppVersion"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
        <param name="IsClassLibrary" select="'true'"/>
        <param name="CKEDITOR" select="$CKEDITOR"/>
        <param name="Mobile" select="$Mobile"/>
        <param name="jQueryMobileVersion" select="$jQueryMobileVersion"/>
        <param name="CodedomProviderName" select="$CodedomProviderName"/>
      </transform>
      <if test="a:project/a:membership[(@enabled='true' or @customSecurity='true' or @activeDirectory='true') and @dedicatedLogin='true']">
        <transform template="$LibraryRoot\Web Site Factory\Login.aspx.1.xslt" output="WebRole1\Login.aspx.1">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="$LibraryRoot\Web Site Factory\Login.aspx.2.xslt" output="WebRole1\Login.aspx.2" >
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="$LibraryRoot\Web Site Factory\Login.aspx.codedom.xslt" output="WebRole1\Login.aspx.codedom.xml">
          <param name="Namespace" select="$Namespace"/>
        </transform>
      </if>
      <if test="$BLL_SharedBusinessRules='true'">
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Rules\SharedBusinessRules.codedom.xslt" output="$Namespace\Rules\SharedBusinessRules.codedom.xml" when="DoesNotExist" usage="ClassLibrary">
          <param name="Namespace" select="$Namespace"/>
        </transform>
      </if>
    </load>
    <copy input="$LibraryRoot\_Schemas\DataAquarium.xsd" output="$Namespace\Controllers\DataAquarium.xsd"/>
    <copy input="$LibraryRoot\_Schemas\Application.xsd" output="$Namespace\Controllers\Application.xsd"/>
    <!--
    <copy input="Web.sitemap" output="Web.sitemap"/>
		-->
    <load path="Controllers.xml" useLog="true">
      <!-- Create Sandbox web application project-->
      <!--<transform template="Default.aspx.1.xslt" output="Sandbox\Default.aspx.1">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="Default.aspx.2.xslt" output="Sandbox\Default.aspx.2">
        <param name="Namespace" select="$Namespace"/>
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
      </transform>
      <transform template="Service.asmx.xslt" output="Sandbox\DAF\Service.asmx">
        <param name="Namespace" select="$Namespace"/>
      </transform>-->
      <!-- Crete WebRole1 web application project -->
      <transform template="Service.asmx.xslt" output="WebRole1\DAF\Service.asmx">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Default.aspx.1.xslt" output="WebRole1\Default.aspx.1">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Default.aspx.2.xslt" output="WebRole1\Default.aspx.2">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Default.aspx.codedom.xslt" output="WebRole1\Default.aspx.codedom.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <!--<transform template="$LibraryRoot\Data Aquarium\Details.aspx.1.xslt" output="WebRole1\Details.aspx.1">
        <param name="Namespace" select="$Namespace"/>
        <param name="IsApplication" select="'true'"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\Details.aspx.2.xslt" output="WebRole1\Details.aspx.2" >
        <param name="Namespace" select="$Namespace"/>
        <param name="IsApplication" select="'true'"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\Details.aspx.codedom.xslt" output="WebRole1\Details.aspx.codedom.xml">
        <param name="Namespace" select="$Namespace"/>
        <param name="IsApplication" select="'true'"/>
      </transform>-->

      <forEach select="/c:dataControllerCollection/c:dataController[not(@generate='false')]">
        <!--<copy output="$Namespace\Controllers\{@name}.xml">
          <regex pattern="&lt;text&gt;(?=[\r\n])([\s\S]*?)&lt;/text&gt;" replacement="&lt;text&gt;&lt;![CDATA[$1]]&gt;&lt;/text&gt;"/>
        </copy>-->
        <transform template="$LibraryRoot\Data Aquarium\DataAquarium.Controller.xslt" output="$Namespace\Controllers\{@name}.xml" async="true">
          <param name="AnnotationsEnabled" select="$AnnotationsEnabled"/>
          <param name="NewColumnEnabled" select="$NewColumnEnabled"/>
          <param name="FloatingEnabled" select="$FloatingEnabled"/>
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <if test="string-length(@handler)>0">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Rules\BusinessRules.codedom.xslt" output="$Namespace\Rules\{@handler}.codedom.xml" when="DoesNotExist" usage="ClassLibrary" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="SharedBusinessRules" select="$BLL_SharedBusinessRules"/>
          </transform>
        </if>
        <if test="c:fields/c:field[string-length(c:codeFormula)>0 or string-length(c:codeDefault)>0 or string-length(c:codeValue)>0 or string-length(c:items/@targetController)>0] or .//c:dataField[string-length(c:codeFilter)>0] or c:views/c:view[@virtualViewId!='']">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Rules\BusinessRules.Generated.codedom.xslt" output="$Namespace\Rules\{@name}.Generated.codedom.xml" usage="ClassLibrary" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="SharedBusinessRules" select="$BLL_SharedBusinessRules"/>
          </transform>
        </if>
        <forEach select="c:businessRules/c:rule[@type='Code']">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Rules\BusinessRules.Rule.codedom.xslt" output="$Namespace\Rules\{ancestor::c:dataController/@name}.{@id}.codedom.xml" usage="ClassLibrary" when="DoesNotExist" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="SharedBusinessRules" select="$BLL_SharedBusinessRules"/>
          </transform>
        </forEach>
        <if test="$BLL_Generate='true'">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Objects\Object.codedom.xslt" output="$Namespace\Data\Objects\{@name}.codedom.xml" usage="ClassLibrary" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="SelectMethod" select="$BLL_SelectMethod"/>
            <param name="SelectSingleMethod" select="$BLL_SelectSingleMethod"/>
            <param name="InsertMethod" select="$BLL_InsertMethod"/>
            <param name="UpdateMethod" select="$BLL_UpdateMethod"/>
            <param name="DeleteMethod" select="$BLL_DeleteMethod"/>
          </transform>
        </if>
        <forEach select="c:views/c:view[@reportTemplate='true']" silent="true">
          <transform template="$LibraryRoot\Data Aquarium\Reports\$ReportTemplate.xslt" output="$Namespace\Reports\{ancestor::c:dataController/@name}_{@id}.rdlc" select="ancestor::c:dataController" async="true" when="DoesNotExist">
            <param name="ControllerName" select="ancestor::c:dataController/@name"/>
            <param name="ViewName" select="@id"/>
          </transform>
        </forEach>
        <load path="$ProjectPath\WebRole1\Controls">
          <variable name="AvailableChartControls" select="';'"/>
          <forEach select="//file[not(contains(@name,'ascx.')) and starts-with(@name, 'Chart_')]">
            <variable name="AvailableChartControls" select="concat('$AvailableChartControls', @name, ';')"/>
          </forEach>
        </load>
        <forEach select="c:views/c:view[@type='Chart' and c:dataFields/c:dataField[@chart!='']]">
          <variable name="ChartName" select="concat('Chart_', ancestor::c:dataController/@name, '_', @id)"/>
          <variable name="ChartType" select="c:dataFields/c:dataField[@chart!='' and @chart!='XValue']/@chart"/>
          <if test="$ChartType!='Custom' or not(contains($AvailableChartControls, concat(';', $ChartName, '.ascx')))">
            <transform template="$LibraryRoot\Premium\Controls\Chart.ascx.1.xslt" output="WebRole1\Controls\$ChartName.ascx.1">
              <param name="Namespace" select="$Namespace"/>
              <param name="Name" select="$ChartName"/>
            </transform>
            <transform template="$LibraryRoot\Premium\Controls\Chart.ascx.2.xslt" output="WebRole1\Controls\$ChartName.ascx.2" >
              <param name="Namespace" select="$Namespace"/>
              <param name="Name" select="$ChartName"/>
            </transform>
            <transform template="$LibraryRoot\Premium\Controls\Chart.ascx.codedom.xslt" output="WebRole1\Controls\$ChartName.ascx.codedom.xml" usage="ClassLibrary">
              <param name="Namespace" select="$Namespace"/>
              <param name="Name" select="$ChartName"/>
            </transform>
          </if>
        </forEach>
      </forEach>
      <transform template="$LibraryRoot\Web App Factory\_references.js.xslt" output="$Namespace\Scripts\_references.js" when="TemplateChanged" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Web App Factory\_references.js.xslt" output="WebRole1\Scripts\_references.js" when="TemplateChanged" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <if test="$ScriptOnly='true'">
        <copy input="$LibraryRoot\Web Site Factory\Scripts\MicrosoftAjax.js" output="$Namespace\Scripts\MicrosoftAjax.js" />
        <copy input="$LibraryRoot\Web Site Factory\Scripts\MicrosoftAjaxWebForms.js" output="$Namespace\Scripts\MicrosoftAjaxWebForms.js" />
        <copy input="$LibraryRoot\Web Site Factory\Scripts\MicrosoftAjaxApplicationServices.js" output="$Namespace\Scripts\MicrosoftAjaxApplicationServices.js" />
        <copy input="$LibraryRoot\Web Site Factory\Scripts\AjaxControlToolkit.js" output="$Namespace\Scripts\AjaxControlToolkit.js" />
        <load path="$LibraryRoot\_Client\Mobile">
          <forEach select="//file">
            <copy input="$LibraryRoot\_Client\Mobile\{@path}" output="WebRole1\touch\{@path}" silent="true"/>
          </forEach>
        </load>
        <if test="$Mobile='true'">
          <load path="$LibraryRoot\_Images\Logos">
            <forEach select="//file">
              <copy input="$LibraryRoot\_Images\Logos\{@path}"  output="WebRole1\touch\{@path}" mode="create" silent="true"/>
            </forEach>
          </load>
          <copy input="$LibraryRoot\Data Aquarium\Mobile\Web.Mobile.js" output="$Namespace\Scripts\Web.Mobile.js" silent="true"/>
          <copy input="$LibraryRoot\Premium\Mobile\Web.Mobile.js" output="$Namespace\Scripts\Web.Mobile.debug.js" silent="true"/>
        </if>
      </if>
      <if test="$MembershipEnabled='true'">
        <copy input="$LibraryRoot\Data Aquarium\_App_Themes\Aquarium\Membership.css" output="$Namespace\Theme\Membership.css">
          <regex pattern="url\s*\((.+?)\)" replacement="url(&lt;%= WebResource(&quot;DAF.Theme.$1&quot;) %&gt;)"/>
        </copy>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipBarExtender.codedom.xslt" output="$Namespace\Web\MembershipBarExtender.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="IsClassLibrary" select="'true'"/>
          <param name="Theme" select="$Theme"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipBar.codedom.xslt" output="$Namespace\Web\MembershipBar.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="IsClassLibrary" select="'true'"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipManagerExtender.codedom.xslt" output="$Namespace\Web\MembershipManagerExtender.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="IsClassLibrary" select="'true'"/>
          <param name="Theme" select="$Theme"/>
          <param name="ScriptOnly" select="$ScriptOnly"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipManager.codedom.xslt" output="$Namespace\Web\MembershipManager.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="IsClassLibrary" select="'true'"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Security\MembershipBusinessRules.codedom.xslt" output="$Namespace\Security\MembershipBusinessRules.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="ProviderName" select="$MembershipProviderName"/>
        </transform>
        <load path="$LibraryRoot\Data Aquarium\Controllers\aspnet_Membership.xml">
          <transform template="$LibraryRoot\Data Aquarium\Controllers\MembershipControllerBuilder.xslt" output="$Namespace\Controllers\aspnet_Membership.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="ProviderName" select="$MembershipProviderName"/>
          </transform>
        </load>
        <load path="$LibraryRoot\Data Aquarium\Controllers\aspnet_Roles.xml">
          <transform template="$LibraryRoot\Data Aquarium\Controllers\MembershipControllerBuilder.xslt" output="$Namespace\Controllers\aspnet_Roles.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="ProviderName" select="$MembershipProviderName"/>
          </transform>
        </load>
        <if test="$TargetFramework='3.5'">
          <copy input="$LibraryRoot\Web Site Factory\Scripts\MicrosoftAjaxApplicationServices.js" output="$Namespace\Scripts\MicrosoftAjaxApplicationServices.js" />
        </if>
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.Membership.js" output="$Namespace\Scripts\Web.Membership.js" />
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.MembershipManager.js" output="$Namespace\Scripts\Web.MembershipManager.js" />
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.MembershipResources.js" output="$Namespace\Scripts\Web.MembershipResources.js" />
        <!--<transform template="$LibraryRoot\Data Aquarium\Global.asax.1.xslt" output="Sandbox\Global.asax.1">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\Global.asax.2.xslt" output="Sandbox\Global.asax.2">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <copy input="$ProjectPath\Sandbox\Global.asax" output="Sandbox\Global.asax">
          <regex pattern="\)\s+Handles\s+.+?\r" replacement=")&#13;"/>
        </copy>
        <transform template="Membership.aspx.1.xslt" output="Sandbox\Membership.aspx.1">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="Membership.aspx.2.xslt" output="Sandbox\Membership.aspx.2">
          <param name="Namespace" select="$Namespace"/>
        </transform>-->
      </if>
      <!--<if test="$MembershipEnabled='true' or $CustomSecurity='true'">-->
      <load path="$ProjectPath\WebRole1" depth="0">
        <if test="not(file[@name='Global.asax'])">
          <transform template="$LibraryRoot\Data Aquarium\Global.asax.1.xslt" output="WebRole1\Global.asax.1">
            <param name="Namespace" select="$Namespace"/>
          </transform>
          <transform template="$LibraryRoot\Data Aquarium\Global.asax.2.xslt" output="WebRole1\Global.asax.2">
            <param name="Namespace" select="$Namespace"/>
            <param name="ProjectName" select="'WebRole1'"/>
          </transform>
          <copy input="$ProjectPath\WebRole1\Global.asax" output="WebRole1\Global.asax">
            <regex pattern="\)\s+Handles\s+.+?\r" replacement=")&#13;"/>
          </copy>
        </if>
      </load>
      <!--</if>-->
      <if test="$MembershipEnabled='true' or $CustomSecurity='true' or $ActiveDirectory='true'">
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Security\ExportAuthenticationModule.codedom.xslt" output="$Namespace\Security\ExportAuthenticationModule.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.Membership.js" output="$Namespace\Scripts\Web.Membership.js" />
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.MembershipResources.js" output="$Namespace\Scripts\Web.MembershipResources.js" />
        <copy input="$LibraryRoot\Data Aquarium\_App_Themes\Aquarium\Membership.css" output="$Namespace\Theme\Membership.css">
          <regex pattern="url\s*\((.+?)\)" replacement="url(&lt;%= WebResource(&quot;DAF.Theme.$1&quot;) %&gt;)"/>
        </copy>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipBarExtender.codedom.xslt" output="$Namespace\Web\MembershipBarExtender.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="IsClassLibrary" select="'true'"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipBar.codedom.xslt" output="$Namespace\Web\MembershipBar.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="IsClassLibrary" select="'true'"/>
        </transform>
      </if>
      <if test="$ReportsEnabled='true'">
        <transform template="$LibraryRoot\Data Aquarium\Report.ashx.codedom.xslt" output="$Namespace\Handlers\Report.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="TargetFramework" select="$TargetFramework"/>
        </transform>
      </if>
      <!-- create web handlers -->
      <!-- create ScriptHost and Export handlers (ignores RawControllers.xml) -->
      <transform template="$LibraryRoot\Data Aquarium\Export.ashx.codedom.xslt" output="$Namespace\Handlers\Export.codedom.xml" usage="ClassLibrary">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\Export.ashx.codedom.xslt" output="$Namespace\Handlers\Export.codedom.xml" usage="ClassLibrary">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <!--<transform template="$LibraryRoot\Data Aquarium\Details.aspx.codedom.xslt" output="$Namespace\Handlers\Details.codedom.xml" usage="ClassLibrary">
        <param name="Namespace" select="$Namespace"/>
        <param name="IsClassLibrary" select="'true'"/>
      </transform>-->
      <!-- create blob handler (uses RawControllers.xml)-->
      <transform template="$LibraryRoot\Data Aquarium\Blob.ashx.codedom.xslt" output="$Namespace\Handlers\Blob.codedom.xml" usage="ClassLibrary">
        <param name="Namespace" select="$Namespace"/>
        <param name="ProviderName" select="$ProviderName"/>
      </transform>
      <transform template="$LibraryRoot\Premium\_App_Code\Data\BlobAdapters.codedom.xslt" output="$Namespace\Data\BlobAdapters.codedom.xml" async="true" usage="ClassLibrary">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Unlimited\Data\BlobAdaptersEx.codedom.xslt" output="$Namespace\Data\BlobAdaptersEx.codedom.xml" async="true" usage="ClassLibrary">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\Import.ashx.codedom.xslt" output="$Namespace\Handlers\Import.codedom.xml" usage="ClassLibrary">
        <param name="Namespace" select="$Namespace"/>
      </transform>
    </load>
    <wait mesage="Waiting for transformations to complete..."/>
    <!-- create WebRole1 applications pages and user controls -->
    <load path="$ProjectPath\Application.xml" useLog="true">
      <forEach select="/app:application/app:pages/app:page[string-length(@url)=0]">
        <transform template="$LibraryRoot\Web Site Factory\Pages\Page.aspx.1.xslt" output="WebRole1\Pages\{@name}.aspx.1">
          <param name="Host" select="'WebApp'"/>
          <param name="Namespace" select="$Namespace"/>
          <param name="Name" select="@name"/>
        </transform>
        <transform template="$LibraryRoot\Web Site Factory\Pages\Page.aspx.2.xslt" output="WebRole1\Pages\{@name}.aspx.2" >
          <param name="Host" select="'WebApp'"/>
          <param name="Namespace" select="$Namespace"/>
          <param name="Name" select="@name"/>
          <param name="UseExtenders" select="$UseExtenders"/>
        </transform>
        <transform template="$LibraryRoot\Web Site Factory\Pages\Page.aspx.codedom.xslt" output="WebRole1\Pages\{@name}.aspx.codedom.xml" >
          <param name="Host" select="'WebApp'"/>
          <param name="Namespace" select="$Namespace"/>
          <param name="Name" select="@name"/>
        </transform>
      </forEach>
      <load path="$ProjectPath\WebRole1\Controls">
        <variable name="AvailableControls" select="';'"/>
        <forEach select="//file[not(contains(@name,'ascx.') or starts-with(@name, 'Chart_'))]">
          <variable name="AvailableControls" select="concat('$AvailableControls', @name, ';')" silent="true"/>
        </forEach>
      </load>
      <forEach select="/app:application/app:userControls/app:userControl">
        <if test="@generate='Always' or not(contains($AvailableControls, concat(';', @name, '.ascx')))" silent="true">
          <choose>
            <when test="not(contains(app:body, '&lt;%@')) or string-length(app:body)>0">
              <transform template="$LibraryRoot\Web Site Factory\Controls\Control.ascx.1.xslt" output="WebRole1\Controls\{@name}.ascx.1">
                <param name="Namespace" select="$Namespace"/>
                <param name="Name" select="@name"/>
              </transform>
              <transform template="$LibraryRoot\Web Site Factory\Controls\Control.ascx.2.xslt" output="WebRole1\Controls\{@name}.ascx.2" >
                <param name="Namespace" select="$Namespace"/>
                <param name="Name" select="@name"/>
              </transform>
              <transform template="$LibraryRoot\Web Site Factory\Controls\Control.ascx.codedom.xslt" output="WebRole1\Controls\{@name}.ascx.codedom.xml">
                <param name="Host" select="'WebApp'"/>
                <param name="Namespace" select="$Namespace"/>
                <param name="Name" select="@name"/>
              </transform>
            </when>
            <otherwise>
              <transform template="$LibraryRoot\Web Site Factory\Controls\Control.ascx.2.xslt" output="WebRole1\Controls\{@name}.ascx" >
                <param name="Namespace" select="$Namespace"/>
                <param name="Name" select="@name"/>
              </transform>
            </otherwise>
          </choose>
        </if>
      </forEach>
    </load>
    <!-- copy Ajax Control Toolkit to the project folder -->
    <if test="$ScriptOnly='false'">

      <choose>
        <when test="$TargetFramework!='3.5'">
          <load path="$LibraryRoot\_AjaxControlToolkit40">
            <forEach select="//file">
              <copy input="$LibraryRoot\_AjaxControlToolkit40\{@path}" output="AjaxControlToolkit\\{@path}" silent="true"/>
            </forEach>
          </load>
        </when>
        <otherwise>
          <load path="$LibraryRoot\_AjaxControlToolkit">
            <forEach select="//file">
              <copy input="$LibraryRoot\_AjaxControlToolkit\{@path}" output="AjaxControlToolkit\\{@path}" silent="true"/>
            </forEach>
          </load>
        </otherwise>
      </choose>
    </if>
    <!-- copy Factory theme files-->
    <load path="$LibraryRoot\Web Site Factory\_App_Themes\Factory">
      <forEach select="//file">
        <copy input="$LibraryRoot\Web Site Factory\_App_Themes\Factory\{@path}" output="WebRole1\App_Themes\_Shared\{@path}"/>
      </forEach>
    </load>
    <load path="$ThemeInput">
      <forEach select="//file">
        <copy input="$ThemeInput\{@path}" output="$ProjectPath\WebRole1\App_Themes\$Theme\{@path}"/>
      </forEach>
    </load>
    <if test="not($MembershipEnabled='true' or $WindowsAuthentication='true' or $CustomSecurity='true' or $ActiveDirectory='true')">
      <copy input="$ThemeInput\$Theme.css" output="$ProjectPath\WebRole1\App_Themes\$Theme\$Theme.css">
        <regex pattern="@import.+?Membership.css\S+?\s+" replacement=""/>
      </copy>
    </if>
    <copy input="$LibraryRoot\Data Aquarium\_App_Themes\_Layout.skin" output="$ProjectPath\WebRole1\App_Themes\$Namespace\_Layout.skin"/>
    <transform template="$LibraryRoot\Data Aquarium\_App_Themes\FactoryTheme.xslt" output="$ProjectPath\WebRole1\App_Themes\$Namespace\_Theme_$Theme.css">
      <param name="Theme" select="$Theme"/>
      <param name="Namespace" select="$Namespace"/>
    </transform>
    <applyTheme theme="$Theme" output="WebRole1\App_Themes\$Namespace\_Theme_$Theme.css"/>
    <load path="$ProjectPath">
      <!-- delete all .codedom.xml files -->
      <forEach select="//file[contains(@name, '.codedom.xml')]">
        <delete path="{@path}" silent="true"/>
      </forEach>
      <!-- merge Blob files -->
      <variable name="BlobSource" select="//file[starts-with(@name, 'Blob.') and not(contains(@name,'codedom'))]/@path"/>
      <copy input="$ProjectPath\$BlobSource" output="$BlobSource">
        <regex pattern="([^\x0d\S])(\x0a)" replacement="$1&#13;$2"/>
        <regex pattern="&quot;&amp;\s+_\s+&quot;" replacement=""/>
        <regex pattern="&quot;&amp;Global\.Microsoft\.VisualBasic\.ChrW\(10\)&amp;&quot;" replacement="&quot;&amp; _&#13;&#10;&#9;&#9;&#9;&quot;"/>
      </copy>
      <!--<delete path="$BlobSource"/>-->
    </load>
    <!-- create Class Library project file-->
    <load path="$LibraryRoot\_Config\CodeOnTime.CodeDom.xml">
      <variable name="CodedomProviderName" select="/config:configuration/config:providers/@default"/>
      <choose>
        <when test="$CodedomProviderName='CSharp'">
          <copy input="$ProjectPath\$Namespace\AssemblyInfo.cs" output="$Namespace\Properties\AssemblyInfo.cs">
            <regex pattern="\[" replacement="[assembly: "/>
            <regex pattern="public class[\s\S]*$" replacement=""/>
          </copy>
          <delete path="$ProjectPath\$Namespace\AssemblyInfo.cs"/>
        </when>
        <otherwise>
          <copy input="$ProjectPath\$Namespace\AssemblyInfo.vb" output="$Namespace\My Project\AssemblyInfo.vb">
            <regex pattern="&quot;&amp;\s+_\s+&quot;" replacement=""/>
            <regex pattern="(WebResource\(&quot;\w+\.)\w+\." replacement="$1"/>
            <regex pattern="&lt;([\s\S]+)&gt;" replacement=" $1,"/>
            <regex pattern="Public[\s\S]+End Class" replacement=""/>
            <regex pattern="\s(\w+\(.+?\)),\s+_" replacement="&lt;Assembly: $1&gt;"/>
          </copy>
          <delete path="$ProjectPath\$Namespace\AssemblyInfo.vb"/>
          <load path="$ProjectPath\$Namespace">
            <!--<forEach select="//file[(contains(@name, '.vb') or contains(@name,'.css')) and (@name!='AssemblyInfo.vb')]">
              <copy input="$ProjectPath\$Namespace\{@path}" output="$Namespace\{@path}">
                <regex pattern="Namespace\s+\w+\." replacement="Namespace "/>
                <regex pattern="(\w+)\.(\w+)\.(.+?)\.(js|css|gif|jpeg|jpg)" replacement="$1.$3.$4"/>
              </copy>
            </forEach>-->
            <forEach select="//file[contains(@name,'.css')]">
              <copy input="$ProjectPath\$Namespace\{@path}" output="$Namespace\{@path}">
                <!--<regex pattern="Namespace\s+\w+\." replacement="Namespace2 "/>-->
                <regex pattern="(\w+)\.(\w+)\.(.+?)\.(js|css|gif|jpeg|jpg|png)" replacement="$1.$3.$4"/>
              </copy>
            </forEach>
          </load>
        </otherwise>
      </choose>
    </load>
    <load path="$ProjectPath\CloudApp" depth="0">
      <if test="not(file[@name='ServiceConfiguration.cscfg'])">
        <load path="DataAquarium.Project.xml">
          <transform template="ServiceConfiguration.cscfg.xslt" output="CloudApp\ServiceConfiguration.cscfg">
            <param name="WindowsAzureSdkVersion" select="$WindowsAzureSdkVersion"/>
          </transform>
        </load>
      </if>
      <if test="not(file[@name='ServiceDefinition.csdef'])">
        <load path="DataAquarium.Project.xml">
          <transform template="ServiceDefinition.csdef.xslt" output="CloudApp\ServiceDefinition.csdef">
            <param name="WindowsAzureSdkVersion" select="$WindowsAzureSdkVersion"/>
          </transform>
        </load>
      </if>
    </load>
    <!-- translate application resources -->
    <translate path="$ProjectPath\$Namespace" pattern="*.xyz" cultures="$Globalization_SupportedCultures" dictionary="$Namespace\Resources.txt"/>
    <load path="$ProjectPath\$Namespace" depth="0">
      <forEach select="//file[starts-with(@name, 'Resources.')]">
        <copy input="$ProjectPath\$Namespace\{@name}" output="{@name}"/>
      </forEach>
    </load>
    <translate path="$ProjectPath\WebRole1" pattern="*.sitemap!,*.aspx,*.ascx" cultures="$Globalization_SupportedCultures" dictionary="Resources.txt" />
    <load path="$ProjectPath" depth="0">
      <forEach select="//file[starts-with(@name, 'Resources.')]">
        <delete path="{@path}"/>
      </forEach>
    </load>
    <translate path="$ProjectPath\$Namespace\Controllers" pattern="*.xml" cultures="$Globalization_SupportedCultures" dictionary="$Namespace\Resources.txt"/>
    <translate path="$ProjectPath\$Namespace\Reports" pattern="*.xslt" cultures="$Globalization_SupportedCultures" dictionary="$Namespace\Resources.txt"/>
    <translate path="$ProjectPath\$Namespace\Scripts" pattern="*.js" cultures="$Globalization_SupportedCultures" dictionary="ClientLibrary.txt"/>
    <!-- create a project file for "Aquarium in a Box" class library-->
    <load path="$Namespace\$Namespace.$ProjectExtension">
      <variable name="LibraryProjectGuid" select="//vsproj:ProjectGuid"/>
    </load>
    <load path="$ProjectPath\$Namespace">
      <transform template="VisualStudioProject.xslt" output="$Namespace\$Namespace.$ProjectExtension">
        <param name="ProjectName" select="$Namespace"/>
        <param name="ProjectGuid" select="$LibraryProjectGuid"/>
        <param name="CodedomProviderName" select="$CodedomProviderName"/>
        <param name="ReportsEnabled" select="$ReportsEnabled"/>
        <param name="TargetFramework" select="$TargetFramework"/>
        <param name="IsClassLibrary" select="'true'"/>
        <param name="MembershipProviderName" select="$MembershipProviderName"/>
        <param name="WindowsAzureSdkVersion" select="$WindowsAzureSdkVersion"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
        <param name="ActiveDirectory" select="$ActiveDirectory"/>
      </transform>
    </load>
    <load path="$Namespace\$Namespace.$ProjectExtension">
      <variable name="ProjectGuid" select="//vsproj:ProjectGuid"/>
    </load>
    <!-- create a project file for WebRole1 app -->
    <load path="WebRole1\WebRole1.$ProjectExtension">
      <variable name="WebRole1ProjectGuid" select="//vsproj:ProjectGuid"/>
    </load>
    <load path="$ProjectPath\WebRole1">
      <transform template="VisualStudioProject.xslt" output="WebRole1\WebRole1.$ProjectExtension">
        <param name="ProjectName" select="'WebRole1'"/>
        <param name="ProjectGuid" select="$WebRole1ProjectGuid"/>
        <param name="ProjectExtension" select="$ProjectExtension"/>
        <param name="CodedomProviderName" select="$CodedomProviderName"/>
        <param name="Reference1" select="$Namespace"/>
        <param name="Reference1Guid" select="$ProjectGuid"/>
        <param name="TargetFramework" select="$TargetFramework"/>
        <param name="MembershipProviderName" select="$MembershipProviderName"/>
        <param name="ReportsEnabled" select="$ReportsEnabled"/>
        <param name="VisualStudio2013" select="$VisualStudio2013"/>
        <param name="VisualStudio2012" select="$VisualStudio2012"/>
        <param name="WindowsAzureSdkVersion" select="$WindowsAzureSdkVersion"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
    </load>
    <load path="WebRole1\WebRole1.$ProjectExtension">
      <variable name="WebRole1Guid" select="//vsproj:ProjectGuid"/>
    </load>
    <!-- create a project file for CloudApp app -->
    <load path="CloudApp\CloudApp.ccproj">
      <variable name="CloudAppProjectGuid" select="//vsproj:ProjectGuid"/>
    </load>
    <load path="$ProjectPath\CloudApp" depth="1">
      <transform template="VisualStudioProject.xslt" output="CloudApp\CloudApp.ccproj">
        <param name="ProjectName" select="'CloudApp'"/>
        <param name="ProjectGuid" select="$CloudAppProjectGuid"/>
        <param name="ProjectExtension" select="$ProjectExtension"/>
        <param name="CodedomProviderName" select="$CodedomProviderName"/>
        <param name="Reference1" select="'WebRole1'"/>
        <param name="Reference1Guid" select="$WebRole1Guid"/>
        <param name="TargetFramework" select="$TargetFramework"/>
        <param name="MembershipProviderName" select="$MembershipProviderName"/>
        <param name="WindowsAzureSdkVersion" select="$WindowsAzureSdkVersion"/>
        <param name="VisualStudio2013" select="$VisualStudio2013"/>
        <param name="VisualStudio2012" select="$VisualStudio2012"/>
      </transform>
    </load>
    <!-- create a solution file -->
    <load path="CloudApp\CloudApp.ccproj">
      <variable name="CloudAppGuid" select="//vsproj:ProjectGuid"/>
    </load>
    <load path="$ProjectPath" depth="0">
      <if test="not(file[@name=concat($Namespace, '.sln')])">
        <load path="DataAquarium.Project.xml">
          <transform template="Solution.sln.xslt" output="$Namespace.sln">
            <param name="Namespace" select="$Namespace"/>
            <param name="ProjectExtension" select="$ProjectExtension"/>
            <param name="ProjectGuid" select="$ProjectGuid"/>
            <param name="SandboxGuid" select="$CloudAppGuid"/>
            <param name="SandboxProjectName" select="'CloudApp'"/>
            <param name="WebAppGuid" select="$WebRole1Guid"/>
            <param name="TargetFramework" select="$TargetFramework"/>
            <param name="VisualStudio2013" select="$VisualStudio2013"/>
            <param name="VisualStudio2012" select="$VisualStudio2012"/>
          </transform>
        </load>
      </if>
    </load>
    <!-- delete temprorary files -->
    <delete path="DataModel.xml"/>
    <delete path="Controllers.xml"/>
    <delete path="Application.Web.Config.xml"/>
    <delete path="Application.xml"/>
    <delete path="Map1.xml"/>
    <delete path="Map2.xml"/>
    <delete path="Map3.xml"/>
    <delete path="Map4.xml"/>
    <load path="DataAquarium.Project.xml">
      <if test="a:project/a:webServer/@run='true'">
        <choose>
          <when test="a:project/@targetFramework!='3.5'">
            <!--<execute fileName="$VisualStudio2010" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot; /Rebuild" mode="wait"/>-->
            <execute fileName="$MSBuild40" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot; /t:rebuild /verbosity:m /p:Platform=&quot;Any CPU&quot;" mode="wait"/>
            <load path="$ProjectPath\WebRole1\bin">
              <variable name="Compiled" select="//file[@name='WebRole1.dll']/@name"/>
            </load>
            <choose>
              <when test="$Compiled!=''">
                <choose>
                  <when test="$IISExpress='true'">
                    <browse name="$ProjectName" path="$ProjectPath\WebRole1" port="{a:project/a:webServer/@port}"
                            framework="{a:project/@targetFramework}"
                            windowsAuthentication="{a:project/a:membership/@windowsAuthentication}"
                            relativePath="default.aspx"/>
                  </when>
                  <otherwise>
                    <execute fileName="$WebDevWebServer40" arguments="/port:{a:project/a:webServer/@port} /path:&quot;$ProjectPath\WebRole1&quot; /vpath:&quot;/$ProjectName&quot;" mode="nowait"/>
                    <execute fileName="http://localhost:{a:project/a:webServer/@port}/$ProjectName/default.aspx" arguments="-new" mode="nowait"/>
                  </otherwise>
                </choose>
              </when>
              <when test="$VisualStudio2013!=''">
                <execute fileName="$VisualStudio2013" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot; /Run" mode="nowait"/>
              </when>
              <when test="$VisualStudio2012!=''">
                <execute fileName="$VisualStudio2012" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot; /Run" mode="nowait"/>
              </when>
              <otherwise>
                <execute fileName="$VisualStudio2010" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot; /Run" mode="nowait"/>
              </otherwise>
            </choose>
          </when>
        </choose>
        <!--<if test="$Compiled!=''">
          <execute fileName="http://localhost:{a:project/a:webServer/@port}/$ProjectName/default.aspx" arguments="-new" mode="nowait"/>
        </if>-->
      </if>
    </load>
  </build>
  <actions>
    <action name="Develop" toolTip="Open in Visual Studio to customize the source code." hint="You will be prompted to elevate permissions to allow debugging under Azure Compute Emulator.">
      <load path="DataAquarium.Project.xml">
        <!--<execute fileName="file://$ProjectPath\{a:project/a:namespace}.sln" arguments="" mode="nowait" runas="true"/>-->
        <choose>
          <when test="$VisualStudio2013!=''">
            <execute fileName="$VisualStudio2013" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot;" mode="nowait" runas="true"/>
          </when>
          <when test="$VisualStudio2012!=''">
            <execute fileName="$VisualStudio2012" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot;" mode="nowait" runas="true"/>
          </when>
          <otherwise>
            <execute fileName="$VisualStudio2010" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot;" mode="nowait" runas="true"/>
          </otherwise>
        </choose>
      </load>
    </action>
    <action name="Browse" toolTip="Compile and view the app in your default web browser.">
      <load path="DataAquarium.Project.xml">
        <choose>
          <when test="a:project/@targetFramework!='3.5'">
            <execute fileName="$MSBuild40" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot; /t:rebuild /verbosity:m /p:Platform=&quot;Any CPU&quot;" mode="wait"/>
            <load path="$ProjectPath\WebRole1\bin">
              <variable name="Compiled" select="//file[@name='WebRole1.dll']/@name"/>
            </load>
            <choose>
              <when test="$Compiled!=''">
                <choose>
                  <when test="$IISExpress='true'">
                    <browse name="$ProjectName" path="$ProjectPath\WebRole1" port="{a:project/a:webServer/@port}"
                            framework="{a:project/@targetFramework}"
                            windowsAuthentication="{a:project/a:membership/@windowsAuthentication}"
                            relativePath="default.aspx"/>
                  </when>
                  <otherwise>
                    <execute fileName="$WebDevWebServer40" arguments="/port:{a:project/a:webServer/@port} /path:&quot;$ProjectPath\WebRole1&quot; /vpath:&quot;/$ProjectName&quot;" mode="nowait"/>
                    <execute fileName="http://localhost:{a:project/a:webServer/@port}/$ProjectName/default.aspx" arguments="-new" mode="nowait"/>
                  </otherwise>
                </choose>
              </when>
              <when test="$VisualStudio2013!=''">
                <execute fileName="$VisualStudio2013" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot; /Run" mode="nowait"/>
              </when>
              <when test="$VisualStudio2012!=''">
                <execute fileName="$VisualStudio2012" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot; /Run" mode="nowait"/>
              </when>
              <otherwise>
                <execute fileName="$VisualStudio2010" arguments="&quot;$ProjectPath\{a:project/a:namespace}.sln&quot; /Run" mode="nowait"/>
              </otherwise>
            </choose>
          </when>
        </choose>
        <!--<if test="$Compiled!=''">
          <execute fileName="http://localhost:{a:project/a:webServer/@port}/$ProjectName/default.aspx" arguments="-new" mode="nowait"/>
        </if>-->
      </load>
    </action>
    <action name="Publish" toolTip="Prepare the app for Windows Azure Cloud deployment.">
      <load path="DataAquarium.Project.xml">
        <revise/>
        <execute fileName="$MSBuild40" arguments="/t:CorePublish &quot;$ProjectPath\CloudApp\CloudApp.ccproj&quot; /p:Configuration=Release" mode="wait" />
        <copy input="$ProjectPath\CloudApp\bin\Release\app.publish\CloudApp.cspkg" output="$Root\Publish\Azure Factory\$ProjectName\CloudApp.cspkg"/>
        <copy input="$ProjectPath\CloudApp\bin\Release\app.publish\ServiceConfiguration.cscfg" output="$Root\Publish\Azure Factory\$ProjectName\ServiceConfiguration.cscfg"/>
        <execute fileName="$Root\Publish\Azure Factory\$ProjectName" arguments="" mode="nowait"/>
        <delete path="$ProjectPath\CloudApp\bin\Release\" />
      </load>
    </action>
  </actions>
  <settings>
    <group name="Namespace" text="Namespace, Framework, and UI" description="Change the source code namespace, .NET framework, and User Interface of the generated web application."/>
    <group name="Connection" text="Database Connection" description="Configure database connection provider and connection string properties."/>
    <group name="BLL" text="Business Logic Layer" description="Configue shared business rules, data access objects, relationship discovery, denormalization map, and text label construction."/>
    <group name="Reports" text="Reporting" description="Enable or disable automatic reports in your application."/>
    <group name="Membership" text="Authentication and Membership" description="Select authentication and membership options for your web app."/>
    <group name="Features" text="Features" description="Specify global features of the generated baseline application."/>
    <group name="Layout" text="Layouts" description="Specify the page data view layout preferences. Select simple, tabbed, classic, inline, or stacked layout."/>
    <group name="Theme" text="Theme" description="Change user interface theme."/>
    <group name="Globalization" text="Globalization and Localization" description="Enter globalization and localization settings of this application."/>
    <group name="WebServer" text="Web Server Configuration" description="Configure development web server and enter runtime configuration properties of the application."/>
  </settings>
</project>
