<?xml version="1.0" encoding="utf-8" ?>
<project xmlns="http://www.codeontime.com/2008/code-generator"
         xmlns:ontime="http://www.codeontime.com/2008/code-generator"
         xmlns:a="urn:schemas-codeontime-com:data-aquarium-project"
         xmlns:c="urn:schemas-codeontime-com:data-aquarium"
         xmlns:app="urn:schemas-codeontime-com:data-aquarium-application"
         debug="false"
>
  <information>
    <product>COT201307-M</product>
    <title>Mobile Factory</title>
    <description>Create a mobile-only web site with navigation system, role-based security, reporting, advanced search options, and much more. The generated project is based on jQuery Mobile and managed via the file system folder structure.</description>
    <vendor>Code OnTime LLC</vendor>
    <website>http://www.codeontime.com</website>
    <about>http://www.codeontime.com/learn</about>
    <demo>http://www.codeontime.com/demo</demo>
  </information>
  <build>
    <!-- load entire project output file/folder tree -->
    <load path="$ProjectPath">
      <if test="not(file/@name='DataAquarium.Project.xml')">
        <copy input="$LibraryRoot\Data Aquarium\DataAquarium.Project.xml" output="DataAquarium.Project.xml"/>
      </if>
    </load>
    <navigate url="..\Data Aquarium\DataAquarium.Start.htm?splash=MobileFactory"/>
    <load path="DataAquarium.Project.xml">
      <variable name="ConnectionString" select="a:project/a:connectionString"/>
      <variable name="ProviderName" select="a:project/a:providerName"/>
      <variable name="MembershipProviderName" select="a:project/a:membership/@providerName"/>
      <load path="$ProjectPath">
        <if test="not(file/@name='DataAquarium.Metadata.xml')">
          <execute fileName="CodeOnTime.exe" arguments="/connectionString:&quot;$ConnectionString&quot; /providerName:&quot;$ProviderName&quot; /output:&quot;$ProjectPath\DataAquarium.Metadata.xml&quot;" mode="wait"/>
        </if>
      </load>
    </load>
    <retract path="Error.DataAquarium.Metadata.xml" test="ontime:error!=''" steps="2"/>
    <!-- convert project data model in the Data Aquarium controller collection -->
    <load path="DataAquarium.Project.xml">
      <variable name="Compatibility" select="a:project/@compatibility"/>
      <variable name="Namespace" select="a:project/a:namespace"/>
      <variable name="TargetFramework" select="a:project/@targetFramework"/>
      <variable name="ScriptOnly" select="a:project/@targetFramework = '4.5' and a:project/a:features/a:framework/@scriptOnly='true'"/>
      <variable name="ReportsEnabled" select="a:project/a:reports/@enabled"/>
      <variable name="MembershipEnabled" select="a:project/a:membership/@enabled"/>
      <variable name="WindowsAuthentication" select="a:project/a:membership/@windowsAuthentication"/>
      <variable name="ActiveDirectory" select="a:project/a:membership/@activeDirectory"/>
      <variable name="CustomSecurity" select="a:project/a:membership/@customSecurity"/>
      <variable name="DedicatedLogin" select="a:project/a:membership/@dedicatedLogin"/>
      <variable name="HelpEnabled" select="/a:project/a:membership/@displayHelp"/>
      <variable name="AnnotationsEnabled" select="a:project/a:features/@annotations"/>
      <variable name="AnnotationsPath" select="a:project/a:features/@annotationsPath"/>
      <variable name="NewColumnEnabled" select="a:project/a:features/@newColumn"/>
      <variable name="FloatingEnabled" select="a:project/a:features/@floating"/>
      <variable name="MaxGridFields" select="a:project/a:features/@maxGridFields"/>
      <variable name="MultiSelectEnabled" select="a:project/a:features/@multiSelect"/>
      <variable name="ShowModalForms" select="a:project/a:features/@showModalForms"/>
      <variable name="SearchOnStart" select="a:project/a:features/@advancedSearch"/>
      <variable name="SearchOnStartInLookups" select="a:project/a:features/@advancedLookup"/>
      <variable name="BatchEditEnabled" select="a:project/a:features/@batchEdit"/>
      <variable name="RelationshipExplorer" select="a:project/a:features/@relationshipExplorer"/>
      <variable name="EnableTransactions" select="a:project/a:features/@enableTransactions"/>
      <variable name="PageHeader" select="a:project/a:features/@pageHeader"/>
      <variable name="Copyright" select="a:project/a:features/@copyright"/>
      <variable name="DataViewLayout" select="a:project/a:layout/@name"/>
      <variable name="BLL_DiscoveryDepth" select="a:project/a:bll/@discoveryDepth"/>
      <variable name="BLL_FieldMap" select="a:project/a:bll/a:fieldMap"/>
      <variable name="BLL_Keys" select="a:project/a:bll/a:keys"/>
      <variable name="BLL_FieldsToIgnore" select="a:project/a:bll/a:fieldsToIgnore"/>
      <variable name="BLL_FieldsToHide" select="a:project/a:bll/a:fieldsToHide"/>
      <variable name="BLL_CustomLabels" select="a:project/a:bll/a:customLabels"/>
      <variable name="BLL_LabelFormatExpression" select="a:project/a:bll/@labelFormatExpression"/>
      <variable name="BLL_SharedBusinessRules" select="a:project/a:bll/@generateSharedBusinessRules"/>
      <variable name="BLL_IncludeViews" select="a:project/a:bll/@includeViews"/>
      <variable name="DatabaseObjectFilter" select="a:project/a:databaseObjectFilter"/>
      <variable name="WebConfigUserData" select="a:project/a:webServer/a:webConfig"/>
      <variable name="Globalization_SupportedCultures" select="a:project/a:globalization/@supportedCultures"/>
      <variable name="Globalization_GoogleTranslateApiKey" select="a:project/a:globalization/@googleTranslateApiKey"/>
      <variable name="EASE_UrlHashing" select="a:project/a:features/a:ease/@urlHashing"/>
      <variable name="DetectUnderscoreSeparatedSchema" select="a:project/a:features/a:navigation/@detectUnderscoreSeparatedSchema"/>
      <variable name="AllowBlobUploadOnInsert" select="a:project/a:features/a:blob/@allowUploadOnInsert"/>
      <variable name="ActionColumn" select="/a:project/a:features/a:grid/@actionColumn"/>
      <variable name="DatabaseObjectGenerate" select="a:project/a:databaseObjectFilter/@generate"/>
      <variable name="UseExtenders" select="a:project/a:features/a:framework/@useExtenders"/>
      <choose>
        <when test="$TargetFramework='4.5'">
          <variable name="ReportTemplate" select="'Template40'"/>
        </when>
        <when test="$TargetFramework='4.0'">
          <variable name="ReportTemplate" select="'Template40'"/>
        </when>
        <otherwise>
          <variable name="ReportTemplate" select="'Template'"/>
        </otherwise>
      </choose>
      <variable name="CKEDITOR" select="'false'"/>
      <load path="$ProjectPath\ckeditor" depth="0">
        <if test="file">
          <variable name="CKEDITOR" select="'true'"/>
        </if>
      </load>

    </load>
    <!-- load meta data produced by the import process in the previous step and convert it into the standardized project data model -->
    <load path="DataAquarium.Metadata.xml" skipIfCached="Controllers.xml">
      <transform template="$LibraryRoot\_System\DataModel.xslt" output="DataModel.xml">
        <param name="Keys" select="$BLL_Keys"/>
        <param name="IncludeViews" select="$BLL_IncludeViews"/>
        <param name="DatabaseObjectFilter" select="$DatabaseObjectFilter"/>
      </transform>
      <load path="$ProjectPath\DataModel.xml">
        <transform template="$LibraryRoot\_System\DataModelReducer.xslt" output="DataModel.xml"/>
      </load>
    </load>
    <load path="DataModel.xml" skipIfCached="Controllers.xml">
      <transform template="$LibraryRoot\_System\BusinessObjects.xslt" output="Controllers.xml">
        <param name="AllowBlobSupport" select="'true'"/>
        <param name="DiscoveryDepth" select="$BLL_DiscoveryDepth"/>
        <param name="FieldMap" select="$BLL_FieldMap"/>
        <param name="LabelFormatExpression" select="$BLL_LabelFormatExpression"/>
        <param name="FieldsToIgnore" select="$BLL_FieldsToIgnore"/>
        <param name="FieldsToHide" select="$BLL_FieldsToHide"/>
        <param name="CustomLabels" select="$BLL_CustomLabels"/>
        <param name="MaxNumberOfDataFieldsInGridView" select="$MaxGridFields"/>
        <param name="DetectUnderscoreSeparatedSchema" select="$DetectUnderscoreSeparatedSchema"/>
        <param name="AllowBlobUploadOnInsert" select="$AllowBlobUploadOnInsert"/>
      </transform>
    </load>
    <load path="Controllers.xml" skipIfCached="Controllers.xml">
      <transform template="$LibraryRoot\Web Site Factory\MapBuilder.1.xslt" output="Map1.xml">
        <param name="DatabaseObjectGenerate" select="$DatabaseObjectGenerate"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\DataAquarium.xslt" output="Controllers.xml" cache="true">
        <param name="ReportsEnabled" select="$ReportsEnabled"/>
        <param name="FactoryEnabled" select="'true'"/>
        <param name="BatchEditEnabled" select="$BatchEditEnabled"/>
        <param name="RelationshipExplorer" select="$RelationshipExplorer"/>
        <param name="EnableTransactions" select="$EnableTransactions"/>
        <param name="SearchOnStartInLookups" select="$SearchOnStartInLookups"/>
        <param name="TargetFramework" select="$TargetFramework"/>
        <param name="ActionColumn" select="$ActionColumn"/>
      </transform>
    </load>
    <load path="$ProjectPath\Map1.xml" skipIfCached="Application.xml">
      <transform template="$LibraryRoot\Web Site Factory\MapBuilder.2.xslt" output="Map2.xml"/>
    </load>
    <load path="$ProjectPath\Map2.xml" skipIfCached="Application.xml">
      <transform template="$LibraryRoot\Web Site Factory\MapBuilder.3.xslt" output="Map3.xml"/>
    </load>
    <load path="$ProjectPath\Map3.xml" skipIfCached="Application.xml">
      <transform template="$LibraryRoot\Web Site Factory\MapBuilder.4.xslt" output="Map4.xml"/>
    </load>
    <load path="$ProjectPath\Controllers.Cache.xml" useLog="false" skipIfCached="Application.xml">
      <transform template="$LibraryRoot\Web Site Factory\Application.xslt" output="Application.xml" cache="true">
        <param name="ProjectPath" select="$ProjectPath"/>
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
        <param name="CustomSecurity" select="$CustomSecurity"/>
        <param name="ActiveDirectory" select="$ActiveDirectory"/>
        <param name="DedicatedLogin" select="$DedicatedLogin"/>
        <param name="Style" select="$DataViewLayout"/>
        <param name="MultiSelectEnabled" select="$MultiSelectEnabled"/>
        <param name="ShowModalForms" select="$ShowModalForms"/>
        <param name="SearchOnStart" select="$SearchOnStart"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <if test="contains($Compatibility, '20111118')">
        <load path="$ProjectPath\Application.Cache.xml" >
          <transform template="$LibraryRoot\Web Site Factory\ApplicationReducer.xslt" output="Application.Cache.xml" />
        </load>
      </if>
    </load>
    <load path="$ProjectPath\Controllers.xml" useLog="true">
      <message text="Finished processing Controllers.xml log."/>
    </load>
    <load path="$ProjectPath\Application.xml" useLog="true">
      <message text="Finished processing Application.xml log."/>
    </load>
    <navigate url="..\Data Aquarium\DataAquarium.Controllers.htm"/>
    <retract path="DataAquarium.Project.xml" test="$NextStep!='Generate'" steps="14"/>
    <!-- create a backup of the project source code -->
    <message text="backup the previous version of the project"/>
    <load path="$ProjectPath">
      <forEach select="//file[not(starts-with(@path, 'Bin\'))]">
        <copy input="$ProjectPath\{@path}" output="$BackupPath\{@path}" silent="true"/>
      </forEach>
    </load>
    <message text="end backup"/>
    <load path="$ProjectPath\Application.xml" useLog="true">
      <transform template="$LibraryRoot\Web Site Factory\Web.Sitemap.xslt" output="Web.Sitemap"/>
    </load>
    <load path="DataAquarium.Project.xml">
      <variable name="BLL_Generate" select="a:project/a:bll/@generate"/>
      <variable name="BLL_SelectMethod" select="a:project/a:bll/@selectMethod"/>
      <variable name="BLL_SelectSingleMethod" select="a:project/a:bll/@selectSingleMethod"/>
      <variable name="BLL_InsertMethod" select="a:project/a:bll/@insertMethod"/>
      <variable name="BLL_UpdateMethod" select="a:project/a:bll/@updateMethod"/>
      <variable name="BLL_DeleteMethod" select="a:project/a:bll/@deleteMethod"/>
      <variable name="Theme" select="a:project/a:theme/@name"/>
      <variable name="ThemeInput" select="'$LibraryRoot\Data Aquarium\_App_Themes\$Theme'"/>
      <variable name="ThemeOutput" select="'$ProjectPath\App_Themes\$Namespace'"/>
      <!--<transform template="$LibraryRoot\Data Aquarium\ScriptHost.ashx.xslt" output="ScriptHost.ashx"/>-->
      <!--<transform template="$LibraryRoot\Data Aquarium\ScriptHost.ashx.codedom.xslt" output="ScriptHost.ashx.codedom.xml"/>-->
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Controller.codedom.xslt" output="App_Code\Data\Controller.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Controller.Core.codedom.xslt" output="App_Code\Data\Controller.Core.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Controller.Export.codedom.xslt" output="App_Code\Data\Controller.Export.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Controller.Filter.codedom.xslt" output="App_Code\Data\Controller.Filter.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Unlimited\Security\EventTracker.codedom.xslt" output="App_Code\Security\EventTracker.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <if test="$ActiveDirectory='true'">
        <transform template="$LibraryRoot\Unlimited\Security\ADRoleProvider.codedom.xslt" output="App_Code\Security\RoleProvider.codedom.xml" when="TemplateChanged" usage="ClassLibrary" dependencies="DataAquarium.Project.xml"  async="true"/>
      </if>
      <if test="$CustomSecurity='true'">
        <transform template="$LibraryRoot\Unlimited\Security\RoleProvider.codedom.xslt" output="App_Code\Security\RoleProvider.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
        <transform template="$LibraryRoot\Unlimited\Security\MembershipProvider.codedom.xslt" output="App_Code\Security\MembershipProvider.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      </if>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\AnnotationPlugIn.codedom.xslt" output="App_Code\Data\AnnotationPlugIn.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ViewPage.codedom.xslt" output="App_Code\Data\ViewPage.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\BusinessRules.codedom.xslt" output="App_Code\Data\BusinessRules.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Premium\_App_Code\Data\ControllerNodeSet.codedom.xslt" output="App_Code\Data\ControllerNodeSet.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\DataField.codedom.xslt" output="App_Code\Data\DataField.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\DataViewExtender.codedom.xslt" output="App_Code\Web\DataViewExtender.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\ControllerDataSourceDesign.codedom.xslt" output="App_Code\Web\ControllerDataSourceDesign.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\ControllerDataSource.codedom.xslt" output="App_Code\Web\ControllerDataSource.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\Export.ashx.xslt" output="Export.ashx" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\Export.ashx.codedom.xslt" output="Export.ashx.codedom.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ActionHandlerBase.codedom.xslt" output="App_Code\Data\ActionHandlerBase.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\AquariumExtenderBase.codedom.xslt" output="App_Code\Web\AquariumExtenderBase.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
        <param name="AppVersion" select="$AppVersion"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
        <param name="Mobile" select="$Mobile"/>
        <param name="jQueryMobileVersion" select="$jQueryMobileVersion"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\PageBase.codedom.xslt" output="App_Code\Web\PageBase.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
        <param name="UrlHashing" select="$EASE_UrlHashing"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\DataViewLookup.codedom.xslt" output="App_Code\Web\DataViewLookup.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\DataViewTextBox.codedom.xslt" output="App_Code\Web\DataViewTextBox.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\_App_Code\Web\MenuExtender.codedom.xslt" output="App_Code\Web\MenuExtender.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
        <param name="ScriptOnly" select="$ScriptOnly"/>
        <param name="Mobile" select="$Mobile"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Services\DataControllerService.codedom.xslt" output="App_Code\Services\DataControllerService.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Services\ApplicationServices.codedom.xslt" output="App_Code\Services\ApplicationServices.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
        <param name="Mobile" select="$Mobile"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Services\ApplicationServices.Version.codedom.xslt" output="App_Code\Services\ApplicationServices.Version.codedom.xml" async="true">
        <param name="AppVersion" select="$AppVersion"/>
        <param name="jQueryMobileVersion" select="$jQueryMobileVersion"/>
      </transform>
      <if test="$TargetFramework!='3.5'">
        <transform template="$LibraryRoot\Unlimited\Services\EnterpriseApplicationServices.codedom.xslt" output="App_Code\Services\EnterpriseApplicationServices.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
        <transform template="$LibraryRoot\Unlimited\Services\RepresentationalStateTransfer.codedom.xslt" output="App_Code\Services\RepresentationalStateTransfer.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="AppVersion" select="$AppVersion"/>
        </transform>
      </if>
      <transform template="$LibraryRoot\Data Aquarium\Services\DataControllerService.asmx.xslt" output="Services\DataControllerService.asmx" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Action.codedom.xslt" output="App_Code\Data\Action.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ActionGroup.codedom.xslt" output="App_Code\Data\ActionGroup.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\FieldValue.codedom.xslt" output="App_Code\Data\FieldValue.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\View.codedom.xslt" output="App_Code\Data\View.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Category.codedom.xslt" output="App_Code\Data\Category.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\DynamicExpression.codedom.xslt" output="App_Code\Data\DynamicExpression.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ActionArgs.codedom.xslt" output="App_Code\Data\ActionArgs.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ActionResult.codedom.xslt" output="App_Code\Data\ActionResult.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\PageRequest.codedom.xslt" output="App_Code\Data\PageRequest.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\DistinctValueRequest.codedom.xslt" output="App_Code\Data\DistinctValueRequest.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Common.codedom.xslt" output="App_Code\Data\Common.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ControllerConfiguration.codedom.xslt" output="App_Code\Data\ControllerConfiguration.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Transactions.codedom.xslt" output="App_Code\Data\Transactions.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\FilterFunctions.codedom.xslt" output="App_Code\Data\FilterFunctions.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\ImportProcessor.codedom.xslt" output="App_Code\Data\ImportProcessor.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\ControlHost.codedom.xslt" output="App_Code\Web\ControlHost.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Localizer.codedom.xslt" output="App_Code\Data\Localizer.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
      <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\CultureManager.codedom.xslt" output="App_Code\Data\CultureManager.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
        <param name="SupportedCultures" select="$Globalization_SupportedCultures"/>
      </transform>
      <choose>
        <when test="$TargetFramework!='3.5'">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\ChartHost.codedom.xslt" output="App_Code\Web\ChartHost.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true"/>
        </when>
        <otherwise>
          <delete path="App_Code\Web\ChartHost.$CodeExtension"/>
        </otherwise>
      </choose>
      <load path="$ProjectPath\Application.xml" useLog="true">
        <copy output="Application.Web.Config.xml" />
      </load>
      <transform template="$LibraryRoot\Data Aquarium\web.config.xslt" output="web.config.xml" >
        <param name="Namespace" select="$Namespace"/>
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
        <param name="ReportsEnabled" select="$ReportsEnabled"/>
        <param name="ApplicationPath" select="concat($ProjectPath, '\Application.Web.Config.xml')"/>
        <param name="AnnotationsPath" select="$AnnotationsPath"/>
        <param name="ProviderFactories" select="$ProviderFactories"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\web.config.Customize.xslt" output="web.config">
        <param name="Path" select="concat($ProjectPath, '\web.config.xml')"/>
        <param name="UserData" select="$WebConfigUserData"/>
      </transform>
      <delete path="$ProjectPath\web.config.xml"/>
      <transform template="$LibraryRoot\_Shared\DataAccess.codedom.xslt" output="App_Code\Data\DataAccess.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Main.master.1.xslt" output="Main.master.1">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Main.master.2.xslt" output="Main.master.2" async="true">
        <param name="Namespace" select="$Namespace"/>
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
        <param name="PageHeader" select="$PageHeader"/>
        <param name="Copyright" select="$Copyright"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Main.master.codedom.xslt" output="Main.master.codedom.xml" async="true">
        <param name="MembershipEnabled" select="$MembershipEnabled"/>
        <param name="AppVersion" select="$AppVersion"/>
        <param name="ScriptOnly" select="$ScriptOnly"/>
        <param name="CKEDITOR" select="$CKEDITOR"/>
        <param name="Mobile" select="$Mobile"/>
        <param name="jQueryMobileVersion" select="$jQueryMobileVersion"/>
      </transform>
      <if test="a:project/a:membership[(@enabled='true' or @customSecurity='true' or @activeDirectory='true') and @dedicatedLogin='true']">
        <transform template="$LibraryRoot\Web Site Factory\Login.aspx.1.xslt" output="Login.aspx.1">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="$LibraryRoot\Web Site Factory\Login.aspx.2.xslt" output="Login.aspx.2" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="$LibraryRoot\Web Site Factory\Login.aspx.codedom.xslt" output="Login.aspx.codedom.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
      </if>
      <if test="$BLL_SharedBusinessRules='true'">
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Rules\SharedBusinessRules.codedom.xslt" output="App_Code\Rules\SharedBusinessRules.codedom.xml" when="DoesNotExist" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
      </if>
    </load>
    <copy input="$LibraryRoot\_Schemas\DataAquarium.xsd" output="Controllers\DataAquarium.xsd"/>
    <copy input="$LibraryRoot\_Schemas\Application.xsd" output="Controllers\Application.xsd"/>
    <!--<copy input="$LibraryRoot\Data Aquarium\Web.sitemap" output="Web.sitemap"/>-->
    <load path="Controllers.xml" useLog="true" >
      <transform template="$LibraryRoot\Web Site Factory\Default.aspx.1.xslt" output="Default.aspx.1">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Default.aspx.2.xslt" output="Default.aspx.2" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Web Site Factory\Default.aspx.codedom.xslt" output="Default.aspx.codedom.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\ControlHost.aspx.xslt" output="ControlHost.aspx">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <if test="$TargetFramework!='3.5'">
        <transform template="$LibraryRoot\Data Aquarium\ChartHost.aspx.xslt" output="ChartHost.aspx">
          <param name="Namespace" select="$Namespace"/>
        </transform>
      </if>
      <!--<transform template="$LibraryRoot\Data Aquarium\Details.aspx.1.xslt" output="Details.aspx.1">
        <param name="Namespace" select="$Namespace"/>
        <param name="IsApplication" select="'true'"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\Details.aspx.2.xslt" output="Details.aspx.2" async="true">
        <param name="Namespace" select="$Namespace"/>
        <param name="IsApplication" select="'true'"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\Details.aspx.codedom.xslt" output="Details.aspx.codedom.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
        <param name="IsApplication" select="'true'"/>
      </transform>-->
      <forEach select="/c:dataControllerCollection/c:dataController[not(@generate='false')]">
        <!--<copy output="Controllers\{@name}.xml">
					<regex pattern="&lt;text&gt;(?=[\r\n])([\s\S]*?)&lt;/text&gt;" replacement="&lt;text&gt;&lt;![CDATA[$1]]&gt;&lt;/text&gt;"/>
				</copy>-->
        <transform template="$LibraryRoot\Data Aquarium\DataAquarium.Controller.xslt" output="Controllers\{@name}.xml" async="true">
          <param name="AnnotationsEnabled" select="$AnnotationsEnabled"/>
          <param name="NewColumnEnabled" select="$NewColumnEnabled"/>
          <param name="FloatingEnabled" select="$FloatingEnabled"/>
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <if test="string-length(@handler)>0">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Rules\BusinessRules.codedom.xslt" output="App_Code\Rules\{@handler}.codedom.xml" when="DoesNotExist" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="SharedBusinessRules" select="$BLL_SharedBusinessRules"/>
          </transform>
        </if>
        <if test="c:fields/c:field[string-length(c:codeFormula)>0 or string-length(c:codeDefault)>0 or string-length(c:codeValue)>0 or string-length(c:items/@targetController)>0] or .//c:dataField[string-length(c:codeFilter)>0] or c:views/c:view[@virtualViewId!='']">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Rules\BusinessRules.Generated.codedom.xslt" output="App_Code\Rules\{@name}.Generated.codedom.xml" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="SharedBusinessRules" select="$BLL_SharedBusinessRules"/>
          </transform>
        </if>
        <forEach select="c:businessRules/c:rule[@type='Code']">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Rules\BusinessRules.Rule.codedom.xslt" output="App_Code\Rules\{ancestor::c:dataController/@name}.{@id}.codedom.xml" when="DoesNotExist" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="SharedBusinessRules" select="$BLL_SharedBusinessRules"/>
          </transform>
        </forEach>
        <if test="$BLL_Generate='true'">
          <transform template="$LibraryRoot\Data Aquarium\_App_Code\Data\Objects\Object.codedom.xslt" output="App_Code\Data\Objects\{@name}.codedom.xml" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="SelectMethod" select="$BLL_SelectMethod"/>
            <param name="SelectSingleMethod" select="$BLL_SelectSingleMethod"/>
            <param name="InsertMethod" select="$BLL_InsertMethod"/>
            <param name="UpdateMethod" select="$BLL_UpdateMethod"/>
            <param name="DeleteMethod" select="$BLL_DeleteMethod"/>
          </transform>
        </if>
        <forEach select="c:views/c:view[@reportTemplate='true']" silent="true">
          <transform template="$LibraryRoot\Data Aquarium\Reports\$ReportTemplate.xslt" output="Reports\{ancestor::c:dataController/@name}_{@id}.rdlc" select="ancestor::c:dataController" async="true" when="DoesNotExist">
            <param name="ControllerName" select="ancestor::c:dataController/@name"/>
            <param name="ViewName" select="@id"/>
          </transform>
        </forEach>
        <load path="$ProjectPath\Controls">
          <variable name="AvailableChartControls" select="';'"/>
          <forEach select="//file[not(contains(@name,'ascx.')) and starts-with(@name, 'Chart_')]">
            <variable name="AvailableChartControls" select="concat('$AvailableChartControls', @name, ';')"/>
          </forEach>
        </load>
        <forEach select="c:views/c:view[@type='Chart' and c:dataFields/c:dataField[@chart!='']]">
          <variable name="ChartType" select="c:dataFields/c:dataField[@chart!='' and @chart!='XValue']/@chart"/>
          <if test="$ChartType!='Custom' or not(contains($AvailableChartControls, concat(';', 'Chart_', ancestor::c:dataController/@name, '_', @id, '.ascx')))">
            <transform template="$LibraryRoot\Premium\Controls\Chart.ascx.1.xslt" output="Controls\{concat('Chart_', ancestor::c:dataController/@name, '_', @id)}.ascx.1">
              <param name="Namespace" select="$Namespace"/>
              <param name="Name" select="concat('Chart_', ancestor::c:dataController/@name, '_', @id)"/>
            </transform>
            <transform template="$LibraryRoot\Premium\Controls\Chart.ascx.2.xslt" output="Controls\{concat('Chart_', ancestor::c:dataController/@name, '_', @id)}.ascx.2" >
              <param name="Namespace" select="$Namespace"/>
              <param name="Name" select="concat('Chart_', ancestor::c:dataController/@name, '_', @id)"/>
            </transform>
            <transform template="$LibraryRoot\Premium\Controls\Chart.ascx.codedom.xslt" output="Controls\{concat('Chart_', ancestor::c:dataController/@name, '_', @id)}.ascx.codedom.xml" >
              <param name="Namespace" select="$Namespace"/>
              <param name="Name" select="concat('Chart_', ancestor::c:dataController/@name, '_', @id)"/>
            </transform>
          </if>
        </forEach>
      </forEach>
      <if test="$ReportsEnabled='true'">
        <transform template="$LibraryRoot\Data Aquarium\Report.ashx.xslt" output="Report.ashx"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\Report.ashx.codedom.xslt" output="App_Code\Handlers\Report.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="TargetFramework" select="$TargetFramework"/>
        </transform>
        <copy input="$LibraryRoot\Data Aquarium\Reports\$ReportTemplate.xslt" output="Reports\Template.xslt"/>
      </if>
      <copy input="$LibraryPath\Default.css" output="$ProjectPath\App_Themes\$Namespace\_Theme_$Theme.css" />
      <!--<load path="$LibraryRoot\Data Aquarium\_App_Themes">
        <forEach select="folder">
          <variable name="ThemeFolder" select="@path"/>
          <load path="$ProjectPath\App_Themes\$ThemeFolder">
            <forEach select="//file">
              <delete path="$ProjectPath\App_Themes\$ThemeFolder\{@path}" silent="true"/>
            </forEach>
          </load>
          <delete path="$ProjectPath\App_Themes\{@path}" silent="true"/>
          <delete path="$ProjectPath\App_Themes\$Namespace\_Theme_{@name}.css" silent="true"/>
        </forEach>
      </load>-->
      <transform template="$LibraryRoot\Web App Factory\_references.js.xslt" output="Scripts\_references.js" when="TemplateChanged" async="true"/>
      <if test="$ScriptOnly='true'">
        <copy input="$LibraryRoot\Web Site Factory\Scripts\MicrosoftAjax.js" output="Scripts\MicrosoftAjax.js" />
        <copy input="$LibraryRoot\Web Site Factory\Scripts\MicrosoftAjaxWebForms.js" output="Scripts\MicrosoftAjaxWebForms.js" />
        <copy input="$LibraryRoot\Web Site Factory\Scripts\MicrosoftAjaxApplicationServices.js" output="Scripts\MicrosoftAjaxApplicationServices.js" />
        <if test="$Mobile='true'">
          <load path="$LibraryRoot\_Client\Mobile">
            <forEach select="//file">
              <copy input="$LibraryRoot\_Client\Mobile\{@path}" output="touch\{@path}" silent="true"/>
            </forEach>
          </load>
          <load path="$LibraryRoot\_Images\Logos">
            <forEach select="//file">
              <copy input="$LibraryRoot\_Images\Logos\{@path}"  output="touch\{@path}" mode="create" silent="true"/>
            </forEach>
          </load>
          <copy input="$LibraryRoot\Data Aquarium\Mobile\Web.Mobile.js" output="Scripts\Web.Mobile.js" silent="true"/>
          <copy input="$LibraryRoot\Premium\Mobile\Web.Mobile.js" output="Scripts\Web.Mobile.debug.js" silent="true"/>
        </if>
      </if>
      <if test="$MembershipEnabled='true'">
        <if test="$TargetFramework='3.5'">
          <copy input="$LibraryRoot\Web Site Factory\Scripts\MicrosoftAjaxApplicationServices.js" output="Scripts\MicrosoftAjaxApplicationServices.js" />
        </if>
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.MembershipResources.js" output="Scripts\Web.MembershipResources.js" />
        <copy input="$LibraryRoot\Standard\Scripts\Web.MembershipResources.js" output="Scripts\Web.MembershipResources.debug.js" />
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.Membership.js" output="Scripts\Web.Membership.js" />
        <copy input="$LibraryRoot\Standard\Scripts\Web.Membership.js" output="Scripts\Web.Membership.debug.js" />
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.MembershipManager.js" output="Scripts\Web.MembershipManager.js" />
        <copy input="$LibraryRoot\Standard\Scripts\Web.MembershipManager.js" output="Scripts\Web.MembershipManager.debug.js" />
        <load path="$LibraryRoot\Data Aquarium\Controllers\aspnet_Membership.xml">
          <transform template="$LibraryRoot\Data Aquarium\Controllers\MembershipControllerBuilder.xslt" output="Controllers\aspnet_Membership.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="ProviderName" select="$MembershipProviderName"/>
          </transform>
        </load>
        <load path="$LibraryRoot\Data Aquarium\Controllers\aspnet_Roles.xml">
          <transform template="$LibraryRoot\Data Aquarium\Controllers\MembershipControllerBuilder.xslt" output="Controllers\aspnet_Roles.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
            <param name="Namespace" select="$Namespace"/>
            <param name="ProviderName" select="$MembershipProviderName"/>
          </transform>
        </load>
        <!--<copy input="$LibraryRoot\Data Aquarium\_App_Themes\_Shared\Membership.css" output="App_Themes\_Shared\Membership.css" />-->
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Security\MembershipBusinessRules.codedom.xslt" output="App_Code\Security\MembershipBusinessRules.codedom.xml" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="ProviderName" select="$MembershipProviderName"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipBarExtender.codedom.xslt" output="App_Code\Web\MembershipBarExtender.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipBar.codedom.xslt" output="App_Code\Web\MembershipBar.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipManagerExtender.codedom.xslt" output="App_Code\Web\MembershipManagerExtender.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="ScriptOnly" select="$ScriptOnly"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipManager.codedom.xslt" output="App_Code\Web\MembershipManager.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
      </if>
      <if test="$MembershipEnabled='true' or $CustomSecurity='true' or $ActiveDirectory='true'">
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Security\ExportAuthenticationModule.codedom.xslt" output="App_Code\Security\ExportAuthenticationModule.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
      </if>
      <load path="$ProjectPath" depth="0">
        <if test="not(file[@name='Global.asax'])">
          <transform template="$LibraryRoot\Data Aquarium\Global.asax.1.xslt" output="Global.asax.1">
            <param name="Namespace" select="$Namespace"/>
          </transform>
          <transform template="$LibraryRoot\Data Aquarium\Global.asax.2.xslt" output="Global.asax.2">
            <param name="Namespace" select="$Namespace"/>
          </transform>
          <copy input="$ProjectPath\Global.asax" output="Global.asax">
            <regex pattern="\)\s+Handles\s+.+?\r" replacement=")&#13;"/>
          </copy>
        </if>
      </load>
      <if test="$CustomSecurity='true' or $WindowsAuthentication or $ActiveDirectory='true'">
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.MembershipResources.js" output="Scripts\Web.MembershipResources.js" />
        <copy input="$LibraryRoot\Standard\Scripts\Web.MembershipResources.js" output="Scripts\Web.MembershipResources.debug.js" />
        <copy input="$LibraryRoot\Data Aquarium\Scripts\Web.Membership.js" output="Scripts\Web.Membership.js" />
        <copy input="$LibraryRoot\Standard\Scripts\Web.Membership.js" output="Scripts\Web.Membership.debug.js" />
        <!--<copy input="$LibraryRoot\Data Aquarium\_App_Themes\_Shared\Membership.css" output="App_Themes\_Shared\Membership.css" />-->
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipBarExtender.codedom.xslt" output="App_Code\Web\MembershipBarExtender.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
        <transform template="$LibraryRoot\Data Aquarium\_App_Code\Web\MembershipBar.codedom.xslt" output="App_Code\Web\MembershipBar.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
        </transform>
      </if>
      <!-- create blob handler -->
      <transform template="$LibraryRoot\Data Aquarium\Blob.ashx.xslt" output="Blob.ashx" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\Blob.ashx.codedom.xslt" output="App_Code\Handlers\Blob.ashx.codedom.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
        <param name="ProviderName" select="$ProviderName"/>
      </transform>
      <transform template="$LibraryRoot\Premium\_App_Code\Data\BlobAdapters.codedom.xslt" output="App_Code\Data\BlobAdapters.codedom.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Unlimited\Data\BlobAdaptersEx.codedom.xslt" output="App_Code\Data\BlobAdaptersEx.codedom.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <!-- create import handler -->
      <transform template="$LibraryRoot\Data Aquarium\Import.ashx.xslt" output="Import.ashx" when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
      <transform template="$LibraryRoot\Data Aquarium\Import.ashx.codedom.xslt" output="App_Code\Handlers\Import.ashx.codedom.xml"  when="TemplateChanged" dependencies="DataAquarium.Project.xml" async="true">
        <param name="Namespace" select="$Namespace"/>
      </transform>
    </load>
    <load path="$ProjectPath\Application.xml" useLog="true">
      <forEach select="/app:application/app:pages/app:page[string-length(@url)=0]">
        <transform template="$LibraryRoot\Web Site Factory\Pages\Page.aspx.1.xslt" output="Pages\{@name}.aspx.1">
          <param name="Namespace" select="$Namespace"/>
          <param name="Name" select="@name"/>
        </transform>
        <transform template="$LibraryRoot\Web Site Factory\Pages\Page.aspx.2.xslt" output="Pages\{@name}.aspx.2" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="Name" select="@name"/>
          <param name="UseExtenders" select="$UseExtenders"/>
        </transform>
        <transform template="$LibraryRoot\Web Site Factory\Pages\Page.aspx.codedom.xslt" output="Pages\{@name}.aspx.codedom.xml" async="true">
          <param name="Namespace" select="$Namespace"/>
          <param name="Name" select="@name"/>
        </transform>
      </forEach>
      <load path="$ProjectPath\Controls">
        <variable name="AvailableControls" select="';'"/>
        <forEach select="//file[not(contains(@name,'ascx.') and starts-with(@name, 'Chart_'))]" >
          <variable name="AvailableControls" select="concat('$AvailableControls', @name, ';')" silent="true"/>
        </forEach>
      </load>
      <forEach select="/app:application/app:userControls/app:userControl">
        <if test="@generate='Always' or not(contains($AvailableControls, concat(';', @name, '.ascx')))" silent="true">
          <choose>
            <when test="not(contains(app:body, '&lt;%@')) or string-length(app:body)>0">
              <transform template="$LibraryRoot\Web Site Factory\Controls\Control.ascx.1.xslt" output="Controls\{@name}.ascx.1">
                <param name="Namespace" select="$Namespace"/>
                <param name="Name" select="@name"/>
              </transform>
              <transform template="$LibraryRoot\Web Site Factory\Controls\Control.ascx.2.xslt" output="Controls\{@name}.ascx.2" async="true">
                <param name="Namespace" select="$Namespace"/>
                <param name="Name" select="@name"/>
              </transform>
              <transform template="$LibraryRoot\Web Site Factory\Controls\Control.ascx.codedom.xslt" output="Controls\{@name}.ascx.codedom.xml" async="true">
                <param name="Namespace" select="$Namespace"/>
                <param name="Name" select="@name"/>
              </transform>
            </when>
            <otherwise>
              <transform template="$LibraryRoot\Web Site Factory\Controls\Control.ascx.2.xslt" output="Controls\{@name}.ascx" async="true">
                <param name="Namespace" select="$Namespace"/>
                <param name="Name" select="@name"/>
              </transform>
            </otherwise>
          </choose>
        </if>
      </forEach>
    </load>
    <!-- copy static files to the project folder -->
    <choose>
      <when test="$TargetFramework='4.5'">
        <if test="$ScriptOnly='false'">
          <load path="$LibraryRoot\_AjaxControlToolkit40">
            <forEach select="//file">
              <copy input="$LibraryRoot\_AjaxControlToolkit40\{@path}" output="Bin\{@path}" silent="true"/>
            </forEach>
          </load>
        </if>
      </when>
      <when test="$TargetFramework='4.0'">
        <load path="$LibraryRoot\_AjaxControlToolkit40">
          <forEach select="//file">
            <copy input="$LibraryRoot\_AjaxControlToolkit40\{@path}" output="Bin\{@path}" silent="true"/>
          </forEach>
        </load>
      </when>
      <otherwise>
        <load path="$LibraryRoot\_AjaxControlToolkit">
          <forEach select="//file">
            <copy input="$LibraryRoot\_AjaxControlToolkit\{@path}" output="Bin\{@path}" silent="true"/>
          </forEach>
        </load>
      </otherwise>
    </choose>
    <if test="$HelpEnabled='true'">
      <load path="$LibraryRoot\Data Aquarium\Help">
        <forEach select="//file">
          <copy input="$LibraryRoot\Data Aquarium\Help\{@path}" output="Help\{@path}"/>
        </forEach>
      </load>
    </if>
    <if test="$MembershipEnabled = 'true' and contains($MembershipProviderName,'SQLAnywhere')">
      <copy input="$ProgramFiles\SQL Anywhere 12\Assembly\V2\iAnywhere.Web.Security.dll" output="Bin\iAnywhere.Web.Security.dll"/>
    </if>
    <load path="$LibraryRoot\Data Aquarium\Scripts">
      <forEach select="//file[@name !='Web.Membership.js' and @name != 'Web.MembershipManager.js' and @name != 'Web.MembershipResources.js']">
        <copy input="$LibraryRoot\Data Aquarium\Scripts\{@path}" output="Scripts\{@path}"/>
        <copy input="$LibraryRoot\Standard\Scripts\{@path}" output="Scripts\{concat(substring-before(@path,'.js'), '.debug.js')}"/>
      </forEach>
    </load>
    <!--<load path="$LibraryRoot\Premium\Scripts">
      <forEach select="//file">
        <copy input="$LibraryRoot\Premium\Scripts\{@path}" output="Scripts\{@path}"/>
      </forEach>
    </load>-->
    <!--<load path="$LibraryRoot\Data Aquarium\_App_Themes\_Shared">
      <forEach select="//file[@name!='Membership.css']">
        <copy input="$LibraryRoot\Data Aquarium\_App_Themes\_Shared\{@path}" output="App_Themes\_Shared\{@path}"/>
      </forEach>
    </load>
    <load path="$LibraryRoot\Web Site Factory\_App_Themes\Factory">
      <forEach select="//file">
        <copy input="$LibraryRoot\Web Site Factory\_App_Themes\Factory\{@path}" output="App_Themes\_Shared\{@path}"/>
      </forEach>
    </load>
    <load path="$ThemeInput">
      <forEach select="//file">
        <copy input="$ThemeInput\{@path}" output="$ProjectPath\App_Themes\$Theme\{@path}"/>
      </forEach>
    </load>
    <if test="not($MembershipEnabled='true' or $WindowsAuthentication='true' or $CustomSecurity='true')">
      <copy input="$ThemeInput\$Theme.css" output="$ProjectPath\App_Themes\$Theme\$Theme.css">
        <regex pattern="@import.+?Membership.css\S+?\s+" replacement=""/>
      </copy>
    </if>
    <copy input="$LibraryRoot\Data Aquarium\_App_Themes\_Layout.skin" output="$ThemeOutput\_Layout.skin"/>
    <transform template="$LibraryRoot\Data Aquarium\_App_Themes\FactoryTheme.xslt" output="$ThemeOutput\_Theme_$Theme.css" async="true">
      <param name="Theme" select="$Theme"/>
      <param name="Namespace" select="$Namespace"/>
    </transform>-->
    <wait mesage="Waiting for transformations to complete..."/>
    <!--<applyTheme theme="$Theme" output="$ThemeOutput\_Theme_$Theme.css"/>-->
    <load path="$ProjectPath">
      <!-- delete all .codedom.xml files -->
      <forEach select="//file[contains(@name, '.codedom.xml')]">
        <delete path="{@path}" silent="true"/>
      </forEach>
      <!-- merge ScriptHost files -->
      <!--<variable name="ScriptHostSource" select="//file[starts-with(@name, 'ScriptHost.ashx.') and not(contains(@name,'codedom'))]/@name"/>
			<copy input="$ProjectPath\$ScriptHostSource" output="ScriptHost.ashx" mode="append"/>
			<delete path="$ScriptHostSource"/>-->
      <!-- merge Export files -->
      <variable name="ExportSource" select="//file[starts-with(@name, 'Export.ashx.') and not(contains(@name,'codedom'))]/@name"/>
      <copy input="$ProjectPath\$ExportSource" output="Export.ashx" mode="append"/>
      <delete path="$ExportSource"/>
      <!-- merge Blob files -->
      <!--<variable name="BlobSource" select="//file[starts-with(@name, 'Blob.ashx.') and not(contains(@name,'codedom'))]/@name"/>
			<copy input="$ProjectPath\$BlobSource" output="Blob.ashx" mode="append">
				<regex pattern="([^\x0d\S])(\x0a)" replacement="$1&#13;$2"/>
				<regex pattern="&quot;&amp;\s+_\s+&quot;" replacement=""/>
				<regex pattern="&quot;&amp;Global\.Microsoft\.VisualBasic\.ChrW\(10\)&amp;&quot;" replacement="&quot;&amp; _&#13;&#10;&#9;&#9;&#9;&quot;"/>
			</copy>
			<delete path="$BlobSource"/>-->
      <!--<variable name="BlobSource" select="//file[starts-with(@name, 'Blob.ashx.') and not(contains(@name,'codedom'))]/@name"/>
			<copy input="$ProjectPath\$BlobSource" output="$BlobSource">
				<regex pattern="([^\x0d])(\x0a)" replacement="$1&#13;$2"/>
				<regex pattern="&quot;&amp;\s+_\s+&quot;" replacement=""/>
				<regex pattern="&quot;&amp;Global\.Microsoft\.VisualBasic\.ChrW\(10\)&amp;&quot;" replacement="&quot;&amp; _&#13;&#10;&#9;&#9;&#9;&quot;"/>
			</copy>-->
      <!-- merge Report files -->
      <!--<variable name="ReportSource" select="//file[starts-with(@name, 'Report.ashx.') and not(contains(@name,'codedom'))]/@name"/>
      <copy input="$ProjectPath\$ReportSource" output="Report.ashx" mode="append"/>
      <delete path="$ReportSource"/>-->
    </load>
    <translate path="$ProjectPath\Scripts" pattern="*.js" cultures="$Globalization_SupportedCultures" dictionary="ClientLibrary.txt"/>
    <translate path="$ProjectPath" pattern="*.sitemap!,*.aspx,*.ascx,*.xslt" cultures="$Globalization_SupportedCultures" dictionary="Resources.txt" />
    <translate path="$ProjectPath\Controllers" pattern="*.xml" cultures="$Globalization_SupportedCultures" dictionary="Resources.txt"/>
    <delete path="DataModel.xml"/>
    <delete path="Controllers.xml"/>
    <delete path="Application.xml"/>
    <delete path="Application.Web.Config.xml"/>
    <delete path="Map1.xml"/>
    <delete path="Map2.xml"/>
    <delete path="Map3.xml"/>
    <delete path="Map4.xml"/>
    <load path="DataAquarium.Project.xml">
      <if test="a:project/a:webServer/@run='true'">
        <choose>
          <when test="$IISExpress='true'">
            <browse name="$ProjectName" path="$ProjectPath" port="{a:project/a:webServer/@port}"
                    framework="{a:project/@targetFramework}"
                    windowsAuthentication="{a:project/a:membership/@windowsAuthentication}"
                    relativePath="default.aspx"/>
          </when>
          <otherwise>
            <choose>
              <when test="$TargetFramework='4.0'">
                <execute fileName="$WebDevWebServer40" arguments="/port:{a:project/a:webServer/@port} /path:&quot;$ProjectPath&quot; /vpath:&quot;/$ProjectName&quot;" mode="nowait"/>
              </when>
              <otherwise>
                <execute fileName="$WebDevWebServer" arguments="/port:{a:project/a:webServer/@port} /path:&quot;$ProjectPath&quot; /vpath:&quot;/$ProjectName&quot;" mode="nowait"/>
              </otherwise>
            </choose>
            <execute fileName="http://localhost:{a:project/a:webServer/@port}/$ProjectName/default.aspx" arguments="-new" mode="nowait"/>
          </otherwise>
        </choose>
      </if>
    </load>
    <load path="$Root\Solutions\Mobile Factory\$ProjectName\" depth="0">
      <if test="not(file[@name=concat($ProjectName, '.sln')])">
        <load path="DataAquarium.Project.xml">
          <transform template="$LibraryRoot\Web Site Factory\Solution.sln.xslt" output="$Root\Solutions\Mobile Factory\$ProjectName\$ProjectName.sln">
            <param name="ProjectName" select="$ProjectName"/>
            <param name="VisualStudio2012" select="$VisualStudio2012"/>
            <param name="VisualStudio2013" select="$VisualStudio2013"/>
          </transform>
        </load>
      </if>
    </load>
  </build>
  <actions>
    <action name="Develop" toolTip="Open in Visual Studio to customize the source code.">

      <load path="DataAquarium.Project.xml">
        <execute fileName="file://$Root\Solutions\Mobile Factory\$ProjectName\$ProjectName.sln" arguments="" mode="nowait"/>
      </load>
    </action>
    <action name="Browse" toolTip="View the site in your default web browser.">
      <load path="DataAquarium.Project.xml">
        <choose>
          <when test="$IISExpress='true'">
            <browse name="$ProjectName" path="$ProjectPath" port="{a:project/a:webServer/@port}"
                    framework="{a:project/@targetFramework}"
                    windowsAuthentication="{a:project/a:membership/@windowsAuthentication}"
                    relativePath="default.aspx"/>
          </when>
          <otherwise>
            <choose>
              <when test="a:project/@targetFramework='4.0'">
                <execute fileName="$WebDevWebServer40" arguments="/port:{a:project/a:webServer/@port} /path:&quot;$ProjectPath&quot; /vpath:&quot;/$ProjectName&quot;" mode="nowait"/>
              </when>
              <otherwise>
                <execute fileName="$WebDevWebServer" arguments="/port:{a:project/a:webServer/@port} /path:&quot;$ProjectPath&quot; /vpath:&quot;/$ProjectName&quot;" mode="nowait"/>
              </otherwise>
            </choose>
            <execute fileName="http://localhost:{a:project/a:webServer/@port}/$ProjectName/default.aspx" arguments="-new" mode="nowait"/>
          </otherwise>
        </choose>
      </load>
    </action>
    <action name="Publish" toolTip="Publish the web site for deployment.">
      <!--<load path="$LibraryRoot\_Config\CodeOnTime.CodeDom.xml">
        <variable name="ProjectExtension" select="concat(substring-after(/config:configuration/config:providers/config:provider[@name=/config:configuration/config:providers/@default]/@extension, '.'), 'proj')"/>
      </load>-->
      <load path="DataAquarium.Project.xml">
        <revise/>
        <variable name="TargetFramework" select="a:project/@targetFramework"/>
        <variable name="ReportsEnabled" select="a:project/a:reports/@enabled"/>
        <choose>
          <when test="$TargetFramework='3.5'">
            <execute fileName="$AspNetCompiler20" arguments="-nologo -f -v  / -p &quot;$ProjectPath&quot; &quot;$Root\Publish\Web Site Factory\$ProjectName&quot;" mode="wait" />
          </when>
          <otherwise>
            <execute fileName="$AspNetCompiler40" arguments="-nologo -f -v / -p &quot;$ProjectPath&quot; &quot;$Root\Publish\Web Site Factory\$ProjectName&quot;" mode="wait" />
          </otherwise>
        </choose>
        <if test="$ReportsEnabled='true'">
          <choose>
            <when test="$TargetFramework='3.5'">
              <copy group="ReportViewer35" output="$Root\Publish\Web Site Factory\$ProjectName\bin"/>
            </when>
            <when test="$TargetFramework='4.0'">
              <copy group="ReportViewer40" output="$Root\Publish\Web Site Factory\$ProjectName\bin"/>
            </when>
            <otherwise>
              <copy group="ReportViewer45" output="$Root\Publish\Web Site Factory\$ProjectName\bin"/>
            </otherwise>
          </choose>
        </if>
        <load path="$ProjectPath\Reports">
          <forEach select="//file['.rdlc'=substring(@name, string-length(@name)-4)]">
            <copy input="$ProjectPath\Reports\{@path}" output="$Root\Publish\Web Site Factory\$ProjectName\Reports\{@path}"/>
          </forEach>
        </load>
        <clean path="$Root\Publish\Web Site Factory\$ProjectName"/>
        <execute fileName="$Root\Publish\Web Site Factory\$ProjectName" arguments="" mode="nowait"/>
      </load>
    </action>
  </actions>
  <settings>
    <group name="Namespace" text="Namespace and Framework" description="Change the source code namespace and target .NET framework of the generated web application."/>
    <group name="Connection" text="Database Connection" description="Configure database connection provider and connection string properties."/>
    <group name="BLL" text="Business Logic Layer" description="Configue shared business rules, data access objects, relationship discovery, denormalization map, and text label construction."/>
    <group name="Reports" text="Reporting" description="Enable or disable automatic reports in your application."/>
    <group name="Membership" text="Authentication and Membership" description="Select authentication and membership options for your web app."/>
    <group name="Features" text="Features" description="Specify global features of the generated baseline application."/>
    <group name="Layout" text="Layouts" description="Specify the page data view layout preferences. Select simple, tabbed, classic, inline, or stacked layout."/>
    <group name="Theme" text="Theme" description="Change user interface theme."/>
    <group name="Globalization" text="Globalization and Localization" description="Enter globalization and localization settings of this application."/>
    <group name="WebServer" text="Web Server Configuration" description="Configure development web server and enter runtime configuration properties of the application."/>
  </settings>
</project>
