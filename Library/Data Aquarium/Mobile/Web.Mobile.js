(function(){function ws(n){var t=n.replace(/\.\w+$/,"").replace(/\W/g,"_").toLowerCase()||"page";return t.match(/^\_/)&&(t=t.substring(1)),t}function f(){return yt&&us=="mouse"}function bs(){return $(".ui-panel-open .ui-btn.app-animated")}function oe(){return $(".ui-popup-active .ui-btn.app-animated")}function ia(){return tt.width()>tt.height()}function lt(){n.promo("search",pt.PerformAdvancedSearch);n.promo().data("icon-list",null)}function ks(){var t=n._menuButton;e(t,function(){t.trigger("vclick")})}function se(){r.sidebar=="Landscape"?ia()?u.removeClass("app-sidebar-undocked"):u.addClass("app-sidebar-undocked"):r.sidebar=="Never"?u.addClass("app-sidebar-undocked"):u.removeClass("app-sidebar-undocked")}function rf(n){f()?w.open(n):w.location.href=n}function ds(){switch(r.displayDensity){case"Comfortable":return 46;case"Compact":return 40}return 35}function fr(){return(new Date).getTime()}function er(n){return parseFloat(n.replace(/[A-Za-z]/g,""))}function gs(n){return n.x!=null&&(n.x=Math.ceil(n.x)),n.y!=null&&(n.y=Math.ceil(n.y)),n}function ra(n){return String.format("{0} - {1}",pt.QuickFindText,n.get_view().Label)}function uf(n){n.refreshCallback&&(n.refreshCallback(),n.refreshCallback=null)}function nh(){return String.format("{0:"+$app.dateFormatStrings["{0:f}"]+"}",new Date)}function ff(n){var t=r.pageTransition!="none";if(arguments.length==0)return t;t||n.removeClass("ui-panel-animate")}function he(n,i){n._hasKey()&&$('<span class="app-btn-more">&nbsp;<\/span>').appendTo(i).attr("title",t.More)}function ce(n,t){n=$(n);n.length&&(n[0].selectionStart=n[0].selectionEnd=t)}function th(n,t){n.extension().quickFind(t);ph(n)}function ef(n){var t=[];return n&&n.viewProp("useAdvancedSearch")&&(t=n.viewProp("advancedSearchFilter")||t),t}function dr(n){su(n);rh(n);$(n._allFields).each(function(){delete this._listOfValues});n._forceSync();n.refreshData();de();ph(n)}function ih(n,t){!t&&ef(n).length&&n.viewProp("advancedSearchFilter",null);n.clearFilter();dr(n)}function rh(n){var t=(n.get_filter()||[]).slice(0),r=[],u,i=0;for($(n.get_externalFilter()).each(function(){r.push(this.Name)});i<t.length;)u=t[i],Array.indexOf(r,u.match(/^\w+/)[0])!=-1?t.splice(i,1):i++;n.viewProp("filter",t)}function uh(){var t=n._menuStrip;return t&&t.strip.is(":visible")}function gr(t){var r=n._menuStrip,i=r&&r.strip,u=n._menuPanel;if(i){var o=$(u).find('li a[rel="external"]'),f=o.parent(),e=$(u).find(".ui-li-divider:not(.app-info):not(.app-copy)");arguments.length==0&&(t=uh());t?(i.show(),f.hide(),e.hide()):(i.hide(),f.show(),e.show())}}function fh(n){n.length&&n[n.length-1].text&&n.push({})}function of(t){t=$(t);causesCalculate=t.attr("data-causes-calculate");causesCalculate&&n.causesCalculate(causesCalculate);var i=n.dataView();i&&!t.is(":checkbox,:radio")&&setTimeout(function(){i.extension().calculate(n.dataView())},200)}function eh(n){var e=$(n.target),t,i,u,r=[],f;t=e.closest(".app-container-scrollable");t.length&&(i=t.next(),u=t.data("data-field"),t.find(":checkbox,:radio").each(function(n){$(this).is(":checked")&&(r.length&&r.push(","),r.push(u.Items[n][0]))}),f=i.val(),i.val(r.join("")),f!=i.val()&&of(i))}function sf(t,i){t.find(".app-container-scrollable").each(function(){var f=0,e=0,r=$(this),o=parseInt(r.attr("data-columns")),t=r.find("fieldset");if(i){var s=t.find(":input"),c=Math.min(Math.ceil(s.length/(o>1?o:1)),Math.max(Math.ceil(n.screen().height*.45/ds()),3)),u,h=[];t.find(":checkbox,:input").checkboxradio("destroy").off("click");t.controlgroup("destroy");s.each(function(n){n%c==0&&(u=$('<fieldset class="app-controlgroup-vertical"/>').appendTo(r),h.push(u));var t=$(this),i=t.prev();i.appendTo(u);t.appendTo(u)});t.remove();t=$(h).controlgroup().find(":checkbox,:radio").checkboxradio();r.find(":checkbox,:radio").on("click",eh)}i||t.each(function(){$(this).height("").find(".ui-checkbox,.ui-radio").width("")});t.each(function(){var n=$(this),t=n.width(),i=n.height();t>f&&(f=t);i>e&&(e=i)});t.each(function(){$(this).height(e).find(".ui-checkbox,.ui-radio").width(f+1)})})}function hf(){try{if(w.getSelection){var n=w.getSelection();n&&n.rangeCount>0&&n.removeAllRanges()}else document.selection&&document.selection.empty()}catch(t){}}function cf(t){var r=n._menuStrip,i=r&&r.strip;i&&(i.hide(),arguments.length==1&&i.attr("data-enabled",t?"true":"false"))}function oh(n,t){t=="Cards"?n.addClass("app-cardview").removeClass("app-grid"):t=="Grid"?n.addClass("app-grid").removeClass("app-cardview"):t=="List"&&n.removeClass("app-cardview app-grid")}function sh(n){n.find("> .app-map").each(function(){var i=$(this),u=n.find("> .app-page-header:visible"),f=n.find("> .app-map-instruction:visible"),r=$(f.length&&f||u.length&&u),e=i.data("data-map"),t,o;i.css("top",r.length?r.position().top+r.outerHeight(!0):0);i.is(":visible")&&e&&(t=e.map,o=t.getCenter(),google.maps.event.trigger(t,"resize"),t.setCenter(o))})}function le(n){n.css({display:"block","z-index":-10});wt(n);n.css({display:"","z-index":""})}function wt(n){var u=i.activePage;n||(n=u);var f=n==u,e=f?n:u,r=e.css("padding-top"),t=e.css("min-height"),l=n.find(".ui-content > .app-tabs"),o=kr&&n.find(kr.fixedTop.selector),s=o&&o.css("position")=="fixed"&&o.outerHeight(),h=kr&&n.find(kr.fixedBottom.selector),c=h&&h.css("position")=="fixed"&&h.outerHeight(),a=0;f?(i.resetActivePageHeight(),t=e.css("min-height")):n.css({"padding-top":r,"min-height":t});t=parseInt(t.substring(0,t.length-2));r=parseInt(r.substring(0,r.length-2));n.find(".app-wrapper").each(function(){var n=$(this),i=l.length?l.outerHeight(!0):0;i&&(t=t-i,r=r+i);s&&(t-=s,r+=s);c&&(t-=c,a+=c);n.css({top:r,bottom:a,"min-height":t});f&&n.css({height:t});sh(n)})}function ua(){return si?tt.width()>=720:tt.width()>=768&&tt.height()>=704}function fa(){function k(n){return n&&n.match(/Landscape|Always|Never/)}var n=__settings,a=n.mobileDisplayDensity,o=Sys.Browser,v,s,y,h=$("#PageHeader").parent(),l=(h.attr("class")||"").match(/\bpage-theme-(\w+)\b/i),p=$("div[data-content-framework]:first"),w=c("buttonShapes"),b=c("promoteActions"),e;r={mapApiIdentifier:n.mapApiIdentifier,pageTransition:c("pageTransition")||n.transitions||(ir?"fade":"slide"),sidebar:c("sidebar")||k(n.sidebar)||"Landscape",theme:l&&l[1]||c("theme")||n.theme,themeDisabled:l!=null,displayDensity:c("displayDensity")||(f()?n.desktopDisplayDensity:a=="Auto"?ua()?"Compact":"Comfortable":a),labelsInForm:c("labelsInForm")||n.labelsInForm,labelsInList:c("labelsInList")||n.labelsInList,buttonShapes:w!=null?w:n.buttonShapes||!0,promoteActions:b!=null?b:n.promoteActions||!0,initialListMode:c("initialListMode")||n.initialListMode||"SeeAll"};o.agent==o.InternetExplorer&&o.version<=9&&(u.hide(),n&&n.ui?(v=(new Date).getDate()+365,s=new Date,s.setDate(v),y=String.format("appfactorytouchui=false; expires={0}; path=/",s.toUTCString()),document.cookie=y,location.reload(i.path.parseUrl(location.href).hrefNoHash)):alert(t.TouchUINotSupported));et&&(u.addClass("app-ios"),hu<8&&u.addClass("app-ios7"));ir&&u.addClass("app-android");r.buttonShapes==!1&&u.addClass("app-buttons-text-only");h.is(".Tall")&&u.addClass("app-page-header-hidden");(h.is(".Wide")||p.length&&p.attr("data-sidebar")!="true")&&(r.sidebar="Never",r.sidebarDisabled=!0);$(document).trigger($.Event("appinit"));i.defaultPageTransition=r.pageTransition;se();r.displayDensity||(r.displayDensity=f()?"Compact":"Comfortable");u.addClass(eo(r.theme));u.addClass(oo(r.displayDensity));r.labelsInForm=="AlignedRight"&&u.addClass("app-labelsinform-alignedright");r.labelsInList=="DisplayedAbove"&&u.addClass("app-labelsinlist-displayedabove");f()&&(e=Sys.CultureInfo.CurrentCulture.dateTimeFormat,$.datepicker.setDefaults({prevText:"",nextText:"",monthNames:e.MonthNames,monthNamesShort:e.AbbreviatedMonthNames,dayNames:e.DayNames,dayNamesShort:e.AbbreviatedDayNames,dayNamesMin:e.ShortestDayNames,firstDay:e.FirstDayOfWeek,constrainInput:!1,showOtherMonths:!0,changeMonth:!0,changeYear:!0}),$.datepicker.parseDate=function(n,t){var i=$(this._lastInput).attr("data-format-string")||"{0:d}";return Date.tryParseFuzzyDate(t,i)},$.datepicker.formatDate=function(n,t){var r=$(this._lastInput),u=r.attr("data-format-string")||"{0:d}",i=Date.tryParseFuzzyDate(r.val(),u);return i&&(t.setHours(i.getHours()),t.setMinutes(i.getMinutes()),t.setSeconds(i.getSeconds())),String.localeFormat(u,t)})}function hh(n){var t;if(ee!=!1&&!a&&(t=n.find(".ui-collapsible:visible .ui-collapsible-heading:not(.ui-collapsible-heading-collapsed):first").parent().find(":input:first").first(),t.length)){var i=t.closest(".app-wrapper"),h=i.offset().top,r=i.scrollTop(),e=i.height(),u=t.offset().top+r-h,o=t.outerHeight(!0);function s(){f()&&(vt(),t.focus(),t[0].select&&t[0].select())}u<r||u+o>r+e?(a=!0,wi(i,u-(e-o)/2,function(){a=!1;s()})):s()}}function ae(n){return(n.metaKey||n.ctrlKey)&&n.shiftKey}function ch(n){var i=!1,t;return n.is("span")&&n.get(0).scrollWidth-n.innerWidth()>0&&(t=$('<div class="ui-content app-popup-message"/>').html(n.text()).popup({history:!1,arrow:"b,t",overlayTheme:"b",positionTo:"origin",afteropen:function(){},afterclose:function(){ai(t)}}).popup("open",{x:n.offset().left+n.outerWidth()/2,y:n.offset().top}).on("vclick",function(){return st(t),!1}),i=!0),i}function or(t){n.tabs("fit",{page:t})}function nu(n){$(n).find(".app-wrapper").each(function(){var n=$(this),t=n.data("scroll-top");t&&n.scrollTop()!=t&&n.scrollTop(t)});$(n).find(".app-echo-inner").each(function(){var n=$(this),t=n.data("scroll-left");n.parent().is(":visible")&&t&&n.scrollLeft()!=t&&n.scrollLeft(t)})}function ve(n){$(n).find(".app-wrapper").each(function(){var n=$(this);n.data("scroll-top",n.scrollTop())});$(n).find(".app-echo-inner").each(function(){var n=$(this);n.parent().is(":visible")&&n.data("scroll-left",n.scrollLeft())})}function ye(n){function e(n){while(n.css("display")=="none"&&n.length)n=n.next();return n}var o=n.scrollTop(),s=n.height(),h=o+s,t=e(n.find("*:first")),u=t.length==0?0:Math.ceil(t.position().top-(t.is("ul")&&t.find("li:first").length?parseInt(t.find("> li:first").css("margin-top").replace("px","")):0)),i=n.find("> *:last"),r=i.is("ul")&&i.find("li:first").length?i.find("> li:last"):i,c=r.position().top,f=Math.ceil(c+r.outerHeight()+parseInt(r.css("margin-top").replace("px",""))+(si?0:+parseInt(r.css("margin-bottom").replace("px","")))+parseInt(i.css("margin-bottom").replace("px",""))),l=-1*(u-f);return{top:u,height:h,maxHeight:l,firstTop:u,lastBottom:f}}function tu(n){var t=n.find(".ui-panel-inner"),i,r,u;if(t.length)t.on("scroll keydown keyup",function(){a||i||(i=!0,r=t.scrollTop(),ui=!0,u=setInterval(function(){var n=t.scrollTop();n!=r?r=n:(clearInterval(u),i=!1,ui=!1,t.data("scroll-stop-time",new Date))},200))})}function ea(n){wrapper=n.find(".ui-panel-inner").off("scroll keydown keyup")}function pe(n,t){function y(n){r.data("scroll-dir",n);$(document).trigger($.Event("scrolldir.app",{relatedTarget:r}))}var r=n.find(".app-wrapper:first"),s,h,e,u,c,l,v,o;if(!r.length){if(s=n.find(".ui-content"),h=s.contents(),r=$('<div class="app-wrapper"/>').appendTo(s),t!=!1)r.on("wheel DOMMouseWheel mousewheel",function(n){if(e&&"deltaY"in n.originalEvent){var i=r.data("scroll-dir"),t=n.originalEvent.deltaY>0?"down":"up";t!=i&&y(t)}}).on("touchstart",function(){et&&hu<8&&(o=!1,fi=!0)}).on("touchmove",function(){et&&(l=fr(),v=r.scrollTop())}).on("touchend",function(){if(et&&hu<8){var t=fr()-l,n=r.scrollTop(),i=Math.abs(v-n);t>0&&i/t>.25||n<0||n>r.height()?o=!0:fi=!1}}).on("scroll",function(){if(!a)if(e){var f=r.data("scroll-dir"),n=r.scrollTop(),t=n<u?"up":n==u?"none":"down";(t!=f||r.scrollTop()<i.getScreenHeight())&&y(t)}else e=!0,u=r.scrollTop(),$(document).trigger($.Event("scrollstart.app",{relatedTarget:r})),ui=!0,c=setInterval(function(){var n=r.scrollTop();n!=u?u=n:(clearInterval(c),e=!1,ui=!1,r.data("scroll-stop-time",new Date),$(document).trigger($.Event("scrollstop.app",{relatedTarget:r})),o&&(o=!1,fi=!1))},200)});f()&&r.attr("tabindex",0);$('<div class="app-page-header"><h2/><h1/><\/div>').appendTo(r);h.appendTo(r)}return r}function o(t){n.activeLink(t)}function we(n){o(n);setTimeout(function(){o()},200)}function e(n,t){n=$(n);n.is(".app-btn-more")?(n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");bu="link";t()},ku)):(o(n),setTimeout(function(){o();bu="link";n&&n.is(".app-btn")&&(bu="toolbar");t()},ku))}function lh(n,t){if(t||(t=n.find(".app-stub,.app-stub-main")),t.length){var i=Math.ceil(t.offset().top),r=Math.ceil(n.offset().top),u=n.height();i>r&&(i>r+u?t.height(""):t.height(u-(i-r)))}}function be(){ft();n.promo(!1);u.find("> *").hide()}function ke(){ti&&ti._updateLastActivity()}function de(){i.activePage.find(".dv-heading").removeClass("app-disabled")}function lf(){return ue||(ue=$("#app-sidebar")),ue}function ge(){return lf().is(":visible")}function no(n){gu&&(clearTimeout(gu),gu=null);n&&(nf=null)}function to(t){return du?!0:n.causesCalculate()?(du=setInterval(function(){n.causesCalculate()||(clearInterval(du),du=null,t())},100),!0):!1}function at(n,t){n&&(to(function(){at(n,t)})||(n.callback?n.callback(n.context,t):n.href&&(w.location.href=n.href)))}function iu(n){var t=i.activePage;t&&t.find(".dv-load-at-top").css("visibility",n?"hidden":"");a=n}function l(){var n=i.activePage;return n?n.attr("id"):"_"}function bt(){return l()=="advanced-search"}function ah(n){return n?n.toJSON().slice(0,10):null}function vh(n){return n?new Date(n.getTime()-n.getTimezoneOffset()*6e4).toJSON().slice(0,19):null}function oa(n){return n?yh(n+"T00:00:00"):null}function yh(n){var t=n?new Date(n.substring(0,4),parseInt(n.substring(5,7))-1,n.substring(8,10),n.substring(11,13),n.substring(14,16),0,0):null;return t!=null&&(t=new Date(t.getTime()-t.getTimezoneOffset()*6e4)),t}function kt(t){var f=16,e=r.displayDensity;e=="Compact"?f==14:e=="Condensed"&&(f=12);$(t||i.activePage.find(".app-listview")).each(function(){var e=$(this),p=e.parent(),k=e.closest(".ui-page"),it,st="w"+Math.ceil((tt.width()-(ge()?lf().outerWidth():0))/f/5)*5,i=vs[st],rt,ht,ct,lt,at,c="app-width",a=e.attr("data-yardstick-class"),o=u.find("#app-yardstick"),d=e.is(".app-grid"),w=p.is(".app-echo-inner"),vt=w||p.is(".app-map-info"),g,ut;if((!i&&!vt||w&&d)&&(o.length||(o=$('<ul id="app-yardstick" class="app-listview"><li class="dv-item"><a><span>1<\/span><\/a><\/li><li><a class="dv-item">2<\/a><\/li><li><a class="dv-item">3<\/a><\/li><\/ul>').appendTo(u).listview()),w&&d&&(p=p.closest(".app-wrapper")),o.appendTo(p).show(),rt=o.find("li:first"),it=k.css("display"),it!="block"&&k.css("display","block"),ct=rt.outerWidth(),o.addClass("app-cardview"),ht=rt.outerWidth(),o.removeClass("app-cardview"),o.addClass("app-grid"),lt=firstSpanPadding=o.find("span:first"),at=parseInt(lt.css("margin-left").replace("px","")),o.removeClass("app-grid"),it!="block"&&k.css("display",""),o.appendTo(u).hide(),i={card:Math.ceil(ht/f/5)*5,list:Math.ceil(ct/f/5)*5,columnPadding:at,grid:{}},vs[st]=i),c+=!d&&vt?Math.ceil(e.width()/f/5)*5:e.is(".app-cardview")?i.card:i.list,c!=a&&(a&&e.removeClass(a),e.addClass("app-yardstick "+c).attr("data-yardstick-class",c)),d&&(g=n.pageInfo(w?e.closest(".app-echo").attr("data-for"):k.attr("id")),ut=g.id+"_"+g.dataView._viewId,!i.grid[ut])){i.grid[ut]=!0;var b=g.dataView,dt=b._fields,gt=b._allFields,s=[],r,v,yt=3,h=0,y=i.list*f,ft=4*f+i.columnPadding,t,nt=new Sys.StringBuilder;$(dt).each(function(){var t=this,n=gt[this.AliasIndex];t.Hidden||t.OnDemand||(r=n.Columns,n.ItemsStyle=="CheckBoxList"?r=80:r>80?r=80:r||(n.Type=="String"?(r=30,n.Len>0&&n.Len<r&&(r=n.Len)):r=15),h+=r,v=0,t.tagged("item-aside")?v=1:t.tagged("item-count")?v=2:(t.tagged("item-para")&&yt++,v=t.tagged("item-desc")?yt:100),s.push({className:String.format("gc_{0}_{1}_{2}",b._id,b._viewId,n.Name),cols:r,priority:v,type:n.Type}))});var l=s[0],et=l.cols,pt,wt,ot=!0,bt=0,ni=b._hasKey();s.reverse();l.priority=0;function kt(){h-=l.cols-et;l.cols=et;l.cols/h*y<ft&&(l.cols=Math.floor(ft/y*h),h+=l.cols-et)}kt();function ti(){$(s).each(function(n){var r,i;if(t=this,!t.hidden&&(t.width=t.cols/h*y,t.width<ft)){for(r=0;r<n&&t.priority>1||r<s.length&&t.priority<2;)if(i=s[r++],t!=i&&!i.hidden&&i.priority>=t.priority&&i.priority>1)return i.hidden=!0,ot=!0,h-=i.cols,!1;t.priority>1&&(t.hidden=!0,h-=t.cols)}})}while(ot)ot=!1,ti();$(s).each(function(){this.hidden||bt++});bt<2&&s.length>0&&(kt(),$(s.reverse()).each(function(){return t=this,t.hidden?(t.hidden=!1,h+=t.cols,!1):void 0}));pt=h;y-=w?32:16;$(s).each(function(){t=this;t.hidden?nt.appendFormat(".app-grid.app-width{0} .{1}, .app-grid-header.app-width{0} .{1} {{display:none!important;}}",i.list,t.className):nt.appendFormat(".app-grid.app-width{0} .{1}, .app-grid-header.app-width{0} .{1} {{width:{2}%;}}",i.list,t.className,(t.cols/pt-i.columnPadding/y-(t==l&&ni?22/y:0))*100);nt.appendLine()});wt=nt.toString();$("<style>").appendTo($("head")).text(wt)}e.find("li.app-yardstick").each(function(){var n=$(this);c="app-width"+i.list;a=n.attr("data-yardstick-class");c!=a&&(a&&n.removeClass(a),n.addClass(c).attr("data-yardstick-class",c))})})}function sa(){var r=n.pageInfo(),t,i;r&&(t=r.dataView,i=t&&t.extension(),i&&t.get_isGrid()&&(fe=!0,i.executeInContext("Eye",null,!1)))}function pi(n,t){return t&&n.addClass("app-width"+t),n}function it(t){var i=n._menuButton;if(arguments.length==0)return i.is("."+gi);i&&n.toolbar().is(":visible")&&(t=="off"?i.removeClass(gi):t?i.addClass(gi):setTimeout(function(){i.removeClass(gi)},500))}function li(){it(!0);tt.one("beforeunload pagehide",function(){it(!1)})}function ph(){}function wh(){var i=n._menuButton,r,u;i&&n.toolbar().is(":visible")&&(r=n.toolbar(),u=l(),u=="Main"||n._pages.length&&u==n._pages[0].id&&n._pages[0].home?(i.removeClass("ui-icon-back ui-icon-bars "+gi).addClass("ui-icon-bars").attr({href:"#app-btn-menu",title:t.Menu}),r.removeClass("app-has-history")):(i.removeClass("ui-icon-bars "+gi).addClass("ui-icon-back").attr({href:"#app-back",title:t.Back}),r.addClass("app-has-history")))}function bh(n){n.length&&(as[l()+"_"+n.attr("id")]=n.find(".ui-panel-inner").scrollTop())}function ha(n){n.length&&n.find(".ui-panel-inner").scrollTop(as[l()+"_"+n.attr("id")]||0)}function io(n,t){var u=n._fields,e=n._allFields,r=!0,i;t.is(":empty")||t.wrapInner('<span class="app-grid-desc"/>');i=$('<div class="app-grid-header"/>').appendTo(t);$(u).each(function(){var l=this,t=e[l.AliasIndex],u,s,o,a,y,h,v,c;l.Hidden||l.OnDemand||(u=$("<span><\/span>").addClass(String.format("gc_{0}_{1}_{2}",n._id,n._viewId,t.Name)).text(t.HeaderText).attr("title",t.HeaderText).attr("data-field-name",t.Name).appendTo(i),s=ni(n,t.Name),o=n.get_fieldFilter(t,!0),s?(h=$('<span class="app-icon app-indicator"><\/span>').appendTo(u).attr("title",bi(t,s)),s.toLowerCase()=="asc"?u.addClass(o?"app-filter-asc":"app-sort-asc"):u.addClass(o?"app-filter-desc":"app-sort-desc")):o&&(h=$('<span class="app-icon app-indicator"><\/span>').appendTo(u),u.addClass("app-filter-on")),o&&($(n._filter).each(function(){var n=this;if(n.startsWith(t.Name+":"))return a=n,!1}),a&&f()&&(y=n._filter,n._filter=[a],v=h.attr("title"),c=n.extension().filterStatus(!0),v&&c.match(/\.\s*$/)&&(c+=" "+v+"."),h.attr("title",c),n._filter=y)),r&&(r=!1,he(n,i)))})}function af(n,t,i,r,u){var e=n._fields,o=n._allFields,f;$(e).each(function(e){var l=this,h=o[l.AliasIndex],a=h.itemColumnClass||String.format("gc_{0}_{1}_{2}",n._id,n._viewId,h.Name),c=$("<span><\/span>").appendTo(r).addClass(a+" app-field app-field-"+h.Name),s;l.Hidden||l.OnDemand||(h.itemColumnClass||(h.itemColumnClass=a),s=t[h.Index],s=h.text(s,!1),e==0&&(i!=null&&(s=String.format("{0}. {1}",i,s)),he(n,r)),u?(f=u?u[e]:null,f&&(s=t[l.Index],s=String.localeFormat(l.DataFormatString||"{0:n0}",s),c.text(s),$('<div class="app-static-text"><\/div>').text(f).insertBefore(c.contents()),c.attr("title",h.HeaderText+"\n"+f+" "+s))):(h.HtmlEncode?c.text(s):c.html(s),c.attr("title",s)))})}function sr(n,t,i,r,u,f){var s=n._allFields,p=f.is("a"),a=$("<h3>").appendTo(f),y=s[i.heading],e,o,h,c,l,v;if(i.thumb!=null)if(e=t[i.thumb],e&&e.toString().match(/^null/))u.addClass("ui-li-has-thumb");else var w=n.resolveClientUrl(n.get_appRootPath()),b=s[i.thumb],k=$('<img class="ui-li-thumb"/>').appendTo(f).attr({src:String.format("{0}blob.ashx?{1}=t|{2}",w,b.OnDemandHandler,e)});e=t[i.heading];e=y.text(e);p&&f.attr("title",e);y.HtmlEncode?a.text(e):a.html(e);a.addClass("app-field app-field-"+y.Name);r&&$('<span class="app-item-number"/>').insertBefore(a.contents()).text(r+". ");i.aside!=null&&(u.addClass("app-li-has-aside"),o=pi($('<p class="ui-li-aside"/>').appendTo(f),i.asideRwd),h=s[i.aside],e=t[i.aside],e=h.text(e),h.HtmlEncode?o.text(e):o.html(e),o.addClass("app-field app-field-"+h.Name),i.asideLabel&&pi($('<span class="app-item-label"/>').insertBefore(o.contents()).text(h.HeaderText),i.asideLabelRwd));i.count!=null&&(o==null||i.desc.length)&&(c=pi($('<span class="ui-li-count"/>').appendTo(f),i.countRwd),l=s[i.count],e=t[i.count],e=l.text(e),l.HtmlEncode?c.text(e):c.html(e),c.addClass("app-field app-field-"+l.Name),i.countLabel&&pi($('<span class="app-item-label"/>').insertBefore(c.contents()).text(l.HeaderText),i.countLabelRwd));i.desc.length&&(v=$('<p class="app-para"/>').appendTo(f),$(i.desc).each(function(n){var o=this,r=s[o],a=i.descLabels[n],c=i.descLabelsRwd[n],y=i.descPara[n],h,l=r.HeaderText,u;y&&(v=$('<p class="app-para"/>').appendTo(f).insertAfter(v));e=t[o];u=pi($('<span class="app-item-desc"/>').appendTo(v),i.descRwd[n]).addClass("app-field app-field-"+r.Name);e=r.text(t[o]);r.HtmlEncode&&r.TextMode!=3?u.text(e):u.html(e);h=u.contents();a&&(pi($('<span class="app-item-label-before"/>').insertBefore(h.first()).text(l),c),pi($('<span class="app-item-label-after"/>').insertAfter(h.last()).text(l),c))}));p&&he(n,f)}function ro(n,t,i){var h=".app-listview li a.app-selected:first,.app-wrapper .app-map",u=n._lookupInfo?n._id:n._parentDataViewId||n._id,r=$("#"+u).find(h),f,e=$app.find(u),s,o,c;return r.length||(r=$("#"+n._id+"_echo .app-echo-inner .app-selected"),u=n._id,e=n),r.length||(u=n._filterSource,r=$("#"+u).find(h),e=$app.find(u)),r.length&&(f=$('<li class="app-li-card">'),t&&f.appendTo(t),r.is(".app-selected")?(s=r.data("data-context"),s&&(o=s.row)):(c=r.data("data-map"),c&&(o=e.extension().commandRow())),o&&(sr(e,o,e.extension().itemMap(),null,f,f),i!=!1&&(contextDataView=$app.find(u),$('<span class="app-li-corner">').appendTo(f.addClass("app-li-has-corner")).text(contextDataView.get_view().Label)),r.parent().is(".app-li-has-aside")&&f.addClass("app-li-has-aside"))),f}function ut(t,r){var f,u,e,s,h,o,c="";if(r)u=r.closest(".ui-page");else{if(u=i.activePage,!u)return;r=u.find(".app-page-header")}if(s=r.find("h1"),h=r.find("h2"),e=u.attr("data-page-header")!="false",typeof t=="boolean")t&&e?r.show():(r.hide(),u.attr("data-page-header","false"));else return f=r.data("data-text"),t?(f&&typeof f!="string"&&typeof t=="string"&&(f[1]=t,t=f),r.data("data-text",t)):t=f,t&&(typeof t=="string"?o=t:(o=t[0],c=t[1])),r.attr("data-locked")!="true"&&(s.text(o),h.text(c)),t!=n.title()&&e?r.show():(r.hide(),e&&u.attr("data-page-header","false")),t}function uo(n){d();var t=Math.ceil(tt.width()*.9);t>800&&(t=800);n.css({maxWidth:t})}function ru(t,i){i==null&&(i=ei);ei=null;var r=t.extension();r.useAdvancedSearch()?hr(t,i,i&&"none"):n.search("configure",{text:i||r.quickFind(),placeholder:ra(t),focus:!0,scope:t._id,setCursor:!!i})}function kh(n){var t=$app.find($("#advanced-search").attr("data-scope"));bt()?(t.extension().useAdvancedSearch(!1),e(n,function(){u.one("pagecontainershow",function(){setTimeout(function(){ru(t)},200)});ci=null;history.go(-1)})):ru(t)}function hr(e,o,s){function ft(n,t,i,r){var f=i.SearchOptions,u=t.FilterType;return{field:t.Name,originalField:i.Name,id:n._id,mappedId:n._mappedId,filterField:n._mappedId&&n._filterFields[0],headerText:t.HeaderText,scopeText:n._mappedId&&n.get_view().Label,filterType:u,operation:f&&$app.filterDef(y.Filters[u].List,f[0])&&f[0]||(u=="Boolean"?"$true":u=="Text"?"$contains":"="),value:null,value2:null,values:[],required:r==!0}}function et(n,t,i){var r=a(),u=r._fields,f=r._allFields;$(u).each(function(){var u=this,o=f[u.AliasIndex],e=u.Search,s=e==1&&n=="Required",h=e==2&&n==="Suggested",c=e==4,l=!n&&t.length<3||s||h;o.AllowQBE&&l&&!c&&t.push(ft(r,o,u,s&&i==!0))})}function k(n,t){var l=t.find(".app-condition-list-field").text(n.headerText),i=n.operation,h=y.Filters[n.filterType],f=h.Kind.toLowerCase(),a=$app.filterDef(h.List,i),c=!i.match(fs),v=c&&i=="$between",o=t.find(".app-condition-list-operation"),r=t.find(".app-input-container:first"),p=r.find(".app-input-value"),w=r.find(".app-input-text"),s=r.next(),u=s.next(),b=u.find(".app-input-value"),k=u.find(".app-input-text"),e=t.find(".app-condition-list-values");n.scopeText&&$("<span/>").appendTo(l).text(n.scopeText);o.text(a.Text);i.match(/month/)?o.addClass("app-condition-list-operation-month"):o.removeClass("app-condition-list-operation-month");p.text(f);w.attr("placeholder",f);b.text(f);k.attr("placeholder",f);c?r.show():r.hide();v?(s.show(),u.show()):(s.hide(),u.hide());r.find(":input").val(n.value);u.find(":input").val(n.value2);i=="$in"||i=="$notin"?(e.show(),e.text(n.lovText||yl.SelectLink),e.addClass("app-has-children")):e.hide();t.data("condition",n)}function wt(n,i){var r=$('<li class="app-condition ui-body-a"><\/li>').appendTo(i),f,u;return f=$('<a class="app-condition-list-field app-btn-select ui-btn ui-corner-all ui-btn-inline"/>').appendTo(r),(!n.required||r.closest(".app-conditions").prev().length)&&f.addClass("app-has-children"),$('<a class="app-condition-list-operation app-btn-select ui-btn app-has-children ui-corner-all ui-btn-inline"/>').appendTo(r),u=$('<div class="app-input-container ui-first-child"><\/div>').appendTo(r),$('<input type="text" class="app-input-text"/>').appendTo(u),$('<span class="app-input-value"/>').appendTo(u).css("visibility","hidden"),$('<span class="app-condition-and"/>').appendTo(r).text(y.Filters.Labels.And),u=$('<div class="app-input-container ui-last-child"><\/div>').appendTo(r),$('<input type="text" class="app-input-text"/>').appendTo(u),$('<span class="app-input-value"/>').appendTo(u).css("visibility","hidden"),$('<a class="app-condition-list-values app-btn-select ui-btn ui-corner-all ui-btn-inline"/>').appendTo(r),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(r).attr("title",t.More),k(n,r),r}function ot(n,i){var r=$('<ul class="app-condition-list ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(h)).data("group",i),f=$('<li class="app-matching ui-body-a"><\/li>').appendTo(r),u;return $('<a class="app-condition-list-scope app-btn-select ui-btn app-has-children ui-corner-all ui-btn-inline"/>').appendTo(f).text(t[i.scope]),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(f).attr("title",t.More),$(i.conditions).each(function(){wt(this,r)}),u=$('<li class="app-condition app-condition-more ui-body-a"><\/li>').appendTo(r),$('<a class="app-condition-list-field app-btn-select ui-btn ui-corner-all ui-btn-inline app-has-children"/>').appendTo(u).text(pt.AddConditionText),b(i).length||!c()&&st().length||u.hide(),r.parent()}function kt(n,t,i){var r=r={scope:"MatchAll",required:!1},u=[],f=[];et("Required",u,i);et("Suggested",f);u.length?r.conditions=u.concat(f):f.length?r.conditions=f:(et(null,u),r.conditions=u,t&&(n.push(r),r=JSON.parse(JSON.stringify(r)),r.scope="MatchAny"));n.push(r)}function b(n,t){function f(n,t){$(n._fields).each(function(){var i=this,u=n._allFields[i.AliasIndex],f=i.Search,e=f==4;!u.AllowQBE||e||r.indexOf(u.Name+"."+n._mappedId)!=-1||n._mappedId&&i.Name==n._filterFields[0]||t.push(i)})}var u=c(),i=[],r=[],e;if($(n.conditions).each(function(){r.push(this.field+"."+this.mappedId)}),includeIndex=r.indexOf(t),includeIndex>=0&&r.splice(includeIndex,1),f(a(),i),u){i._hasChildren=!0;for(e in u)f(u[e],i)}return i}function dt(n,t,i,r){var u;$(n).each(function(){var o=this,f=o._dataView,e=f._mappedId,s;field=f._allFields[o.AliasIndex];n._hasChildren&&(u?e&&u!=e&&(t.push({text:f.get_view().Label}),u=e):(t.push({text:f.get_view().Label}),u=f._id||e));s=i==field.Name+"."+e;t.push({text:field.HeaderText,icon:s?"check":!1,visible:s,context:{field:field.Name,originalField:o.Name,id:f._id,mappedId:e},callback:r})})}function gt(n,t,i){function e(t,u){for(var s=0;s<t.length;s++){var o=t[s],h=o&&o.Function,c=h==n.operation;o?o.List?e(o.List,u):f&&r.indexOf(h)==-1||u.push({text:o.Text,icon:c?"check":!1,visible:c,context:h,callback:i}):f||u.push({})}}var u=nt(n),o=u.findField(n.field),s=u.findField(n.originalField),r=s.SearchOptions,f=r&&r.length;e(y.Filters[o.FilterType].List,t)}function d(n,t){var i=st(),r=[];(oe().length||n==!0)&&($(i).each(function(){var n=$app.find(this.id);r.push({Controller:n._controller,View:n._viewId,RequiresMetaData:!0,DoesNotRequireData:!0})}),$app._invoke("GetPageList",{requests:r},function(r){if(n==!0||n()){var f={};$(r).each(function(n){var r=this,e=i[n],o=e.id,t=new Web.DataView($("<div><\/div>").appendTo(u));t._render=function(){};r.Expressions=[];t._servicePath=a()._servicePath;t._controller=r.Controller;t._viewId=r.View;t._onGetPageComplete(r);t._filterFields=e.filterFields;t._mappedId=o;f[o]=t});c(f);t()}}))}function ni(n,t){var i=n.find(".ui-listview"),r=f(),u;r&&i.hide();items=[];t(items);ki(i);wo(i,items,{});i.listview("refresh");r&&i.show();u=n.data("position-options");n.popup("reposition",n.data("position-options"))}function hi(n,t,i){var r=[],u;t.mappedId&&!c()?r.push({text:rt.Loading,icon:"refresh",animate:!0,context:{},keepOpen:!0,callback:function(){}}):gt(t,r,i);p({anchor:n,items:r,afterclose:function(){u=!0;lt()},afteropen:function(){var n=this;d(function(){return u!=!0},function(){ni(n,function(n){gt(t,n,i)})})}})}function ti(n,t,i,r){var s=a(),e=st(),o=b(t,i),u=[],f;dt(o,u,i,r);e.length&&!c()&&u.push({text:rt.Loading,icon:"refresh",animate:!0,context:{},keepOpen:!0,callback:function(){}});p({anchor:n,items:u,afterclose:function(){f=!0;lt()},afteropen:function(){var n=this;d(function(){return f!=!0},function(){ni(n,function(n){dt(b(t,i),n,i,r)})})}})}function a(){return $app.find(l.attr("data-scope"))}function c(n){if(arguments.length==0)return l.data("detail-map");l.data("detail-map",n)}function st(t){t||(t=a());var i=[];return $(n._pages).each(function(){var r=this,n=r.dataView;n&&n._filterSource==t._id&&i.push({id:n._id,filterFields:n._filterFields.split(/,/)})}),i}function ii(t){var i=l.find(".app-wrapper"),r=t.closest(".app-conditions"),u=r.offset();wi(i,i.scrollTop()+u.top-(i.height()-r.outerHeight())/2,function(){n.blink(t.find(".app-matching .app-btn-select"),function(){f()&&t.find("input:visible").first().focus()})})}function ht(t){n.blink(t,function(){f()&&t.parent().find(":input:visible").first().focus()})}function li(){$app.confirm(t.ResetSearchConfirm,function(){var n=a();n.viewProp("advancedSearchConfig",null);hr(n,null,"no")})}function ri(n,i){if(i&&i.length){var u=i.slice().reverse(),r=!0;$(u).each(function(){var i=this,f,u;n&&i.count<5||!n&&i.count>=5||(r&&(r=!1,$('<div class="app-clear-fix"><\/div>').appendTo(h),$('<div class="app-header"><\/div>').appendTo(h).text(n?t.Favorites:t.Recent)),f=$('<ul class="app-condition-list app-condition-list-history ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(h)),u=$('<li class="app-condition app-condition-history ui-body-a"><\/li>').appendTo(f),$("<div/>").appendTo(u).text(i.date),$("<div/>").appendTo(u).text(i.text),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(u).attr("title",t.More))})}}function g(n){if(!n)return h.find(".app-clear-fix").nextAll().andSelf().detach();n.appendTo(h)}function ui(n,t){var i=-1;return $(n).each(function(n){if(this.text==t)return i=n,!1}),i}function fi(n,t,r){var f=n[ui(n,t)],u=a();u.viewProp("advancedSearchConfig",f.config);wi(i.activePage.find(".app-wrapper"),0,function(){hr(u,null,r)})}function nt(n){return $app.find(n.id)||c()[n.mappedId]}function ai(){var t,n;r.pageTransition!="none"&&o&&s!="none"&&(t=i.navigate.history.stack,t[t.length-1].transition="slidedown");n=h.find("input:visible").first();n.length&&(o&&!n.val().length&&(n.val(o),n.closest(".app-condition").data("condition").value=o),f()&&(ce(n,n.val().length),n.focus()))}var vi=e.get_filter(),yi=e.extension(),w=n.content("advanced-search"),l=w.closest(".ui-page"),it=w.find(".app-page-header"),at=e.get_view().Label,vt=t.AdvancedSearch,h=w.find(".app-panel-filter"),yt=e.viewProp("advancedSearchRecent"),v,tt,ei,ct,oi,si;if(gc(),n._contextButton.show().removeClass("ui-icon-dots").addClass("ui-icon-carat-d").attr("title",pt.HideAdvancedSearch),l.attr("data-scope")!=e._id||l.attr("data-view")!=e._viewId){if(l.attr("data-scope",e._id),l.attr("data-view",e._viewId),tt=c(),tt)for(ei in tt)ct=tt[ei],ct._element.remove(),ct.dispose();c(null);l.find(".app-wrapper").data("scroll-top",null)}it.attr("data-locked","false");ut(at==n.title()?[vt,""]:[at,vt],it);it.attr("data-locked","true");l.addClass("app-page-search app-page-scrollable");u.one("pagecontainershow",function(){ci=function(){e._totalRowCount==-1&&e.sync()}});if(!h.length){h=$('<div class="app-panel-filter"><\/div>').appendTo($("<div><\/div>").appendTo(w)).on("vclick",function(i){var r=$(i.target).closest(".ui-btn"),u=h.data("config");r.length&&n.callWithFeedback(r,function(){var s,i,f,n;if(r.is(".app-btn-more"))if(r.parent().is(".app-matching"))p({anchor:r,iconPos:"left",tolerance:2,items:[{text:vr.Scopes.Grid.Delete.HeaderText,icon:"trash",callback:function(){var n=r.closest(".app-condition-list"),i=n.data("group"),t=!0;$(n).find(".app-condition").each(function(){var n=$(this),i=n.data("condition");if(i&&i.required)return t=!1,p({anchor:n.find(".app-condition-list-field"),title:yr.RequiredField}),!1});t&&(u.splice(u.indexOf(i),1),n.find(".app-condition").data("condition",null),n.data("group",null).parent().remove())}},{text:vr.Scopes.Grid.Duplicate.HeaderText,icon:"duplicate",callback:function(){var n=r.closest(".app-condition-list").data("group"),t,i=g();n=JSON.parse(JSON.stringify(n));u.push(n);t=ot(a(),n);h.find(".app-matching-more").closest(".app-conditions").appendTo(h);g(i);ii(t)}}],afterclose:lt});else if(r.parent().is(".app-condition-history")){var tt=a(),w=r.parent().find("div:last").text(),o=tt.viewProp("advancedSearchRecent");r.parent().addClass("app-selected");p({anchor:r,iconPos:"left",tolerance:2,items:[{text:pt.PerformAdvancedSearch,icon:"search",callback:function(){fi(o,w,"search")}},{text:vr.Scopes.Grid.Edit.HeaderText,icon:"edit",callback:function(){fi(o,w,"no")}},{},{text:vr.Scopes.Grid.Delete.HeaderText,icon:"trash",callback:function(){o.splice(ui(o,w),1);tt.viewProp("advancedSearchRecent",o);var n=r.closest(".app-conditions");n.prev().is(".app-header")&&!n.next().is(".app-conditions")&&(n.prev().remove(),n.prev().remove());n.remove()}}],afterclose:function(){r.parent().removeClass("app-selected");lt()}})}else r.parent().is(".app-condition")&&p({anchor:r,iconPos:"left",tolerance:2,items:[{text:vr.Scopes.Grid.Delete.HeaderText,icon:"trash",callback:function(){var n=r.closest(".app-condition-list"),t=n.data("group"),i=r.parent(),f=i.data("condition");f.required&&!r.closest(".app-conditions").prev().length?p({anchor:i.find(".app-condition-list-field"),title:yr.RequiredField}):(t.conditions.splice(t.conditions.indexOf(f),1),i.data("condition",null).remove(),n.find(".app-condition").length<=1?(u.splice(u.indexOf(t),1),n.data("group",null).parent().remove()):b(t).length&&n.find(".app-condition-more").show())}}],afterclose:lt});else if(r.is(".app-btn-select"))if(r.is(".app-condition-list-scope")){i=r.closest(".app-condition-list").data("group");function l(n){i.scope=n;r.text(t[n])}p({anchor:r,iconPos:"left",items:[{text:t.MatchAll,context:"MatchAll",icon:i.scope=="MatchAll"?"check":!1,callback:l},{text:t.MatchAny,context:"MatchAny",icon:i.scope=="MatchAny"?"check":!1,callback:l},{text:t.DoNotMatchAll,context:"DoNotMatchAll",icon:i.scope=="DoNotMatchAll"?"check":!1,callback:l},{text:t.DoNotMatchAny,context:"DoNotMatchAny",icon:i.scope=="DoNotMatchAny"?"check":!1,callback:l}],afterclose:lt})}else if(r.parent().is(".app-matching-more")){function v(n){kt(u,!1,u.length==0);var t=u[u.length-1],i,f=g();t.scope=n;i=ot(a(),t);r.closest(".app-conditions").appendTo(h);g(f);ii(i)}p({anchor:r,items:[{text:t.MatchAll,context:"MatchAll",callback:v},{text:t.MatchAny,context:"MatchAny",callback:v},{text:t.DoNotMatchAll,context:"DoNotMatchAll",callback:v},{text:t.DoNotMatchAny,context:"DoNotMatchAny",callback:v}],afterclose:lt})}else if(r.parent().is(".app-condition-more"))s=r.closest(".app-condition-list"),i=s.data("group"),ti(r,i,null,function(n){var t=nt(n),u=ft(t,t.findField(n.field),t.findField(n.originalField)),f;i.conditions.push(u);f=wt(u,s);r.parent().appendTo(s);b(i).length?r.parent().show():r.parent().hide();ht(f.find(".app-condition-list-field"))});else if(r.is(".app-condition-list-field")){var s=r.closest(".app-condition-list"),i=s.data("group"),f=r.parent(),e=f.data("condition");e.required&&!r.closest(".app-conditions").prev().length?p({anchor:f.find(".app-condition-list-field"),title:yr.RequiredField}):ti(r,i,e.field+"."+e.mappedId,function(n){var u=nt(n),t=ft(u,u.findField(n.field),u.findField(n.originalField));t.value=e.value;t.value2=e.value2;$app.filterDef(y.Filters[t.filterType].List,e.operation)&&(t.operation=e.operation);i.conditions[i.conditions.indexOf(e)]=t;k(t,f);ht(r)})}else if(r.is(".app-condition-list-operation"))f=r.parent(),n=f.data("condition"),hi(r,n,function(t){n.operation=t;k(n,f);ht(r)});else if(r.is(".app-condition-list-values")){f=r.parent();n=f.data("condition");function it(){var t=nt(n),i=n.field;fv(r,t,i,n.lov,function(r){var s=r.match(/^\w+\:((\$\w+)\$|=)(.+)$/),e=t.findField(i),u=n.operation,h,o,c=[];s?(h=n.lov=s[3],o=s[1],o=="="?u="=":u=="$in"?o=="$in$"||(u="$notin"):o=="$in$"||(u="$in"),n.operation=u,u=="="?(n.value=e.text(t.convertStringToFieldValue(e,h)),n.lovText=null,n.lov=null):($(h.split(/\$or\$/g)).each(function(){var n=t.convertStringToFieldValue(e,this);c.push(e.text(n))}),n.lovText=c.join(", "))):(n.lov=null,n.lovText=null);k(n,f);lt()},lt)}n.mappedId&&!c()?d(!0,it):it()}})});h.on("change",function(n){var t=$(n.target),i,r;t.is(".app-input-text")&&(i=t.closest(".app-condition").data("condition"),r=t.val(),t.parent().is(".ui-first-child")?i.value=r:i.value2=r)}).on("vclick",function(n){var t=$(n.target);if(t.is(".app-condition"))return t.find(":input:visible").first().focus(),!1});$('<div class="app-promo-filler"><\/div>').appendTo(w);$(document).on("sidebar.app",function(n){if(bt()){var i=n.context;i.splice(0,n.context.length);i.push({text:t.AdvancedSearchInstruction,isStatic:!0,wrap:!0});i.push({});i.push({text:pt.ResetAdvancedSearch,icon:"refresh",callback:li})}}).on("search.app",function(t,i){function f(){var n,d=c(),t=a(),g={MatchAll:"_match_:$all$",MatchAny:"_match_:$any$",DoNotMatchAll:"_donotmatch_:$all$",DoNotMatchAny:"_donotmatch_:$any$"},e={positive:[],negative:[]},l,o,s,v,f,y=[],w=[],b={},k=0,u;$(r).each(function(t){var i=this,r,u;$(i.conditions).each(function(f){function nt(n,i,r){return{gIndex:t,cIndex:f,text:n,focus:i,focus2:r}}var o=this,s=o.operation,rt=!s.match(fs),ut=o.value,tt,ft=o.value2,it,v=$app.find(o.id)||o.mappedId&&d[o.mappedId],y=v.findField(o.field),p=y.Name,h,l,a="",et;if(rt?(String.isBlank(ut)?o.required&&(n=nt(yr.RequiredField,!0)):(tt={NewValue:ut.trim()},l=v._validateFieldValueFormat(y,tt),l?n=nt(l,!0):a=v.convertFieldValueToString(y,tt.NewValue)),n||s=="$between"&&(String.isBlank(ft)?o.required&&(n=nt(yr.RequiredField,!1,!0)):(it={NewValue:ft.trim()},l=v._validateFieldValueFormat(y,it),l&&(n=nt(l,!1,!0))),!n&&tt.NewValue>=it.NewValue&&(n=nt(ft+" "+pl.LessThanOrEqual+" "+ut,!1,!0)),n||(a+="$and$"+v.convertFieldValueToString(y,it.NewValue)))):(s=="$in"||s=="$notin")&&(a=o.lov,rt=!0),n)return!1;if(!rt||a){if(o.mappedId&&(h=c()[o.mappedId],h==null))return;r||(r=!0,u=i.scope.startsWith("DoesNot")?e.negative:e.positive,u.push(g[i.scope]),k++);s.match(/\$/)&&(s+="$");o.mappedId&&(et=new Sys.StringBuilder,h._fieldNameHint={},h._fieldNameHint[p]=o.headerText+" ("+o.scopeText.toUpperCase()+")",h._renderFilterDetails(et,[p+":"+s+a],!1),p+=","+h._controller+"."+(h._viewId||"grid1")+"."+o.filterField,b[p.replace(/\W/g,"_")+(k-1)]=et.toString());u.push(p+":"+s+a)}else w.push(o)});r||y.push(i)});n?(l=h.find(".app-condition-list").get(n.gIndex),o=$($(l).find(".app-condition").get(n.cIndex)),s=n.focus?o.find(".ui-first-child .app-input-text"):n.focus2?o.find(".ui-last-child .app-input-text"):o.find(".app-condition-list-field"),p({anchor:s,title:n.text,xOffset:8,yOffset:"bottom",afterclose:function(){s.is(":input")&&s.focus();lt()}})):(t.viewProp("advancedSearchFilter",e.positive.concat(e.negative)),$(r).each(function(){var n=this;$(w).each(function(){var t=n.conditions.indexOf(this);t>=0&&n.conditions.splice(t,1)})}),$(y).each(function(){var n=r.indexOf(this);n>=0&&r.splice(n,1)}),t.viewProp("advancedSearchConfig",r.length==0?null:r),t.viewProp("deepSearchInfo",b),r.length&&(v=t._filter,t._filter=[],f=t.extension().filterStatus(),t._filter=v,u=t.viewProp("advancedSearchRecent")||[],$(u).each(function(n){var t=this;if(t.text==f)return t.date=nh(),t.count++,u.splice(n,1),u.push(t),f=null,!1}),f&&(u.push({text:f,date:nh(),count:1,config:r}),u.length>30&&u.splice(30,1)),t.viewProp("advancedSearchRecent",u)),i())}n.promo(!1);var r=[],u;h.find(".app-condition-list").each(function(){var n=$(this).data("group");n&&(r.push(n),$(n.conditions).each(function(){this.mappedId&&(u=!0)}))});u&&!c()?d(!0,f):f()})}if(v=e.viewProp("advancedSearchConfig"),v||(v=[],kt(v,!0,!0)),h.data("condition",null),h.find(".app-condition").data("condition",null),h.data("config",v).find(".app-condition-list").data("group",null).parent().remove(),h.find(".app-header,.app-clear-fix").remove(),$(v).each(function(){ot(e,this)}),oi=$('<ul class="app-condition-list app-condition-list-more ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(h)),si=$('<li class="app-matching app-matching-more ui-body-a"><\/li>').appendTo(oi),$('<a class="app-condition-list-field app-btn-select app-has-children ui-btn ui-corner-all ui-btn-inline"/>').appendTo(si).text(t.AddMatchingGroup),ri(!0,yt),ri(!1,yt),$('<div class="app-clear-fix"><\/div>').appendTo(h),s=="no"){n.blink(h.find(".app-condition-list-scope"));return}if(s=="search"){n.blink(h.find(".app-condition-list-scope"),function(){setTimeout(function(){uu(!0)},500)});return}u.one("pagecontainershow",function(){setTimeout(ai,200)});le(l);i.changePage("#advanced-search",{changeHash:!0,transition:r.pageTransition=="none"?"none":s||"slidedown"})}function uu(t){t?e(n.promo(),function(){uu()}):$(document).trigger("search.app",function(){var t=$("#advanced-search"),r=$app.find(t.attr("data-scope")),n=i.navigate.history.stack;n[n.length-1].transition="none";u.one("pagecontainershow",function(){nu(i.activePage);dr(r)});ci=null;history.go(-1)})}function dh(f,o){function nt(){(c||h.length>0&&!f.get_useCase())&&(c&&o.parent().addClass("app-page-tasks"),s=$('<ul data-role="listview" data-inset="true" data-shadow="false" class="app-listview app-listview-static"/>').appendTo(o),f&&(k=ro(f,s,c)))}function tt(){c&&(h.length&&h.push({}),h.push({text:t.Settings,icon:"gear",callback:function(){n.contextScope("_taskAssistant");so()}}))}var h=[],v,b=n.pageInfo(f&&f._id),c=!f,s,k,y=!1,p,g="eye",it,w,a;if(f||(f=b&&b.dataView),o||(o=n.content("taskassistant"),v=o.closest(".ui-page"),v.find(".app-page-header").remove(),v.addClass("app-page-tasks app-page-scrollable"),o.find('ul[data-role="listview"]').listview("destroy").remove(),n.tabs("destroy",{container:v}),le(v)),f&&(n.contextScope(f._id),n.navContext(h,!c),n.contextScope(null),h.length&&h[0].icon=="back"&&(h=h.splice(1)),nt(),c&&(f.get_isInserting()?(p="Entering",g="plus"):f.get_isEditing()?(p="Editing",g="edit"):f._lookupInfo&&(p="Lookup")),!1&&n.renderContext(s,h,function(n){var t=n.navigateTo=="detail";return t&&(y=!0),t}),c&&(y&&$('<li data-role="list-divider">').appendTo(s),it=$("<li>").appendTo(s).attr("data-icon",g),resumeLink=$('<a href="#"/>').appendTo(it).text(t["Resume"+(p||(f.get_isForm()?"Viewing":"Browsing"))]),$('<p class="app-item-desc"/>').appendTo(resumeLink).text(b.text),tt(),y=!0,n.renderContext(s,h,function(n){return y&&(y=!1,$('<li data-role="list-divider"/>').appendTo(s)),!n.navigateTo&&(n.callback||n.href)&&n.icon!="dots"&&(!n.command||!n.command.match(/^(Eye|SideBar)$/))})),s&&!c)){a=[];function rt(){n.tabs("create",{tabs:a,className:"app-tabs-echo",change:function(){ct()}})}$(h).each(function(){var i=this,t,n;i.navigateTo=="detail"&&(n=i.activator,n&&n.type=="Tab"&&($(a).each(function(){if(n.text==this.text)return t=this,!1}),t||(w!=n.container&&(w&&(rt(),a=[]),w=n.container),t={text:n.text,content:[]},a.push(t))),echo=gh(this.context,s.parent()),t&&t.content.push(echo))});w&&rt()}if(c&&!f&&(tt(),nt(),n.renderContext(s,h)),s){s.listview().on("vclick",function(n){d();var t=$(n.target).closest("a").andSelf("a"),r=t.data("context-action"),f=i.navigate.history.stack;return t.length&&!ae(n)&&e(t,function(){if(l()=="taskassistant"){f[f.length-1].transition="none";u.one("pagecontainershow",function(){nu(i.activePage);setTimeout(function(){at(r)},100)});history.go(-1)}else at(r)}),!1});s.find(".ui-btn-icon-right").toggleClass("ui-btn-icon-right ui-btn-icon-left");kt(s)}c&&s&&s.find("li:first").length&&(a=[{text:os.Tasks,content:$('#taskassistant ul[data-role="listview"]')},{text:t.Recent,content:$()},{text:t.Favorites,content:$()}],n.tabs("create",{tabs:a,className:"ui-header-fixed app-tabs-tasks",id:"tasks",placeholder:o}),i.changePage("#taskassistant",{changeHash:!0,transition:r.pageTransition=="none"?"none":"slidedown"}));c||!k||k.next().length||s.off().listview("destroy").remove()}function cr(n){n.find("a").data("data-context",null);n.find('ul[data-role="listview"]').listview("destroy").remove()}function gh(i,r){var u=$('<div class="app-echo"/>').appendTo(r).attr({id:i+"_echo","data-for":i}),s,o=$('<div class="app-echo-toolbar"><h3><\/h3><a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-dots ui-btn-icon-notext app-btn-more"/><div class="app-echo-controls"><\/div><span class="app-echo-see-all"><span><\/span><a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-carat-r ui-btn-icon-notext"/><\/span><\/div>').appendTo(u).on("vclick","a",function(t){var r=$(t.target);return dt(r)&&!n.busy()&&e(r,function(){r.is(".ui-icon-carat-r")?n.changePage(i):r.is(".ui-icon-dots")&&n.showContextMenu({scope:i})}),!1});o.find(".ui-icon-dots").attr("title",t.More).css("visibility","hidden");o.find("h3").on("vclick",function(t){var r=$(t.target).closest("h3"),u=[],f=n.contextScope();r.addClass("app-selected");e(r,function(){n.contextScope(i);pc(u,!1);n.contextScope(f);p({anchor:r,items:u,iconPos:"left",y:r.offset().top+r.outerHeight()})})});o.find(".ui-icon-carat-r").attr("title",t.SeeAll);o.find(".app-echo-see-all span").html(t.SeeAll).on("vclick",function(t){var r=$(t.target).addClass("app-selected");setTimeout(function(){r.removeClass("app-selected");n.changePage(i)},ku)});o.find(".app-echo-controls").on("vclick",".ui-btn",function(t,r){function e(){var r=f.context&&f.context.group,e=[],t;r?(t=n.pageInfo(i).dataView,wf(r.Id,t,e,t.extension().commandRow()),p({items:e,anchor:u,iconPos:"left",defaultIcon:"carat-r",scope:t._id})):f.callback()}var u=$(t.target).closest("a"),f=u.data("data-context");return u.length&&!n.busy()&&(r!=!1?n.callWithFeedback(u,e):e()),!1});return $('<div class="app-echo-instruction"><\/div>').appendTo(u).hide(),s=$('<div class="app-echo-inner"><\/div>').appendTo(u).hide().on("vclick taphold",function(t){var r=$(t.target),o=r.closest("a"),y,h,c,l,p=t.type,a=p!="taphold"&&!t.ctrlKey,w=o.is(".dv-action-see-all"),v;return o.length&&!o.is(".app-divider")&&dt(r,p)&&(!w||a)&&!n.busy()&&e(r,function(){w?n.changePage(i):(n.contextScope(i),y=n.pageInfo(i),h=y.dataView,c=h.extension(),l=o.data("data-context"),v=o.is(".app-selected"),h._hasKey()?(u.find(".app-echo-inner .app-selected").removeClass("app-selected"),a?o.addClass("app-selected"):v?o.removeClass("app-selected"):o.addClass("app-selected"),n.dataViewUILinks(h).removeClass("app-selected"),a?(c.tap(l,"none"),eu(h,u),r.is(".app-btn-more")?po(r):c.tap(l)):(v?c.clearSelection():c.tap(l,"none"),eu(h,u),s.find(".app-listview.app-grid").length&&!f()&&r.is("span")&&ch(r))):n.infoView(h,!0,l.row),n.contextScope(null))}),r.closest(".app-grid-header").length?void 0:!1}).on("contextmenu",function(t){return rl(n.pageInfo(i).dataView,t)}),$('<div class="app-echo-footer"><\/div>').appendTo(u),nc(u),o.find("h3").text(n.pageInfo(i).text),f()&&u.find(".app-echo-inner").attr("tabindex",0),u}function ct(t){var f,u,r,e=0;t?i.activePage.find(".app-echo-toolbar").each(function(){f=$(this).parent();u=f.attr("data-for");r=n.pageInfo(u);r.echoId&&!r.dataView._busy()&&fu(r.echoId)}):ui||a||fi||n.callWhenVisible(".app-echo:visible",function(t){setTimeout(function(){u=t.attr("data-for");r=n.pageInfo(u);!r.dataView||r.dataView._busy()||r.dataView.get_isForm()||(r.echoInitialized?r.echoChanged&&fu(r.echoId):(r.echoId=t.attr("id"),n.pageInit(r.id,!1)&&fu(r.id+"_echo")))},e);e+=50});i.activePage.find(".app-echo-controls.app-stale").each(function(){var t=$(this).closest(".app-echo"),i=t.attr("id"),r=n.pageInfo(i.substring(0,i.length-5));eu(r.dataView,t)})}function nc(n){var t=r.displayDensity;t!="Condensed"&&(t=="Comfortable"&&tt.width()/16<31?n.addClass("app-density-compact"):t=="Compact"&&tt.width()/14<31&&n.addClass("app-density-condensed"))}function fu(r){var pt;if(!fi){var c=$("#"+r).removeClass("app-density-condensed app-density-compact"),it=c.parent(),u=c.find(".app-echo-inner").show(),ot=u.next().hide(),ni=c.attr("data-for"),b=n.pageInfo(ni),o=b.dataView,d=o._totalRowCount,e=o.extension(),v=e.visibleDataRows(0),st=e.itemMap(),h,ut=o.get_showRowNumber()==!0,ht=$(c).find(".app-echo-toolbar"),ti=ht.find(".app-echo-controls"),ii=ht.find(".app-echo-see-all"),g=ht.find("h3").empty().text(o.get_view().Label||b.text),wt=u.prev(),ct=e.instruction(!1),bt,ri=i.getScreenHeight(),nt=it.height()*.55,lt,a,s,at,tt,vt,k,dt=o.get_selectedKey().length>0,ft,rt=e.aggregates();if(!c.is(":visible")){b.echoChanged=!0;return}if(b.echoChanged=!1,nc(c),!v){o.goToPage(0,!0);e.echoCallback=function(){e.echoCallback=null;fu(r)};return}if(d&&($("<span> (<\/span>").appendTo(g),$('<span class="app-echo-count"><\/span>').appendTo(g).text(d),$("<span>)<\/span>").appendTo(g),f()&&g.attr("title",g.text())),b.echoInitialized||(b.echoInitialized=!0,b.refreshed=!1),c.css("padding-bottom",""),tt=it.find(".app-stub,.app-stub-main"),tt.length||(tt=$("<div><\/div>").appendTo(it).addClass("app-stub"+(l()=="Main"?"-main":""))),tt.height(tt.outerHeight()+u.outerHeight(!0)),ct&&(v.length||ct.match(/"app-filter"/))?wt.html(ct).show():wt.hide(),lt=u.scrollLeft(),cr(u),u.empty(),v.length)if(u.removeClass("app-no-scrolling app-horizontal-scrolling"),o._filterSource||it.find(".app-echo:visible").length!=1||(nt=ri-u.offset().top-(er(c.css("padding-top"))+er(c.css("padding-bottom")))),a=v.length,e.viewStyle()=="Grid")u.addClass("app-no-scrolling").height(""),cr(u),h=$('<ul class="app-listview app-grid" data-role="listview"/>').appendTo(u),p=$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(h),io(o,p),$(v).each(function(n){var t=this,u=n+1,i=$('<li data-icon="false" class="dv-item"/>').appendTo(h),r=$("<a/>").appendTo(i).data("data-context",{row:this.slice(0),pageIndex:0});return af(o,t,ut?u:null,r),o.rowIsSelected(t)&&(k=t,r.addClass("app-selected")),n==0&&(h.listview(),nt-=i.prev().outerHeight(!0)+1,s=Math.ceil(nt/(i.outerHeight(!0)+1)),rt&&(s-=2)),s<a&&s-2==n?!1:void 0}),rt&&(p=$('<li data-icon="false" class="dv-item"/>').appendTo(h),p.prev().addClass("app-followed-by-aggregates"),w=$('<a class="app-divider app-calculated"/>').appendTo(p),af(o,rt,null,w,e.aggregateLabels())),(s<a||a<d)&&(at=w=$('<a class="dv-action-see-all"/>').appendTo($("<li/>").appendTo(h)).text(t.SeeAll)),kt(h.listview().listview("refresh")),at&&at.toggleClass("ui-btn-icon-right ui-btn-icon-left");else{var h=$('<ul class="app-listview" data-role="listview"/>').hide().appendTo(u),p=$('<li data-icon="false"/>').appendTo(h),w=$("<a/>").appendTo(p),yt,et,gt;if(rt&&(gt=e.aggregateLabels(),ot.show().empty(),$(o._fields).each(function(n){var r=this,f=o._allFields[r.AliasIndex],u=gt[n],t,i,e;u&&(t=rt[r.Index],t=String.localeFormat(r.DataFormatString||"{0:n0}",t),i=$('<a class="ui-btn ui-inline app-calculated app-btn-static"/>').appendTo(ot),$('<span class="app-calculated-label"/>').text(f.HeaderText).appendTo(i),e=$('<span class="app-calculated-value"/>').text(t).appendTo(i),$('<div class="app-static-text"/>').text(u).insertBefore(e.contents()),i.attr("title",f.HeaderText+"\n"+u+" "+t))}),i.activePage.find(".app-echo:visible").length==1&&c.prev().is(".app-page-header")&&(nt-=ot.outerHeight())),sr(o,v[0],st,ut?1:null,p,w),h.listview().show(),yt=p.outerHeight(!0),et=Math.floor(u.innerWidth()/p.outerWidth(!0)),s=Math.floor(nt/yt),s<1&&(s=1),et*s>=v.length&&(s=Math.ceil(v.length/et),u.addClass("app-no-scrolling")),d>a&&(a=a-a%s,et*s>=a&&u.addClass("app-no-scrolling")),u.is(".app-no-scrolling")||(u.addClass("app-horizontal-scrolling"),f()&&(s=Math.floor(nt/yt),s<1&&(s=1))),cr(u),$(v).each(function(n){if(n>=a)return!1;h&&n%s!=0||(h=$('<ul class="app-listview" data-role="listview"/>').appendTo(u),pf(o,h));var r=this,e=n+1,f=$('<li data-icon="false" class="dv-item"/>').appendTo(h),i=$("<a/>").appendTo(f).data("data-context",{row:this.slice(0),pageIndex:0});sr(o,r,st,ut?e:null,f,i);n==a-1&&a<d&&(i.find("p,img,span").css("visibility","hidden"),i.addClass("dv-action-see-all").find("h3").text(t.SeeAll),f.attr("data-icon","carat-r"));o.rowIsSelected(r)&&(k=r,i.addClass("app-selected"))}),a>s&&(pt=s-a%s,pt<s))while(pt-->0)p=$('<li data-icon="false" class="dv-item"/>').appendTo(h),w=$("<a/>").appendTo(p),sr(o,v[0],st,ut?1:null,p,w),w.css("visibility","hidden");s==d&&h.addClass("app-list-one-column");kt(u.find("ul").listview());h=u.find("ul:first");h.length&&(bt=u[0].offsetHeight-u[0].clientHeight,u.height(h.height()+bt+8));w=u.find(".app-selected");w.length&&(vt=w.offset().left-u.offset().left+w.outerWidth(),vt>u.width()&&(lt=vt-w.outerWidth()));u.scrollLeft(lt)}else $('<div class="app-echo-empty"/>').appendTo(u.height("")).text(y.NoRecords);c.prev().is(".app-echo")||c.next().is(".app-echo")||c.css("padding-bottom",0);lh(it,tt);dt?(k||(v=e.visibleDataRows(e.pageIndex()),$(v).each(function(){var n=this;if(o.rowIsSelected(n))return k=n,!1})),k?e.commandRow()!=k&&(e.clearSelection(),e.tap(k,"none")):e.clearSelection()):e.commandRow()&&e.clearSelection();b.echoRefreshCallback&&(b.echoRefreshCallback(),b.echoRefreshCallback=null);eu(o,c,dt,ti,g,ii);e._checkedAutoSelect||(e._checkedAutoSelect=!0,setTimeout(function(){ft=e._autoSelect;e._autoSelect=null;ft&&!n.busy()&&(b.echoChanged=!0,n.contextScope(o._id),e.tap(ft.row,ft.action),n.contextScope(null))}))}}function eu(t,i,r,u,f,e){function c(n){return n.offset().left+n.outerWidth()>d+y-1}var h,s;if(r==null&&(r=t.get_selectedKey().length>0),!u){if(i||(i=$("#"+t._id+"_echo")),!i.length)return;u=i.find(".app-echo-toolbar .app-echo-controls");f=u.parent().find("h3");e=u.next()}var w=[],l=[],b=f.next().css("visibility",""),a=b.offset().left+b.outerWidth(),v=e.offset().left,k,d,y,o=[],p=[];if(a==0&&v==0)u.addClass("app-stale");else if(v-a>=28){if(u.find(".ui-btn").data("data-context",null),u.hide().contents().remove(),k=n.contextScope(),n.contextScope(t._id),t.extension().context(w,["ActionBar"]),n.contextScope(k),$(w).each(function(){var n=this;n.system?n.icon=="search"&&l.push(n):n.text&&l.push(n)}),$(l).each(function(){var n=this,t=$('<a class="ui-btn"/>').appendTo(u).data("data-context",n);n.icon=="dots"?t.addClass("app-has-children ui-corner-all ui-mini").text(n.text):(t.addClass("ui-mini ui-btn-icon-left ui-corner-all ui-icon-"+(n.icon||"carat-r")).attr("title",n.text),n.icon=="search"?t.toggleClass("ui-btn-icon-left ui-btn-icon-notext ui-mini "):t.text(n.text))}),y=v-a-er(u.css("marginRight")),u.width(y).show(),d=u.offset().left,u.find(".ui-btn").each(function(){var n=$(this);n.is(".ui-btn-icon-left")&&p.push(n);c(n)&&o.push(n)}),o.length)for(p.reverse();o.length;){if(h=o[0],s=c(h),s&&(h.is(".ui-btn-icon-left")&&(h.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),s=c(h)),s&&$(p).each(function(){var n=this;if(o.indexOf(n)==-1&&n.is(".ui-btn-icon-left")&&(n.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),s=c(h),!s))return!1}),s)){$(o).each(function(){this.hide()});break}o.splice(0,1)}$('<a class="ui-btn ui-btn-icon-notext ui-corner-all"/>').appendTo(u).css("visibility","hidden")}else u.hide()}function ca(){var n=ui||a;return n==!0}function dt(n,t){var i;if(ui||a)return!1;if(et||!1)if(i=$(n).closest("a"),i.data("scroll-check")==!0)i.data("scroll-check",!1);else{fi=!1;var r=i.closest(".app-wrapper,.ui-panel-inner"),u=r.data("scroll-stop-time"),f=r.scrollTop();return u&&fr()-u.getTime()>5e3?!0:(i.data("scroll-check",!0),setTimeout(function(){t||(t="vclick");f==r.scrollTop()?($(n).is(".app-btn-more")?n:i).trigger(t):(dt(i,t),o())},10),!1)}return!0}function ou(n){setTimeout(function(){$("div.ui-panel-open").panel("close",n!=!0)},ku)}function k(t,i,r){i||(i=450);pr&&(clearTimeout(pr),pr=null);t||(pr=setTimeout(function(){if(a)k(t,100,r);else{pr=null;kt();var i=lf(),u=n.contextScope();bh(i);n.contextScope(null);n.refreshContextMenu(i);n.contextScope(u);n.refreshMenuStrip();r&&r()}},i))}function oi(n,t){if(n=location.pathname.replace(/\W/g,"_")+"_"+n,arguments.length==1)return c(n);c(n,t)}function c(n,t){if(re||(re=__settings.appInfo.replace(/\W/g,"_")),n=re+"_"+n,arguments.length==1){if(typeof Storage!="undefined")try{return t=localStorage[n],t!=null&&(t=JSON.parse(t)),t}catch(i){}return null}if(typeof Storage!="undefined")if(t==null)localStorage.removeItem(n);else try{localStorage[n]=JSON.stringify(t)}catch(i){}}function tc(n,t){var r={text:t,resolved:!0,description:null,type:null},i=n.attr("data-activator"),e,u,o,f;return i||(o=n.closest("div[data-activator]"),i=o.attr("data-activator"),i&&(n=o,e=n.parent(),u=e.attr("id"),u||(u="aid"+kl++,e.attr("id",u)),r.container=u)),i||(i=$(n).prev(".DataViewHeader").text()),i&&i!="false"?(f=el.exec(i),f?(r.text=f[4]||f[2],r.type=f[1]):r.text=i):r.resolved=!1,r.description=n.attr("data-activator-description"),r}function vf(n,t){return(t?n.tagged("action-call"):n.tagged("action-call","field-call"))||n.Name.match(cl)&&(!t||!n.tagged("action-call-disabled"))}function yf(n,t){return(t?n.tagged("action-email"):n.tagged("action-email","field-email"))||n.Name.match(ll)&&!(t||!n.tagged("action-email-disabled"))}function ic(n,t){return(t?n.tagged("action-url"):n.tagged("action-url","field-url"))||n.Name.match(al)&&(!t||!n.tagged("action-url-disabled"))}function la(n,t){return t?n.tagged("action-location"):n.tagged("action-location","map-address")&&!n.tagged("action-location-disabled")}function aa(n){var t=n.ItemsStyle;return!String.isNullOrEmpty(t)&&t!="CheckBoxList"}function pf(n,t){(n.get_isTagged("thumb-person")||n._controller.match(/\b(emp|acc|user|usr|person|cust)/i)&&!n.get_isTagged("thumb-standard"))&&t.addClass("app-thumb-person")}function wi(n,t,i){a=!0;n.animate({scrollTop:t},"swing",function(){a=!1;i&&i()})}function rc(t,i,r){r||(r={});var f=$(t),s=r.position||"right";if(d(),ur=null,f.length==0){f=$(String.format('<div data-position-fixed="true" data-role="panel" data-theme="a" data-display="overlay" class="ui-panel ui-panel-display-overlay ui-panel-animate ui-panel-position-{0}"><ul/><\/div>',s)).appendTo(u).panel({animate:ff(),position:s,beforeopen:function(){rr=!0;wr&&(clearTimeout(wr),wr=null);i&&i()},open:function(){rr=!1;o();r&&r.afteropen&&r.afteropen()},beforeclose:function(){rr=!0;bh(f)},close:function(){rr=!1;ur&&ur();n.contextScope()&&(wr=setTimeout(function(){n.contextScope(null);wr=null},1e3));ur=null;r&&r.close&&r.close()}});ff(f);r.className&&f.addClass(r.className);tu(f);t.match(/^#/)&&f.attr("id",t.substring(1));f.find("ul").listview().on("vclick",function(n){var t=$(n.target).closest("a"),r=t.closest("li").attr("data-icon"),i;if(rr||t.length&&!dt(t))return!1;if(i=t.data("context-action"),i&&!cs){if(i.dataRel)return!0;i.feedback==!1?(o(),i.keepOpen==!0?at(i,t):(f.panel("close",r!="dots"&&r!="back"),ur=function(){setTimeout(function(){at(i,t)},10)})):i.keepOpen==!0?e(t,function(){at(i,t)}):e(t,function(){f.panel("close",r!="dots"&&r!="back");ur=function(){setTimeout(function(){at(i,t)},10)}})}return cs=!1,!1}).on("swipe",function(){});r&&r.resetScrolling&&f.addClass("app-reset-scrolling")}return f}function lr(){n.contextScope()=="_contextMenu"?n._menuPanel.panel("toggle"):n.toggleContextPanel("#app-panel-context")}function d(){s&&$(s).blur()}function ft(){n.headingBar().is(":visible")&&n.headingBar().hide()}function gt(t){t!=null?setTimeout(function(){n.fetchOnDemand()},t):n.fetchOnDemand()}function vt(t){return n.headingOnDemand(t),n}function b(t,i,r){return d(),h=t,(n.contextScope()&&(!r||r.position!="left")||r&&r.position!="right")&&(i+="-scope",r||(r={}),r.position="left"),rc(i,function(){n.refreshContextMenu(i,h)},r).panel("toggle")}function va(n){var i=new Sys.StringBuilder,f=n._fields,t,r,u;if(n.get_sortExpression())for(r=0;r<f.length;r++)t=n._allFields[f[r].AliasIndex],t.AllowSorting&&(u=ni(n,t.Name),u&&(i.isEmpty()||i.append(", "),i.appendFormat("{1} | {0}",t.HeaderText,bi(t,u))));return i.toString()}function su(n){n.extension()._instructed=!1}function fo(){var t=n.contextDataView(),i=new Sys.StringBuilder;vi!=null&&($(t._fields).each(function(){var n=t._allFields[this.AliasIndex],r=ni(t,n.Name);r&&(i.isEmpty()||i.append(","),i.appendFormat("{0} {1}",n.Name,r))}),t._sortExpression=i.toString(),vi=null,su(t),ft(),t.sync())}function ni(n,t,i){var f=vi==null?n.get_sortExpression()||"":vi,e=f.split($app._simpleListRegex),r,u;if(i==null){if(f)for(r=0;r<e.length;r++)if(u=e[r].match(vl),u[1]==t)return u[3]||"asc";return null}vi=i?String.format("{0} {1}",t,i):"";n.viewProp("sortExpression",vi)}function bi(n,t){var i=rt.GenericSortAscending,r=rt.GenericSortDescending;switch(n.FilterType){case"Text":i=rt.StringSortAscending;r=rt.StringSortDescending;break;case"Date":i=rt.DateSortAscending;r=rt.DateSortDescending}return t=="asc"?i:r}function g(n,t){h=n;t?setTimeout(t,500):so()}function uc(){function i(t){cf();ft();n.contextScope(null);r.sidebar=t;c("sidebar",t);se();kt();gt(1e3);sa();k();setTimeout(function(){or();ct(!0);f();vt()},750)}function f(){g(u,uc)}var u=h,e=[{text:t.Back,icon:"back",callback:function(){g(u)}},{text:t.Sidebar,isStatic:!1,instruction:!0},{text:t.Landscape,icon:r.sidebar=="Landscape"?"check":!1,context:"Landscape",callback:i},{text:t.Always,icon:r.sidebar=="Always"?"check":!1,context:"Always",callback:i},{text:t.Never,icon:r.sidebar=="Never"?"check":!1,context:"Never",callback:i},];n.contextScope("_contextMenu");b(e,"#app-panel-settings-sidebar")}function eo(n){return"app-theme-"+n.toLowerCase()}function oo(n){return"app-density-"+n.toLowerCase()}function fc(){var f=h,n=r.theme,e=[{text:t.Back,icon:"back",callback:function(){g(f)}},{text:t.Themes.Label,isStatic:!1,instruction:!0}];for(var i in t.Themes.List)e.push({text:t.Themes.List[i],icon:i==n?"check":!1,context:i,callback:function(t){t!=n&&(n&&u.removeClass(eo(n)),r.theme=t,u.addClass(eo(t)),c("theme",t));g(f,fc)}});b(e,"#app-panel-settings-theme")}function ec(){var i=h,u=r.pageTransition,f=[{text:t.Back,icon:"back",callback:function(){g(i)}},{text:t.Transitions.Label,isStatic:!1,instruction:!0},];for(var n in t.Transitions.List)f.push({text:t.Transitions.List[n],icon:n==u?"check":!1,context:n,callback:function(n){n!=u&&(r.pageTransition=n,c("pageTransition",n));g(i,ec)}});b(f,"#app-panel-settings-theme")}function oc(){var e=h,i=r.displayDensity,o=[{text:t.Back,icon:"back",callback:function(){g(e)}},{text:t.DisplayDensity.Label,isStatic:!1,instruction:!0},];for(var f in t.DisplayDensity.List)o.push({text:t.DisplayDensity.List[f],icon:f==i?"check":!1,context:f,callback:function(t){t!=i&&(u.removeClass(oo(i)),r.displayDensity=t,u.addClass(oo(t)),wt(),c("displayDensity",t),ft(),kt(),or(),vt(),ct(!0),n.refreshMenuStrip());g(e,oc)}});b(o,"#app-panel-settings-display-density")}function sc(){var i=h,f=r.labelsInForm,e=[{text:t.Back,icon:"back",callback:function(){g(i)}},{text:t.LabelsInForm.Label,isStatic:!1,instruction:!0},];for(var n in t.LabelsInForm.List)e.push({text:t.LabelsInForm.List[n],icon:n==f?"check":!1,context:n,callback:function(n){n!=f&&(u.removeClass("app-labelsinform-alignedright"),r.labelsInForm=n,n=="AlignedRight"&&u.addClass("app-labelsinform-alignedright"),c("labelsInForm",n));g(i,sc)}});b(e,"#app-panel-settings-labels-in-form")}function hc(){var i=h,f=r.labelsInList,e=[{text:t.Back,icon:"back",callback:function(){g(i)}},{text:t.LabelsInList.Label,isStatic:!1,instruction:!0},];for(var n in t.LabelsInList.List)e.push({text:t.LabelsInList.List[n],icon:n==f?"check":!1,context:n,callback:function(n){n!=f&&(u.removeClass("app-labelsinlist-displayedabove"),r.labelsInList=n,n=="DisplayedAbove"&&u.addClass("app-labelsinlist-displayedabove"),c("labelsInList",n));g(i,hc)}});b(e,"#app-panel-settings-labels-in-form")}function cc(){function e(n){r.buttonShapes=n;c("buttonShapes",n);n?u.removeClass("app-buttons-text-only"):u.addClass("app-buttons-text-only");k();g(i,cc)}var i=h,f=r.buttonShapes,n=[{text:t.Back,icon:"back",callback:function(){g(i)}},{text:t.ButtonShapes,isStatic:!1,instruction:!0},];n.push({text:vu,icon:f!=!1?"check":!1,context:!0,callback:e});n.push({text:au,icon:f==!1?"check":!1,context:!1,callback:e});b(n,"#app-panel-settings-button-shapes")}function lc(){function f(n){r.promoteActions=n;c("promoteActions",n);k();g(i,lc)}var i=h,u=r.promoteActions,n=[{text:t.Back,icon:"back",callback:function(){g(i)}},{text:t.PromoteActions,isStatic:!1,instruction:!0},];n.push({text:vu,icon:u!=!1?"check":!1,context:!0,callback:f});n.push({text:au,icon:u==!1?"check":!1,context:!1,callback:f});b(n,"#app-panel-promote-actions")}function ya(){var u=h,f=r.initialListMode,i=[{text:t.Back,icon:"back",callback:function(){g(u)}},{text:t.InitialListMode.Label,isStatic:!1,instruction:!0},];for(var n in t.InitialListMode.List)i.push({text:t.InitialListMode.List[n],icon:n==f?"check":!1,context:n,callback:function(n){$app.confirm(t.ConfirmReload,function(){c("initialListMode",n);w.location.reload(w.location.href)})}});b(i,"#app-panel-settings-default-list-mode")}function so(){var i=[];n.contextScope()!="_taskAssistant"&&i.push({text:t.Back,icon:"back",callback:lr});i.push({text:t.Settings});r.displayDensityDisabled||i.push({text:t.DisplayDensity.Label,icon:"dots",callback:oc,desc:t.DisplayDensity.List[r.displayDensity]});r.themeDisabled||i.push({text:t.Themes.Label,icon:"dots",callback:fc,desc:t.Themes.List[r.theme]});r.pageTransitionDisabled||i.push({text:t.Transitions.Label,icon:"dots",callback:ec,desc:t.Transitions.List[r.pageTransition]});r.sidebarDisabled||i.push({text:t.Sidebar,icon:"dots",callback:uc,desc:r.sidebar=="Landscape"?t.Landscape:r.sidebar=="Always"?t.Always:t.Never});r.labelsInFormDisabled||i.push({text:t.LabelsInForm.Label,icon:"dots",callback:sc,desc:t.LabelsInForm.List[r.labelsInForm]});r.labelsInListDisabled||i.push({text:t.LabelsInList.Label,icon:"dots",callback:hc,desc:t.LabelsInList.List[r.labelsInList]});r.buttonShapesDisabled||i.push({text:t.ButtonShapes,icon:"dots",callback:cc,desc:r.buttonShapes!=!1?vu:au});r.promoteActionsDisabled||i.push({text:t.PromoteActions,icon:"dots",callback:lc,desc:r.promoteActions!=!1?vu:au});r.initialListModeDisabled||i.push({text:t.InitialListMode.Label,icon:"dots",callback:ya,desc:t.InitialListMode.List[r.initialListMode]});b(i,"#app-panel-settings")}function pa(){vi=null;var i=n.contextDataView(),r=i.get_view().Label,f=i._fields,e=i._allFields,u=[{text:t.Back,icon:"back",callback:lr},{text:String.format(t.SortByField,r)}];$(f).each(function(){var f=this,s=f,c,o;f=e[f.AliasIndex];!s.Hidden&&f.AllowSorting&&(o=ni(i,f.Name),o&&(c=!0),u.push({text:f.HeaderText,context:f,icon:o?o=="asc"?"arrow-u":"arrow-d":"false",desc:o?bi(f,o):null,callback:function(u){function o(){h=s;n.toggleContextPanel("#app-panel-sort-fields")}function e(n,t){ni(i,n.Name)==t?o():(ni(i,n.Name,t),fo())}var s=h,f=ni(i,u.Name);h=[{text:t.Back,icon:"back",callback:o}];h.push({text:String.format(t.SortByOptions,r,u.HeaderText)});h.push({text:bi(u,"asc"),callback:function(){e(u,"asc")},icon:f=="asc"?"check":!1});h.push({text:bi(u,"desc"),callback:function(){e(u,"desc")},icon:f=="desc"?"check":!1});h.push({text:t.DefaultOption,callback:function(){e(u,!1)},icon:f?!1:"check"});b(h,"#app-panel-sort-options")}}))});b(u,"#app-panel-sort-fields")}function wa(n){var t=n.get_filter(),i=n._externalFilter||[];return t&&t.length&&i.length<t.length||ef(n).length}function ho(n){var t=$(".ui-panel-open .app-btn-apply,.ui-popup-active .app-btn-apply");t.is(".app-enabled")||(n?t.removeClass("ui-disabled"):t.addClass("ui-disabled"))}function ba(n,t){var r=ac(t),i=co(t);t.toggleClass("ui-btn-icon-right ui-icon-check");i.length>i.filter(".ui-icon-check").length?r.removeClass(nr):r.addClass(nr);ho(i.filter(".ui-icon-check").length>0)}function ac(n){return n.closest(".ui-panel-inner").find(".app-btn-select-all a")}function co(n){return ac(n).parent().nextAll().find("a")}function ka(n){return n.length>0?n.data("data-context")||n.data("context-action"):null}function da(t,i){var r=n.contextDataView(),f=r.findField(t),e=r._allFields[f.AliasIndex],u=vc(r,t,i);r.removeFromFilter(e);u&&r._filter.push(u);dr(r)}function vc(n,t,i){function s(t){r=[];o.each(function(){var i=$(this),u=i.is(".ui-icon-check");(u&&t||!u&&!t)&&r.push(n.convertFieldValueToString(f,f._listOfValues[ka(i).context]))})}var f=n.findField(t),h=n._allFields[f.AliasIndex],u=[],r,e,o=co(i);return o.filter(":not(.ui-icon-check)").length&&(s(!0),r.length&&(u.push(h.Name+":"),r.length==1?u.push("="+r[0]):(e=r.length<=10||r.length<=r.length/2,u.push(e?"$in$":"$notin$"),e||s(!1),$(r).each(function(n){n>0&&u.push("$or$");u.push(this)})))),u.join("")}function lo(i){function u(n,r){var f=n._dataView,u=f._allFields[n.AliasIndex],o=f.get_fieldFilter(u,!0);i||(r.push({text:t.Back,icon:"back",callback:e}),r.push({text:u.HeaderText}));o&&r.push({text:y.Filters.Labels.Clear,context:u.Name,callback:function(){f.removeFromFilter(u);dr(f)},icon:"delete"});r.push({text:y.Filters[u.FilterType].Text,context:u.Name,disabled:!0,callback:function(){},icon:"dots"});i||r.push({text:String.format(t.FilterByOptions,f.get_view().Label,u.HeaderText,t.Apply)})}function f(n,i){var u,r,w,s=n._dataView,l=n._listOfValues||[],a=s._allFields[n.AliasIndex],h=s.get_fieldFilter(a,!0),v=[],f,p,e,o,c=h=="$notin";for(h&&(h=="="||h=="$in"||c)&&(p=(s.get_fieldFilter(a)||"").split(/\$or\$/)),f={text:t.Apply,disabled:!0,itemClassName:"app-btn-apply",context:n.Name,callback:da},i.push(f,{}),l.length>1&&i.push({text:y.Filters.Labels.SelectAll,keepOpen:!0,itemClassName:"app-btn-select-all",icon:!1,callback:function(n,t){var i=co(t);t.is(".ui-icon-check")?(t.removeClass(nr),i.removeClass(nr),ho(!1)):(t.addClass(nr),i.addClass(nr),ho(!0))}}),u=0;u<l.length;u++)r=l[u],o=p&&p.indexOf(s.convertFieldValueToString(n,r))!=-1,c&&(o=!o),w=r==null?rt.EmptyValue:typeof r=="string"&&r==""?rt.BlankValue:a.text(r),e={text:w,icon:o?"check":!1,keepOpen:!0,context:u,callback:ba},o?(c?v.push(e):i.push(e),f.disabled&&(f.disabled=!1,f.itemClassName+=" app-enabled")):c?i.push(e):v.push(e);return i.concat(v)}function e(){var i=n.contextDataView(),r=[{text:t.Back,icon:"back",callback:lr}],e={},o=i._filter;wa(i)&&(r.push({text:i.extension().filterStatus()}),r.push({text:y.Filters.Labels.Clear,icon:"delete",callback:function(){var t=n.contextDataView();ih(t)}}));r.push({text:String.format(t.FilterByField,i.get_view().Label)});$(i._filter).each(function(){var n=this,t=n.match(/^\w+/);t&&(e[t[0]]=n)});$(i._externalFilter).each(function(){e[this.Name]=null});$(i._fields).each(function(){var c=this,s,h,t;s=i._allFields[c.AliasIndex];h=e[s.Name];h&&(i._filter=[h],t=i.extension().filterStatus(!0,!0),t.indexOf(s.HeaderText)==0&&(t=t.substring(s.HeaderText.length).trim(),t.length>2&&(t=t.charAt(0).toUpperCase()+t.slice(1))));!c.Hidden&&s.AllowQBE&&r.push({text:s.HeaderText,context:c.Name,icon:h?"filter":!1,desc:t,callback:function(t){var i=[],e=n.contextDataView(),r=e.findField(t);u(s,i);r._listOfValues&&r._listOfValues.length?i=f(r,i):i.push({text:rt.Loading,icon:"refresh",animate:!0,context:{id:e._id,field:t},keepOpen:!0,callback:function(){}});b(i,"#app-panel-filter-field",{position:"right",resetScrolling:!0,afteropen:function(){var e=bs().data("context-action"),r=e&&e.context,i,o,t;r&&(i=$app.find(r.id),t=i.findField(r.field),o=i._allFields,i._loadListOfValues(null,t.Name,o[t.AliasIndex].Name,function(){var r=bs(),o=r.length&&r.data("context-action").context,e=[];r.length&&o.id==i._id&&o.field==t.Name&&(u(t,e),e=f(t,e),n.refreshContextMenu(r.closest(".ui-panel"),e))}))}})}});i._filter=o});b(r,"#app-panel-filter")}if(i){var r=[];return u(i,r),i._listOfValues&&i._listOfValues.length?r=f(i,r):r.push({text:rt.Loading,icon:"refresh",animate:!0,context:{id:i._dataView._id,field:i.Name},keepOpen:!0,callback:function(){}}),r}e()}function yc(t,r,u,f){u||(u=n.pageInfo());var e=u&&u.dataView,o=e&&e.get_view(),s=0;return e&&e.get_isGrid()&&$(e.get_views()).each(function(){var n=this,h=n.Label==o.Label;r&&n.Id==o.Id||(n.Type!="Form"&&n.ShowInSelector||n.Id==o.Id)&&(t.push({text:n.Label,icon:h?"check":r?"":!1,context:s,callback:function(t){var r=$.find("#"+u.id+" .ui-content > .app-tabs-views .ui-btn");f&&r.length?$(r[t]).trigger("vclick",{selectedTab:n.Label}):(e._forceSync(),e.extension()._commandRow=null,e._requestedSortExpression=e.pageProp(n.Id+"_sortExpression"),e._requestedFilter=e.pageProp(n.Id+"_filter"),e.executeCommand({commandName:"Select",commandArgument:n.Id}),e.pageProp("viewId",n.Id),f&&!r.length&&oi(u.id+"_view-tabs",n.Label),u.id==l()&&(ut(n.Label),i.activePage.find(".dv-heading").remove(),su(e),k()))}}),s++)}),s}function pc(i,r){var f=n.contextDataView(),u=f.extension(),e=u.viewStyle(),o=f!=n.dataView();yc(i,null,n.contextPageInfo(),!0)==1&&i.splice(i.length-2,2);f.get_isGrid()&&(r==!1?i.length&&i.push({}):i.push({text:t.PresentationStyle}),i.push({text:t.Grid,icon:e=="Grid"?"check":!1,callback:function(){u.viewStyle("Grid")}}),i.push({text:t.Cards,icon:e=="Cards"?"check":!1,callback:function(){u.viewStyle()!="Cards"&&u.viewStyle("Cards")}}),o||(i.push({text:t.List,icon:e=="List"?"check":!1,callback:function(){u.viewStyle("List")}}),u.tagged("supports-view-style-map")&&i.push({text:t.Map,icon:e=="Map"?"check":!1,callback:function(){u.viewStyle("Map")}})));i.push({});i.push({text:cu.Refresh,icon:"refresh",callback:function(){f.sync()}})}function ga(){var n=[{text:t.Back,icon:"back",callback:lr},{text:t.AlternativeView}];pc(n);b(n,"#app-panel-view-options")}function wc(t,r,u){var o=t._parentDataViewId&&!t._lookupInfo,e=t.extension(),h=e.itemMap(),s=t._allFields[h.heading],f;u&&u.length&&!e.inserting()&&r.push({text:s.text(u[s.Index]),theme:"b",toolbar:!1,icon:"eye",command:"Eye",toolbar:!o,system:!0,callback:function(){var c=i.activePage.find("#"+t._id+"_echo"),v=n.contextPageInfo(),u=c.length?c:n.content(t._id),s,r,l,h,a;if(e.viewStyle()=="Map")f=i.activePage.find(".app-map").data("data-map"),f.selected&&(f.map.panTo(f.selected.position),setTimeout(function(){ar(f.selected);n.infoView(t,!0)},500));else if(o||t.get_isForm()){function y(){wi(u,0,function(){vt().blink(i.activePage.find(".ui-collapsible-heading:first a"))})}s=i.activePage.find('div[data-role="navbar"] a:first');s.length&&!s.is(".app-tab-active")?(s.trigger("vclick"),setTimeout(y,200)):y()}else if(r=u.find('ul[data-role="listview"] a.app-selected'),l=n.screen(),!r.length&&v.echoId&&(r=i.activePage.find("#"+v.echoId).find(".app-selected")),r.length){h=r.offset().top;a=r.outerHeight(!0);function p(t){n.blink(r,t)}h>=l.top&&h+a<l.bottom||c.length?fe?fe=!1:p(function(){n.infoView(t,!0)}):(ft(),wi(u,u.scrollTop()+h-u.offset().top-(u.height()-a)/2,function(){vt();gt();p();n.promo(r)}))}else t.sync()}})}function ao(n,t,i){i&&$(n._fields).each(function(){var r=n._allFields[this.AliasIndex],f=vf(r,!0),e=yf(r,!0),u;(f||e)&&(u=i[r.Index],u!=null&&(f?t.push({text:r.text(u),desc:r.HeaderText,icon:"phone",href:"tel:"+u,system:!0}):e&&t.push({text:r.text(u),desc:r.HeaderText,icon:"mail",href:"mailto:"+u,system:!0})))})}function nv(n){var t=null;switch(n.CommandName){case"Delete":t="trash";break;case"New":t="plus";break;case"Edit":t="edit";break;case"Insert":case"Update":t="check";break;case"Cancel":t="back";break;case"Duplicate":t="duplicate"}return t}function wf(i,r,u,f,e){function d(n){for(var i=r._views,t=0;t<i.length;t++)if(i[t].Id==n)return i[t].Type!="Form";return!1}var p=r.rowIsSelected(f),s,a=[],g=r.get_viewId(),v=r.get_isGrid(),y={},c,o,l,k=yt?/^(DataSheet|Grid|Import|BatchEdit)$/:/^(DataSheet|Grid|Export(Rowset|Rss)|Import|BatchEdit)$/;$(r.actionGroups(i)).each(function(g){var nt=this,tt=nt.Scope;tt!="ActionBar"||nt.Flat||nt.Id==i?(!nt.Scope.match(/Grid|ActionColumn/)||p&&v)&&$(this.Actions).each(function(t){var h=this,i=h.CommandName,p=h.CommandArgument,it=i+"/"+p+"/"+h.HeaderText,b=a.indexOf(it)==-1&&(!i||!i.match(k));l=i?function(){if(n.contextScope(null),!r._busy())if(i=="Cancel")w.history.go(-1);else{function u(){r.extension().command(f,i,p,h.CausesValidation,h.Path)}String.isNullOrEmpty(h.Confirmation)?u():r._confirm({action:h,scope:nt.Scope,actionIndex:t,rowIndex:0,groupIndex:g},function(n){$app.confirm(n,function(){u()})})}}:null;o=null;b&&(c=i&&i.match(/^(Select|Edit|New|Duplicate)$/),c&&v&&(!p||d(p))?e&&i=="Edit"?p=e:(y[i]=u[u.length-1],b=!1):c&&(o=y[i]));b&&!l&&nt.Scope.match(/Grid|ActionColumn/)&&(b=!1);b&&(a.push(it),s={text:h.HeaderText,callback:l,icon:nv(h),uiScope:tt,command:i,argument:p},o?Array.insert(u,u.indexOf(o)+1,s):u.push(s))}):u.push({text:nt.HeaderText,icon:"dots",uiScope:tt,context:{group:nt,isSideBar:u.isSideBar},callback:function(n){h=[];n.isSideBar||h.push({text:t.Back,icon:"back",callback:lr});h.push({text:nt.HeaderText});wf(n.group.Id,r,h,f);b(h,"#app-panel-group-actions",n.isSideBar?{position:"left"}:null)}})})}function tv(n){var f=n._fields,r=n._allFields,t={heading:null,thumb:null,aside:null,count:null,desc:[],descRwd:[],descLabels:[],descLabelsRwd:[],descPara:[]},u=!1,i,e;if($(r).each(function(n){var f=r[n],e=f.AliasIndex,a=r[e];if(!f.Hidden&&f.tagged("item-")){u=!0;var l=f.tagged("item-desc"),o=f.tagged("item-label")||l,s=$app.tagSuffix,h=f.tagged("item-count"),c=f.tagged("item-aside");f.tagged("item-heading")&&(t.heading=e);!f.tagged("item-desc")&&(!o||h||c)||(t.desc.push(e),i=t.desc.length-1,$app.tagSuffix&&(t.descRwd[i]=$app.tagSuffix),o&&(t.descLabels[i]=!0,s&&(t.descLabelsRwd[i]=s)),f.tagged("item-para")&&(t.descPara[i]=!0));h&&(t.count=e,t.countRwd=$app.tagSuffix,t.countLabel=o,t.countLabelRwd=s);c&&(t.aside=e,t.asideRwd=$app.tagSuffix,t.asideLabel=o,t.asideLabelRwd=s);f.tagged("item-thumb")&&(t.thumb=e)}}),u)t.heading==null&&(t.heading=f[0].AliasIndex);else{e=!0;function o(n){if(!this.Hidden)if(this.OnDemand)t.thumb==null&&this.OnDemandStyle==0&&(t.thumb=n);else if(!e||this.ShowInSummary){n=this.AliasIndex;var i=r[n],f=i.Type.match(/^Date/);isSimpleType=i.Type!="String"&&!i.OnDemand;t.heading==null?t.heading=n:t.aside==null&&f&&t.count==null?t.aside=n:t.count==null&&isSimpleType&&!f&&t.aside==null?t.count=n:(t.desc.push(n),t.descLabels[t.desc.length-1]=n);u=!0}}$(f).each(o);u||(e=!1,$(f).each(o))}return t}function bf(n){var t={latitude:null,longitude:null,segments:[]},i=[];return $(n._allFields).each(function(n){var r=this;r.tagged("map-")&&(r.tagged("map-latitude")?t.latitude=n:r.tagged("map-longitude")?t.longitude=n:i.push(this))}),$(["address","city","state","region","postalcode","zipcode","zip","country"]).each(function(){var n=this;$(i).each(function(r){var u=this;if(u.tagged("map-"+n))return t.segments.push(u.Index),i.splice(r,1),!1})}),t}function iv(n){var t=br||c("geoLocations"),i=null;return t&&$(t).each(function(){var t=this;if(t.address==n)return i=t.lat==null&&t.lng==null?"ZERO_RESULTS":{lat:t.lat,lng:t.lng},!1}),br||(br=t),i}function bc(n,t,i){var r=br||c("geoLocations");r||(r=[]);r.push({address:n,lat:t,lng:i});r.length>wl&&r.splice(0,1);br=r;setTimeout(function(){c("geoLocations",r)},0)}function kc(n,t,i){var r=new Sys.StringBuilder;return et?r.append("http://maps.apple.com/?"):r.append("https://maps.google.com/?"),i=="q"?r.append("q="):i=="to"?r.append("daddr="):r.append("saddr="),t.latitude!=null&&t.longitude!=null?r.appendFormat("{0},{1}",t.latitude,t.latitude):$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(",+"),r.append(i.trim().replace(/\s+/g,"+")))}),r.toString()}function rv(n,t){var u,f,e,i,r;return t.latitude!=null&&t.longitude!=null?(u=n[t.latitude],f=n[t.longitude]):(r=new Sys.StringBuilder,$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(","),r.append(i))}),e=r.toString(),i=iv(e),i?typeof i!="string"&&(u=i.lat,f=i.lng):i=e),typeof i!="string"&&(i=new google.maps.LatLng(u,f)),i}function dc(n){$(n.markers).each(function(){google.maps.event.clearListeners(this,"click");this.setMap(null)});n.markers=[];n.selected=null}function vo(n){if(n.fit!=!1){var i=new google.maps.LatLngBounds,t=n.markers,r=n.map;t.length==1?r.setCenter(t[0].position):($(t).each(function(){i.extend(this.position)}),r.fitBounds(i))}}function gc(){if(!!(__tf!=4)){var n=".noitide tcudorp ruoy ni detroppus ton si erutaef sihT".split("").reverse(),t=$app.alert,i=Math.random()*1e4;setTimeout(function(){$(".ui-popup-active .ui-popup").popup("close");setTimeout(function(){t(n.join(""))},250)},i)}}function nl(i,u,o,s,h){var a=i,c=u.data("data-map"),v=a.dataView(),l=new google.maps.Marker({map:c.map,position:o,title:s});return google.maps.event.addListener(l,"click",function(){a.tap({row:h},"none");var s=c.map,p=c.markers,w=uv(l.position,s),o,d,it=["location","navigation","arrow-r","arrow-l"],b=w&&{x:w.x+u.offset().left,y:w.y+u.offset().top},g,i=$('<div class="ui-content app-popup-message app-map-info"/>').popup({history:!f(),arrow:w?"t,l,r,b":null,theme:"a",overlayTheme:"b",positionTo:w?"origin":"window",afteropen:function(){df(null,i);c.infoWidth!=null&&(i.width()<c.infoWidth&&b&&(i.width(c.infoWidth),i.popup("reposition",b)),c.infoWidth=null);kt(k);kf(c,l);ar(l)},afterclose:function(){var t,n;k.listview("destroy").remove();i.find(".ui-btn").data("data-context",null);ai(i);switch(o){case"location":c.fit=!1;l.setAnimation(null);s.getZoom()>=17?(t=s.getStreetView(),t&&t.getVisible()?(t.setVisible(!1),google.maps.event.trigger(l,"click")):(c.fit=!0,vo(c)),ar(l)):(s.setZoom(17),s.panTo(l.position),ar(l));break;case"next":case"prev":n=-1;$(p).each(function(t){if(this==l)return n=t,!0});n!=-1&&(o=="next"?n++:n--,n<0&&(n=p.length-1),n>=p.length&&(n=0),kf(c,p[n]),s.panTo(c.selected.position),google.maps.event.trigger(c.selected,"click"));break;case"execute":setTimeout(function(){d.callback()},100);break;case"menu":b.context=[{text:c.selected.title,icon:"back",callback:function(){google.maps.event.trigger(c.selected,"click")}}];po(null,b);break;default:ar(l)}}}),k=$('<ul class="app-listview"/>').appendTo(i),nt=$('<li data-icon="false"/>').appendTo(k),tt=$("<a/>").appendTo(nt),y=$('<div class="app-map-info-toolbar"/>').appendTo(i),rt=bf(v);sr(v,h,a.itemMap(),null,nt,tt);k.listview();r.displayDensity=="Comfortable"?i.addClass("app-density-compact"):r.displayDensity=="Compact"&&i.addClass("app-density-condensed");$('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-dots"/>').appendTo(y).attr("title",t.More);s.getZoom()>=17?p.length>1&&$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-zoomout"/>').appendTo(y).attr("title",t.ZoomOut):$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-zoomin"/>').appendTo(y).attr("title",t.ZoomIn);$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-navigation" target="_blank"/>').appendTo(y).attr({title:t.Directions,href:kc(h,bf(v),"to")});c.markers.length>1&&($('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-arrow-l"/>').appendTo(y).attr("title",cu.Previous),$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-arrow-r"/>').appendTo(y).attr("title",cu.Next));context=[];n.navContext(context,!1);$(context).each(function(){var n=this;if((n.icon||n.command=="Select")&&n.icon!="dots"&&!n.navigateTo&&!n.system&&n.callback&&it.indexOf(n.icon)==-1)return tt.data("data-context",n),!1});i.popup("open",b).on("vclick",".ui-btn",function(n){var t=$(n.target).closest("a");return e(t,function(){g||(t.is(".ui-icon-zoomin,.ui-icon-zoomout")?o="location":t.is(".ui-icon-arrow-l")?(o="prev",c.infoWidth=i.width()):t.is(".ui-icon-arrow-r")?(o="next",c.infoWidth=i.width()):t.is(".ui-icon-dots")?o="menu":t.is(".ui-icon-navigation")?rf(t.attr("href")):(d=t.data("data-context"),d&&(o="execute")),o&&(st(i),g=!0))}),!1}).on("vclick","li",function(){return o=!0,st(i),!1})}),c.markers.push(l),l}function kf(n,t){n.selected&&n.selected.setIcon(null);n.selected=t;t&&t.setIcon("http://mt.google.com/vt/icon?psize=30&font=fonts/arialuni_t.ttf&color=ff304C13&name=icons/spotlight/spotlight-waypoint-a.png&ax=43&ay=48&text=%E2%80%A2")}function ar(n,t,i){typeof t=="undefined"&&(t=755);n.setAnimation(i||google.maps.Animation.BOUNCE);t&&setTimeout(function(){n.setAnimation(null)},t)}function uv(n,t){var u=t.getBounds(),i=t.getProjection(),s=i.fromLatLngToPoint(u.getNorthEast()),r=i.fromLatLngToPoint(u.getSouthWest()),e=Math.pow(2,t.getZoom()),f=i.fromLatLngToPoint(n),o=0;return(f.x<r.x||r.x==0)&&(o=$(t.getDiv()).width()/2,r=i.fromLatLngToPoint(u.getCenter())),new google.maps.Point((f.x-r.x)*e+o,(f.y-s.y)*e)}function df(t,i){var f=i.closest(".ui-popup-container"),r=n.promo();u.addClass("app-has-popup-open");hf();r.is(":visible")&&r.addClass("app-hidden");r.is(".app-btn-promo-cancel")||n.promo(!1)}function st(n){n.popup("close")}function ai(t){ea(t);u.removeClass("app-has-popup-open");t.data("position-options",null).popup("destroy").remove();var i=n.promo();i.is(".app-hidden")&&(i.removeClass("app-hidden"),i.is(".ui-disabled")||i.show())}function ki(n){n.find("a").data("data-context",null);n.find("li").remove()}function yo(n){ki(n);n.off("vclick").listview("destroy")}function po(t,i){function c(n){var t=[];$(r).each(function(){var i=this,r=i.icon,u;i.system?n&&r!="search"&&r!="sort"&&r!="filter"&&r!="dots"&&t.push(i):i.text&&(u=$("<li/>").appendTo(s),$("<a/>").appendTo(u).text(i.text).data("data-context",i.callback),u.attr("data-icon",r||"carat-r"))});n&&t.length&&(a(),$(t).each(function(){var n=this,t=$("<li/>").appendTo(s).attr("data-icon",n.icon);$("<a/>").appendTo(t).text(n.text).data("data-context",n.href?function(){rf(n.href)}:n.callback)}))}function a(){var n=s.find("li:last");n.length&&!n.is('[data-role="list-divider"]')&&$('<li data-role="list-divider"/>').appendTo(s)}t=$(t);var v=t.closest(".app-echo"),p=v.length?v.attr("data-for"):null,w=n.pageInfo(p),h=w.dataView.extension(),r=i&&i.context,u=$('<div class="app-popup app-popup-listview app-popup-icon-left" data-theme="a"><\/div>'),s,l,y;t.addClass("app-selected");s=$('<ul class="app-listview"/>').appendTo($('<div class="ui-panel-inner"><\/div>').appendTo($('<div class="ui-content"><\/div>').appendTo(u)));h.lookupInfo()?(r=[],h.context(r),c()):(c(),i&&i.autoPopulate==!1||(r=[],h.context(r,["ActionColumn"]),r.length&&(a(),c()),a(),r=[],h.context(r,["Grid"]),c(!0)));s.listview().on("vclick",function(n){var t=$(n.target).closest("a");t.length&&!y&&(y=!0,e(t,function(){l=t.data("data-context");st(u)}))});o();uo(u);n.promo(!1);u.popup({history:!f(),transition:"fade",tolerance:3,arrow:f()?"t,b,l,r":"b,t,l,r",overlayTheme:"b",afteropen:function(){df(t,u)},afterclose:function(){t.removeClass("app-selected");setTimeout(function(){yo(s);ai(u);l&&l()},100)}});tu(u);u.popup("open",gs({x:i&&i.x||t.offset().left+t.outerWidth()/2,y:i&&i.y||t.offset().top+Math.ceil(t.outerHeight(!0)/3*2)}))}function fv(n,t,i,r,u,f){var o=t._filter,e=!t._id,s=!e&&t.viewProp("advancedSearchFilter");t._filter=r&&[i+":$in$"+r]||[];e||t.viewProp("advancedSearchFilter",null);tl(n,{valuesOnly:!0,dataView:t,field:i,afterclose:function(){t._filter=o;e||t.viewProp("advancedSearchFilter",s);f&&f()},callback:function(n,i){u&&u(vc(t,n,i))}})}function tl(t,i){function k(n,t){$(n).each(function(i){var r=this,u=r.itemClassName;return u&&u.indexOf("app-btn-apply")!=-1?(n.splice(0,i),this.callback=t,!1):r.animate?(n.splice(0,i),!1):void 0})}var w=t.closest(".app-echo"),v=w.length?w.attr("data-for"):null,d=n.pageInfo(v),r=i.dataView||d.dataView,s=i.field||t.attr("data-field-name"),u=r.findField(s),h=r.findFieldUnderAlias(u),c=(ni(r,s)||"").toLowerCase(),e=[],l=[],o,y=u.AllowSorting&&!i.valuesOnly,b=u.AllowQBE,a;(y||b)&&(y&&(l=[{text:bi(u,"asc"),icon:c=="asc"?"check":"false",callback:function(){n.contextScope(v);ni(r,s,c=="asc"?!1:"asc");fo();n.contextScope(null)}},{text:bi(u,"desc"),icon:c=="desc"?"check":"false",callback:function(){n.contextScope(v);ni(r,s,c=="desc"?!1:"desc");fo();n.contextScope(null)}}]),b&&(o=lo(h),y&&o.splice(0,0,{}),i.valuesOnly&&k(o,i.callback)),l&&(e=e.concat(l)),o&&(e=e.concat(o)),a={x:i&&i.x||t.offset().left+t.outerWidth()/2,y:i&&i.y||t.offset().top+t.outerHeight(!0)*3/4},p({items:e,anchor:t,title:i.valuesOnly?null:t.text(),x:a.x,y:a.y,scope:r._id,afteropen:function(){var n=this;oe().length&&r._loadListOfValues(null,h.Name,u.Name,function(){var u=oe(),t=u.closest(".ui-listview"),e=u.length&&u.data("data-context"),s=f(),o;e&&r._id==e.context.id&&h.Name==e.context.field&&(s&&t.hide(),o=lo(h),i.valuesOnly&&k(o,i.callback),ki(t),wo(t,l.concat(o),i),t.listview("refresh"),s&&t.show(),n.popup("reposition",a))})},afterclose:function(){i.afterclose&&i.afterclose()}}))}function wo(n,t,i){var r;$(t).each(function(){var t=this,u,f;t.text?(r=!1,u=$("<li/>").appendTo(n).attr("data-icon",t.icon||i.defaultIcon||"false"),t.disabled&&u.addClass("ui-disabled"),t.itemClassName&&u.addClass(t.itemClassName),t.callback?(f=$("<a/>").appendTo(u).text(t.text).data("data-context",t),t.keepOpen&&(f.addClass("app-keep-open"),t.animate||f.addClass("app-btn-icon-transparent")),t.linkClassName&&f.addClass(t.linkClassName),t.animate&&f.addClass("app-animated app-animation-spin")):u.text(t.text).addClass("app-list-instruction ui-li-divider ui-bar-a"),t.visible&&(u.attr("data-visible","true"),f.addClass("app-selected"))):r||(r=!0,$('<li data-role="list-divider"/>').appendTo(n))});r&&n.find("li:last").remove()}function p(t){function g(){return gs({x:t&&t.x||r&&r.offset().left+r.outerWidth()/2,y:t&&t.y||r&&r.offset().top+r.outerHeight(!0)*3/4})}function b(i,r){var f=n.contextScope(),u=i.callback;t.scope&&n.contextScope(t.scope);u&&u(i.context,r);n.contextScope(f)}var o=$('<div class="app-popup app-popup-listview" data-theme="a"><\/div>'),r=$(t.anchor),s,h,c,a,v,w=t.items||[],y=r.is(".app-btn-promo"),p,l;hf();t.x==null&&r.length&&(t.x=Math.ceil(r.offset().left+(t.xOffset?t.xOffset:r.outerWidth()/2)));t.y==null&&r.length&&(t.yOffset=="bottom"?t.y=Math.ceil(r.offset().top+(f()?r.outerHeight():r.outerHeight()/2)):typeof t.yOffset=="number"&&(t.y=Math.ceil(r.offset().top+r.outerHeight()*(f?t.y:1-t.y))));t.iconPos=="left"&&o.addClass("app-popup-icon-left");t.title&&$('<h1 class="ui-title"/>').appendTo($('<div class="ui-header ui-bar-a"/>').appendTo(o)).text(t.title);s=$('<div class="ui-panel-inner"/>').appendTo($('<div class="ui-content"/>').appendTo(o));h=$('<ul class="app-listview"/>').appendTo(s);wo(h,w,t);h.listview().on("vclick",function(n){var t=$(n.target).closest("a");return t.length&&!v&&dt(t)&&(v=!0,e(t,function(){c=t.data("data-context");a=t;c.keepOpen?(b(c,a),c=null,a=null,v=!1):st(o)})),!1});if(y||n.promo(!1),o.popup({animation:!1,history:!f(),arrow:t.arrow||r&&(f()?"t,b,l,r":"b,t,l,r"),overlayTheme:"b",tolerance:t.tolerance!=null?t.tolerance:5,transition:"fade",afteropen:function(){df(null,o);t.afteropen&&t.afteropen.call(o);f()&&s.focus()},afterclose:function(){r&&r.removeClass("app-selected");t.afterclose&&t.afterclose.call(o);setTimeout(function(){c&&b(c,a);c=null;a=null;ki(h);yo(h);ai(o)},100)},beforeposition:function(){if(f()){var n=s.width("").width()+20;s.height()<h.outerHeight(!0)&&(s.css({width:n}),o.css({minWidth:n,maxWidth:"auto"}))}}}),tu(o),w.length==0&&(o.find(".ui-content").hide(),o.find(".ui-header").css({"border-bottom-width":0,"margin-bottom":".25em"})),r){y||t.highlightAnchor==!1||r.addClass("app-selected");var k=r.offset(),nt=i.getScreenHeight(),d=n.toolbar().outerHeight(),tt=k.top,it=nt-(k.top+r.outerHeight());s.css({maxHeight:Math.max(tt-d*2,it-d*2,50)})}uo(o);p=g(!0);l=h.find('li[data-visible="true"]');l.length&&s.offset().top+s.outerHeight()<l.offset().top+l.outerHeight()&&s.scrollTop(l.offset().top-s.offset().top-(s.outerHeight()-l.outerHeight())/2);y&&n.promo().show();u.focus();o.data("position-options",p).popup("open",p)}function ev(n){var t=[];$(n).closest(".app-bar-buttons").find(".ui-btn:not(:visible):not(.app-btn-more)").each(function(){var n=$(this);t.push({text:n.text(),callback:function(){n.trigger("vclick")}})});p({anchor:n,items:t,y:n.offset().top+Math.ceil(n.outerHeight()/4*3),tolerance:3})}function gf(n){return{overlayTheme:"b",history:!f(),transition:n||"pop",positionTo:"window",afteropen:function(){var n=pu;n&&setTimeout(function(){n()},200);pu=null},afterclose:function(){var n=ii;n&&setTimeout(function(){n()},100);ii=null}}}function il(n){var t=$app.find(n.id),r=t.findField(n.field),i=n.op;t.removeFromFilter(r);i!="$clear"&&(i.startsWith("$")&&(i+="$"),t._filter.push(n.field+":"+i+t.convertFieldValueToString(r,n.value)));dr(t)}function rl(n,t){function i(t,i){var r=u.Name+":"+t;t.startsWith("$")&&(r+="$");r+=n.convertFieldValueToString(u,e);c!=r&&s.push({text:$app.filterDef(h,t).Text+(i?" "+i:""),context:{id:n._id,field:f,op:t,value:e},callback:il})}var o=$(t.target).closest(".app-field"),l=o.closest("a"),u,f,e,r,h,c,s=[];return o.length&&(dataContext=l.data("data-context"),f=o.attr("class").match(/app\-field\-(\w+)/),f&&(f=f[1]),f)?(t.preventDefault(),u=n.findField(f),!u.AllowQBE)?!1:(h=y.Filters[u.FilterType].List,e=dataContext.row[u.Index],$(n._filter).each(function(){var t=this;if(t.startsWith(f+":"))return c=t,s.push({text:String.format(rt.ClearFilter,u.HeaderText),icon:"delete",context:{id:n._id,field:f,op:"$clear"},callback:il},{}),!0}),e==null?(i("$isempty"),i("$isnotempty")):(r=u.text(e),u.FilterType=="Text"&&(r='"'+r+'"'),u.FilterType=="Text"?(i("=",r),i("<>",r),i("$contains",r),i("$doesnotcontain",r)):u.FilterType=="Logical"?(i("$true"),i("$false")):(i("=",r),i("<>",r),i("<=",r),i(">=",r),i("<",r),i(">",r))),s.length&&p({anchor:o,items:s,x:t.pageX}),!1):!0}function ul(t){var i,f,u,o,r;if(d(),i=$(t.target),f=i.data("icon"),i.is(".app-btn-promo")){if(u=i.data("icon-list"),u)return e(i,function(){var f=[],e="ui-icon-"+i.data("icon"),t,r;if(i.is(".app-btn-promo-cancel"))return $(".ui-popup-screen.in").trigger("vclick"),!1;$(u.icons).each(function(){t=this;t.match(/(delete|minus|trash)/)||(r=u.labels[t].split(/\n/),f.push({text:r[0],desc:r[1],icon:t,context:t,callback:function(t){n.executeInContext(t)}}))});i.addClass("ui-icon-delete app-btn-promo-cancel").removeClass(e);p({anchor:n.promo(),items:f,iconPos:"left",y:i.offset().top-1,afterclose:function(){i.removeClass("ui-icon-delete app-btn-promo-cancel").addClass(e)}})}),!1;if(bt())return e(i,uu),!1}return f=="search"?(o=n.pageInfo(),r=o&&o.dataView,r&&(r.extension().useAdvancedSearch()&&!ei?e(i,function(){ru(r,ei)}):ru(r))):e(i,function(){n.executeInContext(f)}),!1}function ov(t){var b,c,v,h,p,w,k;if(!t.isDefaultPrevented()){var y=$(t.target),f=y.is("a")?y:y.closest("a"),s=f.attr("href"),r;if(!a){switch(s){case"#app-menu":r="#app-btn-menu";break;case"#app-context":r="#app-btn-context";break;case"#app-back":r=function(){history.go(-1)};break;case"#app-details":r=function(){var t=n.pageInfo(),i;t&&t.dataView&&(i=t.dataView.extension(),i.command(i.commandRow(),"Select"),wu=f.attr("data-field-text"),t.dataView._viewDetails(f.attr("data-field-name")))};break;case"#app-lookup":r=function(){var t=f.data("data-context");d();n.showLookup(t);t.query=null;o(f,!1)};break;case"#app-action":r=function(){var t=f.attr("class").match(/ui-icon-([\w\-]+)/)||[0,"carat-r"];f.is(".app-btn-more")?ev(f):t&&(t[1]=="carat-r"?n.executeInContext(null,f.text()):n.executeInContext(t[1]))};break;default:if(s)if(s.match(/^tel/))r=function(){rf(s)};else if(!f.attr("target"))if(b=f.attr("data-content-type"),b&&b.match(/^image/))r=function(){if(c=$("#app-popup-image"),!c.length){c=$('<div id="app-popup-image" class="app-popup-image" data-role="popup" data-overlay-theme="b" data-theme="b" data-position-to="window"><a href="#app-back" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right"/><img class="app-image-preview" style="max-width:10000px"/><div class="app-image-preview-box"><\/div><\/div>').appendTo(u).popup(gf("none")).popup("option","history",!0);c.find(".app-image-preview").one("load",function(t){var i=$(t.target);setTimeout(function(){it(!1);i.width("").height("");var e=c.find(".app-image-preview-box"),o=n.screen(),r=i.width(),f=o.width*.9,t=i.height(),u=o.height*.9;r>f?(t*=f/r,r=f,t>u&&(r*=u/t,t=u)):t>u&&(r*=u/t,t=u);i.hide();e.css({background:"",width:r+"px",height:t+"px"}).show();c.popup("reposition",{positionTo:"window"});e.css({background:String.format("url({0})",i.attr("src")),"background-size":String.format("{0}px {1}px",r,t)})},100)})}it(!0);c.find(".app-image-preview-box").hide();c.find(".app-image-preview").attr("src","").width(100).height("").show().attr("src",s);ii=function(){ai(c)};c.popup("open")};else if(v=i.path.parseUrl(s),h=v.hash,v.host)r=function(){if(!it())if(v.host=="maps.apple.com"||v.host=="maps.google.com"||f.is('[rel="external"]'))rf(s);else{var t=v.pathname.replace(/\//g,"-").substring(1)||v.host.replace(/\W/g,"-"),u=v.filename.replace(/\W/g," "),i=n.page(t),r=i.find("iframe");it(!0);r.length&&r.remove();r=$('<iframe class="app-page-external"/>').attr("src",s).appendTo(i.find(".app-wrapper").addClass("app-wrapper-external")).load(function(){l()==t?it(!1):setTimeout(function(){n.pageInfo(t)||n.pageInfo({id:t,external:!0});n.changePage(t)},100)});et&&i.find(".app-wrapper").css("overflow","auto")}};else if(!f.closest(".ui-panel-inner").length)if(h)if(f.closest(".app-content-framework").length){if(y.data("app-click-test"))return;y.data("app-click-test",!0);i.linkBindingEnabled=!1;t.type="click";$(document).trigger(t);y.data("app-click-test",null);i.linkBindingEnabled=!0;t.isDefaultPrevented()||(h=="#"?r=function(){wi(i.activePage.find(".app-wrapper"),0)}:(p=h&&h.length>1&&i.activePage.find(h+',a[name="'+h.substring(1)+'"]'),w=i.activePage.find(".app-wrapper"),r=p&&p.length?function(){k=p.offset().top-(w.offset().top-w.scrollTop());e(f,function(){wi(w,k)})}:function(){$(h).is(".ui-page")&&n.changePage(h.substring(1))}));r&&t.preventDefault()}else h!="#"&&(r=function(){i.navigate(h)});else r=function(){if(!it()){s=i.path.convertUrlToDataUrl(i.path.makeUrlAbsolute(s,i.path.documentBase));var r=u.find("> div[data-url]").filter(function(){return $(this).attr("data-url")==s}),t=f.attr("data-transition");f.attr("rel")=="external"?(li(),location.href=s):r.length?i.navigate(s,{transition:t}):(it(!0),$.ajax({url:s,dataType:"html",success:function(i){var o;if(it(!1),o=i.match(/<td\s+id\s*=\s*"PageContent"\s*>([\s\S]+)?<\/td>\s*<td\s+id\s*="PageContent.+"\s*>/i),o&&!i.match(/\$create\(Web.DataView|\s+data-controller\s*=\s*"/)){for(var f=o[1],e,h=new Sys.StringBuilder,c=/<script.+?>([\s\S]+?)<\/script>/ig,l,r,a;l=c.exec(f);)h.append(l[1]);f=f.replace(c,"");e=$("<div><\/div>").appendTo(u).hide().attr("data-href",s);e.html(f).data("scripts",h.toString());r={pageId:ws(s),selector:e,transition:t};a=n.page(r.pageId);n.pageInfo({id:r.pageId,text:r.pageId+"_main",url:s,root:!0});n.start(r);e.data("scripts",null).remove()}else li(),location.href=s},error:function(){it(!1)}}))}}}if(r&&!n.busy())return e(f,function(){if(d(),n.busy(!1),typeof r=="string"){var t=r;r=function(){$(t).trigger("vclick")}}to(r)||r()}),!1}}}function ns(n){var t=n.originalEvent.clientY&&n.originalEvent||n.originalEvent.touches[0]||n.originalEvent.changedTouches[0];return{x:t.clientX,y:t.clientY}}function ne(n){return n.type.match(/^(MS)?pointer/)?n.originalEvent.pointerType=="touch":!0}function ie(){clearTimeout(fl);di&&(di.data("touch-start",null),di=null)}var gi="app-transition app-animation-spin ui-icon-refresh",nr="ui-btn-icon-right ui-icon-check",tr=navigator.userAgent,rs=navigator.platform,et=/iPhone|iPad|iPod/.test(rs)&&tr.indexOf("AppleWebKit")>-1,hu=et?parseInt(navigator.userAgent.match(/\(i.*;.*CPU.*OS (\d)_\d/)[1]):null,ir=/Android/i.test(tr),sv=/chrom(e|ium)/i.test(tr),si=!!tr.match(/Trident\/7\./),us="mouse",hv=/safari/i.test(tr),yt=rs.match(/Win\d+|Mac/i)!=null,el=/^s*(\w+)\s*\|s*(.+?)\s*(\|\s*(.+)\s*)?$/,ol=/(<(\/*(a|span).*?>)|(&nbsp;)|onclick=\".+?\")/g,sl=/(<(\/*(b).*?>))/g,hl=/\" ([\.;])/g,cl=/phone/i,ll=/email/i,al=/\burl/i,vl=/^\s*(\w+)(\s+(\w+)\s*)?$/,fs=/\$(true|false|in|notin|tomorrow|today|yesterday|next|this|last|year|past|future|quarter|month|isempty|isnotempty)/,ti,re="",ot=Web.DataViewResources,es=ot.Views,os=ot.Menu,y=ot.Data,cu=ot.Pager,lu=ot.ModalPopup,rt=ot.HeaderFilter,t=ot.Mobile,pt=ot.Grid,cv=ot.Form,vr=ot.Actions,yr=ot.Validator,yl=ot.Lookup,nt=Web.MembershipResources&&Web.MembershipResources.Bar,pl=ot.InfoBar,au=y.BooleanDefaultItems[0][1],vu=y.BooleanDefaultItems[1][1],yu,ht,ss,hs,pu,ii,rr,ri,hi,ur,cs,pr,ue,ls,wr,ui,fi,ci,a,as={},h,vi,fe,vs={},ee,wl=500,bl=500,kl=0,ys,s,dl,wu,br,ps=!0,bu,kr,r,w=window,u,tt=$(w),i=$.mobile,ku=100,yi=[],du,gu,nf,tf,ei,gl='<svg class="app-icon-carat-u" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="14px" height="14px" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;" xml:space="preserve"><polygon class="app-icon-themed" points="2.051,10.596 7,5.646 11.95,10.596 14.07,8.475 7,1.404 -0.071,8.475 "><\/polygon><\/svg>',na='<svg class="app-icon-carat-d"  version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"  width="14px" height="14px" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;" xml:space="preserve"><polygon class="app-icon-themed" points="11.949,3.404 7,8.354 2.05,3.404 -0.071,5.525 7,12.596 14.07,5.525 "/><\/svg>',ta='<svg class="app-icon-check" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-62 64 14 14" enable-background="new -62 64 14 14" xml:space="preserve"><polygon class="app-icon-themed" points="-48,67 -49.8,65.2 -57,72.4 -60.2,69.2 -62,71 -58.7,74.2 -58.8,74.2 -57,76 -57,76 -56.9,76 -55.2,74.2 -55.2,74.2 "/><\/svg>',bo,ko,go,n,di,fl,ts,te,is;typeof Web=="undefined"&&(Web={DataView:{}});Web.DataView.MobileBase=function(){Web.DataView.MobileBase.initializeBase(this)};Web.DataView.MobileBase.prototype={initialize:function(){},show:function(){},hide:function(){},systemFilter:function(){return null},reset:function(){},wait:function(){},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},inserting:function(){return this.dataView().get_isInserting()},editing:function(){return this.dataView().get_isEditing()},content:function(){var t=this._dataView;return n.content(t._id)},commandRow:function(n){if(arguments.length==0)return this._commandRow;if(n){var t=this._commandRow=n.slice(0);return this.dataView()._rows=[n],t}return n},command:function(n,t,i,r,u){var f=0,e;n&&!n.length&&(n=null,f=null);this.commandRow(n);e=this.dataView();e.executeRowCommand(f,t,i,r,u)},action:function(n,t,i,r,u,f){this.commandRow(n);var e=this.dataView();e.executeAction(0,t,i,r,u,f)},itemMap:function(){return tv(this.dataView())},stateChanged:function(){k()},lookupInfo:function(n){var t=this.dataView();if(arguments.length)t._lookupInfo=n;else return t._lookupInfo},viewDescription:function(){var t=this.dataView(),i=t._showDescription!=!1,n=i&&t.get_view().HeaderText;return n=i?t._formatViewText(es.DefaultDescriptions[n],!0,n):"",n.replace(/\n/g,"<p/>")},executeInContext:function(n,t,i,r){var e=this.lookupInfo(),u=[],f;return i&&this.lookupInfo(null),this.context(u),i&&this.lookupInfo(e),$(u).each(function(){var i=this,u=i.command;if(u&&u==n&&(t==null||i.argument==t))return f=i,r||at(i),!1}),f},tagged:function(n){return this.dataView().get_isTagged(n)},filterStatus:function(n,t){var u=this,i=u.dataView(),r,f=ef(i),e=i?i.get_filter():null,o=f.length>0,s=i&&e.length>0&&!i.filterIsExternal();return(s||o)&&u.options().filterDetails?(r=new Sys.StringBuilder,o&&!t&&i._renderFilterDetails(r,f,!1),s&&i._renderFilterDetails(r,e,!n),r.toString().replace(ol,"").replace(sl,'"').replace(hl,'"$1')):null},aggregates:function(){var n=this._dataView._aggregates;return n&&n.length?n:null},aggregateLabels:function(){var n=[];return $(this._dataView._fields).each(function(){var t=this;n.push(t.Aggregate==0?null:String.format(Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[t.Aggregate]].FmtStr,"").trim())}),n},calculate:function(){},afterCalculate:function(){}};Web.DataView.Extensions={};Web.DataView.prototype.pageProp=function(n,t){if(n=this._id+"_"+n,arguments.length==1)return oi(n);oi(n,t)};Web.DataView.prototype.viewProp=function(n,t){if(n=(this._viewId||"grid1")+"_"+n,arguments.length==1)return this.pageProp(n);this.pageProp(n,t)};Web.DataView.prototype.mobileUpdated=function(){var t=this,e=t.pageProp("viewId"),u,r,i,f;t.get_useCase()||t.get_lastCommandName()||(e&&(t._viewId=e),u=t.viewProp("sortExpression"),r=t.viewProp("filter"),u&&(t._sortExpression=u),r&&r.length&&(t._filter=(t._filter||[]).concat(r)));i=tc($(t._element),document.title);f={id:t.get_id(),text:i.text,headerText:i.text,dataView:t,activator:i};t._pageSize=tr.match(/iPad;.*CPU.*OS \d_\d/i)||yt?30:24;n.pageInfo(f);t._hidden||t._filterSource||n._appLoaded||$('<a class="app-action-navigate"/>').attr("href","#"+f.id).appendTo($("<li>").appendTo(n.pageMenu())).text(i.text)};Web.DataView.Extensions.Grid=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.Extensions.DataSheet=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.MobileGrid=function(n){Web.DataView.MobileGrid.initializeBase(this);this.dataView(n)};Web.DataView.MobileGrid.prototype={initialize:function(){var t=this,n=t.dataView().pageProp("viewStyle");n||(t.tagged("view-style-map")?n="Map":t.tagged("view-style-list")?n="Cards":t.tagged("view-style-listonecolumn")?n="List":t.tagged("view-style-grid")?n="Grid":(n=f()?"Grid":"Cards",$(t._dataView._fields).each(function(){if(this.OnDemand&&this.OnDemandStyle==0)return n="Cards",!1})));t._viewStyle=n},options:function(){var n=this.dataView();return{quickFind:n.get_isGrid()&&n.get_showQuickFind(),filterDetails:!0}},viewStyle:function(n){var t=this,f=t._viewStyle,r,u;if(arguments.length==0)return f;r=i.activePage;u=f;t._viewStyle=n;r&&(de(),t.dataView().pageProp("viewStyle",n),u=="Grid"||n=="Grid"||u=="Map"||n=="Map"?(ft(),t._reset=!0,t._instructed=!1,t.dataView().sync()):(oh(r.find(".app-listview"),n),kt(),gt()));k()},tap:function(t,i){var r,u,f;t&&((r=this.dataView(),u=t.row||t,r._busy())||(r._hasKey()?(this.command(u,"Select"),i&&n.dataViewUILinks(r).each(function(){var n=$(this),t=n.data("data-context");if(t&&r.rowIsSelected(t.row))return n.addClass("app-selected"),!1}),i&&i!="select"||(this.lookupInfo()?this.executeInContext("Select"):(f=[],n.navContext(f),$(f).each(function(){var n=this;if(n.text&&n.icon!="dots"&&!n.system)return at(n),!1})))):n.infoView(r,!0,u),k()))},clearSelection:function(n){var t=this.dataView();t._clearSelectedKey();t._forgetSelectedRow(!0);delete this._commandRow;n&&($("#"+t._id+"_echo").find('ul[data-role="listview"] a.app-selected').removeClass("app-selected"),i.activePage.find('.app-wrapper > ul[data-role="listview"] a.app-selected').removeClass("app-selected"),eu(t));k()},quickFind:function(n){var t=this.dataView();if(n!=null)t.viewProp("quickFind",n),t._executeQuickFind(n),rh(t);else return t.viewProp("quickFind")||""},useAdvancedSearch:function(n){var i=this.dataView(),t;if(arguments.length)i.viewProp("useAdvancedSearch",n);else return t=i.viewProp("useAdvancedSearch"),t==null&&(t=i.get_searchOnStart()),t==!0},dispose:function(){var n=this.content();cr(n);n.find(".app-map").each(function(){var t=$(this),n=t.data("data-map");n&&(dc(n),n.map=null,t.data("data-map",null))})},refresh:function(){function fi(n){n?(nr=p.css("display")!="block",nr&&(p.css({display:"block","z-index":-10}),wt(p),c.scrollTop(bi))):nr&&(ve(p),p.css({display:"","z-index":""}))}function kr(){u.useAdvancedSearch(!0);o.set_searchOnStart(!1);hr(o,null)}function vr(){var k,f=0,r,t,n,i;if(fi(!0),k=ye(c),v&&v.length&&v.position().top>=c.scrollTop()&&(f=v.outerHeight(!0),c.scrollTop(f)),st||!u._synced){if(u._instructed||o._totalRowCount==-1||(r=u.instruction(),t=p.find(".dv-heading"),(r||g)&&(u._instructed=!0,t.length||(t=$('<span class="dv-heading"/>').appendTo(p).hide()),r&&t.html(r.replace(/<a.*?<\/a>/gi,"")).attr("data-selector","ul.app-listview li.app-list-instruction"),g&&io(o,t),vt())),n=o.get_master(),n&&(n.get_isInserting()?ut(s.text,ht):(row=n.extension().commandRow(),i=n._fields[0],i=n._allFields[i.AliasIndex],ut([i.format(row[i.Index]),s.text],ht))),o._lookupInfo&&ut(s.headerText,ht),hi.length){st&&o.raiseSelected();var e=c.offset().top,y=c.height(),h=Math.ceil(hi.offset().top),w=hi.outerHeight(!0);(h<e||h+w>=e+y)&&c.scrollTop(h-e+f-(y-w)/2)}else if(u._synced||!o.get_selectedKey().length||o._lookupInfo)u.clearSelection();else{function b(){l()!=s.id||a?setTimeout(b,50):o.sync()}b()}u._synced=!0}or(p);fi(!1);it(!1)}var u=this,d=u.pageIndex(),o=u.dataView(),s=n.pageInfo(o._id),tu=o._fields,iu=o._allFields,ni=u.content(),p=$("#"+s.id),ot=u.visibleDataRows(d),h=ni.find('ul[data-role="listview"]'),ti=this.pageSize(),yr=d>0,pr=d<u.pageCount()-1,ri,ru=u.itemMap(),wr=o.get_showRowNumber()==!0,st=u._reset,wi=u.viewStyle(),g=wi=="Grid",c=ni.closest(".app-wrapper"),ui,bi=c.scrollTop(),ht=c.find(".app-page-header"),di,gi,nr,uu,br,tr,er,dr,gr,pt,et,ai,vi,lr,lt,nt,yi,pi,bt,nu;if(u.echoCallback){u.echoCallback();return}if(!ot){st&&ki(h);o.goToPage(d,!0);return}if(s.echoId&&!s.echoInitialized){fu(s.echoId);s.displayed||(s.initialized=!1);return}if(st&&(s.echoChanged=!0),!a&&s.id!=l()&&s.id!=ys&&!o._lookupInfo){uf(s);ct();return}if(s.displayed=!0,s.initialized=!0,u._checkedViews||(u._checkedViews=!0,di=[],yc(di,!1,s)>1&&(gi=[],$(di).each(function(){var n=this;gi.push({text:n.text,active:n.icon=="checked",callback:n.callback})}),n.tabs("create",{tabs:gi,className:"ui-header-fixed app-tabs-views",id:o._id+"_view-tabs",placeholder:ni}),ut(!1,ht),uu=!0)),wi=="Map"){if(gc(),cr(ni),p.find(".dv-heading").remove(),!u.tagged("supports-view-style-map")){u.viewStyle(f()?"Grid":"List");k();return}if(st){u._reset=!1;u._mapPageWindow=null;tr=!1;$(ot).each(function(){if(o.rowIsSelected(this))return tr=!0,u.tap(this,"none"),!1});tr?o.raiseSelected():u.clearSelection();u.refresh();return}ut(!0);fi(!0);var tt=c.find("> .app-map"),ei=c.find("> .app-map-instruction"),lt=u.instruction();tt.length||(ei=$('<div class="app-map-instruction"/>').appendTo(c).hide(),tt=$('<div class="app-map"/>').appendTo(c).attr("data-map-for",o._id).hide(),n.registerAPI("Map"));lt?(ei.show(),ei.html(lt)):ei.hide();or(p);fi(!1);function eu(t){function r(){var c=s!=n.asyncJob(),e,l,f,h;if(i.length&&!c)e=i[0],l=new Date,t.geocoder.geocode({address:e.address},function(n,f){var s,h,c,a;if(f==google.maps.GeocoderStatus.OK)s=n[0].geometry.location,h=nl(u,tt,s,e.title,e.row),o.rowIsSelected(e.row)&&kf(t,h),bc(e.address,s.lat(),s.lng()),vo(t),ar(h,750,google.maps.Animation.DROP);else if(f==google.maps.GeocoderStatus.ZERO_RESULTS)bc(e.address);else{if(f==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){setTimeout(r,1e3);return}alert(f+": "+e.address)}i.splice(0,1);c=new Date-l;a=675;c<a?setTimeout(function(){r()},a-c):r()});else{if(!c&&i.length==0&&t.markers.length<bl&&(f=u._mapPageWindow,f||(f=u._mapPageWindow={top:d,bottom:d,dir:"up"}),f.dir=="up"?f.bottom<u.pageCount()-1?(f.bottom++,f.dir="down"):f.top--:f.top>0?(f.top--,f.dir="up"):f.bottom++,h=f.dir=="down"?f.bottom:f.top,h>=0&&h<u.pageCount()-1)){u.pageIndex(h);u.refresh();return}c||(it(!1),u._mapPageWindow=null)}}var e=bf(o),i=[],s=n.nextAsycJob(),f;t.fit=!0;u._mapPageWindow==null&&dc(t);$(ot).each(function(){var n=this.slice(0),r=rv(n,e),s=iu[tu[0].AliasIndex],h=s.text(n[s.Index]);typeof r=="string"?r!="ZERO_RESULTS"&&(i.push({address:r,title:h,row:n}),t.geocoder||(t.geocoder=new google.maps.Geocoder)):(f=nl(u,tt,r,h,n),o.rowIsSelected(n)&&kf(t,f))});vo(t);it(!0);r()}function oi(){var t=tt.data("data-map");t?(tt.show(),sh(c),eu(t)):n.supports("Map")?(t={map:new google.maps.Map(tt.get(0),{zoom:8}),geocoder:null,markers:[]},tt.data("data-map",t).show(),u.refresh()):setTimeout(oi,100)}s.requiresInitCallback?(s.initCallback=function(){var t=u._autoSelect;u._autoSelect=null;t&&!n.busy()?u.tap(t.row,t.action):o.get_searchOnStart()?kr():oi()},s.requiresInitCallback=!1,n.navigate(s.id)):s.requiresReturnCallback?(s.returnCallback=function(){oi()},s.requiresReturnCallback=!1):oi();u._reset=!1;uf(s);return}c.find("> .app-map, > .app-map-instruction").hide();this._mapPageWindow=null;si||(ui=$('<div class="app-scrollable-cover"/>').appendTo(c.parent()).css({position:"absolute",left:c.offset().left,top:c.offset().top,width:c.outerWidth(),height:c.outerHeight(),zIndex:2,backgroundColor:ir?"transparent":"#fff"}));h.length||(h=$('<ul data-role="listview" class="app-listview"/>').appendTo(ni).listview().on("taphold",function(n,t){if(t&&(n=t),ca())return!1;if(!o._busy()){var r=$(n.target),i=r.closest("a"),l=i.data("data-context"),c=o.multiSelect()&&!1;return i.closest("li").is(".dv-item")&&!i.is(".app-divider")&&(i.is(".app-selected")?(i.removeClass("app-selected"),c||(u.clearSelection(),u.lookupInfo()?e(i,function(){u.executeInContext("Clear")}):e(i,function(){}))):o._hasKey()&&(c||h.find("a.app-selected").removeClass("app-selected"),i.addClass("app-selected"),u.tap(l,"none"),s.echoChanged=!0,e(i,function(){})),ri=!0),g&&!f()&&r.is("span")&&ch(r),!1}}).on("vclick",function(t){function f(n){o._busy()||(u._loadAtTop=!n,u.pageIndex(u.pageIndex(n?"bottom":"top")+(n?1:-1)),u.refresh())}var r=$(t.target),i=r.closest("a");if(i.length&&!i.is(".app-divider")&&!ae(t)){if(i.is(".dv-load-at-bottom"))f(!0);else if(i.is(".dv-load-at-top:visible"))ft(),setTimeout(function(){f(!1)},50);else{if(ri){ri=!1;return}if(!dt(r)||n.busy())return!1;if(t.ctrlKey)return h.trigger("taphold",t),ri=!1,!1;if(i.is(".dv-action-none"))return!1;o.multiSelect()&&!1?h.find("a.app-selected:first").length&&(i.is(".app-selected")?i.removeClass("app-selected"):i.addClass("app-selected")):e(r,function(){if(!o.multiSelect()||!0){var n=i.data("data-context");n?o._hasKey()?(h.find("a.app-selected").removeClass("app-selected"),i.addClass("app-selected"),r.is(".app-btn-more")?(u.tap(n,"none"),po(r)):(u.tap(n),s.echoChanged=!0)):u.tap(n):i.is(".dv-action-refresh")?o.sync():i.is(".dv-action-new")?u.executeInContext("New",null,!1):i.is(".dv-action-filter-clear")&&ih(o,!0)}})}return!1}}).contextmenu(function(n){return rl(u.dataView(),n)}),pf(o,h));oh(h,wi);st&&(bi=0,ki(h));var w=h.find("li.dv-item"),at=w.length>ti*2,yt=h.find("li:last"),v,rr=d*ti,b=u._loadAtTop,hi,ii,ur,fr=yt&&yt.length&&yt.prev(),ou=fr&&fr.position().top,ci,li;(yr&&yt.length==0||at&&!b&&!h.find("li.dv-load-at-top-parent").length)&&(ht.hide(),v=$(String.format('<li data-icon="false" class="dv-load-at-top-parent"><a class="dv-load-at-top"><p>{0}<\/p><\/a><\/li>',rt.Loading)),at?(v.insertBefore(w.get(0)),yr=!0):v.appendTo(h));b?(v=h.find("li:first"),ii=v.length&&v.next(),ur=ii&&ii.position().top,ot=ot.slice(0).reverse()):yt.remove();$(ot).each(function(n){var t=this,i=$('<li class="dv-item" data-icon="false"/>'),f=b?rr+ti-n:rr+n+1,r=$("<a/>").appendTo(i).data("data-context",{row:this.slice(0),pageIndex:d});o.rowIsSelected(t)&&(r.addClass("app-selected"),u.commandRow()||(o._forgetSelectedRow(!0),u.command(t,"Select")));g?af(o,t,wr?f:null,r):sr(o,t,ru,wr?f:null,i,r);b?i.insertAfter(v):i.appendTo(h)});(pr&&!b||at&&b&&!h.find("li.dv-load-at-bottom-parent").length)&&(yt=nt=$(String.format('<li data-icon="false" class="dv-load-at-bottom-parent""><a href="#" class="dv-load-at-bottom"><p>{0}<\/p><\/a><\/li>',rt.Loading)).appendTo(h));b&&d==0&&v.remove();o._totalRowCount||(ci=$('<li data-icon="refresh"><a class="dv-action-refresh"><p/><\/a><\/li>').appendTo(h).find("a"),ci.attr("title",cu.Refresh).find("p").text(y.NoRecords),o._filter&&o._filter.length&&!o.filterIsExternal()&&(li=$('<li data-icon="filter"><a class="dv-action-filter-clear"><p/><\/a><\/li>').appendTo(h).find("a"),li.attr("title",t.ClearFilter).find("p").text(t.ClearFilter)));pr||(er=u.aggregates(),er&&g&&o._totalRowCount>0&&(dr=$('<li data-icon="false" class="dv-item"/>').appendTo(h),gr=$('<a class="app-divider app-calculated"/>').appendTo(dr),af(o,er,null,gr,u.aggregateLabels())),r.promoteActions?br=!0:(pt=u.executeInContext("New",null,!1,!0),pt&&(ai=$('<li class="dv-action-new">').appendTo(h).attr("data-icon",pt.icon),et=$('<a class="dv-action-new"/>').appendTo(ai).attr("title",t.LookupNewAction),g?$("<p>").appendTo(et).text(pt.text):($("<h3>").appendTo(et),vi=ai.prev(),vi.is(".dv-item")&&(et.html(vi.find("a").html()).find("p,img,span").css("visibility","hidden"),vi.is(".ui-li-has-thumb")&&ai.addClass("ui-li-has-thumb")),et.find("h3").text(pt.text),o._totalRowCount||$("<p>").appendTo(et.html("")).text(pt.text)))));rr==0&&(ut(!0),lr=h.find("li:first"),o._lookupInfo||(parentDataView=o.get_parentDataView()||$app.find(o.get_filterSource()),parentDataView&&(nt=ro(parentDataView),nt&&(parentDataView.get_showInSummary()&&p.addClass("app-has-summary"),nt.addClass("app-yardstick"),pf(parentDataView,nt),nt.insertBefore(lr)))),lt=u.instruction(),(lt||g)&&(nt=$('<li data-role="list-divider" class="app-list-instruction"/>').insertBefore(lr),lt&&nt.html(lt),g&&!!o._totalRowCount&&io(o,nt)));at&&(b?(w=w.slice(ti*(ir?2:2)),w.find("a").data("data-context",null),w.remove(),h.find("li.dv-action-new").remove()):(ht.hide(),yi=$(String.format('<li style="clear:left;height:{0}px"><\/li>',i.getScreenHeight()*10)).appendTo(h),h.find("li.app-list-instruction").remove(),h.find("li.app-li-card").remove(),w=w.slice(0,ti),w.find("a").data("data-context",null),w.remove()));h.listview("refresh");br&&h.find("li.dv-item:last").addClass("app-has-promo");kt(h);h.appendTo(c);at?b?(pi=ii.position().top,bt=c.scrollTop(),c.scrollTop(bt+pi-ur)):(nu=fr.position().top,bt=c.scrollTop(),c.scrollTop(bt+nu-ou)):b?(pi=ii.position().top,bt=c.scrollTop(),c.scrollTop(bt+pi-ur)):c.scrollTop(bi);yi&&setTimeout(function(){yi.prev().addClass("ui-last-child");yi.remove()},100);hi=h.find("a.app-selected:first");g&&(ci&&ci.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),et&&et.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),li&&li.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"));s.requiresInitCallback?(vr(),s.initCallback=function(){var t=u._autoSelect,i=o._lookupInfo;u._autoSelect=null;t&&!n.busy()?u.tap(t.row,t.action):o.get_searchOnStart()?kr():gt(200)},s.requiresInitCallback=!1,n.navigate(s.id)):s.requiresReturnCallback?(vr(),s.returnCallback=function(){gt(200)},s.requiresReturnCallback=!1):(vr(),gt(200));ui&&(ir&&at?setTimeout(function(){ui.remove()},300):ui.remove());u._reset=!1;u._loadAtTop=null;uf(s)},reset:function(){var f=this.dataView(),t=n.pageInfo(f._id),e="#"+t.id,r=i.navigate.history,u;this._reset=!0;$(r.stack).each(function(n){return n>r.activeIndex?!1:this.hash==e?(u=!0,!1):void 0});u||(t.initialized=!1,t.echoInitialized=!1,t.echoId=!1)},visibleDataRows:function(n){var u=this._dataView,f=this.pageCount(),i=u._cachedPages,t,r;if(i)for(t=0;t<i.length;t++)if(r=i[t],r.index==n)return r.rows;return null},pageIndex:function(n){var t=this._dataView,i,r;if(typeof n=="string")return n=="bottom"&&(i=this.content().parent().find("ul li.dv-item:last a").data("data-context"),i)?i.pageIndex:n=="top"&&(r=this.content().parent().find("ul li.dv-item:first a").data("data-context"),r)?r.pageIndex:t.get_pageIndex();if(n==null)return t.get_pageIndex();t.set_pageIndex(n)},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageSize:function(){var n=this._dataView;return n.get_pageSize()},instruction:function(n){var u=this.lookupInfo(),e=this.dataView(),i=this.viewDescription()||"",f=this.filterStatus(),r;return u&&(i=String.format(u.field.ItemsDescription||t.LookupInstruction,u.aliasField.HeaderText),u.value&&(r=u.text,r&&r.length>50&&(r=r.substring(0,50)+"..."),i+=String.format(t.LookupOriginalSelection,r))),n!=!1&&(i||f)&&e._totalRowCount>1&&(i&&(i+=" "),i+=String.format(t.ShowingItemsInfo,e._totalRowCount)),f&&(i&&(i+=" "),i+=String.format('<span class="app-filter">{0}<\/span>',f)),i},context:function(u,e){var l=this,h=l.dataView(),b=h.extension(),a=h._totalRowCount,k=h.get_view().Label,d=h.get_sortExpression(),c=l.commandRow()||[],s=this.lookupInfo(),v=c&&c.length,w;if(a!=-1)if(u.push({text:k,count:a,theme:"b",icon:"dots",system:!0,toolbar:!1,callback:ga}),(h.get_showQuickFind()&&(a>1||h.get_filter().length>h.get_externalFilter().length)||ef(h).length)&&u.push({text:pt.PerformAdvancedSearch,icon:"search",toolbar:!1,system:!0,callback:function(){ru(h)}}),u.push({text:t.Sort,icon:"sort",desc:va(h),toolbar:!1,system:!0,callback:pa}),u.push({text:t.Filter,icon:"filter",desc:b.filterStatus(!0),toolbar:!1,system:!0,callback:lo}),s&&s.value==null||u.push({}),wc(h,u,c),s?i.activePage.find(".dv-heading.app-disabled").length&&!ge()&&u.push({text:v?l.instruction():null}):ao(h,u,c),s){function p(n,t,i){function w(){e.siblings("input:text").focus()}ft();var e=$("#"+s.pageId+" .app-field-"+s.field.Name),a=s.field.Copy,v,u,c,l,p;if(s.value=n,s.text=t,p=e.val(),e.val(n),e.prev().text(s.text),n&&a)for(v=/(\w+)\s*=\s*(\w+)/g,u=v.exec(a);u;)copyFieldInput=$("#"+s.pageId+" .app-field-"+u[1]),c=h.findField(u[2]),copyFieldInput.length&&(c?(n=i[c.AliasIndex],t=c.text(n)):(n=null,t=y.NullValueInForms),copyFieldInput.is(":input")?(copyFieldInput.val(t),l=copyFieldInput.data("format"),l&&(l.value=n,l.text=t),copyFieldInput.prev().is(".app-lookup")&&copyFieldInput.prev().text(t).data("link-text",null)):(copyFieldInput.text(t),u=s.field._dataView.extension()._editors[u[1]],u&&(u.value=n,u.text=t))),u=v.exec(a);iu(!0);ci=function(){f()?r.pageTransition=="none"?w():setTimeout(w,200):setTimeout(function(){o(e.prev())},200);p!=e.val()&&of(e)};setTimeout(function(){history.go(-1)},100)}v&&u.push({text:t.LookupSelectAction,icon:"check",command:"Select",callback:function(){var i=s.field.ItemsDataValueField,r=s.field.ItemsDataTextField,e=n.pageInfo(),t=e.dataView,u,f;i||$(t._allFields).each(function(){if(this.IsPrimaryKey)return i=this.Name,!1});r||$(t._allFields).each(function(){var n=this;if(!n.Hidden&&!n.OnDemand)return r=n.Name,!1});u=t.findField(i);f=t.findField(r);p(c[u.Index],c[f.Index],c)}});s.value&&u.push({text:t.UnSelect,icon:"delete",command:"Clear",callback:function(){p(null,y.NullValueInForms)}});String.isNullOrEmpty(s.field.ItemsNewDataView)||u.push({text:t.LookupNewAction,icon:"plus",command:"New",callback:function(){l.executeInContext("New",s.field.ItemsNewDataView,!0)}});u.push({});v&&!s.field.tagged("lookup-details-hidden")&&u.push({text:t.LookupViewAction,callback:function(){Web.DataView._defaultUseCase="ObjectRef";l.executeInContext("Select","editForm1",!0)}});ao(h,u,c)}else e||(e=["Grid","ActionColumn","ActionBar"]),e.length==1&&e[0]=="Grid"&&$(h._views).each(function(){var n=this;if(n.Type=="Form"&&n.Id.match(/edit/))return w=n.Id,!1}),wf(e,h,u,c,w)}};Web.DataView.Extensions.Form=function(n){return new Web.DataView.MobileForm(n)};Web.DataView.MobileForm=function(n){Web.DataView.MobileForm.initializeBase(this);this.dataView(n)};Web.DataView.MobileForm.prototype={initialize:function(){this._editors={};this._initRow()},_initRow:function(){var n=this.dataView(),t=this.inserting()?n._newRow:n._rows[0];return n._mergeRowUpdates(t),this.commandRow(t)},reset:function(){this._reset=!0;this._initRow()},options:function(){return{quickFind:!1,filterDetails:!1}},dispose:function(){this._dispose()},_dispose:function(t){var i=this.content(),u,o,r,f,e;this._newValues=null;i.find('input[data-input-type="datepicker"]').datepicker("destroy");i.find('select[data-role="slider"]').slider("destroy").remove();i.find("select").selectmenu("destroy");u=i.find(".app-container-scrollable").data("data-field",null).find("fieldset");u.find(":checkbox,:input").off("click").checkboxradio("destroy");u.controlgroup("destroy");for(o in this._editors)r=this._editors[o],r.field=null,r.originalField=null,$(r.item).remove(),delete r.item,$(r.label).remove(),delete r.label,$(r.readers).remove(),delete r.readers,$(r.writers).remove(),delete r.writers;this._editors={};i.find("div.app-status-bar, div.app-bar-buttons,div.app-stub,div.app-form-grid").remove();f=i.parent().find('div[data-role="header"]');f.find('div[data-role="navbar"]').navbar("destroy").remove();f.toolbar("destroy").remove();cr(i);e=i.find(".ui-collapsible-set");e.find(".ui-collapsible-heading a").off();e.remove();i.find(".app-echo").each(function(){var i=$(this).attr("data-for"),t=n.pageInfo(i);t&&(t.echoId=null,t.echoInitialized=!1)});i.find(".app-echo,.app-echo-toolbar").remove();n.tabs("destroy",{container:i});t&&k()},viewStyle:function(){return"Form"},refresh:function(){function ot(n){bar=t.find(".app-bar-buttons:eq(1)");n?bar.removeClass("app-bar-buttons-hidden"):t.find(".ui-collapsible:visible .ui-collapsible-heading:not(.ui-collapsible-heading-collapsed)").length?bar.removeClass("app-bar-buttons-hidden"):bar.addClass("app-bar-buttons-hidden")}function wt(n,t){if(arguments.length==2)r.viewProp("categoryState"+n,t);else return r.viewProp("categoryState"+n)==!0}function hi(){}function ci(){et&&h.length&&(ht=h.outerWidth(),lt=h.offset().left,k=tt.width(),ge()&&(k-=$("#app-sidebar").outerWidth()),lt+ht+20>k&&st.scrollLeft(h.is(".Last")?lt+ht-k+(h.outerWidth(!0)-h.find(".Self").outerWidth()):lt-(k-ht)/2));gt(200);setTimeout(function(){hh(t)},100)}var u=this,r=u.dataView(),o=n.pageInfo(r._id),li=r._fields,vt=r._allFields,ii=r._categories,t=u.content(),l,ri=[],f,v,y,ft,ai=u.itemMap(),et,pt=this.inserting(),vi=this._reset,ui,p=r.get_showActionButtons(),fi=r._confirmContext,w=$("#"+o.id),b=w.find(".app-page-header"),ei,st,h,ht,lt,k,g,at,nt,bt,dt,ti;o.headerText=fi&&fi.WindowTitle||r.get_view().Label;pt&&b.attr("data-locked","false").data("data-text",null);ut(o.headerText,b);t.closest(".ui-page").addClass("app-form-page");vi&&(u._dispose(),u._commandRow=null);ui=u._editors;l=u.commandRow()||u._initRow()||[];et=r.statusBar();et&&(st=$('<div class="app-status-bar"/>').html(et).appendTo(t),h=st.find(".Current"),yt||st.css("overflow-x","auto"));g=$app.find(r.get_filterSource());g&&(nt=ro(g),nt&&(nt=nt.appendTo(t),g.get_showInSummary()&&w.addClass("app-has-summary"),at=$('<ul data-role="listview" class="app-listview"/>').appendTo(t),pf(g,at),nt.appendTo(at),kt(at.listview())));bt=u.viewDescription();bt&&(dt=$('<ul data-role="listview" class="app-list-instruction"/>').appendTo(t),$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(dt).html(bt),dt.listview());(p=="TopAndBottom"||p=="Top")&&$('<div class="app-bar-buttons"/>').appendTo(t);pt||(y=vt[vt[ai.heading].AliasIndex],y=y.text(l[y.Index],!1));var it=4,c=0,rt=0,oi,ni,s=[],si=0,yi=0;$(ii).each(function(){var n=this;f!=n.Tab&&(f=n.Tab,c=0,rt=0,firstCategory=!0,si++);(firstCategory||n.NewColumn)&&c++;f&&(s[si-1]=c);firstCategory=!1});s.length?$(s).each(function(n){var i=this;i>it&&(i=it);s[n]=i==1?null:$("<div><\/div>").appendTo(t).addClass("app-form-grid ui-grid-"+String.fromCharCode(97+i-2))}):c>1&&(c>it&&(c=it),oi=$("<div><\/div>").appendTo(t).addClass("app-form-grid ui-grid-"+String.fromCharCode(97+c-2)));f=null;v=oi;$(ii).each(function(n){var i=this;f&&f.text==i.Tab||(f={text:i.Tab,content:[]},s.length&&(v=s[yi++]),rt=0,ni=null,ri.push(f));v&&(f.content.length||f.content.push(v),(rt==0||this.NewColumn)&&rt<it&&(ni=$("<div>").appendTo(v).addClass("ui-block-"+String.fromCharCode(97+rt++))));var a=$('<div class="ui-collapsible-set ui-group-theme-inherit"><\/div>').appendTo(ni||t),w=$('<div class="ui-collapsible ui-collapsible-themed-content ui-first-child ui-last-child"><\/div>').appendTo(a.addClass("app-category-"+i.Id)),k=r._processTemplatedText(l,i.Description),g=r._formatViewText(es.DefaultCategoryDescriptions[k],!0,k),p,nt,o=$('<h3 class="ui-collapsible-heading"/>').appendTo(w),h=$('<a class="ui-collapsible-heading-toggle ui-btn ui-btn-a"/>').appendTo(o).text(i.HeaderText),c=$('<div class="ui-collapsible-content ui-body-a" aria-hidden="false"><\/div>').appendTo(w);$(gl).appendTo(h);$(na).appendTo(h);v||f.content.push(a);p=$('<ul data-role="listview" data-theme="a" data-inset="false" class="app-formview"/>').appendTo(c);String.isNullOrEmpty(g)||$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(p).html(g.replace(/\n/g,"<p/>"));$(li).each(function(){var n=this,r=n,o,u,t,f,e;n.CategoryIndex==i.Index&&(n=vt[n.AliasIndex],o=l[r.Index],u=n.text(l[n.Index],!1),pt||nt||(nt=!0,t=ut(null,b),$('<span class="dv-object-identifier"/>').text(y).appendTo(h).hide(),typeof t=="string"&&(t=[0,t]),t[0]=y,ut(t,b),b.attr("data-locked","true")),f=$('<li class="ui-field-contain"/>').appendTo(p),e=$('<label class="app-static-label"/>').appendTo(f).text(n.HeaderText),n.AllowNulls||e.addClass("app-required"),ui[r.Name]={field:n,originalField:r,item:f,label:e,value:o,originalValue:l[r.Index],text:u,trimmedText:n.trim(u),readers:[],writers:[]})});a.find("ul").listview();h.on("vclick",function(t,i){function f(){o.toggleClass("ui-collapsible-heading-collapsed");s?(c.show(),r.find(".dv-object-identifier").hide().closest(".ui-collapsible").find(".dv-heading").removeClass("app-disabled"),ot(!0),d(),u.inserting()||wt(n,!1),ct()):(c.hide(),u.inserting()||wt(n,!0),ot(),hi(),d(),ct())}var r=$(this),s=o.is(".ui-collapsible-heading-collapsed");i==!1?f():e(r,f)});(i.Collapsed||wt(n))&&(o.addClass("ui-collapsible-heading-collapsed"),c.hide());i.HeaderText||o.hide().closest(".ui-collapsible").addClass("app-divider")});n.tabs("create",{id:r._id+"_tabset",tabs:ri,className:"app-tabs-form",change:function(n){d();sf(t);$(n.content).each(function(){this.find("textarea").textinput("refresh")});ot()}});$(s).each(function(n){var i=s[n];i&&i.appendTo(t)});(p=="TopAndBottom"||p=="Bottom")&&$('<div class="app-bar-buttons"/>').appendTo(t);ft=[];u.context(ft);p!="None"&&n.refreshAppButtons(ft,{buttonBars:t.find(".app-bar-buttons"),toolbar:!1});dh(r,t);ei=$('<div class="app-stub"/>').appendTo(t);t.find(".app-echo").length&&ei.height(i.getScreenHeight()*.6);u.stateChanged();u._reset=!1;o.requiresInitCallback?(ti=w.css("display")!="block",ti&&w.css({display:"block","z-index":-10}),hi(),ot(),sf(t),p!="None"&&n.refreshAppButtons(ft,{buttonBars:t.find(".app-bar-buttons"),toolbar:!1}),or(w),ti&&w.css({display:"","z-index":""}),o.requiresInitCallback=!1,a=!1,o.initCallback=ci,n.navigate(o.id)):ci();uf(o)},collect:function(){var t=this,e=[],n,h=t.dataView(),c=h._allFields,s=this.commandRow(),o=t.inserting(),r,u;return s?($(c).each(function(){var h=this,c=i.activePage.find("*.app-field-"+h.Name+":input"),l;h.OnDemand||(r=s[h.Index],n={Name:h.Name,OldValue:o?null:r,NewValue:r,Modified:o&&r!=null},n.ReadOnly=h.ReadOnly&&!(h.IsPrimaryKey&&o),c.length?(n.NewValue=c.is("select")?c.find("option:selected").data("value"):c.val().trim(),si||f()||h.Type.match(/^Date/)&&(n.NewValue=h.TimeFmtStr?yh(n.NewValue):oa(n.NewValue)),n.Modified=!0):(l=t._editors[h.Name],l?(n.NewValue=l.value,n.Modified=!0):(u=t._newValues,u&&h.Name in u&&(n.NewValue=u[h.Name],n.Modified=!0))),e.push(n))}),e):e},_readWrite:function(){function b(n,t){$(n).each(function(){t?e.item.children().length==1&&this.appendTo(e.item):this.detach()})}function k(){p=lt+"_"+i.Name+"_Input";ot.attr("for",p);r.appendTo(w).attr("id",p).addClass(nt);i.Len&&r.attr("maxlength",i.Len);i.Watermark&&r.attr("placeholder",i.Watermark);ht&&r.attr("data-causes-calculate",ht)}var v=this,l=v.dataView(),lt=l._id,ft=v.editing(),ui=v.inserting(),at=v._editors,vt,u,s,e,i,o,pt,ot,w,gt=v.itemMap(),c,r,p,h,nt,ni=v.content(),wt=ni.find(".ui-collapsible ul"),a,st,bt={},ht,ti,kt,tt,d,ct,g;ft?wt.addClass("app-form-editing"):wt.removeClass("app-form-editing");$(l._allFields).each(function(){var n=this;n.Calculated&&n.ContextFields&&$(n.ContextFields.split(/\s*,\s*/)).each(function(){l.findField(this)&&(bt[this]=!0)})});for(vt in at)if(e=at[vt],i=e.field,o=e.originalField,ot=e.label,w=e.item,u=e.value,s=e.text,ft||(s=e.trimmedText),nt="app-field-"+i.Name,c=o.ItemsStyle,ht=o.CausesCalculate||bt[o.Name]?o.Name+"."+l._id+".app":null,!ft||o.isReadOnly()||i.OnDemand)ot.attr("for",""),b(e.writers,!1),e.readers.length?b(e.readers,!0):(h=$('<div class="ui-input-text ui-body-inherit ui-corner-all app-static-text"/>').appendTo(w),fieldText=$("<div>").appendTo(h).addClass(nt),e.readers.push(h),i.Index==gt.heading&&w.addClass("dv-heading"),i.OnDemand?!u||u.match(/^null/)?fieldText.text(y.NullValueInForms):(ct=l.resolveClientUrl(l.get_appRootPath()),g=$('<a rel="external"/>').appendTo(fieldText).attr("href",String.format("{0}blob.ashx?{1}=o|{2}",ct,i.OnDemandHandler,s)),i.OnDemandStyle==0?($('<img class="app-image-thumb">').appendTo(g).attr("src",String.format("{0}blob.ashx?{1}=t|{2}&_nocrop",ct,i.OnDemandHandler,s)),g.attr("data-content-type","image")):(g.text(y.BlobDownloadLink).addClass("ui-btn ui-btn-icon-left ui-icon-arrow-d ui-btn-inline ui-mini ui-shadow ui-corner-all").appendTo(fieldText.parent()),f()&&g.attr("target","_blank"),fieldText.remove())):(i.htmlEncode()?fieldText.html(s):fieldText.text(s),a=null,vf(i,!0)&&u?a=$('<a class="ui-btn-right ui-btn ui-icon-phone ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr("href","tel:"+u):yf(i,!0)&&u?a=$('<a class="ui-btn-right ui-btn ui-icon-mail ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr("href","mailto:"+u):ic(i,!0)&&u?a=$('<a class="ui-btn-right ui-btn ui-icon-eye ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr({href:u}):la(i,!0)&&u?a=$('<a class="ui-btn-right ui-btn ui-icon-location ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr({href:kc(v.commandRow(),bf(l),"q")}):aa(o)&&o.ItemsDataController&&u&&!o.tagged("lookup-details-hidden")&&(a=$('<a href="#app-details" class="ui-btn-right ui-btn ui-icon-carat-r ui-btn-icon-notext ui-shadow ui-corner-all app-btn"/>').appendTo(fieldText).attr("data-field-name",o.Name).attr("data-field-text",i.HeaderText+" - "+l.get_view().Label)),a&&a.attr("title",i.HeaderText+":\n"+u))),b(e.writers,!1);else if(b(e.readers,!1),e.writers.length)b(e.writers,!0);else{if(String.isNullOrEmpty(c))st=!1,d=i.Rows>1,r=d?$("<textarea/>"):$('<input type="text" />'),d?(r.attr("rows",i.Rows),(yt||!et||!0)&&r.attr("data-autogrow","false"),si&&r.css("white-space","pre-wrap")):i.TextMode==1?r.attr("type","password"):i.Type=="String"?vf(i)?r.attr("type","tel"):yf(i)?r.attr("type","email"):ic(i)&&r.attr("type","url"):i.Type.match(/^Date/)?(r.addClass("app-input-date"),si||f()?st=!0:i.TimeFmtStr?(r.attr("type","datetime-local"),s=vh(u)):(r.attr("type","date"),s=ah(u))):i.Type!="TimeSpan"&&r.data("format",{type:"number",value:u,text:u==null?"":s,field:i}),k(),r.val(u==null?"":s),h=r.textinput({clearBtn:!d,clearBtnText:t.ClearText}),d?h.textinput("refresh"):yt&&h.parent().find(".ui-input-clear").attr("tabindex",-1),st&&$(r).attr({"data-input-type":"datepicker","data-format-string":i.DataFormatString}).datepicker();else if(pt=i,i=o,nt="app-field-"+i.Name,u=e.originalValue,c=="Lookup"||c=="AutoComplete")r=$('<input type="hidden"/>').val(u),k(),h=$("<div>").appendTo(w),r.appendTo(h),ti=$('<input type="text" class="app-lookup-input"/>').insertBefore(r).attr("id",p),kt=$('<a href="#app-lookup" class="ui-btn ui-icon-carat-r ui-btn-icon-right ui-corner-all app-lookup"/>').insertBefore(r).text(s).data("data-context",{field:o,aliasField:pt,value:u,text:s,pageId:lt}),yt&&kt.attr("tabindex",-1);else if(c=="CheckBox")r=$('<select data-role="slider">'),tt=0,$(o.Items).each(function(){var n=this[0],t=this[1],i=$("<option>").attr("value",n!=null?n.toString():"").data("value",n).text(t).appendTo(r);t.length>tt&&(tt=t.length)}),k(),r.val(u!=null?u.toString():""),h=r.slider(),r.next().css("width",tt+2+"em");else if(c=="CheckBoxList"||c=="RadioButtonList"||c=="ListBox"){r=$('<input type="hidden"/>');k();r.val(u!=null?u.toString():"").attr("data-field",i.Name);var it=c=="CheckBoxList",rt,ut,dt=[],ii=u!=null?u.toString().split(/\s*,\s*/):[],ri=Math.min(Math.ceil(i.Items.length/(i.Columns>1?i.Columns:1)),Math.max(Math.ceil(n.screen().height*.45/ds()),3));rt=$('<div class="app-container-scrollable"/>').attr("data-columns",i.Columns);$(i.Items).each(function(n){n%ri==0&&(ut=$('<fieldset class="app-controlgroup-vertical"/>').appendTo(rt),dt.push(ut));var t=this,r=$("<input/>").attr({id:p+n,type:it?"checkbox":"radio"}).appendTo(ut),f=$("<label/>").attr("for",p+n).appendTo(ut).text(t[1]);it||r.attr("name",p);i.HtmlEncode||f.html(t[1]);(it&&ii.indexOf(t[0])!=-1||!it&&t[0]==u)&&r.attr("checked","true")});rt.insertBefore(r).data("data-field",i);$(dt).controlgroup().find(":checkbox,:radio").checkboxradio();rt.find(":checkbox,:radio").on("click",eh);h=r}else r=$("<select>").addClass("app-lookup"),$(o.Items).each(function(){var n=this[0],t=this[1],i=$("<option>").attr("value",n!=null?n.toString():"").data("value",n).text(t).appendTo(r)}),k(),r.val(u!=null?u.toString():""),h=r.selectmenu();e.item.children().each(function(n){n>0&&e.writers.push($(this))})}},stateChanged:function(){var n=this,r=n.dataView(),t=n.content(),u=n.editing(),i;n._readWrite();n.calculate(r);u&&(i=t.find(".ui-collapsible:visible .ui-collapsible-heading"),i.filter(":not(.ui-collapsible-heading-collapsed)").length||i.first().find(".ui-btn").trigger("vclick",!1),hh(t));t.closest(".ui-page:visible").length&&sf(t);k()},context:function(n){var t=this,i=t.dataView(),r=t.commandRow(),u=t.editing();wc(i,n,r);u||ao(i,n,r);wf(["Form","ActionBar"],i,n,r)},calculate:function(t){var o=this,i,u,f,r,s;if(typeof t=="string")i=n.dataView(),u=i.findField(t),u&&i._raiseCalculate(u,u);else{i=t;f=n.page(i._id);function e(){r||(r=[],$(i._collectFieldValues()).each(function(){var n=this,t=i.findField(n.Name);r[t.Index]=n.Modified?n.NewValue:n.OldValue}))}$(i._expressions).each(function(){var u=this,s,o,t,n;u.Scope==3&&(e(),s=i._evaluateJavaScriptExpressions([u],r,!1),o=f.find(".app-field-"+u.Target),o.length&&(t=o.closest(".ui-field-contain"),s?t.show():t.hide(),n=t.closest("ul").find("> li").removeClass("ui-first-child ui-last-child").filter(":visible"),n.length&&($(n[0]).addClass("ui-first-child"),$(n[n.length-1]).addClass("ui-last-child"))))});$(i._expressions).each(function(){var u=this,o,n,t;u.Scope==2&&(e(),o=i._evaluateJavaScriptExpressions([u],r,!1),n=f.find(".app-category-"+u.Target),n.length&&(o?n.show().removeClass("app-hidden"):n.hide().addClass("app-hidden"),n.closest(".app-form-grid").length&&(t=n.parent(),t.find("> .ui-collapsible-set:not(.app-hidden)").length?t.show().removeClass("app-hidden"):t.hide().addClass("app-hidden"))))});f.find(".app-form-grid").each(function(){var n=$(this),t=n.find("> div:not(.app-hidden)"),i=n.attr("class").replace(/ui-grid-\w+/,"").trim();t.length==0?n.hide():(i+=" ui-grid-"+(t.length==1?"solo":String.fromCharCode(97+t.length-2)),n.attr("class")!=i&&n.attr("class",i),n.css("display",""),t.each(function(n){var i=$(this),t="ui-block-"+String.fromCharCode(97+n);i.attr("class")!=t&&$(this).attr("class",t)}))});$(i._expressions).each(function(){var t=this,u,n;t.Scope==5&&(n=i.findField(t.Target),n&&(n._originalTextMode==null&&(n._originalTextMode=n.TextMode),e(),u=i._evaluateJavaScriptExpressions([t],r,!1),n.isReadOnly()!=u&&(n.TextMode=u?4:n._originalTextMode,s=!0)))});s&&o._readWrite();o._refreshButtons()}},afterCalculate:function(t){var i=this,r=i.dataView(),u=$("#"+r._id);n.causesCalculate(!1);$(t).each(function(){var s=this,o=i._editors[s.Name],t,h,e,l,a,c,n,p,v;o?(e=o.originalField,c=e.ItemsStyle,t=o.value=s.NewValue,s.NewValue==null?(h=o.text=y.NullValueInForms,o.trimmedText=o.text):(h=o.text=e.format(s.NewValue,!1),o.trimmedText=e.trim(o.text)),n=u.find(".app-field-"+e.Name),n.length&&(n.is("div")?e.htmlEncode()?n.text(o.trimmedText):n.html(o.trimmedText):c=="Lookup"||c=="AutoComplete"?n.val(t!=null?t.toString():"").prev().data("data-context").value=t:c=="CheckBox"?(n.val(t!=null?t.toString():""),n.slider("refresh")):c=="CheckBoxList"||c=="RadioButtonList"||c=="ListBox"?$(e.Items).each(function(i){if(this[0]==t){var r=n.prev();return r.find(":input:eq("+i+")").trigger("click"),r.find(":checkbox,:radio").checkboxradio("refresh"),!1}}):c?(n.next().val(t!=null?t.toString():""),n.next().selectmenu("refresh")):(l=n.data("format"),l&&(l.value=t,l.text=t==null?"":h),e.Type.match(/^Date/)&&(si||f()||(h=e.TimeFmtStr?vh(t):ah(t))),n.is(":focus")&&l?n.val(t==null?"":t):n.val(t==null?"":h)))):(i._newValues||(i._newValues={}),i._newValues[s.Name]=s.NewValue,e=r.findField(s.Name),e&&(a=r.findFieldUnderAlias(e),a!=e&&(n=u.find(".app-field-"+a.Name),n.length&&(p=n.prev(),h=s.NewValue==null?y.NullValueInForms:e.format(s.NewValue,!1),v=p.text(h).data("data-context"),v&&(v.text=h)))))});i._refreshButtons()},_refreshButtons:function(){var n;$(this.dataView()._actionGroups).each(function(){return $(this.Actions).each(function(){if(this._whenClientScript)return n=!0,!1}),n?!1:void 0});n&&k()}};Web.DataView.alert=function(t,i){function s(){r.popup("open")}var o;typeof t!="string"&&(t=t.toString());bo=i;var r=$("#app-popup-alert"),h=l(),f=$("div.ui-popup-active div:first");if(r.length==0){r=$(String.format('<div id="app-popup-alert" class="app-popup app-popup-alert" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" aria-level="1">{0}<\/h1><\/div><div role="main" class="ui-content"><div class="app-popup-text"><\/div><div class="app-popup-buttons"><a href="#" class="ui-btn ui-corner-all ui-mini">{1}<\/a><\/div><\/div><\/div>',n.appName(),lu.Close)).appendTo(u).popup(gf());r.find("a").on("vclick",function(){return f.length?(ii=function(){f.popup("open")},pu=bo):ii=bo,e(this,function(){st(r)}),!1})}o=r.find(".app-popup-text");t=(t||"").replace(/\n/g,"<p/>");t.match(/<\w+/)?o.html(t):o.text(t);f.length?(ii=s,st(f)):s()};Web.DataView.confirm=function(t,i,r){function h(){f.popup("open")}var s;typeof t!="string"&&(t=t.toString());ko=i;go=r;var f=$("#app-popup-confirm"),c=l(),o=$("div.ui-popup-active div:first");if(f.length==0){f=$(String.format('<div id="app-popup-confirm" class="app-popup app-popup-confirm" data-role="popup" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" arial-level="1">{0}<\/h1><\/div><div role="main" class="ui-content"><div class="app-popup-text"><\/div><div class="app-popup-buttons"><a href="#" class="app-btn-confirm ui-btn ui-corner-all ui-mini">{1}<\/a><a href="#" class="ui-btn ui-corner-all ui-mini">{2}<\/a><\/div><\/div><\/div>',n.appName(),lu.OkButton,lu.CancelButton)).appendTo(u).popup(gf());f.find("a").on("vclick",function(n){var t=$(n.target).is(".app-btn-confirm");return ii=o.length?function(){o.popup("open");pu=t?ko:go}:t?ko:go,e(this,function(){st(f)}),!1})}s=f.find(".app-popup-text");t=(t||"").replace(/\n/g,"<p/>");t.match(/<\w+/)?s.html(t):s.text(t);o.length?(ii=h,st(o)):h()};$app.showMessage=function(n){n&&this.alert(n)};Web.Menu.headerIterators=[];Web.Menu.footerIterators=[];Web.Menu.prototype.initialize=function(){Web.Menu.callBaseMethod(this,"initialize")};Web.Menu.prototype.dispose=function(){};Web.Menu.prototype.updated=function(){Web.Menu.callBaseMethod(this,"updated");n&&this.mobileUpdated()};Web.Menu.prototype.mobileUpdated=function(){var s,h,f,i,r;if(Web.Menu.MainMenuId||(Web.Menu.MainMenuId=this.get_id(),Web.Menu.MainMenuElemId=this._element.id),s=this.get_nodes(),s){h=$("#app-btn-context").on("vclick",function(){if(!n.busy())return d(),e(h,function(){bt()?kh():n.showContextMenu({scope:""})}),!1});Web.Menu.footerIterators.unshift(function(){if($(this).is(".level0")){var i=$("<a/>").text(t.Settings).appendTo($('<li data-icon="gear" data-theme="b"/>').appendTo(this)).on("vclick",function(){hi||o(i);ri=function(){n.contextScope("_contextMenu");so()};ou(!0)});return!0}});f=$("a#app-btn-menu");f.on("vclick",function(){function e(t){setTimeout(function(){o();uh()?n._menuPanel.panel("toggle"):r.panel("toggle")},t)}return(d(),o(f,!1),d(),f.attr("href")=="#app-back")?(setTimeout(function(){o();history.go(-1)},200),!1):(i?e(200):setTimeout(function(){var k,f,s,l,a,v,y,p,h,b,c;o();k=$('div[data-role="page"]');f=$();n._menuPanel=i=$('<div id="app-panel-menu" data-role="panel" data-position="left" data-position-fixed="true" data-display="overlay" data-theme="b" class="app-nav-panel"/>').appendTo(u);s=$('<ul data-role="listview"><li data-role="list-divider" data-theme="a" class="app-info"><span class="appname"/><p class="welcome"/><\/li><\/ul>').appendTo($('<div class="ui-panel-inner">').appendTo(i));l=i.find('li[data-role="list-divider"]');l.find(".appname").text(n.appName());a=Web.Menu.headerIterators;v=Web.Menu.footerIterators;a.length==0?l.find(".welcome").hide():$(a).each(function(){this.call(s)&&(y=!0)});y&&$('<li data-role="list-divider" data-theme="b"/>').appendTo(s);p=$find(Web.Menu.MainMenuId).get_nodes();h=-1,function d(n,i,e,o,s){var c="level"+s;e.addClass(c);o.addClass(c);f=f.add(e);$(n).each(function(n){var i=this,l=i.url,a,c,f,p;if(i.children){$(i.children).each(function(){this.selected&&(a=!0)});var v=e.attr("id"),y=v+"-"+n,w=l;l="#";c=$('<div data-role="panel" data-position="left" data-position-fixed="true" data-theme="b" data-display="overlay" class="app-nav-panel"/>').appendTo(u).attr("id",y);f=$('<ul data-role="listview" data-theme="b"/>').appendTo($('<div class="ui-panel-inner"/>').appendTo(c));$("<a>").appendTo($('<li data-icon="arrow-u" data-theme="b"/>').appendTo(f)).attr({"data-for":v}).text(t.UpOneLevel);$('<li data-role="list-divider" data-theme="b"/>').appendTo(f);$('<a rel="external" class="app-btn-icon-transparent"/>').appendTo($("<li>").appendTo(f).attr({"data-theme":i.selected&&!a?"a":"b","data-icon":i.selected&&!a?"check":"false"})).attr("href",w).text(i.title);i.selected&&s>h&&(r=c,h=s);d(i.children,i,c,f,s+1)}i.selected&&s>h&&(r=e,h=s);p=$('<a rel="external" class="app-btn-icon-transparent"/>').appendTo($("<li>").appendTo(o).attr({"data-icon":i.children?"dots":i.selected?"check":"false","class":i.children?"menu-item menu-parent":"menu-item","data-theme":i.selected?"a":"b"})).attr({href:l,title:i.description}).text(i.title);i.children&&p.attr("data-for",y)})}(p,null,i,s,0);b=f.find("ul").each(function(){var n=$(this),t;$(v).each(function(){this.call(n)&&(t||(t=!0,$('<li data-role="list-divider" data-theme="b"/>').insertBefore(n.find("li:last"))))})});c=$("#PageFooterBar");c.length&&$('<li data-role="list-divider" class="app-wrap app-copy" data-theme="b"/>').appendTo(s);b.listview().on("vclick","a",function(n){var t=$(n.target),i=t.attr("data-for"),u=t.attr("href");return dt(t)?(hi||(o(t),!i&&u&&li()),ri||(ri=function(){setTimeout(function(){i?(r=$("#"+i),e()):w.location.href=u},200)}),ou(i!=null),!1):!1}).on("swipe",function(){hi=!0});c.length&&s.find(".app-wrap").html(c.html());gr();i=f.panel({animate:ff(),beforeopen:function(){},open:function(){r=$(this)},beforeclose:function(){},close:function(){!hi&&ri&&ri();ri=null;hi=!1}});ff(i);tu(i);r||(r=f.slice(0,1));e(250)},200),!1)});$('div[data-app-role="sitemap"]').attr("class","app-site-map").each(function(){function u(){var n=$('<li><a href="#" rel="external"/><\/li>').appendTo(i).find("a");$("#app-welcome").length&&!r?n.attr("href","#app-welcome").text(nt.LoginButton):ti.loginStatus(n)}var f=$(this),i=$('<ul data-inset="false" />').appendTo(f),r=ti&&ti.loggedIn();ti&&!r&&u(),function h(n,t,i){$(n).each(function(){var n=$("<li/>").appendTo(t).addClass("app-depth"+i);this.url?$("<a/>").appendTo(n).attr({href:this.url,rel:"external"}).text(this.title):$("<span><\/span>").appendTo(n).text(this.title);this.children&&h(this.children,t,i+1)})}(s,i,1);ti&&r&&u();i.listview().on("vclick",'a[rel="external"]',function(t){var i=$(t.target),r=i.attr("href"),u=r.match(/^#/);return dt(i)?(u||li(),e(i,function(){u?n.changePage(r.substring(1)):(o(i,!1),w.location.href=r)}),!1):!1}).filterable({filterPlaceholder:t.FilterSiteMap})})}};typeof Web.Membership!="undefined"&&(Web.Membership.prototype.initialize=function(){var i=this,r=i.get_authenticationEnabled(),u=i.get_displayMyAccount(),f=i.loggedIn();Web.Menu.headerIterators.push(function(){var l=$(this),a=i.get_cultures(),u,y,r,s,c;if(!String.isNullOrEmpty(a)&&!(__tf!=4)){var e={value:"Detect,Detect",text:nt.AutoDetectLanguageOption,selected:!1},v=[e];$(a.split(/;/)).each(function(){if(this.length){var n=this.split("|"),t={value:n[0],text:n[1],selected:n[2]=="True"};v.push(t);t.selected&&(e=t)}});y=$("<a/>").text(e.text).appendTo($('<li data-icon="location" data-theme="b"/>').appendTo(l)).on("vclick",function(){return hi||o(y),ri=function(){h=[{text:t.Back,icon:"back",callback:function(){n._menuPanel.panel("toggle")}},{text:nt.ChangeLanguageToolTip,instruction:!0}];$(v).each(function(n){var t=this;h.push({text:t.text,icon:n==0?"":t.selected?"check":!1,context:t,callback:function(n){i.changeCulture(n.value)}});n==0&&h.push({})});b(h,"#app-panel-languague",{position:"left"})},ou(!0),!1});u=!0}if(r=this.find(".welcome"),f)s=i.get_welcome(),String.isNullOrEmpty(s)?r.hide():r.html(String.localeFormat(s,i.get_user(),new Date));else if(i._allowLoginInMenu){r.hide();c=$("<a/>").text(nt.LoginLink).appendTo($('<li data-icon="lock" data-theme="b"/>').appendTo(l));c.on("vclick",function(){hi||o(c);ri=function(){o();i.showLogin()};ou()});u=!0}return u});f&&(u||r)&&Web.Menu.footerIterators.push(function(){var n=!1,t;if(u&&$(this).is(".level0")&&!1&&($(String.format("<li>{0}<\/li>",nt.MyAccount)).appendTo(this),n=!0),r){t=$("<a/>").text(nt.LogoutLink).appendTo($('<li data-icon="power" data-theme="b"/>').appendTo(this));t.on("vclick",function(){hi||o(t);ri=function(){be();i.logout()};ou()});n=!0}return n})},Web.Membership.prototype.dispose=function(){},Web.Membership.prototype.updated=function(){if(ti=this,ke(),this.get_idleTimeout())$(document).on("awake.app",function(){return!ti.idle()});this.idleInterval(!0);n&&this.mobileUpdated()},Web.Membership.prototype._idle=function(){d();var n=this;n.idleInterval(!1);$app.alert(nt.UserIdle,function(){be();n.logout()})},Web.Membership.prototype.loginStatus=function(n){var t=this,i=t.loggedIn(),r=$(n).text(i?nt.LogoutLink:nt.LoginLink).on("vclick",function(){return e(r,function(){i?(be(),t.logout()):t.showLogin()}),!1})},Web.Membership.prototype.mobileUpdated=function(){function i(){a?setTimeout(i,200):n.loggedIn()||t!=l()||n.showLogin()}var n=this,t,r;$(document).on("start.app",function(){n._allowLoginInMenu=n.get_displayLogin();!r&&location.href.match(/(\?|&)ReturnUrl=/)&&n._allowLoginInMenu&&(t=l(),setTimeout(i,1e3))});this.loginStatus('a[data-app-role="loginstatus"]')},Web.Membership.prototype.showLogin=function(){var t=this._loginDialog,r,i;if(!t){this._login_CompletedHandler=Function.createDelegate(this,this._login_Completed);this._method_FailureHandler=Function.createDelegate(this,this._method_Failure);t=this._loginDialog=$(String.format('<div id="app-popup-login" data-role="popup" data-theme="a" data-overlay-theme="a" class="app-popup app-popup-login"><div role="banner" class="ui-header ui-bar-a"><h1 class="ui-title" role="heading" aria-level="1">{6}<\/h1><\/div><div role="main" class="ui-content"><div><label for="UserName">{1} {2}<\/label><\/div><input type="text" id="UserName" placeholder="{3}"/><input type="password" id="Password" placeholder="{4}"/>{5}<div class="app-popup-buttons"><a href="#" class="login-button ui-btn ui-corner-all ui-mini">{7}<\/a><\/div><\/div><\/div>',nt.HelpCloseButton,nt.LoginLink,nt.LoginText,nt.UserName.replace(/:/,""),nt.Password.replace(/:/,""),this.get_displayRememberMe()?String.format('<label for="RememberMe"><input type="checkbox" id="RememberMe" />{0}<\/label>',nt.RememberMe):"",n.appName(),nt.LoginButton)).appendTo(u).popup(gf());r=this;this._userName=t.find("input:text").textinput().get(0);this._password=t.find("input:password").textinput().get(0);this._rememberMe=t.find("input:checkbox").checkboxradio().get(0);i=t.find("a.login-button").on("vclick",function(){return d(),e(i,function(){o(i,!1);r.login()}),!1});t.find("input").on("keydown",function(n){if(n.which==13)return d(),setTimeout(function(){i.trigger("vclick")},200),!1})}t.popup("open")});Web.Mobile=function(){var n=this;n._asyncJob=0;n._pageMap={};n._pages=[];n._toolbar=$("#app-bar-tools");n._actionButton=$(".app-btn-promo");n._toolbarButtons=n._toolbar.find(".app-btn");n._title=n._toolbar.find("h1");n._headingBar=$("#app-bar-heading");n._menuButton=$("#app-btn-menu");n._contextButton=$("#app-btn-context");n._modalDataViews=[];n._modalStack=[]};Web.Mobile.prototype={settings:function(){return r},appName:function(){return $("#PageHeaderBar").text()},height:function(){var n=tt.height();return navigator.userAgent.match(/Mobile.+Safari/)&&!navigator.userAgent.match(/Chrome/)&&(n+=60),n},page:function(n){var t;if(n||(n="Main"),t=$("#"+n),t.length==0){t=$(String.format('<div data-role="page" id="{0}"><div data-role="content"/><\/div>',n)).appendTo(u).page();var r=i.activePage,f=r.css("min-height"),e=r.css("padding-top"),o=this.pageInfo(n);pe(t);wt(t)}return t},activeLink:function(n,t){$(i.activeClickedLink).is(".app-tab-active")||i.removeActiveLinkClass(!0);n&&(n=$(n).closest("a"),n.is(".app-btn-static")||(n.addClass("ui-btn-active"),(t==null||t)&&(i.activeClickedLink=n)))},blink:function(n,t){o(n);setTimeout(function(){o();setTimeout(function(){o(n);setTimeout(function(){o();t&&t()},200)},200)},200)},content:function(n){var t=this.page(n),i=t.find('div[data-role="content"] .app-wrapper:last');return i.length?i:t.find('div[data-role="content"]')},showContextPanel:function(n,t,i){b(n,"#"+t,i)},toggleContextPanel:function(n){this.contextScope()&&(n+="-scope");$(n).panel("toggle")},causesCalculate:function(n){if(arguments.length==0)return yi.length?yi[0]:null;n==!1?(yi.length&&yi.splice(0,1),tf=null):yi.push(n)},callAfterCalculate:function(n){to(n)},pageVar:function(n,t){if(arguments.length==1)return oi(n);oi(n,t)},userVar:function(n,t){if(arguments.length==1)return c(n);c(n,t)},callWithFeedback:function(n,t){e(n,t)},dataView:function(){var n=this.pageInfo();return n?n.dataView:null},prevPageInfo:function(){var t=i.navigate.history.stack,r,u;return t.length>1&&(r=t[t.length-2].pageUrl,r&&(u=n.pageInfo(r))),u},pageInfo:function(n){if(n?n.selector!=null&&n.length!=null&&(n=n.attr("id")||""):n=l(),typeof n=="string")return this._pageMap[n];if(n)this._pageMap[n.id]=n,n.dataView&&n.dataView._id&&(this._pageMap[n.dataView._id]=n),this._pages.push(n);else return null},dataViewUIPage:function(n){return $("#"+n._id)},dataViewUILinks:function(n){return this.dataViewUIPage(n).find('ul[data-role="listview"] li a')},unloading:function(){li()},listPopup:function(n){p(n)},promo:function(n,t){function f(){i.is(".ui-disabled")||!r.promoteActions?i.hide():$(".ui-popup-active").length?i.hide().addClass("app-hidden"):i.show()}var i=this._actionButton,u;if(arguments.length==0)return i;if(typeof n=="boolean")n?f():i.hide();else if(typeof n=="string")return u=i.data("icon"),u&&i.removeClass("ui-icon-"+u),i.addClass("ui-icon-"+n).data("icon",n).attr("title",t),n.match(/(delete|minus|trash)/)?(i.hide().addClass("ui-disabled"),!1):(i.removeClass("ui-disabled"),f(),!0)},toolbar:function(n){var t=this._toolbar;return typeof n=="boolean"?n?t.show():t.hide():typeof n=="string"&&this._title.text(n),t},search:function(i,r){function s(t){t!=!1&&u.blur();o();n._toolbar.removeClass("app-logo-hidden");yu.show();ht.hide();k()}function a(){if(yu=$(".ui-title,#app-btn-menu,.app-btn-cluster-right").hide(),ht=n._toolbar.find("#app-controls-find"),ht.length==0){ht=$('<div id="app-controls-find" class="app-bar-search"><form><input type="search" id="app-input-search" data-role="search" data-mini="true"/><a href="#" class="app-btn-search-cancel ui-btn-left ui-btn ui-icon-back ui-btn-icon-notext ui-shadow ui-corner-all"/><a class="app-btn-search-more ui-btn ui-btn-right ui-corner-all ui-btn-icon-notext ui-icon-carat-d"/><\/form><\/div>').insertBefore(n._toolbar.find(".ui-title"));ht.find(".app-btn-search-more").attr("title",pt.ShowAdvancedSearch).on("vmousedown",function(t){if(!n.busy()){var f=n.pageInfo(u.attr("data-scope")||r.scope),i=f.dataView,o=u.val();return i.extension().useAdvancedSearch(!0),e(t.target,function(){s();hr(i,o)}),!1}});n._searchInput=u=ht.find("input").textinput({mini:!0,clearBtnText:t.ClearText}).attr("type","text").keydown(function(t){if(t.keyCode==27)return u.blur(),!1;if(t.keyCode==40||t.keyCode==114){var f=n.pageInfo(u.attr("data-scope")||r.scope),i=f.dataView,o=u.val();return i.extension().useAdvancedSearch(!0),e(ht.find(".ui-icon-carat-d"),function(){s();hr(i,o)}),!1}}).focus(function(){n._toolbar.addClass("app-logo-hidden")}).blur(function(){var t=u.data("allow-blur")!=!1;if(!t){u.parent().addClass("ui-focus");return}cf(!0);s(!1);setTimeout(function(){var t=n.dataView();t&&t._totalRowCount==-1&&t.sync()},200)});h=$('<span class="app-btn-options app-has-children"/>').appendTo(u.parent()).attr("title",t.QuickFindScope).on("vmousedown",function(){function f(n,t){t.toggleClass("ui-icon-check");i[n]._selected=t.is(".ui-icon-check");var r;$(i).each(function(){if(this._selected)return r=!0,!1});r||(i[n]._selected=!0,t.toggleClass("ui-icon-check"))}var o=n.pageInfo(u.attr("data-scope")||i.scope),r=o.dataView,i=[{text:r.get_view().Label,icon:!0,_hint:r._controller+"."+(r._viewId||"grid1"),keepOpen:!0,context:0,callback:f}],s=(r.viewProp("quickFindHint")||"").split(";"),e;return $(n._pages).each(function(){var t=this,n=t.dataView;n&&n._filterSource==r._id&&(i.length==1&&i.push({}),i.push({text:n.get_view()&&n.get_view().Label||t.text,icon:!0,_hint:n._controller+"."+(n._viewId||"grid1")+"."+n._filterFields,keepOpen:!0,context:i.length,callback:f}))}),$(i).each(function(){var n=this;n._selected=s.indexOf(n._hint)!=-1;n._selected&&(n.icon="check",e=!0)}),e||(i[0]._selected=!0,i[0].icon="check"),u.data("allow-blur",!1),p({anchor:h,highlightAnchor:!1,iconPos:"right",y:h.offset().top+h.outerHeight()*.8,title:t.QuickFindScope,items:i,afteropen:function(){setTimeout(function(){u.parent().addClass("ui-focus")})},afterclose:function(){u.focus();u.data("allow-blur",null);var n=[];$(i).each(function(t){var i=this;i.text&&i._selected&&(t>0&&n.push(";"),n.push(i._hint))});r.viewProp("quickFindHint",n.length==1?null:n.join(""))}}),!1});u.parent().find(".ui-input-clear").on("vmousedown",function(){return ce(u,0),$(this).trigger("click"),!1});ht.find("form").submit(function(){return s(),l(u.val()),!1});var i=ht.find(".ui-icon-back").attr("title",lu.CancelButton).on("vclick",function(){return e(i,function(){s()}),!1})}u.attr("data-scope",r.scope)}function l(t){var f=n.pageInfo(u.attr("data-scope")||r.scope),i=f.dataView,e=i.extension();i._busy()||(su(i),th(i,t),n.toolbar(n.title()),de())}var u=$(n._searchInput).attr("data-scope",r.scope),f=r&&r.text,h,c;if(i=="configure")r.focus?(a(),ht.show(),cf(!1),r.placeholder&&u.attr("placeholder",r.placeholder),f?(u.val(f),c=u.parent().find("a"),f?c.removeClass("ui-input-clear-hidden"):c.addClass("ui-input-clear-hidden")):u.val(""),u.focus().select(),r.setCursor&&ce(u,u.val().length)):(yu&&yu.show(),ht&&ht.hide(),typeof f!="undefined"&&u.val(f)),u.attr("data-scope",r.scope);else if(i=="execute")l(r.text);else return u.val()},headingBar:function(){return this._headingBar},enumerateFields:function(n,t,i,r){var u=n._allFields,f=i==null;r||(r=n.extension().commandRow());f?(i=[],$(u).each(function(){this.ShowInSummary&&!this.Hidden&&i.push(this)})):t.push({text:n.get_view().Label,theme:"a",isStatic:!1,instruction:!0});$(i).each(function(){var i=u[this.AliasIndex],f=r[i.Index],e=i.text(f);i.OnDemand?i.OnDemandStyle==0&&f&&!f.match(/^null/)&&t.push({src:String.format("{0}blob.ashx?{1}=t|{2}",n.resolveClientUrl(n.get_appRootPath()),i.OnDemandHandler,f),desc:i.HeaderText,display:"before"}):vf(i)&&f?t.push({text:e,desc:i.HeaderText,href:"tel:"+e,icon:"phone"}):yf(i)&&f?t.push({text:e,desc:i.HeaderText,href:"mailto:"+e,icon:"mail"}):t.push({text:e,desc:i.HeaderText,isStatic:!0,display:"before"})})},infoView:function(n,i,r){var e=[],s=i?"left":null,o,f,u;for(i||e.push({text:t.Back,callback:lr,icon:"back"});n;)o=n.extension().itemMap(),f=n._allFields,u=[f[o.heading]],$(o.desc).each(function(){u.push(f[this])}),$(n._fields).each(function(){this.Hidden||u.indexOf(f[this.AliasIndex])!=-1||u.push(this)}),this.enumerateFields(n,e,u,r),n=$app.find(n._filterSource);b(e,"#app-panel-info-view"+(s?"-standalone":""),{position:s,className:"app-panel-info-view"})},modalDataView:function(n){var t=this,i,r;n?(i=t.pageInfo(n),r=t.page(n),wu&&(i.text=wu,wu=null),i.dataView._lookupInfo||(r.is("app-modal-page")||r.addClass("app-modal-page app-form-page"),i.dataView._isModal=!0),t._modalDataViews.push(n),t.changePage(n)):($(t._modalStack).each(function(n){var i=this,r=$("#"+i.id),u=i.dataView;u.dispose();r.page("destroy").remove();n=t._modalDataViews.indexOf(i.id);t._modalDataViews.splice(n,1);n=t._pages.indexOf(i);t._pages.splice(n,1)}),t._modalStack=[])},unloadPage:function(n,t){var i=this.pageInfo(n),u;if(i&&(u=this._modalDataViews.indexOf(i.id),u>=0)){var e=i.dataView,o=$app.find(e._parentDataViewId),r=this.pageInfo(t),f=r?this._modalDataViews.indexOf(r.id):-1;(r&&o==r.dataView||t.attr("id")=="Main"||f>=0&&u>f)&&this._modalStack.indexOf(i)==-1&&this._modalStack.push(i)}},busy:function(n){var t=this,i=t._busy==!0;if(arguments.length==1)t._busy=n;else return i?!0:(t._busy=!0,setTimeout(function(){t._busy=!1},900),!1)},executeInContext:function(t,i){var r=[];n.navContext(r);$(r).each(function(){var r=this;if(t&&r.icon==t||!t&&r.text==i)return n.busy()||at(r),!1})},navigate:function(t){setTimeout(function(){n.changePage(t)},300)},changePage:function(n,t){var h=i.activePage,c;if(ft(),iu(!0),this.pageInit(n)){c=this.page(n).css("padding-top",h.css("padding-top"));var s=r.pageTransition,u=this.pageInfo(n),l=u.home?"fade":u.transition||s,a=i.navigate.history,e,f,o;f=u.replaceUrl;i.changePage("#"+n,{changeHash:!(t==!1)&&!u.home,transition:l});e=a.stack;o=e[e.length-1];f&&(u.replaceUrl=null,absUrl=i.path.makeUrlAbsolute(f,i.path.documentBase),$("#"+n).attr("data-url",f),i.navigate.navigator.squash(f),o.url=absUrl);u.home&&(o.transition=s)}},title:function(){return title=document.title},navContext:function(i,r){var f=this,e=f.contextPageInfo(),v=e,u=e&&e.dataView,h=u,o=h&&h.extension(),a=u&&u.get_useCase(),s=u&&u.extension(),c=!0,l=-1;s&&(r||s&&s.context(i),e.dataView._parentDataViewId&&(e=f.pageInfo(e.dataView._parentDataViewId),u=e.dataView,l--));!o||o.inserting()||o.lookupInfo()||$(f._pages).each(function(){var o=this,e=o.dataView,v=e&&e.extension(),s,h=!1;e&&(s=!e._hidden&&!e._parentDataViewId,s&&(u&&u._filterSource?(s=$app.find(u._filterSource)==e,h=s,s||(s=$app.find(e._filterSource)==u)):s=e._filterSource?$app.find(e._filterSource)==u:!1));!s||a||o.external||(c&&(r||i.push({}),c=!1),h&&!f.contextScope()&&i.push({text:f._masterHeading,desc:o.text,icon:"info",callback:function(){n.infoView(e,bu=="toolbar")},system:!0}),f.contextScope()&&h||i.push({text:h?t.Back:o.text,icon:h?"back":null,count:h?null:v&&!v._reset?e._totalRowCount:null,callback:h?function(){w.history.go(l)}:function(){f.changePage(o.id)},system:!0,navigateTo:h?"master":"detail",context:o&&o.id,activator:o&&o.activator}))})},refreshAppButtons:function(f,e){var v=this,ot=v._title.offset().left+v._title.outerWidth()-1,c,o,y=[],l,s=[],p={search:pt.PerformAdvancedSearch},a=[],tt,it,k,rt,ut,d=n.dataView(),g=0,h,w=v._contextButton,ft=e&&e.buttonBars||i.activePage.find(".app-bar-buttons"),et,nt,b;if((!e||e.toolbar)&&(bt()?w.show().attr("title",pt.HideAdvancedSearch).addClass("ui-icon-carat-u").removeClass("ui-icon-dots"):(w.attr("title",t.More).removeClass("ui-icon-carat-u").addClass("ui-icon-dots"),f.length?w.show():w.hide()),v._toolbarButtons.each(function(){c=$(this);c.show();c.offset().left>ot&&y.push(c);c.hide()}),l=y.length,l>0)){for($(f).each(function(){var n=this;o=n.icon;showOnToolbar=n.toolbar!=!1&&o!="dots"&&o!="back";o&&(o=="search"?ut=!0:o=="refresh"?it=!0:o=="phone"?tt=!0:o=="mail"?rt=!0:o=="eye"&&showOnToolbar?k=!0:showOnToolbar&&s.indexOf(o)==-1?s.push(o):o=null,o&&(p[o]=n.text+(n.desc?"\n"+n.desc:"")))}),rt&&s.push("mail"),tt&&s.push("phone"),k&&s.push("eye"),it&&s.push("refresh"),s.length&&d&&d.get_isGrid()&&!d.get_isEditing()&&r.promoteActions?n.promo(s[0],p[s[0]])&&(n.promo().data("icon-list",k?{icons:s.slice().reverse(),labels:p}:null),a.push(s[0]),s.splice(0,1)):bt()?lt():n.promo(!1),ut&&(s.length<l?s.push("search"):s[l-1]="search"),s.length<l&&(g=l-s.length),h=0;h<g;h++)$(y[h]).hide();while(h<l)c=$(y[h]),o=s[h-g],et=c.data("icon"),c.removeClass("ui-icon-"+et).addClass("ui-icon-"+o).data("icon",o).show(),c.attr("title",p[o]),a.push(o),h++}for(ft.length&&ft.each(function(){var i=$(this),n,e,s,r,o,h;if(i.is(":visible"))if(i.children().remove(),nt)i.append(nt.html());else if(nt=i,b||(b=[],$(f).each(function(){var n=this,t=n.icon;!n.system&&t!="dots"&&n.text&&n.uiScope=="Form"&&b.push(n)})),$(b).each(function(){var n=this;$('<a href="#app-action" class="ui-btn ui-corner-all ui-mini"/>').text(n.text).appendTo(i)}),r=i.width(),n=i.find(".ui-btn:last"),n.length&&n.position().left+n.outerWidth()>r&&(i.find(".ui-btn").css("min-width","8em"),n.length&&n.position().left+n.outerWidth()>r)){if(i.find(".ui-btn").css("min-width","4em"),n.length&&n.position().left+n.outerWidth()>r)for(e=$('<a href="#app-action" class="ui-btn ui-corner-all ui-mini app-btn-more"/>').html("&nbsp;").attr("title",t.More).appendTo(i);n.length&&e.position().left+e.outerWidth()>r;)n=n.hide().prev();u.is(".app-buttons-text-only")||(o=0,s=i.find(".ui-btn:visible").each(function(){o+=$(this).outerWidth(!0)}),h=Math.ceil((r-o)/(s.length-(e?1:0))),i.find(".ui-btn:visible:not(.app-btn-more)").each(function(){var n=$(this);n.width(n.width()+h)}))}});a.length;)for(h=0;h<f.length;)f[h].icon==a[0]?(f.splice(h,1),a.splice(0,1)):h++},endModalState:function(t,r,u){var f=this.pageInfo(t._id),e=this.pageInfo(r._id);f.refreshCallback=function(){history.go(-1)};ci=function(){ft();i.navigate.history.clearForward();n.modalDataView();var r=t.get_parentDataView(),e;r&&(e=n.pageInfo(r._id),e.echoChanged=!0,r.get_isEditing()||(e.initCallback=function(){r.sync()}));u&&(f.echoInitialized!=null&&f.id!=l()?f.echoRefreshCallback=u:u())};it(!0);f.requiresReturnCallback=!0;t.sync()},renderContext:function(n,t,i){var r=!1;$(t).each(function(){var e,h;if(!i||i(this)){var t=this,f=$("<li>").attr({"data-icon":t.icon,"data-theme":t.theme||"a"}).appendTo(n),u,o=!1,s;t.callback||t.dataRel?(u=$('<a href="#"/>').appendTo(f).text(t.text).data("context-action",t),t.count!=null&&$('<span class="ui-li-count"/>').appendTo(u).text(t.count),t.dataRel&&u.attr("data-rel",t.dataRel)):t.href?(f.attr("data-icon",t.icon),u=$('<a href="#" rel="external"/>').appendTo(f).text(t.text).data("context-action",t).attr("href",t.href)):t.isStatic?f.html(t.text):t.src?$('<img class="ui-li-thumb"/>').appendTo(f.addClass("ui-li-has-thumb")).attr({src:t.src}):(r?f.remove():(s=f.attr("data-role","list-divider").html(t.text),!t.isStatic&&t.text&&t.instruction!=!1&&s.addClass("app-list-instruction")),r=!0,o=!0);o||(r=!1);t.desc&&(e=t.display=="before",e&&$('<p class="app-item-desc app-item-desc-before"/>').insertBefore((u?u:f).contents()).text(t.desc),h=$('<p class="app-item-desc"/>').appendTo(u?u:f).text(t.desc),e&&h.addClass("app-item-desc-after"));t.wrap&&f.addClass(t.callback?"app-wrap-text":"app-wrap");t.disabled&&f.addClass("ui-disabled");t.itemClassName&&f.addClass(t.itemClassName);t.linkClassName&&u.addClass(t.linkClassName);t.keepOpen&&(u.addClass("app-keep-open"),t.animate||u.addClass("app-btn-icon-transparent"));t.animate&&u.addClass("app-animated app-animation-spin");t.selected&&$(ta).appendTo(u)}})},tabs:function(n,r){function o(){var s=r.tabs,c=r.placeholder||$(s[0].content[0]),n=$('<div class="app-tabs ui-header ui-bar-inherit"/>').insertBefore(c).addClass(r.className),t=$('<div class="ui-navbar"/>').appendTo(n),l=$("<ul/>").appendTo(t).addClass("ui-grid-"+String.fromCharCode(97+s.length-2)),h=s[0].text,o;r.id||(r.id=c.attr("id"),r.id&&(r.id+="_tabs"));r.id&&(n.attr("id",r.id),h=oi(r.id)||h);$(s).each(function(n){var t=this,i=$('<a class="ui-btn"/>').appendTo($("<li/>").addClass("ui-block-"+String.fromCharCode(97+n)).appendTo(l)).text(t.text);t.active=t.text==h;t.active&&i.addClass("ui-btn-active app-tab-active")});t.on("vclick",function(h){var c=$(h.target).closest("a"),nt=t.find(".app-tab-active"),a=n.parent(),l=a.find(".app-stub,.app-stub-main"),w=arguments.length!=2?null:arguments[1].selectedTab,b=o||w||c.text(),d=i.activePage,v,y=0,g,k;if(w&&(o=w),c.length)if(!o&&c.is(".app-tab-more"))t.find(".ui-btn").removeClass("ui-btn-active"),e(c,function(){c.addClass("ui-btn-active");k=[];$(r.tabs).each(function(n){var i=this;k.push({text:i.text,icon:i.active?"check":!1,wrap:!0,context:{text:i.text,index:n},linkClassName:"app-btn-icon-transparent",callback:function(n){c.removeClass("ui-btn-active");o=n.text;$(t.find(".ui-btn")[n.index]).trigger("vclick")}})});p({items:k,anchor:c,afterclose:function(){setTimeout(function(){c.removeClass("ui-btn-active");t.find(".app-tab-active").addClass("ui-btn-active")},50)}})});else{if(t.find(".ui-btn").removeClass("app-tab-active ui-btn-active"),c.addClass("app-tab-active ui-btn-active"),$(s).each(function(){var n=this;n.active&&(b==n.text&&(g=!0),$(n.content).each(function(){y+=$(this).outerHeight(!0)}));n.active=n.text==b;n.active&&(v=n)}),g){o=null;return}oi(r.id,b);y&&l.length&&l.offset().top+l.outerHeight()-y<a.offset().top+a.height()&&l.height(y+l.outerHeight());ve(d);f(n);o&&(o=null,u(n));v.callback&&v.callback();r.change&&(fi=!1,r.change(v),nu(d));lh(a,l)}return!1});n.data("data-tabs",r.tabs);f(n);u(n,!1)}function s(n){n||(n=r.container?r.container.find(".app-tabs"):i.activePage.find(".app-wrapper .app-tabs"));n.data("data-tabs",null).remove()}function f(n){n||(n=i.activePage.find(".app-wrapper .app-tabs"));$(n).each(function(){$($(this).data("data-tabs")).each(function(){var n=this;$(n.content).each(function(){n.active?$(this).removeClass("app-tab-hidden"):$(this).addClass("app-tab-hidden")})})})}function u(n,u){n||(n=(r&&r.page||i.activePage).find(".app-tabs"));$(n).each(function(){function a(t){i.attr("class","ui-grid-"+String.fromCharCode(97+n.length-2));t&&(v.width("").show(),i.css("max-width","").width(""),n.removeClass("app-tab-active app-tab-more ui-btn-active ui-last-child"),$(o.removeClass("app-tabs-expanded").data("data-tabs")).each(function(t){var i=this,r=$(n[t]).text(i.text);i.active&&r.addClass("ui-btn-active app-tab-active")}))}var o=$(this),i=o.find("ul"),r,v=i.find("li"),n=i.find(".ui-btn"),e=!0,h=0,s=0,c=!0,l,f;for(a(u!=!1);n.length>2&&e;)if(e=!1,n.each(function(){var n=this,t;n.scrollWidth>n.offsetWidth&&(e=!0,t=n.scrollWidth-n.offsetWidth+er($(n).css("padding-right")),h+=t)}),e){if(i.parent().width()-i.outerWidth()>h){o.addClass("app-tabs-expanded");f=[];n.each(function(){var n=this,t=$(n),i=t.parent();n.scrollWidth>n.offsetWidth?f.push(n.scrollWidth+er(t.css("padding-right"))):f.push(i.width());s+=f[f.length-1]});i.css("max-width",s).width(s);n.each(function(n){$(this).parent().width(f[n])});break}c?c=!1:(r=$(n[n.length-1]),l=r.is(".app-tab-active"),r.parent().hide(),n=n.slice(0,n.length-1),a());r=$(n[n.length-1]);r.text(t.More).addClass("app-tab-more ui-last-child");l&&r.addClass("ui-btn-active app-tab-active")}else break})}switch(n){case"create":r.tabs&&r.tabs.length>1&&o(r);break;case"destroy":s();break;case"fit":u()}},refreshMenuStrip:function(){var r=this._menuStrip,s=r&&r.strip,b=this._title,k=b.offset().left+b.outerWidth(),d=this._toolbar.find(".app-btn-cluster-right .ui-btn:visible").first(),y=(d.length?d.offset().left:this._toolbar.outerWidth())-10,p,c,v,h,g,l,u,nt,tt,it,o;if(!s){r=this._menuStrip={strip:$('<div class="app-menu-strip"/>').appendTo(this.toolbar())};s=r.strip;c=$("<ul/>");for(it in Web.Menu.Nodes){p=Web.Menu.Nodes[it];break}for(o=0;o<p.length;o++){var a=p[o],u=$("<li/>").appendTo(c),rt=$('<a class="ui-btn"/>').appendTo(u).text(a.title).attr({title:a.description}).data("data-node",a);a.children&&rt.addClass("app-has-children");a.selected&&rt.addClass("app-selected")}r.links=c.find(".ui-btn");r.items=r.links.parent();r.more=$('<a class="ui-btn app-has-children"/>').appendTo($("<li/>").appendTo(c)).text(t.More);function ut(n){n.url&&(n.target?w.open(n.url,n.target):w.location.href=n.url)}c.appendTo(s).on("vclick",function(t){var r=$(t.target).closest(".ui-btn"),o=r.is(".app-selected"),u=r.data("data-node"),h=u&&u.url&&!u.children;return r.length==0?!1:(h&&li(),e(r,function(){if(h)ut(u);else{o||r.addClass("app-selected");var t=$('<div class="app-popup app-popup-listview app-popup-menu" data-theme="a"/>'),e=$('<div class="ui-panel-inner"/>').appendTo($('<div class="ui-content"/>').appendTo(t)),a=$('<ul class="app-listview"/>').appendTo(e),l,v,c,y=1;function p(n,t){if(n.title){var i=$('<li data-icon="false"/>').addClass("app-depth"+t).appendTo(a),r=$("<a/>").appendTo(i).text(n.title).attr("title",n.description).data("data-context",n);n.selected&&(v=r)}$(n.children).each(function(){p(this,t+1)})}u||(y=0,u={children:[]},s.find("li:hidden a").each(function(){u.children.push($(this).data("data-node"))}));p(u,y);v&&v.addClass("app-selected app-btn-icon-transparent").parent().attr("data-icon","check");a.listview().on("vclick",function(i){var r=$(i.target).closest(".ui-btn");return dt(r)&&n.callWithFeedback(r,function(){l=r.data("data-context");st(t)}),!1});t.popup({history:!f(),transition:"fade",tolerance:3,arrow:"t,l,r,b",overlayTheme:"b",positionTo:r,beforeposition:function(){var u=i.getScreenHeight(),o=n.toolbar().outerHeight(),s=t.outerHeight(!0),r;s>=u-o&&(e.css("height",u-o*2.25),f()&&(r=e.width()+20,e.css({width:r}),t.css({minWidth:r,maxWidth:"auto"})))},afteropen:function(){df(null,t);f()&&e.focus()},afterclose:function(){o||r.removeClass("app-selected");l&&l.url&&li();setTimeout(function(){yo(a);ai(t);e.off();l&&ut(l)},100)}});tu(t);uo(t);t.popup("open").closest(".ui-popup-container").css("marginTop",er(r.css("fontSize"))*2/3);c=e.find(".ui-btn.ui-icon-check").parent();c.length&&c.position().top+c.outerHeight()-1>e.outerHeight()&&e.scrollTop(c.position().top-(e.outerHeight()-c.outerHeight())/2)}}),!1)})}if(l=y-k,l!=s.data("tested-width")||!s.is(":visible"))if(s.data("tested-width",l),l>=50&&s.attr("data-enabled")!="false")for(gr(!0),s.width(l).css({left:k}),v=r.items,h=r.more.removeClass("app-selected").parent(),h.hide(),v.show(),o=v.length-1;o>=0;o--){if(u=$(v[o]),tt=u.outerWidth(),nt=u.offset().left,nt+tt-1>=y&&(h.show(),g=h.outerWidth(),u.hide()),u.is(":hidden")&&u.find(".app-selected").length&&r.more.addClass("app-selected"),!h.is(":visible")||h.offset().left+g-1<y){o<=1&&!u.is(":visible")&&gr(!1);break}else u.hide(),u.find(".app-selected").length&&r.more.addClass("app-selected");if(o<=1){gr(!1);break}}else gr(!1)},refreshSideBar:function(i,r){function w(){s=!1;fh(r);r.push({text:t.Grid,icon:"grid",selected:v,callback:function(){v||e.viewStyle("Grid")}});r.push({text:t.Cards,icon:"bullets",selected:y,callback:function(){y||e.viewStyle("Cards")}});e.tagged("supports-view-style-map")&&r.push({text:t.Map,icon:"location",selected:p,callback:function(){p||e.viewStyle("Map")}});fh(r)}var b=this,k=lf().find(".ui-panel-inner"),c=n.pageInfo(),u=c&&c.dataView,f=u&&u.get_parentDataView(u),o=[],l=$(".TaskBox.About .Inner .Value"),a=f&&!f._parentDataViewId,s=u&&u.get_isGrid(),e=u&&u.extension(),h=s&&e.viewStyle(),v=h=="Grid",y=h=="Cards"||h=="List",p=h=="Map",d={items:r};if(a){for(u=f;u;)u.get_showInSummary()&&!u.get_isInserting()&&u.extension().commandRow()&&o.unshift(u),u=$app.find(u._filterSource);$(o).each(function(){n.enumerateFields(this,r)});r.length&&(u=o[o.length-1],r.push({text:u.get_view().Label,icon:"info",callback:function(){n.infoView(u,!0)}}),r.push({}))}$(i).each(function(){var n=this;["back","check","info"].indexOf(n.icon)!=-1||n.system&&n.toolbar==!1||n.icon=="eye"&&(!f||f.get_showInSummary())||(n.text||r.length)&&(n.navigateTo&&s&&w(),n.theme=null,r.push(n))});s?w():l.length&&a!=!1&&r.push({text:l.html(),isStatic:!0,wrap:!0})},contextPageInfo:function(){return n.pageInfo(this._contextScope)},refreshContext:function(){k()},contextScope:function(n){if(arguments.length==0)return this._contextScope;this._contextScope=n},contextDataView:function(){return this.contextPageInfo().dataView},showContextMenu:function(t){var i="#app-panel-context";t&&(this.contextScope(t.scope),t.scope&&(i+="-scope",t.position="left"));rc(i,function(){n.refreshContextMenu(i)},t).panel("toggle")},refreshContextMenu:function(n,i){var o=this,r=$(n),f=r.find("ul"),a=f.outerHeight(),h,c,e=r.is(".app-sidebar"),s,l;if(e&&!r.is(":visible")){i=[];o.navContext(i);o.refreshAppButtons(i);return}for(e&&(c=$("<div><\/div>").appendTo(u).css({"z-index":2e3,position:"absolute",left:0,top:r.css("top"),width:r.outerWidth(),height:tt.height(),"background-color":"#fff"})),a&&(h=$("<div><\/div>").height(a).insertAfter(f)),ki(f),f.find("a").data("context-action",null),f.find("li").remove(),i||(i=[],i.isSideBar=e,o.navContext(i)),e&&(o.refreshAppButtons(i),l=[],this.refreshSideBar(i,l),i=l),s=$.Event(e?"sidebar.app":"contextmenu.app"),s.context=i,s.panel=r,$(document).trigger(s);i.length&&!i[i.length-1].text&&!i[i.length-1].src;)i.splice(i.length-1);i.length||e||i.push({text:t.EmptyContext});this.renderContext(f,i);f.listview("refresh");e&&f.find("a.ui-btn-icon-right").removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left");f.find("li.app-wrap").addClass("ui-li-static ui-body-a").find("a").attr({"class":""});r.is(".app-reset-scrolling")?r.find(".ui-panel-inner").scrollTop(0):ha(r);h&&h.remove();c&&c.remove()},masterDetailStatus:function(n){var u=this.pageInfo(n),t,i;if(u!=null&&(t=u.dataView,t&&t._filterSource&&(i=$app.find(t._filterSource),i))){var f=i.extension(),e=f.itemMap(),s=i._allFields,o=f.commandRow(),r;e&&o&&(r=s[e.heading],v=o[r.Index],v=r.text(v),this._masterHeading=v)}},focus:function(t,r){var y=this,a=i.activePage,u=a.find(".app-field-"+t),f,e,o,c,s=$(".app-popup-message"),h=a.find(".app-tabs-form"),l,v;s.length||u.length&&(f=u.closest("li"),u.attr("type")=="hidden"&&(u=f.find('input[type="text"]')),h.length&&(l=n.dataView(),v=l.findField(t),$(l._categories).each(function(){var n=this;if(n.Index==v.CategoryIndex)return h.find(".ui-btn").each(function(){var t=$(this);if(n.Tab==t.text())return t.is(".ui-btn-active")||t.trigger("vclick"),!1}),!1})),u.closest(".ui-collapsible").find(".ui-collapsible-heading-collapsed .ui-btn").trigger("vclick",!1),o=y.screen(),e=f.offset().top,(e<o.top||e+f.outerHeight()>o.bottom-(h.length?h.outerHeight():0))&&(c=e-(o.height-f.outerHeight())/2,tt.scrollTop(c>0?c:0)),s=$('<div class="ui-content app-popup-message"/>').html(r).popup({history:!1,arrow:"t,b",overlayTheme:"b",positionTo:u,afteropen:function(){},afterclose:function(){ai(s);u.focus()}}).popup("open").on("vclick",function(){return st(s),!1}))},showLookup:function(n){var l=this.pageInfo(),o=l.dataView,t=n.field,s=t._dataView,h=s.get_contextFilter(t,s.extension().collect()),i,r,f,e=n.query,c=n.aliasField.HeaderText;this.modalDataView();i=n.field.ItemsDataController.toLowerCase();$find(i)&&(i+=Sys.Application.getComponents().length);e&&oi(i+"_"+(oi(i+"_viewId")||t.ItemsDataView||"grid1")+"_filter",[String.format("_quickfind_:~%js%{0}",Sys.Serialization.JavaScriptSerializer.serialize(e))]);r=$create(Web.DataView,{id:i,baseUrl:o.get_baseUrl(),servicePath:o.get_servicePath(),controller:t.ItemsDataController,viewId:t.ItemsDataView,externalFilter:s.get_contextFilter(t,h),externalFilter:h,filterSource:h.length>0?"Context":null,showSearchBar:!0,showFirstLetters:t.ItemsLetters,searchOnStart:t.SearchOnStart,description:t.ItemsDescription},null,null,$("<div>").hide().appendTo(u).attr("id",i+"Placeholder")[0]);f=this.pageInfo(r._id);e&&r.viewProp("quickFind",e);f.headerText=n.value?[n.text,c]:c;f.resolved=!0;r._lookupInfo=n;n.value==null||t.ItemsValueSyncDisabled||(r._syncKey=[n.value],r._selectedKey=[n.value]);r._parentDataViewId=o._id;this.modalDataView(f.id)},pageInit:function(n,t){var i=this.pageInfo(n),r,u;return i==null?!1:(r=i.dataView,u=i.initialized||!i.dataView&&i.initialized!=!1,r&&r._busy())?!1:(i.initialized||(i.initialized=!0,r&&(i.requiresInitCallback=!0,t!=!1&&it(!0),i.refreshed==!1?(i.refreshed=!0,r.extension().refresh()):r._loadPage())),u)},pageShow:function(n){var t;if(i.activePage&&(i.activePage.find("[data-role='navbar'] a.app-tab-active").addClass("ui-btn-active"),t=this.pageInfo(n),t!=null)){var r=t.dataView,u=r?r.extension():null,f=this._modalStack.indexOf(t);f>=0&&this._modalStack.splice(f,1);t.initialized||(t.initialized=!0,r&&r._loadPage());u&&u._reset&&u.refresh()}},screen:function(){var n=i.window.scrollTop(),t=this.toolbar().outerHeight(),r=i.getScreenHeight();return{top:n+t,bottom:n+i.getScreenHeight(),height:r-t,width:tt.width()}},callWhenVisible:function(n,t){i.activePage.find(n).each(function(){var n=$(this),i=n.offset().top,u=i+n.outerHeight(),e=n.closest(".app-wrapper"),r=e.offset().top,f=r+e.height()-1;(r<=i&&i<=f||r<=u&&u<=f||i<=r&&f<=u)&&t(n)})},asyncJob:function(){return this._asyncJob},nextAsycJob:function(){return++this._asyncJob},supports:function(n){switch(n){case"Map":return this._supportsMap==!0}return!1},registerAPI:function(n){var t=this,i="https://maps.googleapis.com/maps/api/js?&v=3.exp&sensor=false&callback=appFactoryCallback";r.mapApiIdentifier&&!w.location.host.match(/^localhost\b/)&&(i+="&"+r.mapApiIdentifier);n!="Map"||t._mapApiRegistered||(t._mapApiRegistered=!0,w.appFactoryCallback=function(){w.appFactoryCallback=null;t._supportsMap=!0;$(document).trigger($.Event("appmapinit"))},$('<script type="text/javascript"/>').attr("src",i).appendTo(u))},fetchOnDemand:function(){function n(n){n.trigger("vclick")}return fi||(this.callWhenVisible(".dv-load-at-bottom",n),this.callWhenVisible(".dv-load-at-top",n)),this},headingOnDemand:function(n){var o=this,t=i.activePage.find(".dv-heading"),f=t.attr("data-selector"),e=f?i.activePage.find(f):t.find(".app-static-text"),r=o.headingBar(),h,c=!0,u,l;if(!a&&(e.length||f))if(n===!1)u=r.find(".app-grid-header"),u.length?u.is(".app-disabled")||r.slideUp("fast",function(){l=u.parent();u.detach();l.empty();u.appendTo(l);r.slideDown("fast");u.addClass("app-disabled");u=t.find(".app-grid-header").detach();t.empty();u.appendTo(t)}):(t.addClass("app-disabled"),r.slideUp("fast")),c=!1;else if(!t.is(".app-disabled")&&!s){var p=o.screen(),w=Math.ceil(e.length?e.offset().top+(f?1:0):-1),v,y=i.activePage.find("> .ui-content > .app-tabs");w<p.top&&(f||e.height()>0)&&(r.is(":visible")?c=!1:(h=r.css("top",o.toolbar().outerHeight()+(y.length?y.outerHeight():0)-1+"px").find("span.app-bar-text"),f?(h.html(t.html()).css("white-space","normal"),v=t.prev().find(".app-yardstick").attr("data-yardstick-class"),v&&h.find(".app-grid-header").attr("class","app-grid-header "+v)):h.text(e.text()).css("white-space",""),r.find("span.app-bar-label").text(e.closest("li").find("label:first").text()),c=!1,r.show()))}return c&&r.hide(),o},wait:function(){},start:function(t){function g(n){return $(n).each(function(){return this.url&&this.url.toLowerCase()==location.pathname.toLowerCase()?(h=this,!1):this.children&&(g(this.children),h)?(this.selected=!0,!1):void 0}),null}function tt(){var n=t&&$(t.selector).data("scripts");n&&eval(n);$(document).trigger($.Event("start.app"));setInterval(function(){yi.length&&!tf&&(tf=yi[0],$(document).trigger($.Event("calculate.app"),tf))},300)}function it(){n.tabs("create",{tabs:a,className:"app-tabs-echo",change:function(){ct()}})}var k,h,d;if(t||this._appLoaded&&this._pageCreated){i.ignoreContentEnabled=!0;var f=n.pageMenu(t&&t.pageId),p=0,s,b=$(t&&t.selector||"#PageContent"),e=b.attr("data-href"),y=b.find('div[data-app-role="page"]').each(function(i){var r=$(this),s=r.attr("data-content-framework");s&&r.attr("data-enhance","false");r=$(this).attr({"data-role":"page","data-app-role":null}).addClass("app-page-scrollable").appendTo(u);var a=r.attr("data-page-header"),h=tc(r),o={text:(a!="false"?a:"")||h.text||n.title(),description:h.description,activator:h,url:e,transition:t&&t.transition},c=r.attr("id")||ws(e||location.pathname)+(i>0||e?i+1:""),v,l;o.headerText=o.text;r.find('div[data-role="content"]').contents().wrapAll('<div class="app-page-content'+(s?" app-content-framework app-"+s:"")+'"/>');r.page();r.attr("id",c);o.id=c;n.pageInfo(o);l=pe(r,!1).find(".app-page-content");s&&(r.attr("data-page-header","false"),$app.configureFramework(s,l,function(n){kr=n}));l.find(".carousel").on("swipeleft swiperight",function(n){$(n.target).closest(".carousel").find((n.type=="swipeleft"?".right":".left")+".carousel-control").trigger("click")});h.text&&(p++,v=$('<a class="app-action-navigate" />').attr("href","#"+c).text(h.text).appendTo($("<li/>").appendTo(f)),o.description&&$("<p/>").appendTo(v).text(o.description));le(r)});y.length&&(s=y.first(),p==0&&s.attr("data-activator")!="false"&&$('<a class="app-action-navigate" />').attr("href","#"+s.attr("id")).text(s.attr("data-page-header")||os.SeeAlso).appendTo($("<li/>").appendTo(f)),f.is(".ui-listview")&&f.listview().listview("refresh"));for(d in Web.Menu.Nodes){k=Web.Menu.Nodes[d];break}t||g(k);h&&!y.length&&f.find("a").length==0&&$(h.children).each(function(){$('<a rel="external"/>').attr("href",this.url).appendTo($("<li/>").appendTo(f)).text(this.title)});var rt=this,o=t?n.page(t.pageId):i.activePage,c=o.find("a.app-action-navigate"),ft=location.href.match(/#(.+)$/),f,l,a=[],v,nt=this._pages[0];c.length==1&&(r.initialListMode=="SeeAll"||!nt.dataView||nt.dataView.get_lastCommandName()||w.location.href.match(/_controller=.+_commandName=.+/))?$(this._pages).each(function(){var n=this,t=n.dataView;return ys=t&&t._id,(!e||n.url==e&&!n.root)&&(!t||!t._hidden)?(e||(n.home=!0,e=i.path.documentBase.pathname),tt(),i.navigate.history.clearForward(),e&&(n.replaceUrl=e),rt.changePage(n.id),!1):void 0}):o.attr("id")=="Main"&&(c.length&&o.find('a[rel="external"]').parent().remove(),c.show(),pe(o),o.addClass("app-page-scrollable"),ut(document.title),l=o.find(".app-wrapper"),$(c).each(function(){var u=$(this),f=u.attr("href"),r=f&&n.pageInfo(f.substring(1)),i,e,t;r&&r.dataView&&(t=r.activator,t&&t.type=="Tab"&&($(a).each(function(){if(this.text==t.text)return i=this,!1}),i||(v!=t.container&&(v&&(it(),a=[]),v=t.container),i={text:t.text,content:[]},a.push(i))),e=gh(r.id,l),i&&i.content.push(e),u.parent().remove())}),v&&it(),f=n.pageMenu(),f.find('a.app-action-navigate,a[rel="external"]').length?f.listview().show():f.remove(),wt(),l.find(".app-tabs").length>1&&$('<div class="app-stub-main"/>').appendTo(l),tt(),ct(),n.content().focus(),wh());t||setTimeout(function(){ps=!1},500)}},pageMenu:function(n){var r=this,i=this.content(n),t=i.find("ul.app-page-menu");return t.length||(t=$('<ul data-role="listview" data-inset="false" class="app-page-menu"/>').appendTo(i).hide().on("vclick",function(n){var t=$(n.target),i,u;return t.is("a")||(t=t.closest("a")),t.length&&(i=t.attr("href"),u=i.match(/^#/),u||li(),e(t,function(){u?r.changePage(i.substring(1)):(o(t,!1),w.location.href=i)})),!1})),t},initialize:function(){function c(){var n=fr(),t;if(n-e>2500){if(t=$.Event("awake.app"),$(document).trigger(t),t.isDefaultPrevented())return;n=fr()}e=n;setTimeout(c,1250)}var l=this,e=fr(),t=i.path.parseUrl(location.href),r=t&&t.hash,u,h=$("head");fa();r&&(r.match(/\W/)||!$(r).length)&&(i.navigate.history.initialDst="",u=i.navigate.history.stack[0],u.url=t.hrefNoHash,u.hash="");et?$('<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black'+(hu>=8?"-translucent":"")+'"/><link rel="apple-touch-icon" href="../touch/logo-icon.png"/>').appendTo(h):ir&&$('<meta name="mobile-web-app-capable" content="yes"/><link rel="icon" sizes="196x196" href="../touch/logo-icon.png"/>').appendTo(h);setTimeout(c,10);__settings.appInfo.match(/\|$/)||$("#app-welcome").remove();$(document).on("change",":input",function(n){var t=$(n.target),i=t.attr("data-passive-value");(i==null||i!=t.val())&&of(t);i!=null&&t.attr("data-passive-value",null)}).on("keydown",":input",function(n){var t=$(n.target),i=t.attr("data-causes-calculate");i&&(nf==null&&(nf=t.val()),no(),gu=setTimeout(function(){nf!=t.val()&&(t.attr("data-passive-value",t.val()),of(t));no(!0)},4e3))}).on("focus",":input",function(t){var i=$(t.target),h=i.parent(),r=i.data("format"),e,u;i.is("#app-input-search")||(s=i,o(),i.is(".app-lookup-input")&&i.next().addClass("ui-focus"),ft(),r&&(e=i.val(),e&&r.type=="number"&&(i.val(r.value),u=i.val().length,i.get(0).setSelectionRange(u,u)),et?setTimeout(function(){i.attr("type",r.type)},200):i.attr("type",r.type)),f()||(clearTimeout(ss),n.toolbar().css("position","absolute"),$(".app-sidebar").css("position","absolute")))}).on("blur",":input",function(t){var r,e,u,o=$(t.target),i=o.data("format");(no(!0),s)&&(s.is(".app-lookup-input")&&(e=s.data("link-text"),r=s.data("link-text",null).next().removeClass("ui-focus"),e&&(r.toggleClass("ui-icon-carat-r ui-icon-search").removeClass("app-transparent"),setTimeout(function(){r.data("link-text")&&r.text(e)},2500)),u=s.val().trim(),u&&(r.text(u).data("data-context").query=u),s.val("")),s=null,i&&(i.value=o.val(),i.value=i.value?parseFloat(i.value):null,i.text=i.value==null?"":i.field.text(i.value,!1),o.attr("type","text").val(i.text)),f()||(ss=setTimeout(function(){s||(n.toolbar().css("position",""),$(".app-sidebar").css("position",""))},1e3)))}).on("touchstart","a.app-lookup",function(){if(s){var n=s.val().trim();n&&s.next().text(n).removeClass("app-transparent")}}).on("touchend","a.app-lookup",function(){d()}).on("keydown",function(n){var i=n.which,r,t;if(i==13&&!$(n.target).is("textarea")){if(s)return s.is(".app-lookup-input")?(r=s.val().trim(),(r.length||yt)&&(s.next().data("data-context").query=r,s.next().trigger("vclick"))):bt()?setTimeout(function(){s&&s.blur();uu(!0)},200):setTimeout(function(){s&&s.blur()},200),!1;bt()&&(t=$(".ui-popup-active"),t.length?t.find(".ui-listview .ui-btn").length||$(".ui-popup-active .ui-popup").popup("close"):uu(!0))}if(!s&&(i==13||i==32||i==27)&&(t=$(".ui-popup-active .app-popup"),t.length)){if(t.is(".app-popup-alert"))return t.find(".ui-btn").trigger("vclick"),!1;if(t.is(".app-popup-confirm")&&i!=32)return t.find(i==13?".app-btn-confirm":".ui-btn:not(.app-btn-confirm)").trigger("vclick"),!1}}).on("keyup",".app-lookup-input",function(n){var t=$(n.target),i=t.next();t.data("link-text")||setTimeout(function(){t.val()!=""&&(t.data("link-text",i.text()),i.html("&nbsp;").toggleClass("ui-icon-carat-r ui-icon-search app-transparent"))},10)})}},function(){var h,r,w,b,c,v;$.event.special.swipe.scrollSupressionThreshold=100;var g=/\b_touch_(\w+)=(\w+)\b/g.exec(location.href),y=i.focusPage;i.focusPage=function(n){y(n);wt(n);nu(n)};i.resetActivePageHeight=function(t){var r=$("."+i.activePageClass);typeof t=="number"&&t--;t=t||i.getScreenHeight();t-=n.toolbar().outerHeight(!0);r.css("min-height",t)};u=$("body");yt&&u.addClass("app-desktop");si&&navigator.maxTouchPoints>0&&(u.addClass("app-ms-tablet").removeClass("app-desktop"),us="touch");$("form:first").hide();var f=$('<div id="app-bar-tools" data-role="header" data-position="fixed" data-theme="a" class="app-bar-tools"/>"').appendTo(u),p=$('<div data-role="page" id="Main"/>').appendTo(u),s='<a href="#" class="ui-btn-right app-btn ui-btn ui-btn-icon-notext ui-shadow ui-corner-all"/>',nt=$('<a class="ui-btn ui-btn-a ui-btn-icon-notext app-btn-promo"/>').hide().appendTo(u).on("vclick",ul);$('<div data-role="content" class="app-content-main"/>"').appendTo(p);$('<a data-role="button" href="#" id="app-btn-menu" class="ui-btn ui-btn-icon-notext ui-shadow ui-corner-all ui-icon-bars app-animation-spin">Site Map<\/a>').appendTo(f);h=$('<h1 class="ui-title"/>').appendTo(f);r=$('<div class="app-btn-cluster-right"/>').appendTo(f);h.on("vclick",function(){a||$(".app-popup-message").length||(h.addClass("ui-btn-active"),setTimeout(function(){h.removeClass("ui-btn-active");l()=="taskassistant"?history.go(-1):dh()},200))});$(s).appendTo(r);$(s).appendTo(r);$(s).appendTo(r);$(s).appendTo(r);$(s).appendTo(r);$('<a href="#" id="app-btn-context" data-icon="dots" data-iconpos="notext" data-role="button" class="ui-btn-right app-btn-context"/>').appendTo(r).attr("title",t.More).hide();w=$('<div id="app-bar-heading" class="app-bar-heading ui-overlay-shadow"><span class="app-bar-label"/><span class="app-bar-text"/><\/div>').appendTo(u).hide().on("vclick",function(n){if(!$(n.target).closest(".app-grid-header").length)return vt(!1),k(),!1});b=f.find(".app-btn").data("icon","gear").on("vclick",ul);f.toolbar();c=$('<div id="app-sidebar" class="ui-panel ui-panel-fixed ui-body-a app-sidebar"><div class="ui-panel-inner"><ul/><\/div><\/div>').appendTo(u);v=c.find("ul");v.listview().on("vclick",function(t){if(rr||!dt(t.target))return!1;d();var i=$(t.target).closest("a"),r=i.data("context-action");if(i.length){if(r)return n.busy()||e(i,function(){at(r)}),!1;o(i,!1)}})}();n=$app.touch=$app.mobile=new Web.Mobile;n.activeLinkBlacklist=".ui-slider-handle";u.on("pagebeforeload",function(n,t){n.preventDefault();setTimeout(function(){location.replace(t.toPage)},200)}).on("pagecontainershow",function(){function i(){ci&&(ci(),ci=null,t&&t.returnCallback&&(t.returnCallback(),t.returnCallback=null))}iu(!1);wh();vt();gt(100);setTimeout(function(){ct()},200);k();var t=n.pageInfo();t?t.initCallback?(t.initCallback(),t.initCallback=null):i():l()=="Main"&&i()}).on("pagecontainercreate",function(){n._shown||setTimeout(function(){n.start();n._shown=!0},100)}).on("pagecontainerbeforeshow",function(t,r){var e=i.activePage,f=n.pageInfo();n.toolbar(n.title());u.is(".app-page-header-hidden")?ut(!1):ut(f&&f.headerText||f&&f.dataView&&f.dataView.get_view().Label||document.title);n.pageShow(l());n.unloadPage(r.prevPage,e);ke();n.contextScope(null)}).on("pagecontainerbeforehide",function(t,i){if(a=!0,i.nextPage){var r=n.pageInfo(i.nextPage.attr("id"));r&&n.masterDetailStatus(r.id)}}).on("pagecontainerbeforetransition",function(){n.promo(!1);ve(i.activePage)}).on("pagecontainertransition",function(){r&&(iu(!1),wt(),r.pageTransition=="none"&&nu(i.activePage),yt&&$(i.activePage).find(".app-wrapper").focus())});$(document).ready(function(){n.initialize()}).on("calculate.app",function(t,i){var i=i.split(/\./),r;if(i[i.length-1]=="app")return r=n.pageInfo(i[1]).dataView,r.extension().calculate(i[0]),!1}).on("touchstart MSPointerDown pointerdown",function(t){if(!s&&ne(t)){if(a){t.preventDefault();return}te=s==null;var r=$(t.target),i=r.closest("a"),u=ts=ns(t);r.closest(".app-echo").length&&(te=!1);i.length&&(di=i.data("touch-start",u),i.is(n.activeLinkBlacklist)||(i.parent().is("li")?fl=setTimeout(function(){di&&o(di,!1)},200):o(i,!1)))}}).on("touchmove MSPointerMove pointermove",function(n){if(ne(n)){var r,t=$(n.target),u=$(di),f=t.closest(".ui-panel-inner,.app-wrapper"),i=ns(n),e=u.length&&u.data("touch-start"),s;if(et&&(t.closest(".app-tabs,.app-map-info").length||t.closest(".app-bar-tools").length&&!t.closest(".ui-btn").length)){n.preventDefault();return}if(te){if(te=!1,f.length&&(i.y>ts.y?r=f.scrollTop()==0:i.y<ts.y&&(s=ye(f),r=s.height>=s.maxHeight-1)),r){ie();o();n.preventDefault();et&&(fi=!1);return}if(t.is(".ui-panel-dismiss,.ui-popup-screen,.app-scrollable-cover")){n.preventDefault();return}}u.length&&(e&&(Math.abs(e.x-i.x)>0||Math.abs(e.y-i.y)>0)&&o(),ie())}}).on("touchend MSPointerUp pointerup",function(n){if(ne(n)){var t=$(n.target).closest("a"),r=ns(n),i=t.length&&t.data("touch-start");t.length&&(!i||Math.abs(i.x-r.x)>0||Math.abs(i.y-r.y)>0)&&n.preventDefault();ie()}}).on("touchcancel MSPointerCancel pointercancel",function(n){ne(n)&&(o(),ie())}).on("scrollstart.app",function(){ke()}).on("scrolldir.app scrollstop.app",function(t){if(t.relatedTarget){var f=$(t.relatedTarget),u=f.data("scroll-dir"),r=t.relatedTarget.find("ul:first").is(".app-grid"),i=r?n.headingBar().find(".app-grid-desc"):null;u=="up"?(r&&i.length&&!i.is(":visible")&&i.show(),vt()):u=="down"&&(r&&t.relatedTarget.scrollTop()!=0?r&&(i.length&&i.is(":visible")&&i.hide(),vt()):ft());t.type=="scrollstop"&&(clearInterval(hs),hs=setTimeout(function(n){var t=ye(n);t.top<=0&&t.height<=t.maxHeight+1&&(gt(),ct())},250,t.relatedTarget))}}).on("contextmenu MSHoldVisual selectstart",function(n){f()||$(n.target).is(":input")?$(".ui-popup-active").length&&($(".ui-popup-active .ui-popup").popup("close"),n.preventDefault()):n.preventDefault()}).one("pagecreate","#Main",function(){n._pageCreated=!0}).on("pagebeforechange",function(t,i){if(typeof i.toPage=="string"&&i.toPage.match(/^http/))return(iu(!1),ps&&l()=="Main"&&location.href==i.toPage)?!1:void 0;if(i.options.deferred){var e=n.pageInfo(),f=$(i.toPage),r=n.pageInfo(f.attr("id")),u=r&&r.dataView;r&&!i.toPage.prevObject||(ft(),extension=u&&u.extension(),n.search("configure",{allow:extension?extension.options().quickFind:!1}))}}).on("vmousedown",".app-static-label",function(){dl=s}).on("dblclick",".app-yardstick",function(n){if(ae(n)){hf();var i=$(n.currentTarget).attr("class").match(/app-width(\d+)/),t=$('<div class="ui-content app-popup-message"/>').text(String.format("Item Width: {0}em",i[1])).popup({history:!1,arrow:"b,t",x:n.clientX,y:n.clientY,overlayTheme:"b",afteropen:function(){},afterclose:function(){ai(t)}}).popup("open").on("vclick",function(){return st(t),!1});return!1}}).on("dblclick",".app-static-text",function(t){var f;if(!ui&&(hf(),f=n.pageInfo(),f)){var r=f.dataView,e=r?r._allFields:null,u=$(t.target).attr("class").match(/(app-field-(\w+))/);return u&&r&&(ee=!1,r.extension().executeInContext("Edit",null,!0),setTimeout(function(){$(e).each(function(){if(e[this.AliasIndex].Name==u[2])return u=this.Name,!1});var n=i.activePage.find("*:input.app-field-"+u),t=n.parent().find(".app-lookup-input"),r=t.length?t:n;r.focus().select();ee=!0},500)),!1}}).on("vclick","a",ov).on("vclick",".app-input-value",function(n){return $(n.target).prev().focus(),!1}).on("vclick",".app-filter",function(){}).on("vclick contextmenu",".app-grid-header > span:not(.app-btn-more)",function(n){var t=$(n.target),i={x:n.pageX,y:null};return t.is(".app-indicator")&&(t=t.parent()),t.addClass("ui-btn-active"),i.x&&(i.y=t.offset().top+t.outerHeight()*.75),n.preventDefault(),setTimeout(function(){t.removeClass("ui-btn-active");tl(t,i)},200),!1}).on("keydown keypress",function(t){var w=$(t.target),b=n._toolbar,a=t.type=="keydown",e,k=t.key,v=t.keyCode,r,o=a&&(v==114||v==70&&t.ctrlKey),h=a&&v==27,c,y,p,f;if(!a||h||o){if(!s&&!w.is("#app-input-search")&&(e=String.fromCharCode(t.which),e.match(/[\w\-\"]/)||h||o)){if(bt()&&!ei){if(o)return setTimeout(function(){kh(n._contextButton)}),!1;if(h&&!u.find(".ui-popup-active").length)return ks(),!1}else if(l()=="taskassistant"&&h)return ks(),!1;if(c=i.activePage.find(".app-wrapper"),c.length&&(y=c.offset().top,p=y+c.height()-1,i.activePage.find(".app-echo-controls .ui-btn.ui-icon-search").each(function(){var n=$(this),t;if(n.is(":visible")&&(t=n.offset().top,t>=y&&t<p-75))return r=n,f=$app.find(n.closest(".app-echo").attr("data-for")),!1})),r||(r=b.find(".ui-icon-search:visible"),f=n.dataView()),r.length){if(h)if(f&&f.extension().quickFind())th(f,""),su(f),we(r);else return!1;else if(o)r.trigger("vclick",!1),we(r);else if(t.type=="keypress"){if(bt())return;ei!=null&&(e=ei+e);ei=e;ei.length==1&&(r.trigger("vclick",!1),we(r))}return!1}}if(o)return!1}});tt.on("resize",function(){is||(is=!0,cf(),$(".app-echo-controls").hide(),n._toolbarButtons.hide())}).on("throttledresize",function(){is=!1;se();$(".ui-panel-dismiss").height(i.getScreenHeight());f()&&wt();k(!1,null,function(){ft();vt();or()});gt();clearTimeout(ls);ls=setTimeout(function(){var r=i.activePage.find(".app-wrapper"),t;sf(r,!0);ct(!0);ct(!1);n.refreshMenuStrip();t=l();$(n._pages).each(function(){var n=this;n.echoId&&n.id!=t&&$("#"+n.echoId+" .app-echo-controls").addClass("app-stale")})},1e3);var t=$(".ui-popup");t.is(".app-popup-message,.app-popup-listview")?st(t):t.popup("reposition",{positionTo:"window"});ui=!1}).on("orientationchange",function(){setTimeout(function(){s||wt();setTimeout(function(){s||wt()},500)},500)});Sys.Application.add_init(function(){});Sys.Application.add_load(function(){n._appLoaded=!0});Web.DataView.MobileGrid.registerClass("Web.DataView.MobileGrid",Web.DataView.MobileBase);Web.DataView.MobileForm.registerClass("Web.DataView.MobileForm",Web.DataView.MobileBase)})()